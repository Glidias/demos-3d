var MyCtrl=pc.createScript("myCtrl");MyCtrl.attributes.add("Armor",{type:"number",title:"Armor",default:10}),MyCtrl.attributes.add("GunBase",{type:"entity",title:"GunBase Obj"}),MyCtrl.attributes.add("Gun",{type:"entity",title:"Gun Obj"}),MyCtrl.attributes.add("Bullet",{type:"entity",title:"Bullet"}),MyCtrl.attributes.add("MuzzleFlash",{type:"entity",title:"MuzzleFlash"}),MyCtrl.attributes.add("MuzzleFlashCtrl",{type:"entity",title:"MuzzleFlashCtrl"}),MyCtrl.attributes.add("forceForward",{type:"number",default:9}),MyCtrl.attributes.add("forceReverse",{type:"number",default:4.5}),MyCtrl.attributes.add("forceTurn",{type:"number",default:3});var reload=0;MyCtrl.prototype.initialize=function(){this.entity.on("Damage",this.onDamage,this)},MyCtrl.prototype.initialize=function(){this.vehicle=this.entity.script.vehicle},MyCtrl.prototype.update=function(t){var e=0;this.app.keyboard.isPressed(pc.KEY_W)&&(e=1,this.vehicle.applyForce(this.entity.forward.scale(-this.forceForward),null,e)),this.app.keyboard.isPressed(pc.KEY_S)&&(e=2,this.vehicle.applyForce(this.entity.forward.scale(this.forceReverse),null,e)),this.app.keyboard.wasPressed(pc.KEY_M)&&(this.vehicle.orientStyle=2===this.vehicle.orientStyle?4:2);var i=2===e?-1:1;(this.app.keyboard.isPressed(pc.KEY_A)&&1===e||this.app.keyboard.isPressed(pc.KEY_D)&&2===e)&&this.vehicle.applyForce(this.entity.right.scale(this.forceTurn*i),this.entity.forward.scale(-2),e,1),(this.app.keyboard.isPressed(pc.KEY_D)&&1===e||this.app.keyboard.isPressed(pc.KEY_A)&&2===e)&&this.vehicle.applyForce(this.entity.right.scale(-this.forceTurn*i),this.entity.forward.scale(-2),e,-1),this.app.keyboard.isPressed(pc.KEY_NUMPAD_4)&&this.GunBase.rotateLocal(0,20*t,0),this.app.keyboard.isPressed(pc.KEY_NUMPAD_6)&&this.GunBase.rotateLocal(0,-20*t,0);var s=this.Gun.getLocalRotation().getEulerAngles().x;this.app.keyboard.isPressed(pc.KEY_NUMPAD_8)&&s>-80&&this.Gun.rotateLocal(-20*t,0,0),this.app.keyboard.isPressed(pc.KEY_NUMPAD_5)&&s<3&&this.Gun.rotateLocal(20*t,0,0);var r="ProtoType\n---\n";r+="Speed:0km/h\n",r+="Gun Dir:"+Math.floor(this.GunBase.getLocalRotation().getEulerAngles().y)+"\n",r+="Gun Ang:"+(s=-1*Math.floor(s))+"\n";var a=this.Gun.getPosition(),o=this.Gun.getPosition().clone().add(this.Gun.forward.scale(-1e3)),l=this.app.systems.rigidbody.raycastFirst(a,o);if(r+=l?"Trgt Dis:"+Math.floor(a.distance(l.point))+"\n":"Trgt Dis:Out Of Range\n",r+="Armor:"+this.Armor+"\n",r+="OrientMode:"+this.vehicle.orientStyle+"\n",this.app.fire("reloadDisplayText",r),reload+=t,this.app.keyboard.isPressed(pc.KEY_SPACE)&&reload>.2){var n=this.Bullet.clone();if(this.entity.root.addChild(n),n.rigidbody){n.rigidbody.enabled=!0;var d=this.Gun.getPosition().clone().add(this.Gun.forward.scale(-2));n.rigidbody.teleport(d,this.Gun.getRotation()),n.rigidbody.applyImpulse(n.forward.scale(-2))}else{n.setPosition(this.Gun.getPosition());var h=new pc.Quat;h.setFromAxisAngle(this.Gun.up,180),h.mul(this.Gun.getRotation()),n.setRotation(h),n.translate(n.forward.scale(2)),n.script.scripts[0].fire("ModeChange",1)}reload=0,this.MuzzleFlash.setPosition(n.getPosition()),this.MuzzleFlash.particlesystem.reset(),this.MuzzleFlash.particlesystem.play(),this.MuzzleFlashCtrl.fire("start")}},MyCtrl.prototype.onDamage=function(t){--this.Armor};var TargetCamera=pc.createScript("targetCamera");TargetCamera.attributes.add("target",{type:"entity",title:"Target Obj"}),TargetCamera.attributes.add("subCam",{type:"entity",title:"Sub Camera"}),TargetCamera.attributes.add("GunCam",{type:"entity",title:"Gun Camera"});var mode=0;TargetCamera.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),this.onCamChange()},TargetCamera.prototype.update=function(e){this.entity.lookAt(this.target.getPosition()),this.entity.camera.enabled&&(this.app.keyboard.isPressed(pc.KEY_Z)&&this.entity.translate(0,.5,0),this.app.keyboard.isPressed(pc.KEY_X)&&this.entity.translate(0,-.5,0)),0===this.GunCam.camera.rect.x&&(this.app.keyboard.isPressed(pc.KEY_Z)&&this.GunCam.camera.fov<45&&(this.GunCam.camera.fov+=1),this.app.keyboard.isPressed(pc.KEY_X)&&this.GunCam.camera.fov>1&&(this.GunCam.camera.fov-=1))},TargetCamera.prototype.onKeyUp=function(e){e.key===pc.KEY_C&&this.onCamChange()},TargetCamera.prototype.onCamChange=function(){this.entity.camera.enabled=!1,this.subCam.enabled=!1;var e=new pc.Vec4(.75,.75,.25,.25);if(this.GunCam.camera.rect=e,0===mode)this.entity.camera.enabled=!0,mode=1;else if(1===mode)this.subCam.enabled=!0,mode=2;else if(2===mode){this.GunCam.enabled=!0;var a=new pc.Vec4(0,0,1,1);this.GunCam.camera.rect=a,mode=0}console.log(this.GunCam.camera.rect)};var Movement=pc.createScript("movement");Movement.prototype.initialize=function(){},Movement.prototype.update=function(t){this.app.keyboard.isPressed(pc.KEY_LEFT)&&this.entity.translate(-.1,0,0),this.app.keyboard.isPressed(pc.KEY_RIGHT)&&this.entity.translate(.1,0,0),this.app.keyboard.isPressed(pc.KEY_UP)&&this.entity.translate(0,0,-.1),this.app.keyboard.isPressed(pc.KEY_DOWN)&&this.entity.translate(0,0,.1)};var DisplayCtrl=pc.createScript("displayCtrl");DisplayCtrl.attributes.add("DisplayText",{type:"entity",title:"DisplayText"}),DisplayCtrl.prototype.initialize=function(){this.app.on("reloadDisplayText",this.onReloadDisplayText,this)},DisplayCtrl.prototype.update=function(t){},DisplayCtrl.prototype.onReloadDisplayText=function(t){this.DisplayText.element.text=t};var Bullet=pc.createScript("bullet");Bullet.attributes.add("Mode",{type:"number",title:"Mode",default:0}),Bullet.attributes.add("G",{type:"vec3",title:"G"}),Bullet.attributes.add("Spark",{type:"entity",title:"Spark"}),Bullet.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this),this.entity.collision.on("contact",this.onContact,this),this.on("ModeChange",this.onModeChange,this)},Bullet.prototype.update=function(t){1===this.Mode||2===this.Mode&&this.entity.destroy()},Bullet.prototype.onTriggerEnter=function(t){this.Mode=2,console.log("Enter:"+t.name)},Bullet.prototype.onContact=function(t){this.Mode=2;var e=this.Spark.clone();this.entity.root.addChild(e),e.setPosition(t.contacts[0].point),e.particlesystem.reset(),e.particlesystem.play(),console.log(t.other.name+":"+t.contacts[0].point),t.other.fire("Damage",1)},Bullet.prototype.onModeChange=function(t){this.entity.rigidbody.enabled=!0,this.entity.rigidbody.applyImpulse(this.entity.forward.scale(-2.5)),this.Mode=t},Bullet.prototype.swap=function(t){};var MuzzleFlashCtrl=pc.createScript("muzzleFlashCtrl"),cnt=0;MuzzleFlashCtrl.prototype.initialize=function(){cnt=0,this.entity.light.enabled=!1,this.entity.on("start",this.start,this)},MuzzleFlashCtrl.prototype.update=function(t){(cnt+=t)>.1&&(this.entity.light.enabled=!1)},MuzzleFlashCtrl.prototype.start=function(){this.entity.light.enabled=!0,cnt=0};var EnemyCtrl=pc.createScript("enemyCtrl");EnemyCtrl.attributes.add("Armor",{type:"number",title:"Armor",default:10}),EnemyCtrl.attributes.add("Muzzle",{type:"entity",title:"Muzzle"}),EnemyCtrl.attributes.add("Bullet",{type:"entity",title:"Bullet"}),EnemyCtrl.attributes.add("MuzzleFlash",{type:"entity",title:"MuzzleFlash"}),EnemyCtrl.attributes.add("MuzzleFlashCtrl",{type:"entity",title:"MuzzleFlashCtrl"}),EnemyCtrl.attributes.add("TargetMe",{type:"entity",title:"TargetMe"}),EnemyCtrl.attributes.add("Search",{type:"entity",title:"Search"}),EnemyCtrl.attributes.add("forceForward",{type:"number",default:9}),EnemyCtrl.attributes.add("forceReverse",{type:"number",default:4.5}),EnemyCtrl.attributes.add("forceTurn",{type:"number",default:3}),EnemyCtrl.reload=0,EnemyCtrl.move=0,EnemyCtrl.move_interval=0,EnemyCtrl.reload_interval=0,EnemyCtrl.prototype.initialize=function(){this.entity.on("Damage",this.onDamage,this)},EnemyCtrl.prototype.update=function(t){if(EnemyCtrl.move_interval+=t,EnemyCtrl.move_interval>5){this.entity.getPosition().distance(this.TargetMe.getPosition());EnemyCtrl.move=Math.floor(pc.math.random(0,6)),EnemyCtrl.move_interval=0}(0!==EnemyCtrl.move&&4!==EnemyCtrl.move&&5!==EnemyCtrl.move||this.entity.rigidbody.applyForce(this.entity.forward.scale(-4e5)),1===EnemyCtrl.move&&this.entity.rigidbody.applyForce(this.entity.forward.scale(4e5)),EnemyCtrl.move<3)?(this.Search.lookAt(this.TargetMe.getPosition()),this.Search.getLocalEulerAngles().y>0?this.entity.rigidbody.applyTorque(0,-2e5,0):this.entity.rigidbody.applyTorque(0,2e5,0)):4===EnemyCtrl.move?this.entity.rigidbody.applyTorque(0,-2e5,0):5===EnemyCtrl.move&&this.entity.rigidbody.applyTorque(0,2e5,0);if(EnemyCtrl.reload+=t,EnemyCtrl.reload_interval+=t,EnemyCtrl.reload>.2&&EnemyCtrl.reload_interval<1){var e=this.Bullet.clone();this.entity.root.addChild(e),e.setPosition(this.Muzzle.getPosition()),e.rigidbody.enabled=!0;var r=this.Muzzle.getPosition().clone().add(this.Muzzle.forward.scale(-2));e.rigidbody.teleport(r,this.Muzzle.getRotation()),e.rigidbody.applyImpulse(e.forward.scale(-2)),this.MuzzleFlash.setPosition(e.getPosition()),this.MuzzleFlash.particlesystem.reset(),this.MuzzleFlash.particlesystem.play(),this.MuzzleFlashCtrl.fire("start"),EnemyCtrl.reload=0}EnemyCtrl.reload_interval>5&&(EnemyCtrl.reload_interval=0)},EnemyCtrl.prototype.onDamage=function(t){--this.Armor,console.log("Damage!")};var TestSceneBackTogame=pc.createScript("testSceneBackTogame");TestSceneBackTogame.prototype.initialize=function(){},TestSceneBackTogame.prototype.onKeyUp=function(e){if(e.key===pc.KEY_R){var t=this.app.root.findByName("Root");this.app.keyboard.off(pc.EVENT_KEYUP,this.onKeyUp,this),this.app.off("reloadDisplayText"),this.app.loadSceneHierarchy(this.app.getSceneUrl("シーン1"),(function(e,a){e||t.destroy()})),this.app.loadSceneSettings(this.app.getSceneUrl("シーン1"),(function(e){}))}};var CollisionScene=pc.createScript("collisionScene");CollisionScene.attributes.add("bvhTrisPerNode",{type:"number",description:"Set this value to around 6 or higher to determine the maximum number of triangles per leaf node in a triMesh. Usually i reccomend not more than 16 per node in general.",default:12,min:6,precision:1}),CollisionScene.TYPE_PLAYCANVAS_TAGGED=0,CollisionScene.TYPE_DBVT=1,CollisionScene.TYPE_BVHTREE=2,CollisionScene.TYPE_NONE=-1,CollisionScene.attributes.add("sceneGenType",{type:"number",default:CollisionScene.TYPE_PLAYCANVAS_TAGGED,description:"Construct entire collision scene using one of the following implementations from your Playcanvas Scene (or 'None', if you wish not to process anything in your scenegraph)",enum:[{"Playcanvas SceneGraph Tagged":CollisionScene.TYPE_PLAYCANVAS_TAGGED},{"Dynamic Bounding Volume Tree":CollisionScene.TYPE_DBVT},{None:CollisionScene.TYPE_NONE}]}),CollisionScene.attributes.add("recastCLIEnable",{type:"boolean",default:!1,description:"Check this box to connect to your RecastCLI Server to generate navmesh of collisions from your Playcanvas scene graph at runtime!"}),CollisionScene.attributes.add("recastCLIServer",{type:"string",description:"The websocket server path to use",default:"ws://localhost:9090/"}),CollisionScene.attributes.add("recastCLIEntity",{type:"entity",description:"The entity reference that holds the recastCli Settings"}),CollisionScene.attributes.add("recastNoStream",{type:"boolean",description:"Check this box to quickly force-send all geometry data to RecastCLI websocket server without streaming. Might have issues on some browsers (like Firefox)."}),CollisionScene.getAltTransform=function(e,t){return e=e.data,(t=t||new altern.Transform3D).a=e[0],t.b=e[4],t.c=e[8],t.d=e[12],t.e=e[1],t.f=e[5],t.g=e[9],t.h=e[13],t.i=e[2],t.j=e[6],t.k=e[10],t.l=e[14],t},CollisionScene.getWavefrontStr=function(e){var t,o,n="";for(o=e.vertices.length,t=0;t<o;t+=3)n+="v "+e.vertices[t]+" "+e.vertices[t+1]+" "+e.vertices[t+2]+"\n";for(o=e.indices.length,t=0;t<o;t+=3)n+="f "+(e.indices[t]+1)+" "+(e.indices[t+1]+1)+" "+(e.indices[t+2]+1)+"\n";return n},CollisionScene.MODEL_ENTRIES={},CollisionScene.MODEL_GEOM_ENTRIES={},CollisionScene.getScaleCompensation=function(e,t,o){var n=e;for(t=t||new pc.Vec3(1,1,1);(n=n.parent)&&n!==o;){var i=n.getLocalScale();if(0===i.x||0===i.y||0===i.z)return console.error("Detected scale zero in collision hierachy. Scale compensation will halt!"),t.x=1,t.y=1,t.z=1,t;t.x/=i.x,t.y/=i.y,t.z/=i.z}return t},CollisionScene.prototype.getScaleFromCollision=function(e){switch(e.type){case"box":return new pc.Vec3(2*e.halfExtents.x,2*e.halfExtents.y,2*e.halfExtents.z);case"cylinder":return new pc.Vec3(2*e.radius,e.height,2*e.radius);case"capsule":return new pc.Vec3(2*e.radius,.5*e.height,2*e.radius);case"sphere":return new pc.Vec3(2*e.radius,2*e.radius,2*e.radius);default:console.warn("Could not find collision primitive transform type for:"+e.type)}return new pc.Vec3(1,1,1)},CollisionScene.prototype.getAltTransformFromCollision=function(e,t,o,n,i){switch(o=o||1,n=n||1,i=i||1,t=t||new altern.Transform3D,e.type){case"box":t.compose(0,0,0,0,0,0,2*e.halfExtents.x*o,2*e.halfExtents.y*n,2*e.halfExtents.z*i);break;case"cylinder":t.compose(0,0,0,0,0,0,2*e.radius*o,e.height*n,2*e.radius*i);break;case"capsule":t.compose(0,0,0,0,0,0,2*e.radius*o,.5*e.height*n,2*e.radius*i);break;case"sphere":t.compose(0,0,0,0,0,0,2*e.radius*o,2*e.radius*n,2*e.radius*i);break;default:console.warn("Could not find collision primitive transform type for:"+e.type)}return t},CollisionScene.prototype.getBoundsFromCollision=function(e,t){switch(t=t||new altern.BoundBox,e.type){case"box":case"cylinder":case"sphere":t.minX=-.5,t.minY=-.5,t.minZ=-.5,t.maxX=.5,t.maxY=.5,t.maxZ=.5;break;case"capsule":t.minX=-.5,t.minY=-1,t.minZ=-.5,t.maxX=.5,t.maxY=1,t.maxZ=.5;break;default:console.warn("Could not find collision primitive transform type for:"+e.type)}return t},CollisionScene.prototype.getBoxGeom=function(){return CollisionScene.box||(CollisionScene.box=this.getAltGeometryFromMesh(pc.createBox(this.app.graphicsDevice,{halfExtents:new pc.Vec3(.5,.5,.5)})))},CollisionScene.prototype.getCylinderGeom=function(){return CollisionScene.cylinder||(CollisionScene.cylinder=this.getAltGeometryFromMesh(pc.createCylinder(this.app.graphicsDevice,{radius:.5,height:1})))},CollisionScene.prototype.getSphereGeom=function(){return CollisionScene.sphere||(CollisionScene.sphere=this.getAltGeometryFromMesh(pc.createSphere(this.app.graphicsDevice,{radius:.5})))},CollisionScene.prototype.getCapsuleGeom=function(){return CollisionScene.capsule||(CollisionScene.capsule=this.getAltGeometryFromMesh(pc.createCapsule(this.app.graphicsDevice,{radius:.5,height:2})))},CollisionScene.prototype.getCollidableFromEntity=function(e){var t;if(e.script&&e.script.staticModelBody&&e.script.staticModelBody.enabled){if(null!==(t=(e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null)||(e.model?e.model.model:null)))return null===(e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null)&&console.log("CollisionScene:: "+e.name+". Could not find staticModelBody.collision model from script asset, using render model instead."),this.getCollidableEntryFromModel(t,e.script.staticModelBody?e.script.staticModelBody.filteredIndexList:null,e.script.staticModelBody.model);console.warn("CollisionScene:: "+e.name+". Could not find collision model from staticModelBody or model from entity itself!")}return e.collision?this.getCollidableFromCollision(e.collision):null},CollisionScene.prototype.getAllCollideGeometryFromEntity=function(e){if(e.script&&e.script.staticModelBody&&e.script.staticModelBody.enabled){if(model=(e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null)||(e.model?e.model.model:null),null!==model)return null===(e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null)&&console.log("CollisionScene:: "+e.name+". Could not find staticModelBody.collision model from script asset, using render model instead."),this.getAltGeometryFromModel(model,e.script.staticModelBody?e.script.staticModelBody.filteredIndexList:null,e.script.staticModelBody.model);console.warn("CollisionScene:: "+e.name+". Could not find collision model from staticModelBody or model from entity itself!")}var t;return e.collision?"mesh"!==e.collision.type?this.getCollidableFromCollision(e.collision):e.collision.model?e.collision.asset&&CollisionScene.MODEL_GEOM_ENTRIES[e.collision.asset.id]?CollisionScene.MODEL_GEOM_ENTRIES[e.collision.asset.id]:(t=this.getAltGeometryFromModel(e.collision.model),e.collision.asset&&(CollisionScene.MODEL_GEOM_ENTRIES[e.collision.asset.id]=t),t):e.collision.asset&&e.collision.asset.loaded?(console.warn("Could not find supplied model asset "),null):(console.warn("Could not find collision model. Currently not yet supported non-preloaded collision model assets"),null):null},CollisionScene.prototype.isCollisionPrim=function(e){return!(e.script&&e.script.staticModelBody&&e.script.staticModelBody.enabled&&null!==((e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null)||(e.model?e.model.model:null))&&null===(e.script.staticModelBody.model?e.script.staticModelBody.model.resource:null))&&!(!e.collision||"mesh"===e.collision.type)},CollisionScene.prototype.getCollidableFromCollision=function(e){return"box"===e.type?this.getBoxGeom():"cylinder"===e.type?this.getCylinderGeom():"sphere"===e.type?this.getSphereGeom():"capsule"===e.type?this.getCapsuleGeom():"mesh"===e.type?e.model?this.getCollidableEntryFromModel(e.model,null,e.asset):e.asset&&e.asset.loaded?(console.warn("Could not find supplied model asset "),null):(console.warn("Could not find collision model. Currently not yet supported non-preloaded collision model assets"),null):(console.warn("CollisionScene:: Could not find matching collision type!:"+e.type),null)},CollisionScene.prototype.exceedPolies=function(e){for(var t=Math.ceil(1.6*this.bvhTrisPerNode),o=e.meshInstances,n=o.length,i=0;--n>-1;){var l=o[n].mesh;if((i+=l.indexBuffer?l.indexBuffer[pc.RENDERSTYLE_SOLID].getNumIndices()/3:l.vertexBuffer.getNumVertices()/3)>t)return!0}return!1},CollisionScene.prototype.getCollidableEntryFromModel=function(e,t,o,n){if(o&&CollisionScene.MODEL_ENTRIES[o.id])return this._entryBounds=CollisionScene.MODEL_ENTRIES[o.id].bounds,CollisionScene.MODEL_ENTRIES[o.id].collidable;this._entryBounds=new altern.BoundBox,this._entryBounds.cached=!0;var i=this.exceedPolies(e)||n?this.getBVHTreeFromModel(e,t,this._entryBounds)||this.getAltGeometryFromModel(e,t,this._entryBounds):this.getAltGeometryFromModel(e,t,_entryBounds);return i?o&&(CollisionScene.MODEL_ENTRIES[o.id]={collidable:i,bounds:this._entryBounds}):this._entryBounds=null,i},CollisionScene.prototype.getAltGeometryFromModel=function(e,t){var o,n,i,l=e.meshInstances,s=new altern.Geometry,r=[],a=[],c=new altern.Transform3D,d=new altern.Transform3D,m=t?t.length:l.length;for(o=0;o<m;o++){for(n=t?l[t[o]]:l[o],CollisionScene.getAltTransform(n.node.getLocalTransform(),c),i=n.node;(i=i.parent)&&!(i instanceof pc.Entity);)c.append(CollisionScene.getAltTransform(i.getLocalTransform(),d));this.collectAltGeometryFromMesh(n.mesh,c,this._entryBounds,r.length,a.length,r,a)}return s.setVertices(r),s.setIndices(a),s},CollisionScene.prototype.getBVHTreeFromModel=function(e,t){if(!window.bvhtree)return console.warn("window.bvhtree package missing? We reccomend it for better mesh collision performance!"),null;var o,n,i,l=e.meshInstances,s=new altern.Transform3D,r=new altern.Transform3D,a=[],c=t?t.length:l.length;for(o=0;o<c;o++){for(n=t?l[t[o]]:l[o],CollisionScene.getAltTransform(n.node.getLocalTransform(),s),i=n.node;(i=i.parent)&&!(i instanceof pc.Entity);)s.append(CollisionScene.getAltTransform(i.getLocalTransform(),r));this.addMeshToTris(a,n.mesh,s,this._entryBounds)}return new altern.BVHTree(new bvhtree.BVH(a,12))},CollisionScene.prototype.getAltGeometryFromMesh=function(e,t,o){var n=new altern.Geometry,i=[],l=[];return this.collectAltGeometryFromMesh(e,t,o,0,0,i,l),n.setVertices(i),n.setIndices(l),n},CollisionScene.prototype.collectAltGeometryFromMesh=function(e,t,o,n,i,l,s){var r,a=n/3,c=t,d=e.indexBuffer[pc.RENDERSTYLE_SOLID],m=e.vertexBuffer,h=m.getFormat(),u=h.size/4;for(j=0;j<h.elements.length;j++){var p=h.elements[j];p.name===pc.SEMANTIC_POSITION&&(r=new Float32Array(m.lock(),p.offset))}var C,y,f,g,S,L,B,T,I,b=new Uint16Array(d.lock()),v=e.primitive[0].count/3,E=e.primitive[0].base;for(j=0;j<r.length;j+=u)B=r[j],T=r[j+1],I=r[j+2],c&&(g=B,S=T,L=I,B=c.a*g+c.b*S+c.c*L+c.d,T=c.e*g+c.f*S+c.g*L+c.h,I=c.i*g+c.j*S+c.k*L+c.l),o&&altern.AABBUtils.expand(B,T,I,o),l[n++]=B,l[n++]=T,l[n++]=I;for(j=0;j<v;j++)C=b[E+3*j],y=b[E+3*j+1],f=b[E+3*j+2],s[i++]=a+C,s[i++]=a+y,s[i++]=a+f},CollisionScene.prototype.addMeshToTris=function(e,t,o,n){var i,l=o,s=t.indexBuffer[pc.RENDERSTYLE_SOLID],r=t.vertexBuffer,a=r.getFormat(),c=a.size/4;for(j=0;j<a.elements.length;j++){var d=a.elements[j];d.name===pc.SEMANTIC_POSITION&&(i=new Float32Array(r.lock(),d.offset))}var m,h,u,p,C,y,f=new Uint16Array(s.lock()),g=t.primitive[0].count/3,S=t.primitive[0].base;if(n)for(j=0;j<i.length;j+=c)p=i[j],C=i[j+1],y=i[j+2],altern.AABBUtils.expand(l.a*p+l.b*C+l.c*y+l.d,l.e*p+l.f*C+l.g*y+l.h,l.i*p+l.j*C+l.k*y+l.l,n);for(j=0;j<g;j++){m=f[S+3*j]*c,h=f[S+3*j+1]*c,u=f[S+3*j+2]*c;var L=new altern.Vec3(i[m],i[m+1],i[m+2]),B=new altern.Vec3(i[h],i[h+1],i[h+2]),T=new altern.Vec3(i[u],i[u+1],i[u+2]),I=L;p=I.x,C=I.y,y=I.z,I.x=l.a*p+l.b*C+l.c*y+l.d,I.y=l.e*p+l.f*C+l.g*y+l.h,I.z=l.i*p+l.j*C+l.k*y+l.l,p=(I=B).x,C=I.y,y=I.z,I.x=l.a*p+l.b*C+l.c*y+l.d,I.y=l.e*p+l.f*C+l.g*y+l.h,I.z=l.i*p+l.j*C+l.k*y+l.l,p=(I=T).x,C=I.y,y=I.z,I.x=l.a*p+l.b*C+l.c*y+l.d,I.y=l.e*p+l.f*C+l.g*y+l.h,I.z=l.i*p+l.j*C+l.k*y+l.l,e.push([L,B,T])}},CollisionScene.DEG_TO_RAD=Math.PI/180,CollisionScene.prototype.initialize=function(){this.node=altern.CollisionBoundNode.create(new altern.Transform3D),this.entity.collisionScene=this.node,this.node.name=this.entity.name},CollisionScene.prototype.postInitialize=function(){this.sceneGenType===CollisionScene.TYPE_PLAYCANVAS_TAGGED?this.initPlaycanvasTagged():this.sceneGenType===CollisionScene.TYPE_DBVT?this.initDBVT():this.initPlaycanvasTagged(),function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var o=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}("debug")||"https:"!==window.location.protocol||(this.recastCLIEnable=!1),this.recastCLIEnable&&(this.initRecastData(),this.connectRecastCLI())},CollisionScene.prototype.initDBVT=function(){var e,t=new altern.DBVT;this.entity.dbvt=t;var o,n,i,l,s,r=this.entity.find((function(e){return e.enabled&&!e.tags.has("dynamic")&&(e.script&&e.script.staticModelBody||e.collision)})),a=r.length,c=new altern.Transform3D,d=new pc.Vec3,m=CollisionScene.DEG_TO_RAD;for(n=0;n<a;n++){var h;l=i=r[n];var u,p="!c"!==i.name&&"c"!==i.name&&"c!"!=i.name?i.name:i.parent.name;if(h=this.isCollisionPrim(l)){var C=this.getScaleFromCollision(i.collision),y=(i.getLocalScale(),CollisionScene.getScaleCompensation(i,null,this.entity));u=this.getBoundsFromCollision(i.collision),d.x=C.x*y.x,d.y=C.y*y.y,d.z=C.z*y.z;var f=i.getLocalPosition(),g=i.getLocalTransform().getEulerAngles();for((s=new altern.Transform3D).compose(f.x,f.y,f.z,g.x*m,g.y*m,g.z*m,d.x,d.y,d.z);(l=l.parent)&&l!==this.entity;)CollisionScene.getAltTransform(l.getLocalTransform(),c),s.append(c)}else for(s=CollisionScene.getAltTransform(l.getLocalTransform());(l=l.parent)&&l!==this.entity;)CollisionScene.getAltTransform(l.getLocalTransform(),c),s.append(c);if(l&&l!==i||(alert("CollisionScene:: null or invalid r exception. SHould not be!!:"+l),l=this.entity),e=this.getCollidableFromEntity(i),o=null,h?o=u:e&&this._entryBounds&&(o=this._entryBounds),o){var S=new altern.BoundBox;altern.AABBUtils.match(S,o),altern.AABBUtils.transform(S,s),o=S}e&&(o?t.insertLeaf(altern.DBVTNode.createFrom(e,o,s)):alert("Failed to find bounding box for :"+p))}this.node.collidable=t,this.node.raycastable=altern.LibUtil.as(t,altern.IRaycastImpl)},CollisionScene.prototype.initPlaycanvasTagged=function(){var e;(e=this.getCollidableFromEntity(this.entity))&&(this.entity.tags.has("noCollide")||(this.node.collidable=e),this.entity.tags.has("noRaycast")||(this.node.raycastable=altern.LibUtil.as(e,altern.IRaycastImpl)));var t={};t[this.entity._guid]=this.node;var o,n,i,l,s,r,a={},c=this.entity.find((function(e){return e.enabled&&!e.tags.has("dynamic")&&(e.script&&e.script.staticModelBody||e.collision||e.tags.has("collisionBoundNode"))})),d=c.length,m=new altern.Transform3D,h=new pc.Vec3,u=CollisionScene.DEG_TO_RAD;for(o=0;o<d;o++)a[(n=c[o])._guid]=!0;for(o=0;o<d;o++){var p;i=n=c[o];var C,y="!c"!==n.name&&"c"!==n.name&&"c!"!=n.name?n.name:n.parent.name;if(p=this.isCollisionPrim(i)){var f=this.getScaleFromCollision(n.collision),g=(n.getLocalScale(),CollisionScene.getScaleCompensation(n,null,this.entity));C=this.getBoundsFromCollision(n.collision),h.x=f.x*g.x,h.y=f.y*g.y,h.z=f.z*g.z;var S=n.getLocalPosition(),L=n.getLocalTransform().getEulerAngles();for((l=new altern.Transform3D).compose(S.x,S.y,S.z,L.x*u,L.y*u,L.z*u,h.x,h.y,h.z);(i=i.parent)&&!a[i._guid]&&i!==this.entity;)CollisionScene.getAltTransform(i.getLocalTransform(),m),l.append(m)}else for(l=CollisionScene.getAltTransform(i.getLocalTransform());(i=i.parent)&&!a[i._guid]&&i!==this.entity;)CollisionScene.getAltTransform(i.getLocalTransform(),m),l.append(m);t[n._guid]=s=altern.CollisionBoundNode.create(l),n.collisionNode=s,i&&i!==n||(alert("CollisionScene:: null or invalid r exception. SHould not be!!:"+i),i=this.entity),a[n._guid]=i._guid,s.name=y,e=this.getCollidableFromEntity(n),p?s.boundBox=C:e&&this._entryBounds&&(s.boundBox=this._entryBounds),e&&(n.tags.has("noCollide")||(s.collidable=e),n.tags.has("noRaycast")||(s.raycastable=altern.LibUtil.as(e,altern.IRaycastImpl))),s.boundBox||(s.boundBox=new altern.BoundBox)}for(o=0;o<d;o++)t[a[(n=c[o])._guid]].addChild(t[n._guid]);for(this.node.boundBox=new altern.BoundBox,m=new altern.Transform3D,o=0;o<d;o++)for(i=s=t[c[o]._guid],r=s;i=i._parent;)i.boundBox&&(i.boundBox.cached&&(l=new altern.BoundBox,altern.AABBUtils.match(l,i.boundBox),i.boundBox=l),altern.AABBUtils.match(m,r.boundBox),altern.AABBUtils.transform(m,r.transform),altern.GeomCollisionSceneUtil.updateBounds(i.boundBox,m),r=i);console.log("Playcanvas SceneGraph Tagged:: Successfully created root scene collision bound node!")},CollisionScene.prototype.getRecastCLIParams=function(e){if(this.recastCLIParams)return this.recastCLIParams;var t=null;return(t=this.recastCLIEntity?this.recastCLIEntity.script.recastCli:this.entity.script.recastCli)?(this.recastCLIParams=t.getParams(e),this.recastCLIParams):null},CollisionScene.prototype.initRecastData=function(e){if(e||(this.getRecastCLIParams(),this.recastCLIParams)){var t,o,n,i,l,s=this.entity.find((function(e){return e.enabled&&!e.tags.has("dynamic")&&(e.script&&e.script.staticModelBody||e.collision)})),r=s.length,a=new altern.Transform3D,c=new pc.Vec3,d=CollisionScene.DEG_TO_RAD,m=[],h=[],u=0,p=0,C=0;for(t=0;t<r;t++){n=o=s[t];"!c"!==o.name&&"c"!==o.name&&"c!"!=o.name?o.name:o.parent.name;if(this.isCollisionPrim(n)){var y=this.getScaleFromCollision(o.collision),f=(o.getLocalScale(),CollisionScene.getScaleCompensation(o,null,this.entity));c.x=y.x*f.x,c.y=y.y*f.y,c.z=y.z*f.z;var g=o.getLocalPosition(),S=o.getLocalTransform().getEulerAngles();for((i=new altern.Transform3D).compose(g.x,g.y,g.z,S.x*d,S.y*d,S.z*d,c.x,c.y,c.z);(n=n.parent)&&n!==this.entity;)CollisionScene.getAltTransform(n.getLocalTransform(),a),i.append(a)}else for(i=CollisionScene.getAltTransform(n.getLocalTransform());(n=n.parent)&&n!==this.entity;)CollisionScene.getAltTransform(n.getLocalTransform(),a),i.append(a);if(n&&n!==o||(alert("CollisionScene:: null or invalid r exception. SHould not be!!:"+n),n=this.entity),l=this.getAllCollideGeometryFromEntity(o)){var L,B,T,I,b;for(B=l.indices.length,L=0;L<B;L+=3)m[p++]=C+l.indices[L],m[p++]=C+l.indices[L+1],m[p++]=C+l.indices[L+2];for(C+=l.vertices.length/3,B=l.vertices.length,L=0;L<B;L+=3)T=l.vertices[L],I=l.vertices[L+1],b=l.vertices[L+2],h[u++]=i.a*T+i.b*I+i.c*b+i.d,h[u++]=i.e*T+i.f*I+i.g*b+i.h,h[u++]=i.i*T+i.j*I+i.k*b+i.l}}if(CollisionScene.MODEL_GEOM_ENTRIES={},e)return(l=new altern.Geometry).setVertices(h),l.setIndices(m),l;var v=new Float32Array(this.recastCLIParams.length+2+m.length+h.length);for(r=this.recastCLIParams.length,t=0;t<r;t++)v[t]=this.recastCLIParams[t];for(v[this.recastCLIParams.length]=h.length/3,v[this.recastCLIParams.length+1]=m.length/3,u=this.recastCLIParams.length+2,r=h.length,t=0;t<r;t+=3)v[u++]=h[t],v[u++]=h[t+1],v[u++]=h[t+2];for(r=m.length,t=0;t<r;t+=3)v[u++]=m[t],v[u++]=m[t+1],v[u++]=m[t+2];return this.recastCLIPacket=v,console.log("Created RecastCLI packet..."+v[this.recastCLIParams.length]+" vertices, "+v[this.recastCLIParams.length+1]+" triangles. "+4*v.length+" bytes."),l}alert("Could not find recastCli settings script! RecastCLI will NOT run for: "+this.entity.name)},CollisionScene.prototype.connectRecastCLI=function(){var e=this;CollisionScene.RecastCLI.socket=new WebSocket("ws://localhost:9090/"),CollisionScene.RecastCLI.socket.binaryType="arraybuffer",CollisionScene.RecastCLI.socket.addEventListener("open",(function(){console.log("Connected to the RecastCLI server!"),CollisionScene.RecastCLI.connected=!0,e.sendRecastCLI()})),CollisionScene.RecastCLI.socket.addEventListener("message",(function(e){})),CollisionScene.RecastCLI.socket.addEventListener("close",(function(){console.log("RecastCLI Server Connection closed"),alert(CollisionScene.RecastCLI.connected?"RecastCLI Server Connection closed":"RecastCLI Server Connection Failed to Connect")}))},CollisionScene.prototype.sendRecastCLI=function(){var e;this.recastCLIPacket&&CollisionScene.RecastCLI.connected&&(4*this.recastCLIPacket.length>65536&&!this.recastNoStream?(e=new Float32Array([-this.recastCLIPacket.length]).buffer,this.recastCLIPacketStream={progress:0,packet:this.recastCLIPacket},console.log("Preparing recastCLIPacketStream..."),CollisionScene.RecastCLI.Send(e),setTimeout(this.sendRecastCLIStream.bind(this),200)):(e=this.recastCLIPacket.buffer,CollisionScene.RecastCLI.Send(e),console.log("Sending entire recastCLIPacket...")),this.recastCLIPacket=null)},CollisionScene.prototype.sendRecastCLIStream=function(){if(this.recastCLIPacketStream){var e=this.recastCLIPacketStream.progress;CollisionScene.RecastCLI.Send(this.recastCLIPacketStream.packet.slice(e,e+16384).buffer),e+=16384,this.recastCLIPacketStream.progress=e,e>=this.recastCLIPacketStream.packet.length?(this.recastCLIPacketStream=null,console.log("recastCLIPacketStream completed!")):setTimeout(this.sendRecastCLIStream.bind(this),200)}},CollisionScene.RecastCLI={Send:function(e){CollisionScene.RecastCLI.socket.send(e)},connected:!1};var RecastCli=pc.createScript("recastCli");RecastCli.attributes.add("cellSize",{type:"number",default:0}),RecastCli.attributes.add("cellHeight",{type:"number",default:0}),RecastCli.attributes.add("agentHeight",{type:"number",default:0,min:0}),RecastCli.attributes.add("agentRadius",{type:"number",default:0,min:0}),RecastCli.attributes.add("maxClimb",{type:"number",default:0}),RecastCli.attributes.add("maxSlope",{type:"number",default:45,min:0,max:90}),RecastCli.attributes.add("regionMinSize",{type:"number",default:0,min:0}),RecastCli.attributes.add("regionMergeSize",{type:"number",default:0,min:0}),RecastCli.attributes.add("edgeMaxLen",{type:"number",default:0,min:0}),RecastCli.attributes.add("edgeMaxError",{type:"number",default:0,min:0}),RecastCli.attributes.add("vertsPerPoly",{type:"number",default:0,min:0}),RecastCli.attributes.add("detailSampleDist",{type:"number",default:0,min:0}),RecastCli.attributes.add("detailSampleMaxError",{type:"number",default:0,min:0}),RecastCli.prototype.getParams=function(){var t=this.agentHeight,e=this.agentRadius;t<=0&&(this.entity.collision?t=this.entity.collision.height:(console.warn("Could not find Agent height for: "+this.entity.name+". Using default 2"),t=2)),e<=0&&(this.entity.collision?e=this.entity.collision.radius:(console.warn("could not find Agent radius for: "+this.entity.name+". Using default 0.5"),e=.5));var i=this.cellSize;i<=0&&(i=0===i?e/2:e/-i);var a=this.cellHeight;a<=0&&(a=0===a?i/2:i/-a);var l=this.maxClimb;return l<=0&&(l=0===l?.25*t:-l*t),[i,a,t,e,l,this.maxSlope,this.regionMinSize,this.regionMergeSize,this.edgeMaxLen,this.edgeMaxError,this.vertsPerPoly,this.detailSampleDist,this.detailSampleMaxError]},RecastCli.PARAM_CELLSIZE=0,RecastCli.PARAM_CELLHEIGHT=1,RecastCli.PARAM_AGENT_HEIGHT=2,RecastCli.PARAM_AGENT_RADIUS=3,RecastCli.PARAM_MAX_CLIMB=4,RecastCli.PARAM_MAX_SLOPE=5,RecastCli.PARAM_REGION_MIN_SIZE=6,RecastCli.PARAM_REGION_MERGE_SIZE=7,RecastCli.PARAM_EDGE_MAX_LEN=8,RecastCli.PARAM_EDGE_MAX_ERROR=9,RecastCli.PARAM_VERTS_PER_POLY=10,RecastCli.PARAM_DETAIL_SAMPLE_DIST=11,RecastCli.PARAM_DETAIL_SAMPLE_MAX_ERROR=12;var StaticModelBody=pc.createScript("staticModelBody");StaticModelBody.attributes.add("model",{type:"asset",assetType:"model",description:"The Model Asset"}),StaticModelBody.attributes.add("noPhysics",{type:"boolean"}),StaticModelBody.attributes.add("filterRegex",{type:"string",description:"RegExp expression for filtering meshInstances"}),StaticModelBody.attributes.add("filterFlags",{type:"string",description:"RegExp flags for expression"}),StaticModelBody.attributes.add("filterAsExclude",{type:"boolean",description:"Filter is used for excluding meshInstances instead?"}),StaticModelBody.attributes.add("debugTestFilter",{type:"boolean",description:"Check this box to hide/show visibility of meshInstances of current entity's matching model asset for collision filter previewing"}),StaticModelBody.prototype.initialize=function(){var t=this.model?this.model.resource:null;t?this.initModel(t):this.model&&this.model.on("ready",(function(){this.initModel(this.model.resource)}),this)},StaticModelBody.prototype.countAllPrimitives=function(t){for(var e=t.length,i=0;--e>-1;)i+=t[e].count;return i},StaticModelBody.prototype.initModel=function(t){var e=null;if(this.filterRegex&&this.filterRegex.trim()){var i=0,s=new RegExp(this.filterRegex,this.filterFlags&&this.filterFlags.trim()?this.filterFlags:void 0),o=this.filterAsExclude,n=(this.entity,this.entity.model?this.entity.model.model:null);this.filteredIndexList=[],e=t.meshInstances,t.meshInstances=t.meshInstances.filter(function(t,e){var l;return l=s.test(t.node.name),o&&(l=!l),this.debugTestFilter&&n&&e<n.meshInstances.length&&(n.meshInstances[e].visible=l),i+=l?(t.mesh.primitive.length<2?t.mesh.primitive[0].count:this.countAllPrimitives(t.mesh.primitive))/3:0,l&&this.filteredIndexList.push(e),l}.bind(this)),this.debugTestFilter&&console.log(this.entity.name+" collision polies: "+i)}this.noPhysics||(this.entity.addComponent("rigidbody",{type:"static"}),this.entity.addComponent("collision",{type:"mesh",asset:this.model})),null!==e&&(t.meshInstances=e)};var bvhtree=bvhtree||{};bvhtree.EPSILON=1e-6,bvhtree.BVHVector3=function(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0},bvhtree.BVHVector3.prototype={constructor:bvhtree.BVHVector3,copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setFromArray:function(t,e){this.x=t[e],this.y=t[e+1],this.z=t[e+2]},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){var e=this.x,r=this.y,n=this.z;return this.x=r*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-r*t.x,this},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,s=e.x,o=e.y,h=e.z;return this.x=n*h-i*o,this.y=i*s-r*h,this.z=r*o-n*s,this},clone:function(){return new bvhtree.BVHVector3(this.x,this.y,this.z)}},bvhtree.BVH=function(t,e){for(var r=new Float32Array(9*t.length),n=0;n<t.length;n++){var i=t[n][0],s=t[n][1],o=t[n][2];r[9*n]=i.x,r[9*n+1]=i.y,r[9*n+2]=i.z,r[9*n+3]=s.x,r[9*n+4]=s.y,r[9*n+5]=s.z,r[9*n+6]=o.x,r[9*n+7]=o.y,r[9*n+8]=o.z}this._trianglesArray=r,this._maxTrianglesPerNode=e||10,this._bboxArray=this.calcBoundingBoxes(r),this._bboxHelper=new Float32Array(this._bboxArray.length),this._bboxHelper.set(this._bboxArray);var h=r.length/9,a=this.calcExtents(0,h,bvhtree.EPSILON);for(this._rootNode=new bvhtree.BVHNode(a[0],a[1],0,h,0),this._nodesToSplit=[this._rootNode];this._nodesToSplit.length>0;){var x=this._nodesToSplit.pop();this.splitNode(x)}},bvhtree.BVH.prototype.intersectRay=function(t,e,r){for(var n,i=[this._rootNode],s=[],o=[],h=new bvhtree.BVHVector3(1/e.x,1/e.y,1/e.z);i.length>0;){var a=i.pop();if(bvhtree.BVH.intersectNodeBox(t,h,a))for(a._node0&&i.push(a._node0),a._node1&&i.push(a._node1),n=a._startIndex;n<a._endIndex;n++)s.push(this._bboxArray[7*n])}var x=new bvhtree.BVHVector3,c=new bvhtree.BVHVector3,b=new bvhtree.BVHVector3,u=new bvhtree.BVHVector3(t.x,t.y,t.z),l=new bvhtree.BVHVector3(e.x,e.y,e.z);for(n=0;n<s.length;n++){var y=s[n];x.setFromArray(this._trianglesArray,9*y),c.setFromArray(this._trianglesArray,9*y+3),b.setFromArray(this._trianglesArray,9*y+6);var _=bvhtree.BVH.intersectRayTriangle(x,c,b,u,l,r);_&&o.push({triangle:[x.clone(),c.clone(),b.clone()],triangleIndex:y,intersectionPoint:_})}return o},bvhtree.BVH.prototype.calcBoundingBoxes=function(t){for(var e,r,n,i,s,o,h,a,x,c,b,u,l,y,_,v=t.length/9,m=new Float32Array(7*v),V=0;V<v;V++)e=t[9*V],r=t[9*V+1],n=t[9*V+2],i=t[9*V+3],s=t[9*V+4],o=t[9*V+5],h=t[9*V+6],a=t[9*V+7],x=t[9*V+8],c=Math.min(Math.min(e,i),h),b=Math.min(Math.min(r,s),a),u=Math.min(Math.min(n,o),x),l=Math.max(Math.max(e,i),h),y=Math.max(Math.max(r,s),a),_=Math.max(Math.max(n,o),x),bvhtree.BVH.setBox(m,V,V,c,b,u,l,y,_);return m},bvhtree.BVH.prototype.calcExtents=function(t,e,r){if(r=r||0,t>=e)return[{x:0,y:0,z:0},{x:0,y:0,z:0}];for(var n=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE,o=-Number.MAX_VALUE,h=-Number.MAX_VALUE,a=-Number.MAX_VALUE,x=t;x<e;x++)n=Math.min(this._bboxArray[7*x+1],n),i=Math.min(this._bboxArray[7*x+2],i),s=Math.min(this._bboxArray[7*x+3],s),o=Math.max(this._bboxArray[7*x+4],o),h=Math.max(this._bboxArray[7*x+5],h),a=Math.max(this._bboxArray[7*x+6],a);return[{x:n-r,y:i-r,z:s-r},{x:o+r,y:h+r,z:a+r}]},bvhtree.BVH.prototype.splitNode=function(t){if(!(t.elementCount()<=this._maxTrianglesPerNode||0===t.elementCount())){var e=t._startIndex,r=t._endIndex,n=[[],[],[]],i=[[],[],[]],s=[t.centerX(),t.centerY(),t.centerZ()],o=[t._extentsMax.x-t._extentsMin.x,t._extentsMax.y-t._extentsMin.y,t._extentsMax.z-t._extentsMin.z],h=[];h.length=3;for(var a=e;a<r;a++){h[0]=.5*(this._bboxArray[7*a+1]+this._bboxArray[7*a+4]),h[1]=.5*(this._bboxArray[7*a+2]+this._bboxArray[7*a+5]),h[2]=.5*(this._bboxArray[7*a+3]+this._bboxArray[7*a+6]);for(var x=0;x<3;x++)h[x]<s[x]?n[x].push(a):i[x].push(a)}var c=[];if(c.length=3,c[0]=0===n[0].length||0===i[0].length,c[1]=0===n[1].length||0===i[1].length,c[2]=0===n[2].length||0===i[2].length,!(c[0]&&c[1]&&c[2])){var b,u,l=[0,1,2];for(l.sort((function(t,e){return o[e]-o[t]})),x=0;x<3;x++){var y=l[x];if(!c[y]){b=n[y],u=i[y];break}}var _,v=e,m=v+b.length,V=m,d=r,f=t._startIndex,B=b.concat(u);for(a=0;a<B.length;a++)_=B[a],bvhtree.BVH.copyBox(this._bboxArray,_,this._bboxHelper,f),f++;var p=this._bboxHelper.subarray(7*t._startIndex,7*t._endIndex);this._bboxArray.set(p,7*t._startIndex);var H=this.calcExtents(v,m,bvhtree.EPSILON),M=this.calcExtents(V,d,bvhtree.EPSILON),z=new bvhtree.BVHNode(H[0],H[1],v,m,t._level+1),A=new bvhtree.BVHNode(M[0],M[1],V,d,t._level+1);t._node0=z,t._node1=A,t.clearShapes(),this._nodesToSplit.push(z),this._nodesToSplit.push(A)}}},bvhtree.BVH._calcTValues=function(t,e,r,n){var i={min:0,max:0};return n>=0?(i.min=(t-r)*n,i.max=(e-r)*n):(i.min=(e-r)*n,i.max=(t-r)*n),i},bvhtree.BVH.intersectNodeBox=function(t,e,r){var n=bvhtree.BVH._calcTValues(r._extentsMin.x,r._extentsMax.x,t.x,e.x),i=bvhtree.BVH._calcTValues(r._extentsMin.y,r._extentsMax.y,t.y,e.y);if(n.min>i.max||i.min>n.max)return!1;(i.min>n.min||n.min!=n.min)&&(n.min=i.min),(i.max<n.max||n.max!=n.max)&&(n.max=i.max);var s=bvhtree.BVH._calcTValues(r._extentsMin.z,r._extentsMax.z,t.z,e.z);return!(n.min>s.max||s.min>n.max)&&((s.min>n.min||n.min!=n.min)&&(n.min=s.min),(s.max<n.max||n.max!=n.max)&&(n.max=s.max),!(n.max<0))},bvhtree.BVH.intersectRayTriangle=function(){var t=new bvhtree.BVHVector3,e=new bvhtree.BVHVector3,r=new bvhtree.BVHVector3,n=new bvhtree.BVHVector3;return function(i,s,o,h,a,x){e.subVectors(s,i),r.subVectors(o,i),n.crossVectors(e,r);var c,b=a.dot(n);if(b>0){if(x)return null;c=1}else{if(!(b<0))return null;c=-1,b=-b}t.subVectors(h,i);var u=c*a.dot(r.crossVectors(t,r));if(u<0)return null;var l=c*a.dot(e.cross(t));if(l<0)return null;if(u+l>b)return null;var y=-c*t.dot(n);if(y<0)return null;var _=y/b;return(new bvhtree.BVHVector3).copy(a).multiplyScalar(_).add(h)}}(),bvhtree.BVH.setBox=function(t,e,r,n,i,s,o,h,a){t[7*e]=r,t[7*e+1]=n,t[7*e+2]=i,t[7*e+3]=s,t[7*e+4]=o,t[7*e+5]=h,t[7*e+6]=a},bvhtree.BVH.copyBox=function(t,e,r,n){r[7*n]=t[7*e],r[7*n+1]=t[7*e+1],r[7*n+2]=t[7*e+2],r[7*n+3]=t[7*e+3],r[7*n+4]=t[7*e+4],r[7*n+5]=t[7*e+5],r[7*n+6]=t[7*e+6]},bvhtree.BVH.getBox=function(t,e,r){r.triangleId=t[7*e],r.minX=t[7*e+1],r.minY=t[7*e+2],r.minZ=t[7*e+3],r.maxX=t[7*e+4],r.maxY=t[7*e+5],r.maxZ=t[7*e+6]},bvhtree.BVHNode=function(t,e,r,n,i){this._extentsMin=t,this._extentsMax=e,this._startIndex=r,this._endIndex=n,this._level=i,this._node0=null,this._node1=null},bvhtree.BVHNode.prototype.elementCount=function(){return this._endIndex-this._startIndex},bvhtree.BVHNode.prototype.centerX=function(){return.5*(this._extentsMin.x+this._extentsMax.x)},bvhtree.BVHNode.prototype.centerY=function(){return.5*(this._extentsMin.y+this._extentsMax.y)},bvhtree.BVHNode.prototype.centerZ=function(){return.5*(this._extentsMin.z+this._extentsMax.z)},bvhtree.BVHNode.prototype.clearShapes=function(){this._startIndex=-1,this._endIndex=-1},bvhtree.BVHNode.calcBoundingSphereRadius=function(t,e){var r=.5*(t.x+e.x),n=.5*(t.y+e.y),i=.5*(t.z+e.z),s=(r-t.x)*(r-t.x)+(n-t.y)*(n-t.y)+(i-t.z)*(i-t.z),o=(r-e.x)*(r-e.x)+(n-e.y)*(n-e.y)+(i-e.z)*(i-e.z);return Math.sqrt(Math.max(s,o))},"undefined"!=typeof module&&module.exports&&(module.exports.BVH=bvhtree.BVH,module.exports.intersectRay=bvhtree.intersectRay);!function(t,i){"use strict";function $extend(t,i){function Inherit(){}Inherit.prototype=t;var s=new Inherit;for(var n in i)s[n]=i[n];return i.toString!==Object.prototype.toString&&(s.toString=i.toString),s}var HxOverrides=function(){};HxOverrides.__name__=!0,HxOverrides.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var s=t.altern=function(){};s.__name__=!0,s.main=function(){var t=s;t.IntersectSlopeUtil=altern_geom_IntersectSlopeUtil,t.BVHTree=altern_partition_js_BVHTree,t.CullingDFS=altern_culling_CullingDFS,t.DefaultCulling=altern_culling_DefaultCulling,t.CullingPlane=altern_culling_CullingPlane,t.GeomCollisionSceneUtil=util_geom_GeomCollisionSceneUtil,t.GeomUtil=util_geom_GeomUtil,t.Raycaster=altern_ray_Raycaster,t.DBVTProxy=altern_collisions_dbvt_DBVTProxy,t.DBVTNode=altern_collisions_dbvt_DBVTNode,t.DBVT=altern_collisions_dbvt_DBVT,t.IRaycastImpl=altern_ray_IRaycastImpl,t.ITCollidable=systems_collisions_ITCollidable,t.Geometry=util_geom_Geometry,t.BoundBox=components_BoundBox,t.Transform3D=components_Transform3D,t.AABBUtils=util_geom_AABBUtils,t.CollisionBoundNode=altern_collisions_CollisionBoundNode,t.Vec3=util_geom_Vec3,t.Vector3D=jeash_geom_Vector3D,t.LibUtil=util_LibUtil,t.Jump=components_Jump,t.SurfaceMovement=components_controller_SurfaceMovement,t.CollisionResult=components_CollisionResult,t.MoveResult=components_MoveResult,t.EllipsoidCollider=systems_collisions_EllipsoidCollider,t.CollisionEvent=systems_collisions_CollisionEvent,t.TargetBoardTester=altern_culling_TargetBoardTester,t.AMesh=altern_geom_AMesh,t.ClipMacros=altern_geom_ClipMacros,t.Edge=altern_geom_Edge,t.Face=altern_geom_Face,t.Wrapper=altern_geom_Wrapper,t.Vertex=altern_geom_Vertex},Math.__name__=!0;var Std=function(){};Std.__name__=!0,Std.string=function(t){return js_Boot.__string_rec(t,"")};var systems_collisions_IECollidable=function(){};systems_collisions_IECollidable.__name__=!0,systems_collisions_IECollidable.prototype={__class__:systems_collisions_IECollidable};var altern_collisions_CollisionBoundNode=function(){};altern_collisions_CollisionBoundNode.__name__=!0,altern_collisions_CollisionBoundNode.__interfaces__=[systems_collisions_IECollidable],altern_collisions_CollisionBoundNode.calculateLocalToGlobal2=function(t,i){(i=null!=i?i:new components_Transform3D).copy(t.transform);for(var s=t;null!=s._parent;)s=s._parent,i.append(s.transform);return i},altern_collisions_CollisionBoundNode.calculateGlobalToLocal2=function(t,i){(i=null!=i?i:new components_Transform3D).copy(t.inverseTransform);for(var s=t;null!=s._parent;)s=s._parent,i.prepend(s.inverseTransform);return i},altern_collisions_CollisionBoundNode.create=function(t,i){var s=new altern_collisions_CollisionBoundNode;return s.transform=t,null==i?(s.inverseTransform=new components_Transform3D,s.inverseTransform.calculateInversion(s.transform)):s.inverseTransform=i,s.localToGlobalTransform=new components_Transform3D,s.globalToLocalTransform=new components_Transform3D,s},altern_collisions_CollisionBoundNode.createNew=function(t,i,s,n){var e=altern_collisions_CollisionBoundNode.create(null!=t?t:new components_Transform3D,i);return e.collidable=s,e.raycastable=null!=n?n:js_Boot.__instanceof(s,altern_ray_IRaycastImpl)?s:null,e},altern_collisions_CollisionBoundNode.prototype={calculateLocalGlobalTransforms:function(){var t=this.localToGlobalTransform;(t=null!=t?t:new components_Transform3D).copy(this.transform);for(var i=this;null!=i._parent;)i=i._parent,t.append(i.transform);this.globalToLocalTransform.calculateInversion(this.localToGlobalTransform)},calculateLocalWorldTransforms:function(){null==this.worldToLocalTransform&&(this.worldToLocalTransform=new components_Transform3D),null==this.localToWorldTransform&&(this.localToWorldTransform=new components_Transform3D);var t=this.localToWorldTransform;(t=null!=t?t:new components_Transform3D).copy(this.transform);for(var i=this;null!=i._parent;)i=i._parent,t.append(i.transform);this.worldToLocalTransform.calculateInversion(this.localToWorldTransform)},mirrorClone:function(){var t=altern_collisions_CollisionBoundNode.create(this.transform,this.inverseTransform);t.collidable=this.collidable,t.boundBox=this.boundBox,t.raycastable=this.raycastable;for(var i=this.childrenList,s=null;null!=i;){var n=i.mirrorClone();null!=t.childrenList?s.next=n:t.childrenList=n,s=n,n._parent=t,i=i.next}return t},updateTransform:function(t){this.transform.copy(t),this.inverseTransform.calculateInversion(this.transform)},collectGeometry:function(t){this.globalToLocalTransform.combine(this.inverseTransform,t.matrix),t.calculateSphere(this.globalToLocalTransform),this.localToGlobalTransform.combine(t.inverseMatrix,this.transform),null!=this.collidable&&this.collidable.collectGeometryAndTransforms(t,this.localToGlobalTransform),null!=this.childrenList&&this.visitChildren(t)},intersectRay:function(t,i,s){for(var n=null!=this.raycastable?this.raycastable.intersectRay(t,i,s):null,e=null!=n?n.w:0!=s.w?s.w:0!=i.w?i.w:1e22,r=null,h=null,a=this.childrenList;null!=a;)if(null==r&&(r=new jeash_geom_Vector3D,h=new jeash_geom_Vector3D),r.x=a.inverseTransform.a*t.x+a.inverseTransform.b*t.y+a.inverseTransform.c*t.z+a.inverseTransform.d,r.y=a.inverseTransform.e*t.x+a.inverseTransform.f*t.y+a.inverseTransform.g*t.z+a.inverseTransform.h,r.z=a.inverseTransform.i*t.x+a.inverseTransform.j*t.y+a.inverseTransform.k*t.z+a.inverseTransform.l,h.x=a.inverseTransform.a*i.x+a.inverseTransform.b*i.y+a.inverseTransform.c*i.z,h.y=a.inverseTransform.e*i.x+a.inverseTransform.f*i.y+a.inverseTransform.g*i.z,h.z=a.inverseTransform.i*i.x+a.inverseTransform.j*i.y+a.inverseTransform.k*i.z,h.w=0!=i.w?Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z)/Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)*i.w:1e22,null==a.boundBox||util_geom_AABBUtils.intersectRay(a.boundBox,r,h)){var o=a.intersectRay(r,h,s);null!=o&&o.w<e&&(e=o.w,n=o),a=a.next}else a=a.next;return n},visitChildren:function(t){for(var i=this.childrenList;null!=i;){i.globalToLocalTransform.combine(i.inverseTransform,this.globalToLocalTransform);var s=!0;if(t.calculateSphere(i.globalToLocalTransform),null!=i.boundBox){var n=i.boundBox,e=t.sphere;s=e.x+e.w>n.minX&&e.x-e.w<n.maxX&&e.y+e.w>n.minY&&e.y-e.w<n.maxY&&e.z+e.w>n.minZ&&e.z-e.w<n.maxZ}s&&(i.localToGlobalTransform.combine(this.localToGlobalTransform,i.transform),null!=i.collidable&&i.collidable.collectGeometryAndTransforms(t,i.localToGlobalTransform),null!=i.childrenList&&i.visitChildren(t)),i=i.next}},addChild:function(t){if(null==t)throw new js__$Boot_HaxeError("Parameter child must be non-null.");if(t==this)throw new js__$Boot_HaxeError("An object cannot be added as a child of itself.");for(var i=this._parent;null!=i;){if(i==t)throw new js__$Boot_HaxeError("An object cannot be added as a child to one of it's children (or children's children, etc.).");i=i._parent}if(t._parent!=this)null!=t._parent&&t._parent.removeChild(t),this.addToList(t),t._parent=this;else{if(null==(t=this.removeFromList(t)))throw new js__$Boot_HaxeError("Cannot add child.");this.addToList(t)}return t},removeChild:function(t){if(null==t)throw new js__$Boot_HaxeError("Parameter child must be non-null.");if(t._parent!=this)throw new js__$Boot_HaxeError("The supplied CollisionBoundNode must be a child of the caller.");if(null==(t=this.removeFromList(t)))throw new js__$Boot_HaxeError("Cannot remove child.");return t._parent=null,t},addToList:function(t,i){if(t.next=i,i==this.childrenList)this.childrenList=t;else for(var s=this.childrenList;null!=s;){if(s.next==i){s.next=t;break}s=s.next}},removeFromList:function(t){for(var i=null,s=this.childrenList;null!=s;){if(s==t)return null!=i?i.next=s.next:this.childrenList=s.next,s.next=null,t;i=s,s=s.next}return null},_prepend:function(t){t.next=this.childrenList,this.childrenList=t,t._parent=this},_removeHead:function(){var t=this.childrenList;null!=t&&(this.childrenList=t.next),t._parent=null},__class__:altern_collisions_CollisionBoundNode};var n={__name__:!0,get_minX:function(t){return t.minX},get_minY:function(t){return t.minY},get_minZ:function(t){return t.minZ},get_maxX:function(t){return t.maxX},get_maxY:function(t){return t.maxY},get_maxZ:function(t){return t.maxZ},_new:function(t,i,s,n,e,r){null==r&&(r=0),null==e&&(e=0),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=0);var h=new components_BoundBox;return h.minX=t,h.maxX=i,h.minY=s,h.maxY=n,h.minZ=e,h.maxZ=r,h},init:function(t,i,s,n,e,r,h){null==h&&(h=0),null==r&&(r=0),null==e&&(e=0),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),t.minX=i,t.maxX=s,t.minY=n,t.maxY=e,t.minZ=r,t.maxZ=h},combine:function(t,i,s){i.minX<s.minX?t.minX=i.minX:t.minX=s.minX,i.maxX>s.maxX?t.maxX=i.maxX:t.maxX=s.maxX,i.minY<s.minY?t.minY=i.minY:t.minY=s.minY,i.maxY>s.maxY?t.maxY=i.maxY:t.maxY=s.maxY,i.minZ<s.minZ?t.minZ=i.minZ:t.minZ=s.minZ,i.maxZ>s.maxZ?t.maxZ=i.maxZ:t.maxZ=s.maxZ;t.minX-=0,t.minY-=0,t.minZ-=0,t.maxX+=0,t.maxY+=0,t.maxZ+=0},matchWith:function(t,i){t.minX=i.minX,t.minY=i.minY,t.minZ=i.minZ,t.maxX=i.maxX,t.maxY=i.maxY,t.maxZ=i.maxZ},surfaceArea:function(t){var i=t.maxY-t.minY,s=t.maxZ-t.minZ;return 2*((t.maxX-t.minX)*(i+s)+i*s)},intersectsWithPoint:function(t,i,s,n){return i>=t.minX&&i<=t.maxX&&s>=t.minY&&s<=t.maxY&&n>=t.minZ&&n<=t.maxZ}},altern_ray_IRaycastImpl=function(){};altern_ray_IRaycastImpl.__name__=!0,altern_ray_IRaycastImpl.prototype={__class__:altern_ray_IRaycastImpl};var systems_collisions_ITCollidable=function(){};systems_collisions_ITCollidable.__name__=!0,systems_collisions_ITCollidable.prototype={__class__:systems_collisions_ITCollidable};var util_geom_XYZW=function(){};util_geom_XYZW.__name__=!0,util_geom_XYZW.prototype={__class__:util_geom_XYZW};var jeash_geom_Vector3D=function(t,i,s,n){null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.w=n,this.x=t,this.y=i,this.z=s};jeash_geom_Vector3D.__name__=!0,jeash_geom_Vector3D.__interfaces__=[util_geom_XYZW],jeash_geom_Vector3D.angleBetween=function(t,i){var s=new jeash_geom_Vector3D(t.x,t.y,t.z,t.w),n=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);0!=n&&(s.x/=n,s.y/=n,s.z/=n);var e=new jeash_geom_Vector3D(i.x,i.y,i.z,i.w),r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return 0!=r&&(e.x/=r,e.y/=r,e.z/=r),Math.acos(s.x*e.x+s.y*e.y+s.z*e.z)},jeash_geom_Vector3D.distance=function(t,i){var s=i.x-t.x,n=i.y-t.y,e=i.z-t.z;return Math.sqrt(s*s+n*n+e*e)},jeash_geom_Vector3D.get_X_AXIS=function(){return new jeash_geom_Vector3D(1,0,0)},jeash_geom_Vector3D.get_Y_AXIS=function(){return new jeash_geom_Vector3D(0,1,0)},jeash_geom_Vector3D.get_Z_AXIS=function(){return new jeash_geom_Vector3D(0,0,1)},jeash_geom_Vector3D.prototype={get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},get_lengthSquared:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)*Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},add:function(t){return new jeash_geom_Vector3D(this.x+t.x,this.y+t.y,this.z+t.z)},clone:function(){return new jeash_geom_Vector3D(this.x,this.y,this.z,this.w)},crossProduct:function(t){return new jeash_geom_Vector3D(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,1)},decrementBy:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},dotProduct:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},equals:function(t,i){return null==i&&(i=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!i||this.w==t.w)},incrementBy:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},nearEquals:function(t,i,s){return null==s&&(s=!1),Math.abs(this.x-t.x)<i&&Math.abs(this.y-t.y)<i&&Math.abs(this.z-t.z)<i&&(!s||Math.abs(this.w-t.w)<i)},negate:function(){this.x*=-1,this.y*=-1,this.z*=-1},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0!=t&&(this.x/=t,this.y/=t,this.z/=t),t},project:function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},scaleBy:function(t){this.x*=t,this.y*=t,this.z*=t},subtract:function(t){return new jeash_geom_Vector3D(this.x-t.x,this.y-t.y,this.z-t.z)},toString:function(){return"Vector3D("+this.x+", "+this.y+", "+this.z+")"},__class__:jeash_geom_Vector3D};var altern_collisions_dbvt_DBVT=function(){this._stack=[],this.freeNodes=[],this.numFreeNodes=0,this.aabb=n._new()};altern_collisions_dbvt_DBVT.__name__=!0,altern_collisions_dbvt_DBVT.__interfaces__=[altern_ray_IRaycastImpl,systems_collisions_ITCollidable],altern_collisions_dbvt_DBVT.prototype={purge:function(){this._stack.length=0},moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,s,n=t.aabb,e=this.root;null==e.proxy;){var r=e.child1,h=e.child2,a=e.aabb,o=r.aabb,l=h.aabb,c=a.maxY-a.minY,x=a.maxZ-a.minZ;i=2*((a.maxX-a.minX)*(c+x)+c*x);var m=this.aabb;n.minX<a.minX?m.minX=n.minX:m.minX=a.minX,n.maxX>a.maxX?m.maxX=n.maxX:m.maxX=a.maxX,n.minY<a.minY?m.minY=n.minY:m.minY=a.minY,n.maxY>a.maxY?m.maxY=n.maxY:m.maxY=a.maxY,n.minZ<a.minZ?m.minZ=n.minZ:m.minZ=a.minZ,n.maxZ>a.maxZ?m.maxZ=n.maxZ:m.maxZ=a.maxZ;m.minX-=0,m.minY-=0,m.minZ-=0,m.maxX+=0,m.maxY+=0,m.maxZ+=0;var u=this.aabb,f=u.maxY-u.minY,y=u.maxZ-u.minZ,_=2*(s=2*((u.maxX-u.minX)*(f+y)+f*y)),v=2*(s-i),p=v,d=this.aabb;n.minX<o.minX?d.minX=n.minX:d.minX=o.minX,n.maxX>o.maxX?d.maxX=n.maxX:d.maxX=o.maxX,n.minY<o.minY?d.minY=n.minY:d.minY=o.minY,n.maxY>o.maxY?d.maxY=n.maxY:d.maxY=o.maxY,n.minZ<o.minZ?d.minZ=n.minZ:d.minZ=o.minZ,n.maxZ>o.maxZ?d.maxZ=n.maxZ:d.maxZ=o.maxZ;if(d.minX-=0,d.minY-=0,d.minZ-=0,d.maxX+=0,d.maxY+=0,d.maxZ+=0,null!=r.proxy){var z=this.aabb,g=z.maxY-z.minY,b=z.maxZ-z.minZ;p+=2*((z.maxX-z.minX)*(g+b)+g*b)}else{var w=this.aabb,Y=w.maxY-w.minY,X=w.maxZ-w.minZ,Z=o.maxY-o.minY,T=o.maxZ-o.minZ;p+=2*((w.maxX-w.minX)*(Y+X)+Y*X)-2*((o.maxX-o.minX)*(Z+T)+Z*T)}var P=v,k=this.aabb;n.minX<l.minX?k.minX=n.minX:k.minX=l.minX,n.maxX>l.maxX?k.maxX=n.maxX:k.maxX=l.maxX,n.minY<l.minY?k.minY=n.minY:k.minY=l.minY,n.maxY>l.maxY?k.maxY=n.maxY:k.maxY=l.maxY,n.minZ<l.minZ?k.minZ=n.minZ:k.minZ=l.minZ,n.maxZ>l.maxZ?k.maxZ=n.maxZ:k.maxZ=l.maxZ;if(k.minX-=0,k.minY-=0,k.minZ-=0,k.maxX+=0,k.maxY+=0,k.maxZ+=0,null!=h.proxy){var L=this.aabb,j=L.maxY-L.minY,C=L.maxZ-L.minZ;P+=2*((L.maxX-L.minX)*(j+C)+j*C)}else{var M=this.aabb,F=M.maxY-M.minY,I=M.maxZ-M.minZ,A=l.maxY-l.minY,R=l.maxZ-l.minZ;P+=2*((M.maxX-M.minX)*(F+I)+F*I)-2*((l.maxX-l.minX)*(A+R)+A*R)}if(p<P){if(_<p)break;e=r}else{if(_<P)break;e=h}}var E,O=e.parent;(E=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new altern_collisions_dbvt_DBVTNode).parent=O,E.child1=t,E.child2=e;var S=E.aabb,N=t.aabb,V=e.aabb;N.minX<V.minX?S.minX=N.minX:S.minX=V.minX,N.maxX>V.maxX?S.maxX=N.maxX:S.maxX=V.maxX,N.minY<V.minY?S.minY=N.minY:S.minY=V.minY,N.maxY>V.maxY?S.maxY=N.maxY:S.maxY=V.maxY,N.minZ<V.minZ?S.minZ=N.minZ:S.minZ=V.minZ,N.maxZ>V.maxZ?S.maxZ=N.maxZ:S.maxZ=V.maxZ;for(S.minX-=0,S.minY-=0,S.minZ-=0,S.maxX+=0,S.maxY+=0,S.maxZ+=0,E.height=e.height+1,e.parent=E,t.parent=E,e==this.root?this.root=E:O.child1==e?O.child1=E:O.child2=E;;){var D=(E=this.balance(E)).child1,B=E.child2,G=E.aabb,q=D.aabb,U=B.aabb;q.minX<U.minX?G.minX=q.minX:G.minX=U.minX,q.maxX>U.maxX?G.maxX=q.maxX:G.maxX=U.maxX,q.minY<U.minY?G.minY=q.minY:G.minY=U.minY,q.maxY>U.maxY?G.maxY=q.maxY:G.maxY=U.maxY,q.minZ<U.minZ?G.minZ=q.minZ:G.minZ=U.minZ,q.maxZ>U.maxZ?G.maxZ=q.maxZ:G.maxZ=U.maxZ;G.minX-=0,G.minY-=0,G.minZ-=0,G.maxX+=0,G.maxY+=0,G.maxZ+=0;var W=D.height,H=B.height;if(E.height=W<H?H+1:W+1,null==(E=E.parent))break}}else this.root=t},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,s=t.parent;if(i=s.child1==t?s.child2:s.child1,s==this.root)return this.root=i,void(i.parent=null);var n=s.parent;for(i.parent=n,n.child1==s?n.child1=i:n.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=s);;){var e=(n=this.balance(n)).child1,r=n.child2,h=n.aabb,a=e.aabb,o=r.aabb;a.minX<o.minX?h.minX=a.minX:h.minX=o.minX,a.maxX>o.maxX?h.maxX=a.maxX:h.maxX=o.maxX,a.minY<o.minY?h.minY=a.minY:h.minY=o.minY,a.maxY>o.maxY?h.maxY=a.maxY:h.maxY=o.maxY,a.minZ<o.minZ?h.minZ=a.minZ:h.minZ=o.minZ,a.maxZ>o.maxZ?h.maxZ=a.maxZ:h.maxZ=o.maxZ;h.minX-=0,h.minY-=0,h.minZ-=0,h.maxX+=0,h.maxY+=0,h.maxZ+=0;var l=e.height,c=r.height;if(n.height=l<c?c+1:l+1,null==(n=n.parent))break}}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var s,n=t.parent,e=t.child1,r=t.child2,h=e.height,a=r.height,o=h-a;if(o>1){var l=e.child1,c=e.child2,x=l.height,m=c.height;if(x>m){e.child2=t,t.parent=e,t.child1=c,c.parent=t;var u=t.aabb,f=c.aabb,y=r.aabb;f.minX<y.minX?u.minX=f.minX:u.minX=y.minX,f.maxX>y.maxX?u.maxX=f.maxX:u.maxX=y.maxX,f.minY<y.minY?u.minY=f.minY:u.minY=y.minY,f.maxY>y.maxY?u.maxY=f.maxY:u.maxY=y.maxY,f.minZ<y.minZ?u.minZ=f.minZ:u.minZ=y.minZ,f.maxZ>y.maxZ?u.maxZ=f.maxZ:u.maxZ=y.maxZ;u.minX-=0,u.minY-=0,u.minZ-=0,u.maxX+=0,u.maxY+=0,u.maxZ+=0,s=m-a,t.height=m-(s&s>>31)+1;var _=e.aabb,v=l.aabb,p=t.aabb;v.minX<p.minX?_.minX=v.minX:_.minX=p.minX,v.maxX>p.maxX?_.maxX=v.maxX:_.maxX=p.maxX,v.minY<p.minY?_.minY=v.minY:_.minY=p.minY,v.maxY>p.maxY?_.maxY=v.maxY:_.maxY=p.maxY,v.minZ<p.minZ?_.minZ=v.minZ:_.minZ=p.minZ,v.maxZ>p.maxZ?_.maxZ=v.maxZ:_.maxZ=p.maxZ;_.minX-=0,_.minY-=0,_.minZ-=0,_.maxX+=0,_.maxY+=0,_.maxZ+=0,s=x-i,e.height=x-(s&s>>31)+1}else{e.child1=t,t.parent=e,t.child1=l,l.parent=t;var d=t.aabb,z=l.aabb,g=r.aabb;z.minX<g.minX?d.minX=z.minX:d.minX=g.minX,z.maxX>g.maxX?d.maxX=z.maxX:d.maxX=g.maxX,z.minY<g.minY?d.minY=z.minY:d.minY=g.minY,z.maxY>g.maxY?d.maxY=z.maxY:d.maxY=g.maxY,z.minZ<g.minZ?d.minZ=z.minZ:d.minZ=g.minZ,z.maxZ>g.maxZ?d.maxZ=z.maxZ:d.maxZ=g.maxZ;d.minX-=0,d.minY-=0,d.minZ-=0,d.maxX+=0,d.maxY+=0,d.maxZ+=0,s=x-a,t.height=x-(s&s>>31)+1;var b=e.aabb,w=t.aabb,Y=c.aabb;w.minX<Y.minX?b.minX=w.minX:b.minX=Y.minX,w.maxX>Y.maxX?b.maxX=w.maxX:b.maxX=Y.maxX,w.minY<Y.minY?b.minY=w.minY:b.minY=Y.minY,w.maxY>Y.maxY?b.maxY=w.maxY:b.maxY=Y.maxY,w.minZ<Y.minZ?b.minZ=w.minZ:b.minZ=Y.minZ,w.maxZ>Y.maxZ?b.maxZ=w.maxZ:b.maxZ=Y.maxZ;b.minX-=0,b.minY-=0,b.minZ-=0,b.maxX+=0,b.maxY+=0,b.maxZ+=0,s=i-m,e.height=i-(s&s>>31)+1}return null!=n?n.child1==t?n.child1=e:n.child2=e:this.root=e,e.parent=n,e}if(o<-1){var X=r.child1,Z=r.child2,T=X.height,P=Z.height;if(T>P){r.child2=t,t.parent=r,t.child2=Z,Z.parent=t;var k=t.aabb,L=e.aabb,j=Z.aabb;L.minX<j.minX?k.minX=L.minX:k.minX=j.minX,L.maxX>j.maxX?k.maxX=L.maxX:k.maxX=j.maxX,L.minY<j.minY?k.minY=L.minY:k.minY=j.minY,L.maxY>j.maxY?k.maxY=L.maxY:k.maxY=j.maxY,L.minZ<j.minZ?k.minZ=L.minZ:k.minZ=j.minZ,L.maxZ>j.maxZ?k.maxZ=L.maxZ:k.maxZ=j.maxZ;k.minX-=0,k.minY-=0,k.minZ-=0,k.maxX+=0,k.maxY+=0,k.maxZ+=0,s=h-P,t.height=h-(s&s>>31)+1;var C=r.aabb,M=X.aabb,F=t.aabb;M.minX<F.minX?C.minX=M.minX:C.minX=F.minX,M.maxX>F.maxX?C.maxX=M.maxX:C.maxX=F.maxX,M.minY<F.minY?C.minY=M.minY:C.minY=F.minY,M.maxY>F.maxY?C.maxY=M.maxY:C.maxY=F.maxY,M.minZ<F.minZ?C.minZ=M.minZ:C.minZ=F.minZ,M.maxZ>F.maxZ?C.maxZ=M.maxZ:C.maxZ=F.maxZ;C.minX-=0,C.minY-=0,C.minZ-=0,C.maxX+=0,C.maxY+=0,C.maxZ+=0,s=T-i,r.height=T-(s&s>>31)+1}else{r.child1=t,t.parent=r,t.child2=X,X.parent=t;var I=t.aabb,A=e.aabb,R=X.aabb;A.minX<R.minX?I.minX=A.minX:I.minX=R.minX,A.maxX>R.maxX?I.maxX=A.maxX:I.maxX=R.maxX,A.minY<R.minY?I.minY=A.minY:I.minY=R.minY,A.maxY>R.maxY?I.maxY=A.maxY:I.maxY=R.maxY,A.minZ<R.minZ?I.minZ=A.minZ:I.minZ=R.minZ,A.maxZ>R.maxZ?I.maxZ=A.maxZ:I.maxZ=R.maxZ;I.minX-=0,I.minY-=0,I.minZ-=0,I.maxX+=0,I.maxY+=0,I.maxZ+=0,s=h-T,t.height=h-(s&s>>31)+1;var E=r.aabb,O=t.aabb,S=Z.aabb;O.minX<S.minX?E.minX=O.minX:E.minX=S.minX,O.maxX>S.maxX?E.maxX=O.maxX:E.maxX=S.maxX,O.minY<S.minY?E.minY=O.minY:E.minY=S.minY,O.maxY>S.maxY?E.maxY=O.maxY:E.maxY=S.maxY,O.minZ<S.minZ?E.minZ=O.minZ:E.minZ=S.minZ,O.maxZ>S.maxZ?E.maxZ=O.maxZ:E.maxZ=S.maxZ;E.minX-=0,E.minY-=0,E.minZ-=0,E.maxX+=0,E.maxY+=0,E.maxZ+=0,s=i-P,r.height=i-(s&s>>31)+1}return null!=n?n.child1==t?n.child1=r:n.child2=r:this.root=r,r.parent=n,r}return t},fix:function(t){var i=t.child1,s=t.child2,n=t.aabb,e=i.aabb,r=s.aabb;e.minX<r.minX?n.minX=e.minX:n.minX=r.minX,e.maxX>r.maxX?n.maxX=e.maxX:n.maxX=r.maxX,e.minY<r.minY?n.minY=e.minY:n.minY=r.minY,e.maxY>r.maxY?n.maxY=e.maxY:n.maxY=r.maxY,e.minZ<r.minZ?n.minZ=e.minZ:n.minZ=r.minZ,e.maxZ>r.maxZ?n.maxZ=e.maxZ:n.maxZ=r.maxZ;n.minX-=0,n.minY-=0,n.minZ-=0,n.maxX+=0,n.maxY+=0,n.maxZ+=0;var h=i.height,a=s.height;t.height=h<a?a+1:h+1},collectGeometryAndTransforms:function(t,i){var s=0,n=this._stack;n[s++]=this.root;var e=altern_collisions_dbvt_DBVT.COLLIDER_SPHERE;for(e.x=t.sphere.x,e.y=t.sphere.y,e.z=t.sphere.z,e.w=t.sphere.w;--s>=0;){var r=n[s];e.x+e.w>r.aabb.minX&&e.x-e.w<r.aabb.maxX&&e.y+e.w>r.aabb.minY&&e.y-e.w<r.aabb.maxY&&e.z+e.w>r.aabb.minZ&&e.z-e.w<r.aabb.maxZ&&(null!=r.child1&&(n[s++]=r.child1),null!=r.child2&&(n[s++]=r.child2),null!=r.proxy&&null!=r.proxy.collidable&&(null!=r.proxy.transform?(r.proxy.globalToLocalTransform.combine(r.proxy.inverseTransform,t.matrix),t.calculateSphere(r.proxy.globalToLocalTransform),r.proxy.localToGlobalTransform.combine(t.inverseMatrix,r.proxy.transform),r.proxy.collidable.collectGeometryAndTransforms(t,r.proxy.localToGlobalTransform)):r.proxy.collidable.collectGeometryAndTransforms(t,i)))}},intersectRay:function(t,i,s){var n=0,e=this._stack;e[n++]=this.root;for(var r=null,h=0!=s.w?s.w:0!=i.w?i.w:1e22;--n>=0;){var a=e[n];if(util_geom_GeomUtil.boundIntersectRay(t,i,a.aabb.minX,a.aabb.minY,a.aabb.minZ,a.aabb.maxX,a.aabb.maxY,a.aabb.maxZ,s)&&(null!=a.child1&&(e[n++]=a.child1),null!=a.child2&&(e[n++]=a.child2),null!=a.proxy&&null!=a.proxy.raycastable)){var o=s,l=i;if(null!=a.proxy.transform){o=new jeash_geom_Vector3D,l=new jeash_geom_Vector3D;var c=a.proxy.inverseTransform;o.x=c.a*t.x+c.b*t.y+c.c*t.z+c.d,o.y=c.e*t.x+c.f*t.y+c.g*t.z+c.h,o.z=c.i*t.x+c.j*t.y+c.k*t.z+c.l,l.x=c.a*i.x+c.b*i.y+c.c*i.z,l.y=c.e*i.x+c.f*i.y+c.g*i.z,l.z=c.i*i.x+c.j*i.y+c.k*i.z,l.w=h}var x=a.proxy.raycastable.intersectRay(o,l,s);null!=x&&x.w<h&&(h=x.w,r=x)}}return r},__class__:altern_collisions_dbvt_DBVT};var altern_collisions_dbvt_DBVTNode=function(){this.aabb=n._new()};altern_collisions_dbvt_DBVTNode.__name__=!0,altern_collisions_dbvt_DBVTNode.createFrom=function(t,i,s){var n=new altern_collisions_dbvt_DBVTNode,e=new altern_collisions_dbvt_DBVTProxy,r=n.aabb;return r.minX=i.minX,r.minY=i.minY,r.minZ=i.minZ,r.maxX=i.maxX,r.maxY=i.maxY,r.maxZ=i.maxZ,e.collidable=js_Boot.__instanceof(t,systems_collisions_ITCollidable)?t:null,e.raycastable=js_Boot.__instanceof(t,altern_ray_IRaycastImpl)?t:null,null!=s&&(e.transform=s,e.inverseTransform=new components_Transform3D,e.inverseTransform.calculateInversion(s),e.localToGlobalTransform=new components_Transform3D,e.globalToLocalTransform=new components_Transform3D),n.proxy=e,n},altern_collisions_dbvt_DBVTNode.prototype={__class__:altern_collisions_dbvt_DBVTNode};var altern_collisions_dbvt_DBVTProxy=function(){};altern_collisions_dbvt_DBVTProxy.__name__=!0,altern_collisions_dbvt_DBVTProxy.prototype={__class__:altern_collisions_dbvt_DBVTProxy};var altern_culling_CullingDFS=function(){this._aabb=new components_BoundBox,this.initialCulling=63,this.dfsStackCulling=[],this.dfsStack=[]};altern_culling_CullingDFS.__name__=!0,altern_culling_CullingDFS.prototype={purge:function(){this.dfsStack.length=0,this.dfsStackCulling.length=0},start:function(){var t=0;for(this.dfsStack[t]=this.root,this.dfsStackCulling[t]=this.initialCulling,++t;--t>=0;){var i=this.dfsStack[t],s=this.dfsStackCulling[t];null==i.worldToLocalTransform&&i.calculateLocalWorldTransforms();var n=i.worldToLocalTransform;if(null!=this.processWorldToLocal&&this.processWorldToLocal(n,i),null!=this.checkBoundBox&&null!=i.boundBox){var e=this._aabb,r=i.boundBox;e.minX=r.minX,e.minY=r.minY,e.minZ=r.minZ,e.maxX=r.maxX,e.maxY=r.maxY,e.maxZ=r.maxZ;var h=this._aabb,a=i.localToWorldTransform,o=h.minX,l=h.minY,c=h.minZ,x=h.maxX,m=h.maxY,u=h.maxZ;h.minX=17976931348623157e292,h.minY=17976931348623157e292,h.minZ=17976931348623157e292,h.maxX=-17976931348623157e292,h.maxY=-17976931348623157e292,h.maxZ=-17976931348623157e292;var f,y,_,v=o,p=l,d=c;f=v*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),p=l,d=c,f=(v=x)*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),p=m,d=c,f=(v=o)*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),p=l,d=u,f=(v=o)*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),v=h.maxX,p=h.maxY,d=h.minZ,f=v*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),p=m,d=u,f=(v=o)*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),p=l,d=u,f=(v=x)*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),v=h.maxX,p=h.maxY,d=h.maxZ,f=v*a.a+p*a.b+d*a.c+a.d,y=v*a.e+p*a.f+d*a.g+a.h,_=v*a.i+p*a.j+d*a.k+a.l,f<h.minX&&(h.minX=f),y<h.minY&&(h.minY=y),_<h.minZ&&(h.minZ=_),f>h.maxX&&(h.maxX=f),y>h.maxY&&(h.maxY=y),_>h.maxZ&&(h.maxZ=_),s=this.checkBoundBox(this._aabb,s,i)}else s=0;if(s>=0){for(var z=i.childrenList;null!=z;)(null==this.checkChild||this.checkChild(z,s))&&(this.dfsStack[t]=z,this.dfsStackCulling[t]=s,++t),z=z.next;if(n=i.localToWorldTransform,null!=this.processLocalToWorld&&this.processLocalToWorld(n,i),null!=this.processChild&&!this.processChild(i,s))return!1}}return!0},__class__:altern_culling_CullingDFS};var altern_culling_CullingPlane=function(){};altern_culling_CullingPlane.__name__=!0,altern_culling_CullingPlane.create=function(){if(null!=altern_culling_CullingPlane.collector){var t=altern_culling_CullingPlane.collector;return altern_culling_CullingPlane.collector=t.next,t.next=null,t}return new altern_culling_CullingPlane},altern_culling_CullingPlane.prototype={__class__:altern_culling_CullingPlane};var altern_terrain_ICuller=function(){};altern_terrain_ICuller.__name__=!0,altern_terrain_ICuller.prototype={__class__:altern_terrain_ICuller};var altern_culling_DefaultCulling=function(){};altern_culling_DefaultCulling.__name__=!0,altern_culling_DefaultCulling.__interfaces__=[altern_terrain_ICuller],altern_culling_DefaultCulling.cullingInFrustumOf=function(t,i,s,n,e,r,h,a){for(var o=1,l=t;null!=l;){if(0!=(i&o))if(l.x>=0)if(l.y>=0)if(l.z>=0){if(r*l.x+h*l.y+a*l.z<=l.offset)return-1;s*l.x+n*l.y+e*l.z>l.offset&&(i&=63&~o)}else{if(r*l.x+h*l.y+e*l.z<=l.offset)return-1;s*l.x+n*l.y+a*l.z>l.offset&&(i&=63&~o)}else if(l.z>=0){if(r*l.x+n*l.y+a*l.z<=l.offset)return-1;s*l.x+h*l.y+e*l.z>l.offset&&(i&=63&~o)}else{if(r*l.x+n*l.y+e*l.z<=l.offset)return-1;s*l.x+h*l.y+a*l.z>l.offset&&(i&=63&~o)}else if(l.y>=0)if(l.z>=0){if(s*l.x+h*l.y+a*l.z<=l.offset)return-1;r*l.x+n*l.y+e*l.z>l.offset&&(i&=63&~o)}else{if(s*l.x+h*l.y+e*l.z<=l.offset)return-1;r*l.x+n*l.y+a*l.z>l.offset&&(i&=63&~o)}else if(l.z>=0){if(s*l.x+n*l.y+a*l.z<=l.offset)return-1;r*l.x+h*l.y+e*l.z>l.offset&&(i&=63&~o)}else{if(s*l.x+n*l.y+e*l.z<=l.offset)return-1;r*l.x+h*l.y+a*l.z>l.offset&&(i&=63&~o)}o<<=1,l=l.next}return i},altern_culling_DefaultCulling.isInFrontOfFrustum=function(t,i,s,n,e,r,h,a,o,l){var c,x,m,u,f,y,_,v,p,d,z,g,b=n-t,w=t*(x=(c=o-s)*(v=e-i)-(f=a-i)*(y=r-s))+i*(m=(u=h-t)*y-c*b)+s*(_=f*b-u*v);if(x*l[0].x+m*l[0].y+_*l[0].z<=w)return!1;d=!1,z=!1,g=!1;for(var Y=0,X=l.length;Y<X;){if(x*(p=l[Y++]).x+m*p.y+_*p.z>=w?z=!0:d=!0,z&&d){g=!0;break}}return g},altern_culling_DefaultCulling.createNewTri=function(){var t,i,s=new altern_geom_Face;return t=new altern_geom_Wrapper,s.wrapper=t,i=new altern_geom_Vertex,t.vertex=i,t=t.next=new altern_geom_Wrapper,i=new altern_geom_Vertex,t.vertex=i.next=i,t=t.next=new altern_geom_Wrapper,i=new altern_geom_Vertex,t.vertex=i.next=i,s},altern_culling_DefaultCulling.collectClippedFace=function(){var t=altern_culling_DefaultCulling.clippedFace;t.destroy(),t.next=altern_geom_Face.collector,altern_geom_Face.collector=t},altern_culling_DefaultCulling.collectClippedFace2=function(){var t=altern_culling_DefaultCulling.clippedFace2;t.destroy(),t.next=altern_geom_Face.collector,altern_geom_Face.collector=t},altern_culling_DefaultCulling.triInFrustumCover=function(t,i,s,n,e,r,h,a,o,l){for(var c=null,x=altern_culling_DefaultCulling.CLIP_NEAR,m=null,u=t;null!=u;){if(i*u.x+s*u.y+n*u.z<u.offset&&e*u.x+r*u.y+h*u.z<u.offset&&a*u.x+o*u.y+l*u.z<u.offset)return-1;c=u,u=u.next,x&&null!=u&&null==u.next&&(m=u)}var f=0;return(i*(u=c).x+s*u.y+n*u.z<u.offset||e*u.x+r*u.y+h*u.z<u.offset||a*u.x+o*u.y+l*u.z<u.offset)&&(null==altern_culling_DefaultCulling.clippingTri&&(altern_culling_DefaultCulling.clippingTri=altern_culling_DefaultCulling.createNewTri(),altern_culling_DefaultCulling.clippingNormal=new util_geom_Vec3),altern_culling_DefaultCulling.clippingTri.wrapper.vertex.x=i,altern_culling_DefaultCulling.clippingTri.wrapper.vertex.y=s,altern_culling_DefaultCulling.clippingTri.wrapper.vertex.z=n,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.x=e,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.y=r,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.z=h,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.x=a,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.y=o,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.z=l,altern_culling_DefaultCulling.clippingNormal.x=u.x,altern_culling_DefaultCulling.clippingNormal.y=u.y,altern_culling_DefaultCulling.clippingNormal.z=u.z,altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(altern_culling_DefaultCulling.clippingTri,altern_culling_DefaultCulling.clippingNormal),altern_culling_DefaultCulling.clippedFace=altern_geom_ClipMacros.newPositiveClipFace(altern_culling_DefaultCulling.clippingTri,altern_culling_DefaultCulling.clippingNormal,u.offset),f|=1),x&&(i*(u=m).x+s*u.y+n*u.z<u.offset||e*u.x+r*u.y+h*u.z<u.offset||a*u.x+o*u.y+l*u.z<u.offset)&&(null==altern_culling_DefaultCulling.clippingTri2&&(altern_culling_DefaultCulling.clippingTri2=altern_culling_DefaultCulling.createNewTri(),altern_culling_DefaultCulling.clippingNormal2=new util_geom_Vec3),altern_culling_DefaultCulling.clippingTri2.wrapper.vertex.x=i,altern_culling_DefaultCulling.clippingTri2.wrapper.vertex.y=s,altern_culling_DefaultCulling.clippingTri2.wrapper.vertex.z=n,altern_culling_DefaultCulling.clippingTri2.wrapper.next.vertex.x=e,altern_culling_DefaultCulling.clippingTri2.wrapper.next.vertex.y=r,altern_culling_DefaultCulling.clippingTri2.wrapper.next.vertex.z=h,altern_culling_DefaultCulling.clippingTri2.wrapper.next.next.vertex.x=a,altern_culling_DefaultCulling.clippingTri2.wrapper.next.next.vertex.y=o,altern_culling_DefaultCulling.clippingTri2.wrapper.next.next.vertex.z=l,altern_culling_DefaultCulling.clippingNormal2.x=u.x,altern_culling_DefaultCulling.clippingNormal2.y=u.y,altern_culling_DefaultCulling.clippingNormal2.z=u.z,altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(altern_culling_DefaultCulling.clippingTri2,altern_culling_DefaultCulling.clippingNormal2),altern_culling_DefaultCulling.clippedFace2=altern_geom_ClipMacros.newPositiveClipFace(altern_culling_DefaultCulling.clippingTri2,altern_culling_DefaultCulling.clippingNormal2,u.offset),f|=2),f},altern_culling_DefaultCulling.pointInFrustum=function(t,i,s,n){for(var e=t;null!=e;){if(i*e.x+s*e.y+n*e.z<e.offset)return!1;e=e.next}return!0},altern_culling_DefaultCulling.prototype={cullingInFrustum:function(t,i,s,n,e,r,h){for(var a=1,o=this.frustum;null!=o;){if(0!=(t&a))if(o.x>=0)if(o.y>=0)if(o.z>=0){if(e*o.x+r*o.y+h*o.z<=o.offset)return-1;i*o.x+s*o.y+n*o.z>o.offset&&(t&=63&~a)}else{if(e*o.x+r*o.y+n*o.z<=o.offset)return-1;i*o.x+s*o.y+h*o.z>o.offset&&(t&=63&~a)}else if(o.z>=0){if(e*o.x+s*o.y+h*o.z<=o.offset)return-1;i*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~a)}else{if(e*o.x+s*o.y+n*o.z<=o.offset)return-1;i*o.x+r*o.y+h*o.z>o.offset&&(t&=63&~a)}else if(o.y>=0)if(o.z>=0){if(i*o.x+r*o.y+h*o.z<=o.offset)return-1;e*o.x+s*o.y+n*o.z>o.offset&&(t&=63&~a)}else{if(i*o.x+r*o.y+n*o.z<=o.offset)return-1;e*o.x+s*o.y+h*o.z>o.offset&&(t&=63&~a)}else if(o.z>=0){if(i*o.x+s*o.y+h*o.z<=o.offset)return-1;e*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~a)}else{if(i*o.x+s*o.y+n*o.z<=o.offset)return-1;e*o.x+r*o.y+h*o.z>o.offset&&(t&=63&~a)}a<<=1,o=o.next}return t},__class__:altern_culling_DefaultCulling};var altern_culling_IFrustumCollectTri=function(){};altern_culling_IFrustumCollectTri.__name__=!0,altern_culling_IFrustumCollectTri.prototype={__class__:altern_culling_IFrustumCollectTri};var components_Transform3D=function(){this.identity()};components_Transform3D.__name__=!0,components_Transform3D.prototype={identity:function(){this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=1,this.g=0,this.h=0,this.i=0,this.j=0,this.k=1,this.l=0},compose:function(t,i,s,n,e,r,h,a,o){var l=Math.cos(n),c=Math.sin(n),x=Math.cos(e),m=Math.sin(e),u=Math.cos(r),f=Math.sin(r),y=u*m,_=f*m,v=x*h,p=c*a,d=l*a,z=l*o,g=c*o;this.a=u*v,this.b=y*p-f*d,this.c=y*z+f*g,this.d=t,this.e=f*v,this.f=_*p+u*d,this.g=_*z-u*g,this.h=i,this.i=-m*h,this.j=x*p,this.k=x*z,this.l=s},invert:function(){var t=this.a,i=this.b,s=this.c,n=this.d,e=this.e,r=this.f,h=this.g,a=this.h,o=this.i,l=this.j,c=this.k,x=this.l,m=1/(-s*r*o+i*h*o+s*e*l-t*h*l-i*e*c+t*r*c);this.a=(-h*l+r*c)*m,this.b=(s*l-i*c)*m,this.c=(-s*r+i*h)*m,this.d=(n*h*l-s*a*l-n*r*c+i*a*c+s*r*x-i*h*x)*m,this.e=(h*o-e*c)*m,this.f=(-s*o+t*c)*m,this.g=(s*e-t*h)*m,this.h=(s*a*o-n*h*o+n*e*c-t*a*c-s*e*x+t*h*x)*m,this.i=(-r*o+e*l)*m,this.j=(i*o-t*l)*m,this.k=(-i*e+t*r)*m,this.l=(n*r*o-i*a*o-n*e*l+t*a*l+i*e*x-t*r*x)*m},initFromVector:function(t){this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5],this.g=t[6],this.h=t[7],this.i=t[8],this.j=t[9],this.k=t[10],this.l=t[11]},append:function(t){var i=this.a,s=this.b,n=this.c,e=this.d,r=this.e,h=this.f,a=this.g,o=this.h,l=this.i,c=this.j,x=this.k,m=this.l;this.a=t.a*i+t.b*r+t.c*l,this.b=t.a*s+t.b*h+t.c*c,this.c=t.a*n+t.b*a+t.c*x,this.d=t.a*e+t.b*o+t.c*m+t.d,this.e=t.e*i+t.f*r+t.g*l,this.f=t.e*s+t.f*h+t.g*c,this.g=t.e*n+t.f*a+t.g*x,this.h=t.e*e+t.f*o+t.g*m+t.h,this.i=t.i*i+t.j*r+t.k*l,this.j=t.i*s+t.j*h+t.k*c,this.k=t.i*n+t.j*a+t.k*x,this.l=t.i*e+t.j*o+t.k*m+t.l},prepend:function(t){var i=this.a,s=this.b,n=this.c,e=this.d,r=this.e,h=this.f,a=this.g,o=this.h,l=this.i,c=this.j,x=this.k,m=this.l;this.a=i*t.a+s*t.e+n*t.i,this.b=i*t.b+s*t.f+n*t.j,this.c=i*t.c+s*t.g+n*t.k,this.d=i*t.d+s*t.h+n*t.l+e,this.e=r*t.a+h*t.e+a*t.i,this.f=r*t.b+h*t.f+a*t.j,this.g=r*t.c+h*t.g+a*t.k,this.h=r*t.d+h*t.h+a*t.l+o,this.i=l*t.a+c*t.e+x*t.i,this.j=l*t.b+c*t.f+x*t.j,this.k=l*t.c+c*t.g+x*t.k,this.l=l*t.d+c*t.h+x*t.l+m},combine:function(t,i){this.a=t.a*i.a+t.b*i.e+t.c*i.i,this.b=t.a*i.b+t.b*i.f+t.c*i.j,this.c=t.a*i.c+t.b*i.g+t.c*i.k,this.d=t.a*i.d+t.b*i.h+t.c*i.l+t.d,this.e=t.e*i.a+t.f*i.e+t.g*i.i,this.f=t.e*i.b+t.f*i.f+t.g*i.j,this.g=t.e*i.c+t.f*i.g+t.g*i.k,this.h=t.e*i.d+t.f*i.h+t.g*i.l+t.h,this.i=t.i*i.a+t.j*i.e+t.k*i.i,this.j=t.i*i.b+t.j*i.f+t.k*i.j,this.k=t.i*i.c+t.j*i.g+t.k*i.k,this.l=t.i*i.d+t.j*i.h+t.k*i.l+t.l},calculateInversion:function(t){var i=t.a,s=t.b,n=t.c,e=t.d,r=t.e,h=t.f,a=t.g,o=t.h,l=t.i,c=t.j,x=t.k,m=t.l,u=1/(-n*h*l+s*a*l+n*r*c-i*a*c-s*r*x+i*h*x);this.a=(-a*c+h*x)*u,this.b=(n*c-s*x)*u,this.c=(-n*h+s*a)*u,this.d=(e*a*c-n*o*c-e*h*x+s*o*x+n*h*m-s*a*m)*u,this.e=(a*l-r*x)*u,this.f=(-n*l+i*x)*u,this.g=(n*r-i*a)*u,this.h=(n*o*l-e*a*l+e*r*x-i*o*x-n*r*m+i*a*m)*u,this.i=(-h*l+r*c)*u,this.j=(s*l-i*c)*u,this.k=(-s*r+i*h)*u,this.l=(e*h*l-s*o*l-e*r*c+i*o*c+s*r*m-i*h*m)*u},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l},__class__:components_Transform3D};var altern_culling_TargetBoardTester=function(){this.delaunatorPts=[],this.dfsStackCulling=[],this.dfsStack=[],this.priorityCover=0,this.nearClip=0,this.planeOrientedFarclip=!1,this.yLockedNearClip=!1,this.dummyVec=new util_geom_Vec3,this.nearClipPointRef2=new jeash_geom_Vector3D,this.nearClipPointRef=new jeash_geom_Vector3D,this.testFrustumPoints2=[],this.testFrustumPoints=[],this.testVertices=[],this.testIndices=[],this.RIGHT=new jeash_geom_Vector3D(1,0,0),this.UP=new jeash_geom_Vector3D(0,1,0),this.targLook=new util_geom_Vec3,this.targUp=new util_geom_Vec3,this.targRight=new util_geom_Vec3,this.targPos=new util_geom_Vec3,this.targOrigin=new util_geom_Vec3,this.proot=new util_geom_Vec3,this.position=new jeash_geom_Vector3D,this.testFrustumPoints[0]=new jeash_geom_Vector3D,this.testFrustumPoints[1]=new jeash_geom_Vector3D,this.testFrustumPoints[2]=new jeash_geom_Vector3D,this.testFrustumPoints[3]=new jeash_geom_Vector3D,this.testFrustumPoints[4]=new jeash_geom_Vector3D,this.testFrustumPoints2[0]=new jeash_geom_Vector3D,this.testFrustumPoints2[1]=new jeash_geom_Vector3D,this.testFrustumPoints2[2]=new jeash_geom_Vector3D,this.testFrustumPoints2[3]=new jeash_geom_Vector3D,this.testFrustumPoints2[4]=new jeash_geom_Vector3D,this.testFrustum=this.setupNewFrustum()};altern_culling_TargetBoardTester.__name__=!0,altern_culling_TargetBoardTester.prototype={setObserverPosition:function(t,i,s){this.position.x=t,this.position.y=i,this.position.z=s},setObserverPriority:function(t){this.priorityCover=t},setupTargetBoard:function(t,i,s,n,e,r,h){var a,o,l,c;if(this.targPos.x=t.x,this.targPos.y=t.y,this.targPos.z=t.z,this.targUp.x=i.x,this.targUp.y=i.y,this.targUp.z=i.z,this.targRight.x=s.x,this.targRight.y=s.y,this.targRight.z=s.z,null==h){this.dummyVec.x=this.targRight.x,this.dummyVec.y=0,this.dummyVec.z=this.targRight.z,this.dummyVec.normalize();var x=this.dummyVec;x.x*=n,x.y*=n,x.z*=n;var m=this.targRight,u=this.dummyVec;l=(a=(a=m.x*u.x+m.y*u.y+m.z*u.z)<0?-a:a)<(o=(o=this.targRight.y*e)<0?-o:o)?o:a;var f=this.targUp,y=this.dummyVec;c=(c=(a=(a=f.x*y.x+f.y*y.y+f.z*y.z)<0?-a:a)<(o=(o=this.targUp.y*e)<0?-o:o)?o:a)>=l?c:l}else l=n,c=e;var _=0;this.testFrustumPoints[_].x=this.position.x,this.testFrustumPoints[_].y=this.position.y,this.testFrustumPoints[_].z=this.position.z,++_,this.proot.x=this.targPos.x,this.proot.y=this.targPos.y,this.proot.z=this.targPos.z,this.proot.x+=this.targUp.x*c,this.proot.y+=this.targUp.y*c,this.proot.z+=this.targUp.z*c,this.proot.x-=this.targRight.x*l,this.proot.y-=this.targRight.y*l,this.proot.z-=this.targRight.z*l,this.testFrustumPoints[_].x=this.proot.x,this.testFrustumPoints[_].y=this.proot.y,this.testFrustumPoints[_].z=this.proot.z,++_,this.proot.x=this.targPos.x,this.proot.y=this.targPos.y,this.proot.z=this.targPos.z,this.proot.x-=this.targUp.x*c,this.proot.y-=this.targUp.y*c,this.proot.z-=this.targUp.z*c,this.proot.x-=this.targRight.x*l,this.proot.y-=this.targRight.y*l,this.proot.z-=this.targRight.z*l,this.testFrustumPoints[_].x=this.proot.x,this.testFrustumPoints[_].y=this.proot.y,this.testFrustumPoints[_].z=this.proot.z;var v=this.targOrigin,p=this.proot;v.x=p.x,v.y=p.y,v.z=p.z,++_,this.proot.x=this.targPos.x,this.proot.y=this.targPos.y,this.proot.z=this.targPos.z,this.proot.x-=this.targUp.x*c,this.proot.y-=this.targUp.y*c,this.proot.z-=this.targUp.z*c,this.proot.x+=this.targRight.x*l,this.proot.y+=this.targRight.y*l,this.proot.z+=this.targRight.z*l,this.testFrustumPoints[_].x=this.proot.x,this.testFrustumPoints[_].y=this.proot.y,this.testFrustumPoints[_].z=this.proot.z,++_,this.proot.x=this.targPos.x,this.proot.y=this.targPos.y,this.proot.z=this.targPos.z,this.proot.x+=this.targUp.x*c,this.proot.y+=this.targUp.y*c,this.proot.z+=this.targUp.z*c,this.proot.x+=this.targRight.x*l,this.proot.y+=this.targRight.y*l,this.proot.z+=this.targRight.z*l,this.testFrustumPoints[_].x=this.proot.x,this.testFrustumPoints[_].y=this.proot.y,this.testFrustumPoints[_].z=this.proot.z;var d=null!=h?h:null!=this.disposableFace?altern_geom_Face.setupQuad(this.disposableFace,this.targPos,this.targUp,this.targRight,l,c,altern_culling_TargetBoardTester.IDENTITY):altern_geom_Face.getQuad(this.targPos,this.targUp,this.targRight,l,c,altern_culling_TargetBoardTester.IDENTITY);null==h&&(this.disposableFace=d),this.testIndices.length=0,this.testVertices.length=0;var z=0,g=0;for(this.dfsStack[g]=r,this.dfsStackCulling[g]=63,++g,this.targLook.x=this.targPos.x-this.position.x,this.targLook.y=this.targPos.y-this.position.y,this.targLook.z=this.targPos.z-this.position.z,this.targLook.normalize(),this.nearClipPointRef.x=this.position.x+this.nearClip*this.targLook.x,this.nearClipPointRef.y=this.position.y+this.nearClip*this.targLook.y,this.nearClipPointRef.z=this.position.z+this.nearClip*this.targLook.z;--g>=0;){var b=this.dfsStack[g],w=this.dfsStackCulling[g];null==b.worldToLocalTransform&&b.calculateLocalWorldTransforms();for(var Y=b.worldToLocalTransform,X=0,Z=this.testFrustumPoints.length;X<Z;){var T=X++,P=this.testFrustumPoints2[T],k=this.testFrustumPoints[T];P.x=Y.a*k.x+Y.b*k.y+Y.c*k.z+Y.d,P.y=Y.e*k.x+Y.f*k.y+Y.g*k.z+Y.h,P.z=Y.i*k.x+Y.j*k.y+Y.k*k.z+Y.l}if(this.dummyVec.x=Y.a*this.targPos.x+Y.b*this.targPos.y+Y.c*this.targPos.z+Y.d,this.dummyVec.y=Y.e*this.targPos.x+Y.f*this.targPos.y+Y.g*this.targPos.z+Y.h,this.dummyVec.z=Y.i*this.targPos.x+Y.j*this.targPos.y+Y.k*this.targPos.z+Y.l,this.nearClipPointRef2.x=Y.a*this.nearClipPointRef.x+Y.b*this.nearClipPointRef.y+Y.c*this.nearClipPointRef.z+Y.d,this.nearClipPointRef2.y=Y.e*this.nearClipPointRef.x+Y.f*this.nearClipPointRef.y+Y.g*this.nearClipPointRef.z+Y.h,this.nearClipPointRef2.z=Y.i*this.nearClipPointRef.x+Y.j*this.nearClipPointRef.y+Y.k*this.nearClipPointRef.z+Y.l,this.createFrustumFromPoints(this.testFrustumPoints2,this.dummyVec,this.nearClipPointRef2),null!=b.boundBox&&(w=altern_culling_DefaultCulling.cullingInFrustumOf(this.testFrustum,w,b.boundBox.minX,b.boundBox.minY,b.boundBox.minZ,b.boundBox.maxX,b.boundBox.maxY,b.boundBox.maxZ)),w>=0){for(var L,j,C,M,F=b.childrenList;null!=F;)this.dfsStack[g]=F,this.dfsStackCulling[g]=w,++g,F=F.next;if(0!=this.priorityCover){var I;if(null!=b.collidable){var A=b.collidable;I=null!=(L=js_Boot.__instanceof(A,altern_culling_IFrustumCollectTri)?A:null)}else I=!1;if(I)L.collectTrisForFrustum(this.testFrustum,w,this.testFrustumPoints2,this.testVertices,this.testIndices);else{var R;if(null!=b.raycastable){var E=b.raycastable;R=null!=(L=js_Boot.__instanceof(E,altern_culling_IFrustumCollectTri)?E:null)}else R=!1;R&&L.collectTrisForFrustum(this.testFrustum,w,this.testFrustumPoints2,this.testVertices,this.testIndices)}}else{var O;if(null!=b.raycastable){var S=b.raycastable;O=null!=(L=js_Boot.__instanceof(S,altern_culling_IFrustumCollectTri)?S:null)}else O=!1;if(O)L.collectTrisForFrustum(this.testFrustum,w,this.testFrustumPoints2,this.testVertices,this.testIndices);else{var N;if(null!=b.collidable){var V=b.collidable;N=null!=(L=js_Boot.__instanceof(V,altern_culling_IFrustumCollectTri)?V:null)}else N=!1;N&&L.collectTrisForFrustum(this.testFrustum,w,this.testFrustumPoints2,this.testVertices,this.testIndices)}}Y=b.localToWorldTransform;for(var D=this.testVertices.length,B=z;B<D;)j=this.testVertices[B],C=this.testVertices[B+1],M=this.testVertices[B+2],this.testVertices[B]=Y.a*j+Y.b*C+Y.c*M+Y.d,this.testVertices[B+1]=Y.e*j+Y.f*C+Y.g*M+Y.h,this.testVertices[B+2]=Y.i*j+Y.j*C+Y.k*M+Y.l,B+=3;z=this.testVertices.length}}var G=d.getArea();return this.collectClipPolygonsFromSoup(this.testVertices,this.testIndices,this.position.x,this.position.y,this.position.z,G,d)/G},transformVertices:function(t,i){for(var s,n,e,r=this.testVertices.length,h=i;h<r;)s=this.testVertices[h],n=this.testVertices[h+1],e=this.testVertices[h+2],this.testVertices[h]=t.a*s+t.b*n+t.c*e+t.d,this.testVertices[h+1]=t.e*s+t.f*n+t.g*e+t.h,this.testVertices[h+2]=t.i*s+t.j*n+t.k*e+t.l,h+=3},setupNewFrustum:function(){var t=new altern_culling_CullingPlane,i=t;return i=(i=(i=(i=(i=i.next=new altern_culling_CullingPlane).next=new altern_culling_CullingPlane).next=new altern_culling_CullingPlane).next=new altern_culling_CullingPlane).next=new altern_culling_CullingPlane,t},createFrustumFromPoints:function(t,i,s){var n,e=this.testFrustum,r=t[2],h=t[0],a=new jeash_geom_Vector3D(r.x-h.x,r.y-h.y,r.z-h.z),o=t[1],l=t[0],c=new jeash_geom_Vector3D(o.x-l.x,o.y-l.y,o.z-l.z);n=new jeash_geom_Vector3D(a.y*c.z-a.z*c.y,a.z*c.x-a.x*c.z,a.x*c.y-a.y*c.x,1),e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*t[0].x+n.y*t[0].y+n.z*t[0].z,e=e.next;var x=t[3],m=t[0],u=new jeash_geom_Vector3D(x.x-m.x,x.y-m.y,x.z-m.z),f=t[2],y=t[0],_=new jeash_geom_Vector3D(f.x-y.x,f.y-y.y,f.z-y.z);n=new jeash_geom_Vector3D(u.y*_.z-u.z*_.y,u.z*_.x-u.x*_.z,u.x*_.y-u.y*_.x,1),e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*t[0].x+n.y*t[0].y+n.z*t[0].z,e=e.next;var v=t[4],p=t[0],d=new jeash_geom_Vector3D(v.x-p.x,v.y-p.y,v.z-p.z),z=t[3],g=t[0],b=new jeash_geom_Vector3D(z.x-g.x,z.y-g.y,z.z-g.z);n=new jeash_geom_Vector3D(d.y*b.z-d.z*b.y,d.z*b.x-d.x*b.z,d.x*b.y-d.y*b.x,1),e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*t[0].x+n.y*t[0].y+n.z*t[0].z,e=e.next;var w=t[1],Y=t[0],X=new jeash_geom_Vector3D(w.x-Y.x,w.y-Y.y,w.z-Y.z),Z=t[4],T=t[0],P=new jeash_geom_Vector3D(Z.x-T.x,Z.y-T.y,Z.z-T.z);if(n=new jeash_geom_Vector3D(X.y*P.z-X.z*P.y,X.z*P.x-X.x*P.z,X.x*P.y-X.y*P.x,1),e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*t[0].x+n.y*t[0].y+n.z*t[0].z,e=e.next,n.x=i.x-s.x,n.y=this.yLockedNearClip?0:i.y-s.y,n.z=i.z-s.z,e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*s.x+n.y*s.y+n.z*s.z,e=e.next,this.planeOrientedFarclip){var k=t[3],L=t[2],j=new jeash_geom_Vector3D(k.x-L.x,k.y-L.y,k.z-L.z),C=t[1],M=t[2],F=new jeash_geom_Vector3D(C.x-M.x,C.y-M.y,C.z-M.z);n=new jeash_geom_Vector3D(j.y*F.z-j.z*F.y,j.z*F.x-j.x*F.z,j.x*F.y-j.y*F.x,1)}else n.x=t[0].x-i.x,n.y=t[0].y-i.y,n.z=t[0].z-i.z;e.x=n.x,e.y=n.y,e.z=n.z,e.offset=n.x*i.x+n.y*i.y+n.z*i.z},collectClipPolygonsFromSoup:function(t,i,s,n,e,r,h){var a,o,l,c,x,m,u,f=!1;null==this.soupPlaneList&&(u=altern_culling_CullingPlane.create(),this.soupPlaneList=u,u=(u=u.next=altern_culling_CullingPlane.create()).next=altern_culling_CullingPlane.create()),this.soupFaceList=null;var y=0;for(c=i.length,x=0;x<c;){0;var _=3*i[x],v=3*i[x+1],p=3*i[x+2];a=t[_],o=t[_+1],l=t[_+2];var d,z,g,b,w,Y,X=t[v],Z=t[v+1],T=t[v+2],P=t[p],k=t[p+1],L=t[p+2];if(d=a-s,z=o-n,g=l-e,b=X-s,w=Z-n,Y=T-e,(u=this.soupPlaneList).x=Y*z-w*g,u.y=b*g-Y*d,u.z=w*d-b*z,u.offset=a*u.x+o*u.y+l*u.z,d=X-s,z=Z-n,g=T-e,b=P-s,w=k-n,Y=L-e,(u=u.next).x=Y*z-w*g,u.y=b*g-Y*d,u.z=w*d-b*z,u.offset=X*u.x+Z*u.y+T*u.z,d=P-s,z=k-n,g=L-e,b=a-s,w=o-n,Y=l-e,(u=u.next).x=Y*z-w*g,u.y=b*g-Y*d,u.z=w*d-b*z,u.offset=P*u.x+k*u.y+L*u.z,m=altern_geom_ClipMacros.clipWithPlaneList(this.soupPlaneList,h),this.soupNegativeFace=m,null!=m&&(this.soupNegativeFace.next=this.soupFaceList,this.soupFaceList=this.soupNegativeFace,m.getArea()>=r)){f=!0;break}x+=3}if(f){var j=null;for(m=this.soupFaceList;null!=m;)m.destroy(),j=m,m=m.next;return j.next=altern_geom_Face.collector,altern_geom_Face.collector=this.soupFaceList,r}if(null!=this.soupFaceList){if(null==this.soupFaceList.next){y=this.soupFaceList.getArea();var C=this.soupFaceList;return C.next=altern_geom_Face.collector,altern_geom_Face.collector=C,this.soupFaceList=null,y}return altern_geom_ClipMacros.calculateFaceCoordinates(this.soupFaceList,this.targUp,this.targRight,this.targPos),y=this.disposeGetTotalArea(this.soupFaceList)}return y},disposeGetTotalArea:function(t){var i,s,n,e=0,r=null,h=t,a=null,o=null;for(h=t;null!=h;){var l=h.next;for(h.next=null,i=l;null!=i;)h.visible&&i.visible||!h.overlapsOther2D(i)||(h.visible||(h.visible=!0,h.processNext=a,a=h),i.visible||(i.visible=!0,i.processNext=a,a=i)),i=i.next;h.visible||(e+=h.getArea(),h.destroy(),null==o&&(o=h),r=h),h=l}if(null!=r&&(r.next=altern_geom_Face.collector,altern_geom_Face.collector=o),null!=a&&null==a.processNext.processNext){e+=a.getArea()+a.processNext.getArea(),e-=null!=(s=altern_geom_ClipMacros.getOverlapClipFace(a,a.processNext))?s.getArea():0;var c=a.processNext;return c.next=altern_geom_Face.collector,altern_geom_Face.collector=c,a.next=altern_geom_Face.collector,altern_geom_Face.collector=a,a.processNext.destroy(),a.destroy(),e}var x,m,u=null,f=0,y=++altern_geom_ClipMacros.transformId;for(h=a;null!=h;){n=null;var _=h.processNext;for(null,h.next=u,u=h,i=_;null!=i;)h.overlapsOther2D(i)&&null!=(s=altern_geom_ClipMacros.getOverlapClipFace(h,i))&&(i,s.next=n,n=s),i=i.processNext;if(null!=n)for(i=n;null!=i;){for(x=i.wrapper;null!=x;)(m=x.vertex).transformId!=y&&(this.delaunatorPts[f++]=[m.cameraX,m.cameraY],m.transformId=y),x=x.next;i=i.next}h=_}for(i=u;null!=i;){for(x=i.wrapper;null!=x;)(m=x.vertex).transformId!=y&&(this.delaunatorPts[f++]=[m.cameraX,m.cameraY],m.transformId=y),x=x.next;i=i.next}if(this.delaunatorPts.length=f,null!=u){for(var v=Delaunator.from(this.delaunatorPts).triangles,p=0;p<v.length;){var d,z,g,b,w,Y;d=this.delaunatorPts[v[p]][0],z=this.delaunatorPts[v[p]][1],g=this.delaunatorPts[v[p+1]][0],b=this.delaunatorPts[v[p+1]][1];var X=(d+g+(w=this.delaunatorPts[v[p+2]][0]))/3,Z=(z+b+(Y=this.delaunatorPts[v[p+2]][1]))/3;h=u;for(var T=!1;null!=h;){if(h.isPointInside2D(X,Z)){T=!0;break}h=h.next}T&&(e+=Math.abs(.5*(d*(b-Y)+g*(Y-z)+w*(z-b)))),p+=3}for(i=u;null!=i;)i.destroy(),r=i,i=i.next;r.next=altern_geom_Face.collector,altern_geom_Face.collector=u}return e},__class__:altern_culling_TargetBoardTester};var altern_geom_AMesh=function(){};altern_geom_AMesh.__name__=!0,altern_geom_AMesh.prototype={createForm:function(t,i,s,n,e){var r;null==e&&(e=0),null==n&&(n=0),null==s&&(s=0),this.faceList=null,this.edgeList=null,this.vertexList=null;var h=t.indices.length;if(0==t.numVertices||0==h)throw new js__$Boot_HaxeError("The supplied geometry is empty.");var a=[];for(h=3*t.numVertices,r=0;r<h;){var o=new altern_geom_Vertex;o.x=t.vertices[r++],o.y=t.vertices[r++],o.z=t.vertices[r++],a.push(o)}for(h=t.indices.length,r=0;r<h;){var l=t.indices[r++],c=t.indices[r++],x=t.indices[r++],m=new altern_geom_Face;m.wrapper=new altern_geom_Wrapper,m.wrapper.vertex=a[l],m.wrapper.next=new altern_geom_Wrapper,m.wrapper.next.vertex=a[c],m.wrapper.next.next=new altern_geom_Wrapper,m.wrapper.next.next.vertex=a[x],m.calculateBestSequenceAndNormal(),m.next=this.faceList,this.faceList=m}this.vertexList=0!=(4&i)?this.weldVertices(a,s):this.getVerticesFromArray(a),0!=(8&i)&&this.weldFaces(n,e),0!=(3&i)&&this.createEdges(i)},checkConvex:function(){return null==this.calculateEdges()},createEdges:function(t){null==t&&(t=3);var i=this.calculateEdges();if(0!=(1&t)&&null!=i)throw this.faceList=null,this.edgeList=null,this.vertexList=null,new js__$Boot_HaxeError(i);0==(2&t)&&(this.edgeList=null)},getVerticesFromArray:function(t){var i;if(0==t.length)return null;for(var s=i=t[0],n=1,e=t.length;n<e;){var r=n++;s=s.next=t[r]}return i},destroyForm:function(){this.faceList=null,this.edgeList=null,this.vertexList=null},weldVertices:function(t,i){var s,n=t.length;this.group(t,0,n,0,i,[]);for(var e=this.faceList;null!=e;){for(var r=e.wrapper;null!=r;)null!=r.vertex.value&&(r.vertex=r.vertex.value),r=r.next;e=e.next}for(var h=null,a=0,o=n;a<o;){null==(s=t[a++]).value&&(s.next=h,h=s)}return h},group:function(t,i,s,n,e,r){var h,a,o;switch(n){case 0:for(var l=i,c=s;l<c;){(o=t[l++]).offset=o.x}break;case 1:for(var x=i,m=s;x<m;){(o=t[x++]).offset=o.y}break;case 2:for(var u=i,f=s;u<f;){(o=t[u++]).offset=o.z}}r[0]=i,r[1]=s-1;for(var y=2;y>0;){var _=r[--y];a=_;var v=r[--y];h=v;for(var p=(o=t[_+v>>1]).offset;h<=a;){for(var d=t[h];d.offset>p;)d=t[++h];for(var z=t[a];z.offset<p;)z=t[--a];h<=a&&(t[h]=z,t[a]=d,++h,--a)}v<a&&(r[y]=v,r[++y]=a,++y),h<_&&(r[y]=h,r[++y]=_,++y)}o=t[h=i];for(var g=null,b=h+1,w=s+1;b<w;){var Y=b++;Y<s&&(g=t[Y]),Y==s||o.offset-g.offset>e?(n<2&&Y-h>1&&this.group(t,h,Y,n+1,e,r),Y<s&&(o=t[h=Y])):2==n&&(g.value=o)}},weldFaces:function(t,i){var s,n,e,r,h,a,o,l,c,x,m,u,f,y,_,v,p,d,z,g,b,w,Y,X,Z,T;null==i&&(i=0),null==t&&(t=0);var P=altern_geom_AMesh.DIGIT_THRESHOLD;t=Math.cos(t)-P,i=Math.cos(Math.PI-i)-P;var k=new haxe_ds_ObjectMap,L=new haxe_ds_ObjectMap;for(n=this.faceList;null!=n;){for(e=n.next,n.next=null,k.set(n,!0),l=n.wrapper;null!=l;)u=l.vertex,null==(T=L.h[u.__id__])&&(T=new haxe_ds_ObjectMap,L.set(u,T)),T.set(n,!0),l=l.next;n=e}this.faceList=null;for(var j=[],C=new haxe_ds_ObjectMap,M=new haxe_ds_ObjectMap;;){n=null;for(var F=k.keys();F.hasNext();){var I=F.next();n=I,k.remove(I);break}if(null==n)break;var A=0;j[A]=n,++A,w=n.normalX,Y=n.normalY,X=n.normalZ;for(var R=M.keys();R.hasNext();){var E=R.next();M.remove(E)}for(var O=0,S=A;O<S;){n=j[O++];for(var N=C.keys();N.hasNext();){var V=N.next();C.remove(V)}for(a=n.wrapper;null!=a;){for(var D=L.h[a.vertex.__id__].keys();D.hasNext();){var B=D.next();k.h[B.__id__]&&!M.h[B.__id__]&&C.set(B,!0)}a=a.next}for(var G=C.keys();G.hasNext();){if(w*(s=G.next()).normalX+Y*s.normalY+X*s.normalZ>=t){for(a=n.wrapper;null!=a;){for(l=null!=a.next?a.next:n.wrapper,o=s.wrapper;null!=o&&(c=null!=o.next?o.next:s.wrapper,a.vertex!=c.vertex||l.vertex!=o.vertex););if(null!=o)break;a=a.next,o=o.next}null!=a&&(j[A]=s,++A,k.remove(s))}else M.set(s,!0)}}if(1==A)(n=j[0]).next=this.faceList,this.faceList=n;else{for(;;){for(var q=!1,U=0,W=A-1;U<W;){var H=U++;if(null!=(n=j[H]))for(var K=1,J=A;K<J;){var Q=K++;if(null!=(s=j[Q])){for(a=n.wrapper;null!=a;){for(l=null!=a.next?a.next:n.wrapper,o=s.wrapper;null!=o&&(c=null!=o.next?o.next:s.wrapper,a.vertex!=c.vertex||l.vertex!=o.vertex);)o=o.next;if(null!=o)break;a=a.next}if(null!=a){for(;;){for(x=null!=l.next?l.next:n.wrapper,h=s.wrapper;h.next!=o&&null!=h.next;)h=h.next;if(x.vertex!=h.vertex)break;l=x,o=h}for(;;){for(r=n.wrapper;r.next!=a&&null!=r.next;)r=r.next;if(m=null!=c.next?c.next:s.wrapper,r.vertex!=m.vertex)break;a=r,c=m}if(f=a.vertex,y=m.vertex,_=r.vertex,v=y.x-f.x,p=y.y-f.y,d=y.z-f.z,z=_.x-f.x,g=_.y-f.y,Y=z*d-(b=_.z-f.z)*v,X=g*v-z*p,(w=b*p-g*d)<P&&w>-P&&Y<P&&Y>-P&&X<P&&X>-P){if(v*z+p*g+d*b>0)continue}else if(n.normalX*w+n.normalY*Y+n.normalZ*X<0)continue;if(p*=Z=1/Math.sqrt(v*v+p*p+d*d),d*=Z,(v*=Z)*(z*=Z=1/Math.sqrt(z*z+g*g+b*b))+p*(g*=Z)+d*(b*=Z)<i)continue;if(f=o.vertex,y=x.vertex,_=h.vertex,v=y.x-f.x,p=y.y-f.y,d=y.z-f.z,z=_.x-f.x,g=_.y-f.y,Y=z*d-(b=_.z-f.z)*v,X=g*v-z*p,(w=b*p-g*d)<P&&w>-P&&Y<P&&Y>-P&&X<P&&X>-P){if(v*z+p*g+d*b>0)continue}else if(n.normalX*w+n.normalY*Y+n.normalZ*X<0)continue;if(p*=Z=1/Math.sqrt(v*v+p*p+d*d),d*=Z,(v*=Z)*(z*=Z=1/Math.sqrt(z*z+g*g+b*b))+p*(g*=Z)+d*(b*=Z)<i)continue;q=!0;var $=new altern_geom_Face;for($.normalX=n.normalX,$.normalY=n.normalY,$.normalZ=n.normalZ,$.offset=n.offset,x=null;l!=a;)(m=new altern_geom_Wrapper).vertex=l.vertex,null!=x?x.next=m:$.wrapper=m,x=m,l=null!=l.next?l.next:n.wrapper;for(;c!=o;)(m=new altern_geom_Wrapper).vertex=c.vertex,null!=x?x.next=m:$.wrapper=m,x=m,c=null!=c.next?c.next:s.wrapper;j[H]=$,j[Q]=null,n=$}}}}if(!q)break}for(var tt=0,it=A;tt<it;){null!=(n=j[tt++])&&(n.calculateBestSequenceAndNormal(),n.next=this.faceList,this.faceList=n)}}}},calculateEdges:function(){var t,i,s;for(t=this.faceList;null!=t;){var n,e;for(i=t.wrapper;null!=i;){for(n=i.vertex,e=null!=i.next?i.next.vertex:t.wrapper.vertex,s=this.edgeList;null!=s;){if(s.a==n&&s.b==e)return"The supplied geometry is not valid.";if(s.a==e&&s.b==n)break;s=s.next}null!=s?s.right=t:((s=new altern_geom_Edge).a=n,s.b=e,s.left=t,s.next=this.edgeList,this.edgeList=s),i=i.next,n=e}t=t.next}for(var r=this.edgeList;null!=r;){if(null==r.left||null==r.right)return"The supplied geometry is non whole.";var h=r.b.x-r.a.x,a=r.b.y-r.a.y,o=r.b.z-r.a.z;if(h*(r.right.normalZ*r.left.normalY-r.right.normalY*r.left.normalZ)+a*(r.right.normalX*r.left.normalZ-r.right.normalZ*r.left.normalX)+o*(r.right.normalY*r.left.normalX-r.right.normalX*r.left.normalY)<0)return"The supplied geometry is non convex.";r=r.next}return null},clearPlanes:function(){var t;if(null!=this.planeList){for(t=this.planeList;null!=t.next;)t=t.next;t.next=altern_culling_CullingPlane.collector,altern_culling_CullingPlane.collector=this.planeList,this.planeList=null}},calculatePlanes:function(t){var i,s,n,e,r;if(null!=this.planeList){for(r=this.planeList;null!=r.next;)r=r.next;r.next=altern_culling_CullingPlane.collector,altern_culling_CullingPlane.collector=this.planeList,this.planeList=null}if(null!=this.faceList&&null!=this.edgeList){var h=!0;for(n=this.faceList;null!=n;)n.normalX*t.x+n.normalY*t.y+n.normalZ*t.z>n.offset?(n.visible=!0,h=!1):n.visible=!1,n=n.next;if(!h)for(var a=this.edgeList;null!=a;)a.left.visible!=a.right.visible&&(a.left.visible?(i=a.a,s=a.b):(i=a.b,s=a.a),i.x,i.y,i.z,s.x,s.y,s.z,(e=altern_culling_CullingPlane.create()).next=this.planeList,this.planeList=e)}},__class__:altern_geom_AMesh};var util_geom_Vec3=function(t,i,s){null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=s};util_geom_Vec3.__name__=!0,util_geom_Vec3.copy=function(t){return new util_geom_Vec3(t.x,t.y,t.z)},util_geom_Vec3.createCross=function(t,i){return new util_geom_Vec3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},util_geom_Vec3.createAdd=function(t,i){return new util_geom_Vec3(t.x+i.x,t.y+i.y,t.z+i.z)},util_geom_Vec3.createSubtract=function(t,i){return new util_geom_Vec3(t.x-i.x,t.y-i.y,t.z-i.z)},util_geom_Vec3.createScale=function(t,i){return new util_geom_Vec3(t.x*i,t.y*i,t.z*i)},util_geom_Vec3.createProjection=function(t,i){var s=t.x*i.x+t.y*i.y+t.z*i.z;return new util_geom_Vec3(t.x-i.x*s,t.y-i.y*s,t.z-i.z*s)},util_geom_Vec3.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},util_geom_Vec3.lengthOf=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},util_geom_Vec3.squareLengthOf=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},util_geom_Vec3.writeCross=function(t,i,s){s.x=t.y*i.z-t.z*i.y,s.y=t.z*i.x-i.z*t.x,s.z=t.x*i.y-t.y*i.x},util_geom_Vec3.writeProjection=function(t,i,s){var n=t.x*i.x+t.y*i.y+t.z*i.z;s.x=t.x-i.x*n,s.y=t.y-i.y*n,s.z=t.z-i.z*n},util_geom_Vec3.writeSubtract=function(t,i){t.x-=i.x,t.y-=i.y,t.z-=i.z},util_geom_Vec3.writeAdd=function(t,i){t.x+=i.x,t.y+=i.y,t.z+=i.z},util_geom_Vec3.writeScale=function(t,i){t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3.prototype={length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSqr:function(){return this.x*this.x+this.y*this.y+this.z*this.z},dotProduct:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossProduct:function(t){return new util_geom_Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},clone:function(){return new util_geom_Vec3(this.x,this.y,this.z)},isZeroVector:function(){return this.x*this.x+this.y*this.y+this.z*this.z==0},crossProductSet:function(t){this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},addScaled:function(t,i){this.x+=t*i.x,this.y+=t*i.y,this.z+=t*i.z},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},sum:function(t,i){this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z},diff:function(t,i){this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z},scale:function(t){this.x*=t,this.y*=t,this.z*=t},reverse:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},transform3:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z,this.y=t.e*this.x+t.f*this.y+t.g*this.z,this.z=t.i*this.x+t.j*this.y+t.k*this.z},transformTransposed3:function(t){this.x=t.a*this.x+t.e*this.y+t.i*this.z,this.y=t.b*this.x+t.f*this.y+t.j*this.z,this.z=t.c*this.x+t.g*this.y+t.k*this.z},reset:function(){this.x=this.y=this.z=0},set:function(t,i,s){this.x=t,this.y=i,this.z=s},saveTo:function(t){t.x=this.x,t.y=this.y,t.z=this.z},copyFrom:function(t){this.x=t.x,this.y=t.y,this.z=t.z},transform4:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z+t.d,this.y=t.e*this.x+t.f*this.y+t.g*this.z+t.h,this.z=t.i*this.x+t.j*this.y+t.k*this.z+t.l},transformTransposed4:function(t){this.x,t.d,this.y,t.h,this.z,t.l;this.x=t.a*this.x+t.e*this.y+t.i*this.z,this.y=t.b*this.x+t.f*this.y+t.j*this.z,this.z=t.c*this.x+t.g*this.y+t.k*this.z},transformVector4:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z,this.y=t.e*this.x+t.f*this.y+t.g*this.z,this.z=t.i*this.x+t.j*this.y+t.k*this.z},assignAddition:function(t,i){this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z},normalize:function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x*=t,this.y*=t,this.z*=t},normalizeWithSquared:function(t){var i=1/Math.sqrt(t);this.x*=i,this.y*=i,this.z*=i},setLength:function(t){var i=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x*=i,this.y*=i,this.z*=i},removeComponent:function(t){var i=this.x*t.x+this.y*t.y+this.z*t.z;this.x-=t.x*i,this.y-=t.y*i,this.z-=t.z*i},distanceTo:function(t){var i=this.x-t.x,s=this.y-t.y,n=this.z-t.z;return Math.sqrt(i*i+s*s+n*n)},toString:function(){return"Vec3("+this.x+", "+this.y+", "+this.z+")"},__class__:util_geom_Vec3};var altern_geom_ClipMacros=function(){};altern_geom_ClipMacros.__name__=!0,altern_geom_ClipMacros.computeMeshVerticesLocalOffsets=function(t,i){var s,n;for(altern_geom_ClipMacros.transformId++,n=t;null!=n;){for(s=n.wrapper;null!=s;){var e=s.vertex;e.transformId!=altern_geom_ClipMacros.transformId&&(e.offset=e.x*i.x+e.y*i.y+e.z*i.z,e.transformId=altern_geom_ClipMacros.transformId),s=s.next}n=n.processNext}},altern_geom_ClipMacros.getClippedVerticesForFace=function(t,i,s,n,e){var r,h,a,o,l,c,x,m=null,u=n.vertex,f=u.offset;for(h=e;null!=h;)r=h.next,((o=(l=h.vertex).offset)>s&&f<=s||o<=s&&f>s)&&(c=(s-f)/(o-f),(x=altern_geom_Vertex.create()).cameraX=u.cameraX+(l.cameraX-u.cameraX)*c,x.cameraY=u.cameraY+(l.cameraY-u.cameraY)*c,x.cameraZ=u.cameraZ+(l.cameraZ-u.cameraZ)*c,x.x=u.x+(l.x-u.x)*c,x.y=u.y+(l.y-u.y)*c,x.z=u.z+(l.z-u.z)*c,(a=altern_geom_Wrapper.create()).vertex=x,null!=m?n.next=a:m=a,n=a),o>s?(null!=m?n.next=h:m=h,n=h,h.next=null):(h.vertex=null,h.next=altern_geom_Wrapper.collector,altern_geom_Wrapper.collector=h),u=l,f=o,h=r;return m},altern_geom_ClipMacros.calculateFaceCoordinates2=function(t,i){var s,n,e,r,h=++altern_geom_ClipMacros.transformId,a=i.wrapper.next.vertex,o=i.wrapper.vertex,l=i.wrapper.next.next.vertex,c=o.x-a.x,x=o.y-a.y,m=o.z-a.z,u=l.x-a.x,f=l.y-a.y,y=l.z-a.z;c*=s=1/Math.sqrt(c*c+x*x+m*m),x*=s,m*=s,u*=s=1/Math.sqrt(u*u+f*f+y*y),f*=s,y*=s;for(var _=t;null!=_;){for(var v=_.wrapper;null!=v;){var p=v.vertex;p.transformId!=h&&(p.transformId=h,n=p.x-a.x,e=p.y-a.y,r=p.z-a.z,p.cameraX=n*u+e*f+r*y,p.cameraY=n*c+e*x+r*m),v=v.next}_=_.next}},altern_geom_ClipMacros.calculateFaceCoordinates=function(t,i,s,n){for(var e,r,h,a=++altern_geom_ClipMacros.transformId,o=i.x,l=i.y,c=i.z,x=s.x,m=s.y,u=s.z,f=t;null!=f;){for(var y=f.wrapper;null!=y;){var _=y.vertex;_.transformId!=a&&(_.transformId=a,e=_.x-n.x,r=_.y-n.y,h=_.z-n.z,_.cameraX=e*x+r*m+h*u,_.cameraY=e*o+r*l+h*c),y=y.next}f=f.next}},altern_geom_ClipMacros.updateClipFace=function(t,i,s){for(var n=t.wrapper,e=n;null!=n;)e=n,n=n.next;t.wrapper=altern_geom_ClipMacros.getClippedVerticesForFace(t,i,s,e,t.wrapper)},altern_geom_ClipMacros.newPositiveClipFace=function(t,i,s){var n=altern_geom_Face.create();n.offset=t.offset,n.normalX=t.normalX,n.normalY=t.normalY,n.normalZ=t.normalZ;var e=t.wrapper,r=altern_geom_Wrapper.create();r.vertex=e.vertex;for(var h,a=e.next,o=r;null!=a;)(h=altern_geom_Wrapper.create()).vertex=a.vertex,o.next=h,o=h,a=a.next;return n.wrapper=altern_geom_ClipMacros.getClippedVerticesForFace(t,i,s,o,r),n},altern_geom_ClipMacros.getOverlapClipFace=function(t,i){var s,n,e,r,h,a,o,l,c=null;e=t.normalX,r=t.normalY,h=t.normalZ;var x=altern_geom_ClipMacros.DUMMY_VECTOR;for(n=t.wrapper;null!=n;){s=n.vertex;var m=null!=n.next?n.next.vertex:t.wrapper.vertex;a=m.x-s.x,o=m.y-s.y,l=m.z-s.z;var u=1/Math.sqrt(a*a+o*o+l*l);a*=u,o*=u,l*=u,x.x=l*r-o*h,x.y=a*h-l*e,x.z=o*e-a*r;var f=s.x*x.x+s.y*x.y+s.z*x.z;if(altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(i,x),null==c?c=altern_geom_ClipMacros.newPositiveClipFace(i,x,f):altern_geom_ClipMacros.updateClipFace(i,x,f),null==c.wrapper&&(c=null),null==(i=c))break;n=n.next}return null!=c?c:null},altern_geom_ClipMacros.clipWithPlaneList=function(t,i,s){var n;null==s&&(s=0);var e=i,r=null,h=altern_geom_ClipMacros.DUMMY_VECTOR,a=0;for(n=t;null!=n;)if(0==(s&1<<a)){h.x=-n.x,h.y=-n.y,h.z=-n.z;var o=-n.offset;if(altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(e,h),null==r?r=altern_geom_ClipMacros.newPositiveClipFace(e,h,o):altern_geom_ClipMacros.updateClipFace(e,h,o),null==r.wrapper&&(r=null),null==(e=r))break;++a,n=n.next}else++a,n=n.next;return null!=r?r:null},altern_geom_ClipMacros.prototype={deepCloneWrapper:function(t){var i=altern_geom_Wrapper.create();i.vertex=t.vertex;for(var s=t.next,n=i;null!=s;){var e=altern_geom_Wrapper.create();e.vertex=s.vertex,n.next=e,n=e,s=s.next}return i},__class__:altern_geom_ClipMacros};var altern_geom_Edge=function(){};altern_geom_Edge.__name__=!0,altern_geom_Edge.prototype={__class__:altern_geom_Edge};var altern_geom_Face=function(){};altern_geom_Face.__name__=!0,altern_geom_Face.create=function(){if(null!=altern_geom_Face.collector){var t=altern_geom_Face.collector;return altern_geom_Face.collector=t.next,t.next=null,t}return new altern_geom_Face},altern_geom_Face.getQuad=function(t,i,s,n,e,r){var h,a,o,l,c=new altern_geom_Face,x=new altern_geom_Wrapper;return c.wrapper=x,h=new altern_geom_Vertex,x.vertex=h,a=t.x,o=t.y,l=t.z,a+=i.x*e,o+=i.y*e,l+=i.z*e,a-=s.x*n,o-=s.y*n,l-=s.z*n,h.x=r.a*a+r.b*o+r.c*l+r.d,h.y=r.e*a+r.f*o+r.g*l+r.h,h.z=r.i*a+r.j*o+r.k*l+r.l,x=x.next=new altern_geom_Wrapper,h=new altern_geom_Vertex,x.vertex=h.next=h,a=t.x,o=t.y,l=t.z,a-=i.x*e,o-=i.y*e,l-=i.z*e,a-=s.x*n,o-=s.y*n,l-=s.z*n,h.x=r.a*a+r.b*o+r.c*l+r.d,h.y=r.e*a+r.f*o+r.g*l+r.h,h.z=r.i*a+r.j*o+r.k*l+r.l,x=x.next=new altern_geom_Wrapper,h=new altern_geom_Vertex,x.vertex=h.next=h,a=t.x,o=t.y,l=t.z,a-=i.x*e,o-=i.y*e,l-=i.z*e,a+=s.x*n,o+=s.y*n,l+=s.z*n,h.x=r.a*a+r.b*o+r.c*l+r.d,h.y=r.e*a+r.f*o+r.g*l+r.h,h.z=r.i*a+r.j*o+r.k*l+r.l,x=x.next=new altern_geom_Wrapper,h=new altern_geom_Vertex,x.vertex=h.next=h,a=t.x,o=t.y,l=t.z,a+=i.x*e,o+=i.y*e,l+=i.z*e,a+=s.x*n,o+=s.y*n,l+=s.z*n,h.x=r.a*a+r.b*o+r.c*l+r.d,h.y=r.e*a+r.f*o+r.g*l+r.h,h.z=r.i*a+r.j*o+r.k*l+r.l,c.calculateNormal(),c},altern_geom_Face.setupQuad=function(t,i,s,n,e,r,h){var a,o,l,c,x=t.wrapper;return a=x.vertex,o=i.x,l=i.y,c=i.z,o+=s.x*r,l+=s.y*r,c+=s.z*r,o-=n.x*e,l-=n.y*e,c-=n.z*e,a.x=h.a*o+h.b*l+h.c*c+h.d,a.y=h.e*o+h.f*l+h.g*c+h.h,a.z=h.i*o+h.j*l+h.k*c+h.l,a=(x=x.next).vertex,o=i.x,l=i.y,c=i.z,o-=s.x*r,l-=s.y*r,c-=s.z*r,o-=n.x*e,l-=n.y*e,c-=n.z*e,a.x=h.a*o+h.b*l+h.c*c+h.d,a.y=h.e*o+h.f*l+h.g*c+h.h,a.z=h.i*o+h.j*l+h.k*c+h.l,a=(x=x.next).vertex,o=i.x,l=i.y,c=i.z,o-=s.x*r,l-=s.y*r,c-=s.z*r,o+=n.x*e,l+=n.y*e,c+=n.z*e,a.x=h.a*o+h.b*l+h.c*c+h.d,a.y=h.e*o+h.f*l+h.g*c+h.h,a.z=h.i*o+h.j*l+h.k*c+h.l,a=(x=x.next).vertex,o=i.x,l=i.y,c=i.z,o+=s.x*r,l+=s.y*r,c+=s.z*r,o+=n.x*e,l+=n.y*e,c+=n.z*e,a.x=h.a*o+h.b*l+h.c*c+h.d,a.y=h.e*o+h.f*l+h.g*c+h.h,a.z=h.i*o+h.j*l+h.k*c+h.l,t.calculateNormal(),t},altern_geom_Face.prototype={collect:function(){this.next=altern_geom_Face.collector,altern_geom_Face.collector=this},destroy:function(){for(var t=this.wrapper;null!=t;){var i=t.next;t.next=altern_geom_Wrapper.collector,altern_geom_Wrapper.collector=t,t.vertex.temp&&(t.vertex.temp=!1,t.vertex.next=altern_geom_Vertex.collector,altern_geom_Vertex.collector=t.vertex),t.vertex=null,t=i}this.wrapper=null,this.processNext=null,this.visible=!1},calculateNormal:function(){var t,i,s,n,e,r,h,a,o,l,c,x,m,u;u=(n=this.wrapper).vertex,m=(n=n.next).vertex,x=(n=n.next).vertex,l=m.x-u.x,o=m.y-u.y,a=m.z-u.z,h=x.x-u.x,r=x.y-u.y,(c=(s=(e=x.z-u.z)*o-r*a)*s+(i=h*a-e*l)*i+(t=r*l-h*o)*t)>0&&(s*=c=1/Math.sqrt(c),i*=c,t*=c,this.normalX=s,this.normalY=i,this.normalZ=t),u.x,u.y,u.z},calculateBestSequenceAndNormal:function(){var t,i,s,n,e,r,h,a,o,l,c,x,m,u;if(null!=this.wrapper.next.next.next){var f,y,_=-1e22,v=null;for(e=this.wrapper;null!=e;){var p=null!=e.next?e.next:this.wrapper,d=null!=p.next?p.next:this.wrapper;u=e.vertex,m=p.vertex,x=d.vertex,c=m.x-u.x,l=m.y-u.y,o=m.z-u.z,a=x.x-u.x,h=x.y-u.y,(t=(n=(r=x.z-u.z)*l-h*o)*n+(s=a*o-r*c)*s+(i=h*c-a*l)*i)>_&&(_=t,v=e)}if(v!=this.wrapper){for(f=this.wrapper.next.next.next;null!=f.next;)f=f.next;for(y=this.wrapper;y.next!=v&&null!=y.next;)y=y.next;f.next=this.wrapper,y.next=null,this.wrapper=v}}u=(e=this.wrapper).vertex,m=(e=e.next).vertex,x=(e=e.next).vertex,c=m.x-u.x,l=m.y-u.y,o=m.z-u.z,a=x.x-u.x,h=x.y-u.y,(t=(n=(r=x.z-u.z)*l-h*o)*n+(s=a*o-r*c)*s+(i=h*c-a*l)*i)>0&&(n*=t=1/Math.sqrt(t),s*=t,i*=t,this.normalX=n,this.normalY=s,this.normalZ=i),this.offset=u.x*n+u.y*s+u.z*i},getArea:function(){for(var t,i=this.wrapper.vertex,s=0,n=(t=this.wrapper.next).next;null!=n;){var e=t.vertex,r=n.vertex,h=e.x-i.x,a=e.y-i.y,o=e.z-i.z,l=r.x-i.x,c=r.y-i.y,x=r.z-i.z,m=a*x-o*c,u=o*l-h*x,f=h*c-a*l;s+=.5*Math.sqrt(m*m+u*u+f*f),t=t.next,n=n.next}return s},overlapsOther2D:function(t){var i,s,n,e,r,h,a,o=null,l=null;for(s=this.wrapper;null!=s;)l=s.vertex,s=s.next;for(h=l,s=t.wrapper;null!=s;)l=s.vertex,s=s.next;for(a=l,l=h,s=this.wrapper;null!=s;){var c=l;l=s.vertex;var x=null!=s.next?s.next.vertex:this.wrapper.vertex;for(o=a,i=t.wrapper;null!=i;){var m=o;o=i.vertex;var u=null!=i.next?i.next.vertex:t.wrapper.vertex;n=-(o.cameraY-l.cameraY),e=o.cameraX-l.cameraX,r=n*l.cameraX+e*l.cameraY;var f=n*c.cameraX+e*c.cameraY-r,y=f>0?1:f<0?-1:0,_=n*x.cameraX+e*x.cameraY-r,v=_>0?1:_<0?-1:0,p=y*v,d=p<0?-2:p>0?y:0==y?v:0==v?y:-2;if(d<-1)i=i.next;else{var z=n*m.cameraX+e*m.cameraY-r,g=z>0?1:z<0?-1:0,b=n*u.cameraX+e*u.cameraY-r,w=b>0?1:b<0?-1:0,Y=g*w,X=Y<0?-2:Y>0?g:0==g?w:0==w?g:-2;if(X<-1)i=i.next;else{if(d*X<0)return!1;i=i.next}}}s=s.next}return!0},isPointInside2D:function(t,i){for(var s,n,e,r=this.wrapper;null!=r;){s=r.vertex;var h=null!=r.next?r.next.vertex:this.wrapper.vertex;if((n=-(h.cameraY-s.cameraY))*t+(e=h.cameraX-s.cameraX)*i<n*s.cameraX+e*s.cameraY)return!1;r=r.next}return!0},get_side:function(t,i,s,n,e){var r=t*n.cameraX+i*n.cameraY-s,h=r>0?1:r<0?-1:0,a=t*e.cameraX+i*e.cameraY-s,o=a>0?1:a<0?-1:0,l=h*o;return l<0?-2:l>0?h:0==h?o:0==o?h:-2},__class__:altern_geom_Face};var altern_geom_IntersectSlopeUtil=function(){this.intersectZ=new x(2),this.intersectTimes=new x(2),this.intersectSides=new Array(2),this.startPosition=new jeash_geom_Vector3D,this.velocity=new jeash_geom_Vector3D,this.pt3=new jeash_geom_Vector3D(70,180,100),this.pt1=new jeash_geom_Vector3D(100,60,60),this.pt2=new jeash_geom_Vector3D(90,60,80),this.endPt=new jeash_geom_Vector3D,this.startPt=new jeash_geom_Vector3D(30,60)};altern_geom_IntersectSlopeUtil.__name__=!0,altern_geom_IntersectSlopeUtil.prototype={sqDistBetween2DVector:function(t,i){var s=i.x-t.x,n=i.y-t.y;return s*s+n*n},rBetween2DVec:function(t,i,s){var n=i.x-t.x,e=i.y-t.y;return n*(s.x-t.x)+e*(s.y-t.y)},setupRay:function(t,i){this.startPt.x=t.x,this.startPt.y=t.y,this.startPt.z=t.z,this.velocity.x=i.x,this.velocity.y=i.y,this.velocity.z=0,this.endPt.x=this.startPt.x+this.velocity.x,this.endPt.y=this.startPt.y+this.velocity.y,this.endPt.z=0},getTriSlopeTrajTime:function(t,i,s){var n=Math.sqrt(t.x*t.x+t.y*t.y);this._unitDist=n,this.velocity.x=n,this.velocity.y=t.z,this.velocity.z=0;var e=this.velocity,r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return 0!=r&&(e.x/=r,e.y/=r,e.z/=r),this.velocity.x*=s,this.velocity.y*=s,this.startPosition.x=-this.intersectTimes[0],this.startPosition.y=this.startPt.z-this.intersectZ[0],this.getTrajectoryTimeOfFlight2(this.startPosition.y,this.velocity.y,i)},setupTri:function(t,i,s,n,e,r,h,a,o){this.pt1.x=t,this.pt1.y=i,this.pt1.z=s,this.pt2.x=n,this.pt2.y=e,this.pt2.z=r,this.pt3.x=h,this.pt3.y=a,this.pt3.z=o},getTrajHeightAtTime:function(t,i,s){return this.startPt.z-.5*i*s*s+t.y*s},getTrajHeightAtTime2:function(t,i,s,n){return this.startPt.z-.5*i*n*n+t.y*s*n},getGradHeightAtTime:function(t){return this.intersectZ[0]+(t-this.intersectTimes[0])*this.gradient},getFlatTrajTime:function(t,i,s,n){null==n&&(n=0),this.velocity.x=Math.sqrt(t.x*t.x+t.y*t.y),this.velocity.y=t.z,this.velocity.z=0;var e=this.velocity,r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return 0!=r&&(e.x/=r,e.y/=r,e.z/=r),this.velocity.x*=s,this.velocity.y*=s,this.startPosition.x=0,this.startPosition.y=0,this.gradient=n,this.getTrajectoryTimeOfFlight2(this.startPosition.y,this.velocity.y,i)},getTrajectoryTimeOfFlight2:function(t,i,s){var n=i/s;Math.sqrt(i*i+2*s*t);this._tRise=n,this._h=t+i*i/(2*s);var e,r,h=this.gradient,a=-this.startPosition.x*this.gradient,o=-t,l=0,c=0;e=s/2;var x=(r=-i+h*this.velocity.x)*r-4*e*(o-a);return x>0?(h*(l=(-r+Math.sqrt(x))/(2*e))+a,h*(c=(-r-Math.sqrt(x))/(2*e))+a,l>c?l:c):0==x?(h*(l=-r/(2*e))+a,l):-1},getTriIntersections:function(){var t,i=0;this._coincident=!1,this.IsIntersecting(this.startPt,this.endPt,this.pt1,this.pt2)&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt2.z*this.s-this.pt1.z*this.s+this.pt1.z,this.intersectSides[i]=3,++i),this.IsIntersecting(this.startPt,this.endPt,this.pt2,this.pt3)&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt3.z*this.s-this.pt2.z*this.s+this.pt2.z,this.intersectSides[i]=6,++i),this.IsIntersecting(this.startPt,this.endPt,this.pt3,this.pt1)&&i<2&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt1.z*this.s-this.pt3.z*this.s+this.pt3.z,this.intersectSides[i]=5,++i);this.endPt.x,this.startPt.x,this.endPt.y,this.startPt.y;var s=this.intersectTimes[0],n=this.intersectZ[0],e=this.intersectSides[0];return this.intersectTimes[1]<s&&(this.intersectTimes[0]=this.intersectTimes[1],this.intersectZ[0]=this.intersectZ[1],this.intersectSides[0]=this.intersectSides[1],this.intersectTimes[1]=s,this.intersectZ[1]=n,this.intersectSides[1]=e),this.intersectTimes[0]<0&&(this.intersectZ[0]-=this.intersectTimes[0]/(this.intersectTimes[1]-this.intersectTimes[0])*(this.intersectZ[1]-this.intersectZ[0]),this.intersectTimes[0]=0),this._coincident?i>1?(t=this.intersectTimes[1]-this.intersectTimes[0],this.gradient=(this.intersectZ[1]-this.intersectZ[0])/t,2):-2:0!=i?(t=this.intersectTimes[1]-this.intersectTimes[0],i>1?t>0?(this.gradient=(this.intersectZ[1]-this.intersectZ[0])/t,1):-1:-3):0},IsIntersecting:function(t,i,s,n){var e=(i.x-t.x)*(n.y-s.y)-(i.y-t.y)*(n.x-s.x),r=(t.y-s.y)*(n.x-s.x)-(t.x-s.x)*(n.y-s.y),h=(t.y-s.y)*(i.x-t.x)-(t.x-s.x)*(i.y-t.y);if(0==e){var a,o,l=s.x-t.x,c=s.y-t.y,x=n.x-t.x,m=n.y-t.y;if(a=l*l+c*c<x*x+m*m?0:1,this.s=a,0!=this.s){var u=i.x-t.x,f=i.y-t.y;o=u*(n.x-t.x)+f*(n.y-t.y)}else{var y=i.x-t.x,_=i.y-t.y;o=y*(s.x-t.x)+_*(s.y-t.y)}return this.r=o,this._coincident=!0,!1}return this.r=r/e,this.s=h/e,this.s>=0&&this.s<=1},__class__:altern_geom_IntersectSlopeUtil};var altern_geom_Vertex=function(){this.transformId=0};altern_geom_Vertex.__name__=!0,altern_geom_Vertex.create=function(){if(null!=altern_geom_Vertex.collector){var t=altern_geom_Vertex.collector;return altern_geom_Vertex.collector=t.next,t.next=null,t.transformId=0,t.temp=!0,t}return new altern_geom_Vertex},altern_geom_Vertex.prototype={__class__:altern_geom_Vertex};var altern_geom_Wrapper=function(){};altern_geom_Wrapper.__name__=!0,altern_geom_Wrapper.create=function(){if(null!=altern_geom_Wrapper.collector){var t=altern_geom_Wrapper.collector;return altern_geom_Wrapper.collector=altern_geom_Wrapper.collector.next,t.next=null,t}return new altern_geom_Wrapper},altern_geom_Wrapper.prototype={__class__:altern_geom_Wrapper};var altern_partition_js_BVHTree=function(t){this.aabbTriCount=0,this.aabbTris=new Int32Array(64),this._stackCulling=[],this._stack=[],this.geom=new util_geom_Geometry,this._result=new jeash_geom_Vector3D,this.bvh=t};altern_partition_js_BVHTree.__name__=!0,altern_partition_js_BVHTree.__interfaces__=[altern_culling_IFrustumCollectTri,altern_ray_IRaycastImpl,systems_collisions_ITCollidable],altern_partition_js_BVHTree.prototype={setBufferAlloc:function(t){this.aabbTris=new Int32Array(t)},collectGeometryFromAABB:function(t){var i=0,s=this._stack;s[i++]=this.bvh._rootNode;var n=this.bvh._bboxArray,e=this.bvh._trianglesArray;this.geom.numIndices=0,this.geom.numVertices=0;var r=0,h=0;for(this.aabbTriCount=0;--i>=0;){var a=s[i];if(!(t.maxX<a._extentsMin.x||t.maxY<a._extentsMin.y||t.maxZ<a._extentsMin.z||t.minX>a._extentsMax.x||t.minY>a._extentsMax.y||t.minZ>a._extentsMax.z)){null!=a._node0&&(s[i++]=a._node0),null!=a._node1&&(s[i++]=a._node1);for(var o=a._startIndex,l=a._endIndex;o<l;){var c=n[7*o++];this.aabbTris[this.aabbTriCount++]=c,c*=9,this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.indices[r]=r++,this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.indices[r]=r++,this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.vertices[h++]=e[c++],this.geom.indices[r]=r++}}}return r>0&&(this.geom.numVertices=this.geom.numIndices=r),this.geom},collectGeometryAndTransforms:function(t,i){var s=0,n=this._stack;n[s++]=this.bvh._rootNode;var e=this.bvh._bboxArray,r=this.bvh._trianglesArray;this.geom.numIndices=0,this.geom.numVertices=0;for(var h=0,a=0;--s>=0;){var o=n[s],l=t.sphere;if(l.x+l.w>o._extentsMin.x&&l.x-l.w<o._extentsMax.x&&l.y+l.w>o._extentsMin.y&&l.y-l.w<o._extentsMax.y&&l.z+l.w>o._extentsMin.z&&l.z-l.w<o._extentsMax.z){null!=o._node0&&(n[s++]=o._node0),null!=o._node1&&(n[s++]=o._node1);for(var c=o._startIndex,x=o._endIndex;c<x;){var m=e[7*c++];m*=9,this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.indices[h]=h++,this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.indices[h]=h++,this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.vertices[a++]=r[m++],this.geom.indices[h]=h++}}}h>0&&(this.geom.numVertices=this.geom.numIndices=h,t.geometries[t.numGeometries]=this.geom,t.transforms[t.numGeometries]=i,t.numGeometries++)},purge:function(){this._stack.length=0},intersectRay:function(t,i,s){var n=this.bvh.intersectRay(t,i,!0);if(null!=n&&0!=n.length){var e=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),r=null,h=0!=i.w?i.w:1e22;h*=h;for(var a=0,o=n.length;a<o;){var l=n[a++],c=l.intersectionPoint.x-t.x,x=l.intersectionPoint.y-t.y,m=l.intersectionPoint.z-t.z,u=c*c+x*x+m*m;u<=h&&(r=l,h=u)}if(null!=r)return this._result.x=r.intersectionPoint.x,this._result.y=r.intersectionPoint.y,this._result.z=r.intersectionPoint.z,this._result.w=Math.sqrt(h)/e,this.allResults=n,this.lastResult=r,this._result}return null},collectTrisForFrustum:function(t,i,s,n,e){var r=n.length,h=e.length,a=0,o=this._stack,l=this._stackCulling;o[a]=this.bvh._rootNode,l[a]=i,++a;var c=this.bvh._bboxArray,x=this.bvh._trianglesArray;for(this.geom.numIndices=0,this.geom.numVertices=0,this.aabbTriCount=0;--a>=0;){var m=o[a],u=l[a];if((u=altern_culling_DefaultCulling.cullingInFrustumOf(t,u,m._extentsMin.x,m._extentsMin.y,m._extentsMin.z,m._extentsMax.x,m._extentsMax.y,m._extentsMax.z))>=0){null!=m._node0&&(o[a]=m._node0,l[a]=u,++a),null!=m._node1&&(o[a]=m._node1,l[a]=u,++a);for(var f=m._startIndex,y=m._endIndex;f<y;){var _=c[7*f++];_*=9;var v,p=x[_++],d=x[_++],z=x[_++],g=x[_++],b=x[_++],w=x[_++],Y=x[_++],X=x[_++],Z=x[_++];if(!!altern_culling_DefaultCulling.isInFrontOfFrustum(p,d,z,g,b,w,Y,X,Z,s)&&(v=altern_culling_DefaultCulling.triInFrustumCover(t,p,d,z,g,b,w,Y,X,Z))>=0)if(0==v)n[r++]=p,n[r++]=d,n[r++]=z,e[h]=h++,n[r++]=g,n[r++]=b,n[r++]=w,e[h]=h++,n[r++]=Y,n[r++]=X,n[r++]=Z,e[h]=h++;else{var T,P,k,L,j,C;if(P=altern_culling_DefaultCulling.clippedFace,0!=(1&v)&&null!=P){for(k=P.wrapper.vertex,L=(T=P.wrapper.next).next;null!=L;)j=T.vertex,C=L.vertex,n[r++]=k.x,n[r++]=k.y,n[r++]=k.z,e[h]=h++,n[r++]=j.x,n[r++]=j.y,n[r++]=j.z,e[h]=h++,n[r++]=C.x,n[r++]=C.y,n[r++]=C.z,e[h]=h++,T=T.next,L=L.next;var M=altern_culling_DefaultCulling.clippedFace;M.destroy(),M.next=altern_geom_Face.collector,altern_geom_Face.collector=M}if(P=altern_culling_DefaultCulling.clippedFace2,0!=(2&v)&&null!=P){for(k=P.wrapper.vertex,L=(T=P.wrapper.next).next;null!=L;)j=T.vertex,C=L.vertex,n[r++]=k.x,n[r++]=k.y,n[r++]=k.z,e[h]=h++,n[r++]=j.x,n[r++]=j.y,n[r++]=j.z,e[h]=h++,n[r++]=C.x,n[r++]=C.y,n[r++]=C.z,e[h]=h++,T=T.next,L=L.next;var F=altern_culling_DefaultCulling.clippedFace2;F.destroy(),F.next=altern_geom_Face.collector,altern_geom_Face.collector=F}}}}}},__class__:altern_partition_js_BVHTree};var altern_ray_Raycaster=function(t){this._output=new jeash_geom_Vector3D,this._direction=new jeash_geom_Vector3D,this._origin=new jeash_geom_Vector3D,this.source=t};altern_ray_Raycaster.__name__=!0,altern_ray_Raycaster.prototype={setTarget:function(t){return this.source=t,this},position:function(t,i,s){return this._origin.x=t,this._origin.y=i,this._origin.z=s,this},direction:function(t,i,s){return this._direction.x=t,this._direction.y=i,this._direction.z=s,this},positionAndDirection:function(t,i,s,n,e,r){return this._origin.x=t,this._origin.y=i,this._origin.z=s,this._direction.x=n,this._direction.y=e,this._direction.z=r,this},setIgnoreDistance:function(t){this._direction.w=t},gotHit:function(){this._output.w=0;var t=this.source.intersectRay(this._origin,this._direction,this._output);return null!=t&&(t.x=this._origin.x+t.w*this._direction.x,t.y=this._origin.y+t.w*this._direction.y,t.z=this._origin.z+t.w*this._direction.z),t},__class__:altern_ray_Raycaster};var util_geom_IAABB=function(){};util_geom_IAABB.__name__=!0,util_geom_IAABB.prototype={__class__:util_geom_IAABB};var components_BoundBox=function(){this.minX=17976931348623157e292,this.minY=17976931348623157e292,this.minZ=17976931348623157e292,this.maxX=-17976931348623157e292,this.maxY=-17976931348623157e292,this.maxZ=-17976931348623157e292};components_BoundBox.__name__=!0,components_BoundBox.__interfaces__=[util_geom_IAABB],components_BoundBox.prototype={__class__:components_BoundBox};var components_CollisionResult=function(){this.gotCollision=!1,this.flags=0,this.stateFlags=0,this.max_ground_normal_threshold=.573576436351046,this.maximum_normal_impulse=0,this.maximum_ground_normal=new util_geom_Vec3};components_CollisionResult.__name__=!0,components_CollisionResult.prototype={get_gotGroundNormal:function(){return 0!=(2&this.stateFlags)},set_gotGroundNormal:function(t){return t?this.stateFlags|=2:this.stateFlags&=-3,t},__class__:components_CollisionResult};var components_Ellipsoid=function(t,i,s){null==s&&(s=32),null==i&&(i=32),null==t&&(t=32),util_geom_Vec3.call(this,t,i,s)};components_Ellipsoid.__name__=!0,components_Ellipsoid.__super__=util_geom_Vec3,components_Ellipsoid.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Ellipsoid});var components_Jump=function(t,i){this.JUMP_COOLDOWN=t,this.jump_speed=i,this.jump_timer=0,this.enabled=!0};components_Jump.__name__=!0,components_Jump.prototype={update:function(t){this.jump_timer=this.jump_timer-t<0?0:this.jump_timer-t},attemptJump:function(t,i){var s=this.enabled&&this.jump_timer<=0;return s&&(t.z+=.04*this.jump_speed,this.jump_timer=this.JUMP_COOLDOWN),s},attemptJumpY:function(t,i){var s=this.enabled&&this.jump_timer<=0;return s&&(t.y+=this.jump_speed,this.jump_timer=this.JUMP_COOLDOWN),s},__class__:components_Jump};var components_MoveResult=function(){util_geom_Vec3.call(this)};components_MoveResult.__name__=!0,components_MoveResult.__super__=util_geom_Vec3,components_MoveResult.prototype=$extend(util_geom_Vec3.prototype,{init:function(){this.preventDefault=!1},disposeCollisions:function(){if(null!=this.collisions){for(var t=this.collisions;null!=t.next;)t=t.next;t.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=this.collisions,this.collisions=null}},setIntegrationNewVelAtCollideTime:function(t,i,s,n){for(var e=this.collisions,r=null,h=null;null!=e;){if(e.t==n){h=e;break}r=e,e=e.next}if(null!=h)if(null!=r){n=1/(n=r.t-h.t);s.x,s.y,s.z;i.x=r.dest.x,i.y=r.dest.y,i.z=r.dest.z,i.x-=t.x,i.y-=t.y,i.z-=t.z,i.x*=n,i.y*=n,i.z*=n}else n=1/(n=1-h.t),i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.x*=n,i.y*=n,i.z*=n},initIntegration:function(t,i,s,n){i.x=t.x,i.y=t.y,i.z=t.z;var e=this.collisions;if(null!=e){for(var r=null,h=null;null!=e&&(r=e,null!=(e=e.next));)0!=e.t&&(h=e);if(0!=r.t){n.x,n.y,n.z;s.x=r.dest.x,s.y=r.dest.y,s.z=r.dest.z,1/r.t,s.x-=t.x,s.y-=t.y,s.z-=t.z}else if(null!=h){n.x,n.y,n.z;s.x=h.dest.x,s.y=h.dest.y,s.z=h.dest.z,1/h.t,s.x-=t.x,s.y-=t.y,s.z-=t.z}else s.x=this.x-t.x,s.y=this.y-t.y,s.z=this.z-t.z}else s.x=this.x-t.x,s.y=this.y-t.y,s.z=this.z-t.z},findNearestCollisionEvent:function(t){var i=this.collisions;if(null==i)return null;for(var s=null;null!=i&&!(i.t<=t);)s=i,i=i.next;return s},truncateCollisionEvents:function(t){for(var i=this.collisions,s=null;null!=i&&!(i.t<=t);)s=i,i=i.next;if(null!=s){var n=this.collisions;this.collisions=s.next,s.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=n}},addCollisionEvent:function(t){t.next=this.collisions,this.collisions=t},__class__:components_MoveResult});var components_Pos=function(t,i,s){null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),util_geom_Vec3.call(this,t,i,s)};components_Pos.__name__=!0,components_Pos.__super__=util_geom_Vec3,components_Pos.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Pos});var components_Vel=function(t,i,s){null==s&&(s=0),null==i&&(i=0),null==t&&(t=0),util_geom_Vec3.call(this,t,i,s)};components_Vel.__name__=!0,components_Vel.__super__=util_geom_Vec3,components_Vel.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Vel});var components_controller_SurfaceMovement=function(){this.walk_state=0,this.strafe_state=0,this.friction=0,this.WALK_SPEED=115,this.WALKBACK_SPEED=32,this.STRAFE_SPEED=37};components_controller_SurfaceMovement.__name__=!0,components_controller_SurfaceMovement.updateWith=function(t,i,s,n,e,r,h,a,o,l,c,x){var m;if(null==c&&(c=.25),null!=x){s.x*=c,s.y*=c,s.z*=c,s.x*s.x+s.y*s.y+s.z*s.z<1&&(s.x=0,s.y=0,s.z=0),null!=i&&(r.x=-Math.sin(i.z),r.y=Math.cos(i.z),r.z=0),r.x*x.x+r.y*x.y+r.z*x.z>0&&(m=r.x*x.x+r.y*x.y+r.z*x.z,r.x-=r.x*m,r.y-=r.y*m,r.z-=r.z*m);var u=1/Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);r.x*=u,r.y*=u,r.z*=u,0!=n&&(m=-1!=n?a:-o,s.x+=r.x*m,s.y+=r.y*m,s.z+=r.z*m),h.x=r.y*x.z-r.z*x.y,h.y=r.z*x.x-x.z*r.x,h.z=r.x*x.y-r.y*x.x;var f=1/Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);h.x*=f,h.y*=f,h.z*=f,0!=e&&(m=-1!=e?l:-l,s.x+=h.x*m,s.y+=h.y*m,s.z+=h.z*m)}},components_controller_SurfaceMovement.prototype={resetAllStates:function(){this.walk_state=0,this.strafe_state=0},setWalkSpeeds:function(t,i){null==i&&(i=-1),this.WALK_SPEED=t,this.WALKBACK_SPEED=-1!=i?i:t},setStrafeSpeed:function(t){this.STRAFE_SPEED=t},setAllSpeeds:function(t){this.WALK_SPEED=t,this.WALKBACK_SPEED=t,this.STRAFE_SPEED=t},respond_move_forward:function(){this.walk_state=1},respond_move_back:function(){this.walk_state=-1},respond_move_stop:function(){this.walk_state=0},respond_strafe_left:function(){this.strafe_state=-1},respond_strafe_right:function(){this.strafe_state=1},respond_strafe_stop:function(){this.strafe_state=0},__class__:components_controller_SurfaceMovement};var de_polygonal_ds_tools_ArrayTools=function(){};de_polygonal_ds_tools_ArrayTools.__name__=!0,de_polygonal_ds_tools_ArrayTools.alloc=function(t){return new Array(t)},de_polygonal_ds_tools_ArrayTools.trim=function(t,i){return t.length>i?(t.length=i,t):t},de_polygonal_ds_tools_ArrayTools.swap=function(t,i,s){if(i!=s){var n=t[i];t[i]=t[s],t[s]=n}},de_polygonal_ds_tools_ArrayTools.getFront=function(t,i){if(0!=i){var s=t[i];t[i]=t[0],t[0]=s}return t[0]},de_polygonal_ds_tools_ArrayTools.init=function(t,i,s,n){null==n&&(n=0),null==s&&(s=0);for(var e=s,r=n<=0?t.length:e+n;e<r;)t[e++]=i;return t},de_polygonal_ds_tools_ArrayTools.blit=function(t,i,s,n,e){if(e>0)if(t==s){if(i<n)for(var r=i+e,h=n+e,a=0,o=e;a<o;){a++;--r,t[--h]=t[r]}else if(i>n)for(var l=i,c=n,x=0,m=e;x<m;){x++;t[c]=t[l],++l,++c}}else if(0==i&&0==n)for(var u=0,f=e;u<f;){var y=u++;s[y]=t[y]}else if(0==i)for(var _=0,v=e;_<v;){var p=_++;s[n+p]=t[p]}else if(0==n)for(var d=0,z=e;d<z;){var g=d++;s[g]=t[i+g]}else for(var b=0,w=e;b<w;){var Y=b++;s[n+Y]=t[i+Y]}},de_polygonal_ds_tools_ArrayTools.iter=function(t,i,s){null==s&&(s=0),0==s&&(s=t.length);for(var n=0,e=s;n<e;){i(t[n++])}},de_polygonal_ds_tools_ArrayTools.forEach=function(t,i){for(var s=0,n=t.length;s<n;){var e=s++;t[e]=i(t[e],e)}},de_polygonal_ds_tools_ArrayTools.binarySearchCmp=function(t,i,s,n,e){for(var r,h=s,a=n+1;h<a;)e(t[r=h+(a-h>>1)],i)<0?h=r+1:a=r;return h<=n&&0==e(t[h],i)?h:~h},de_polygonal_ds_tools_ArrayTools.binarySearchf=function(t,i,s,n){for(var e,r=s,h=n+1;r<h;)t[e=r+(h-r>>1)]<i?r=e+1:h=e;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_ArrayTools.binarySearchi=function(t,i,s,n){for(var e,r=s,h=n+1;r<h;)t[e=r+(h-r>>1)]<i?r=e+1:h=e;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_ArrayTools.shuffle=function(t,i){var s=t.length;if(null==i)for(;--s>1;){var n=de_polygonal_ds_tools_Shuffle._f()*s|0,e=t[s];t[s]=t[n],t[n]=e}else for(var r=0;--s>1;){var h=i[r++]*s|0,a=t[s];t[s]=t[h],t[h]=a}},de_polygonal_ds_tools_ArrayTools.sortRange=function(t,i,s,n,e){if(t.length>1)if(s)for(var r=n+1,h=n+e;r<h;){for(var a=r++,o=t[a],l=a;l>n;){var c=t[l-1];if(!(i(c,o)>0))break;t[l]=c,--l}t[l]=o}else de_polygonal_ds_tools_ArrayTools._quickSort(t,n,e,i)},de_polygonal_ds_tools_ArrayTools.quickPerm=function(t){var i,s,n,e=[],r=[],h=[];for(i=0;i<t;)r[i]=i+1,h[i]=0,++i;for(e.push(r.slice()),i=1;i<t;)h[i]<i?(n=r[s=i%2*h[i]],r[s]=r[i],r[i]=n,e.push(r.slice()),h[i]++,i=1):(h[i]=0,++i);return e},de_polygonal_ds_tools_ArrayTools.equals=function(t,i){if(t.length!=i.length)return!1;for(var s=0,n=t.length;s<n;){var e=s++;if(t[e]!=i[e])return!1}return!0},de_polygonal_ds_tools_ArrayTools.split=function(t,i,s){for(var n=[],e=null,r=0,h=i;r<h;){var a=r++;a%s==0&&(e=[],n[a/s|0]=e),e.push(t[a])}return n},de_polygonal_ds_tools_ArrayTools.pairwise=function(t,i){for(var s=0,n=t.length;s<n;)i(s,t[s],t[s+1]),s+=2},de_polygonal_ds_tools_ArrayTools.bruteforce=function(t,i){for(var s,n=0,e=t.length,r=e-1;n<r;){for(s=n+1;s<e;)i(t[n],t[s]),++s;++n}},de_polygonal_ds_tools_ArrayTools._quickSort=function(t,i,s,n){var e=i+s-1,r=i,h=e;if(s>1){var a,o=i,l=o+(s>>1),c=o+s-1,x=t[o],m=t[l],u=t[c],f=n(x,u),y=t[a=f<0&&n(x,m)<0?n(m,u)<0?l:c:n(m,x)<0&&n(m,u)<0?f<0?o:c:n(u,x)<0?l:o];for(t[a]=t[i];r<h;){for(;n(y,t[h])<0&&r<h;)--h;for(h!=r&&(t[r]=t[h],++r);n(y,t[r])>0&&r<h;)++r;h!=r&&(t[h]=t[r],--h)}t[r]=y,de_polygonal_ds_tools_ArrayTools._quickSort(t,i,r-i,n),de_polygonal_ds_tools_ArrayTools._quickSort(t,r+1,e-r,n)}};var de_polygonal_ds_tools_NativeArrayTools=function(){};de_polygonal_ds_tools_NativeArrayTools.__name__=!0,de_polygonal_ds_tools_NativeArrayTools.alloc=function(t){return new Array(t)},de_polygonal_ds_tools_NativeArrayTools.get=function(t,i){return t[i]},de_polygonal_ds_tools_NativeArrayTools.set=function(t,i,s){t[i]=s},de_polygonal_ds_tools_NativeArrayTools.size=function(t){return t.length},de_polygonal_ds_tools_NativeArrayTools.toArray=function(t,i,s,n){if(0==s)return[];var e=new Array(s);if(0==i)for(var r=0,h=s;r<h;){var a=r++;e[a]=t[a]}else for(var o=i,l=i+s;o<l;){var c=o++;e[c-i]=t[c]}return e},de_polygonal_ds_tools_NativeArrayTools.ofArray=function(t){return t.slice(0,t.length)},de_polygonal_ds_tools_NativeArrayTools.blit=function(t,i,s,n,e){if(e>0)if(t==s){if(i<n)for(var r=i+e,h=n+e,a=0,o=e;a<o;){a++;--r,t[--h]=t[r]}else if(i>n)for(var l=i,c=n,x=0,m=e;x<m;){x++;t[c]=t[l],++l,++c}}else if(0==i&&0==n)for(var u=0,f=e;u<f;){var y=u++;s[y]=t[y]}else if(0==i)for(var _=0,v=e;_<v;){var p=_++;s[n+p]=t[p]}else if(0==n)for(var d=0,z=e;d<z;){var g=d++;s[g]=t[i+g]}else for(var b=0,w=e;b<w;){var Y=b++;s[n+Y]=t[i+Y]}},de_polygonal_ds_tools_NativeArrayTools.copy=function(t){return t.slice(0)},de_polygonal_ds_tools_NativeArrayTools.zero=function(t,i,s){null==s&&(s=0),null==i&&(i=0);for(var n=i,e=s<=0?t.length:n+s;n<e;)t[n++]=0;return t},de_polygonal_ds_tools_NativeArrayTools.init=function(t,i,s,n){null==n&&(n=0),null==s&&(s=0);for(var e=s,r=n<=0?t.length:e+n;e<r;)t[e++]=i;return t},de_polygonal_ds_tools_NativeArrayTools.nullify=function(t,i,s){null==s&&(s=0),null==i&&(i=0);for(var n=i,e=s<=0?t.length:n+s;n<e;)t[n++]=null;return t},de_polygonal_ds_tools_NativeArrayTools.binarySearchCmp=function(t,i,s,n,e){for(var r,h=s,a=n+1;h<a;)e(t[r=h+(a-h>>1)],i)<0?h=r+1:a=r;return h<=n&&0==e(t[h],i)?h:~h},de_polygonal_ds_tools_NativeArrayTools.binarySearchf=function(t,i,s,n){for(var e,r=s,h=n+1;r<h;)t[e=r+(h-r>>1)]<i?r=e+1:h=e;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_NativeArrayTools.binarySearchi=function(t,i,s,n){for(var e,r=s,h=n+1;r<h;)t[e=r+(h-r>>1)]<i?r=e+1:h=e;return r<=n&&t[r]==i?r:~r};var de_polygonal_ds_tools_NativeInt32ArrayTools=function(){};de_polygonal_ds_tools_NativeInt32ArrayTools.__name__=!0,de_polygonal_ds_tools_NativeInt32ArrayTools.alloc=function(t){return new Int32Array(t)},de_polygonal_ds_tools_NativeInt32ArrayTools.get=function(t,i){return t[i]},de_polygonal_ds_tools_NativeInt32ArrayTools.setD=function(t,i,s){t[i]=s},de_polygonal_ds_tools_NativeInt32ArrayTools.size=function(t){return t.length},de_polygonal_ds_tools_NativeInt32ArrayTools.toArray=function(t,i,s,n){if(0==s)return[];var e=new Array(s);if(0==i)for(var r=0,h=s;r<h;){var a=r++;e[a]=t[a]}else for(var o=i,l=i+s;o<l;){var c=o++;e[c-i]=t[c]}return e},de_polygonal_ds_tools_NativeInt32ArrayTools.ofArray=function(t){for(var i=new Int32Array(t.length),s=0,n=t.length;s<n;){var e=s++;i[e]=t[e]}return i},de_polygonal_ds_tools_NativeInt32ArrayTools.blit=function(t,i,s,n,e){if(e>0)if(t==s){if(i<n)for(var r=i+e,h=n+e,a=0,o=e;a<o;){a++;--r,t[--h]=t[r]}else if(i>n)for(var l=i,c=n,x=0,m=e;x<m;){x++;t[c]=t[l],++l,++c}}else if(0==i&&0==n)for(var u=0,f=e;u<f;){var y=u++;s[y]=t[y]}else if(0==i)for(var _=0,v=e;_<v;){var p=_++;s[n+p]=t[p]}else if(0==n)for(var d=0,z=e;d<z;){var g=d++;s[g]=t[i+g]}else for(var b=0,w=e;b<w;){var Y=b++;s[n+Y]=t[i+Y]}},de_polygonal_ds_tools_NativeInt32ArrayTools.copy=function(t){for(var i=t.length,s=new Int32Array(i),n=0,e=i;n<e;){var r=n++;s[r]=t[r]}return s},de_polygonal_ds_tools_NativeInt32ArrayTools.zero=function(t,i,s){null==s&&(s=0),null==i&&(i=0);for(var n=i,e=s<=0?t.length:n+s;n<e;)t[n++]=0;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.init=function(t,i,s,n){null==n&&(n=0),null==s&&(s=0);for(var e=s,r=n<=0?t.length:e+n;e<r;)t[e++]=i;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.nullify=function(t,i,s){null==s&&(s=0),null==i&&(i=0);for(var n=i,e=s<=0?t.length:n+s;n<e;)t[n++]=null;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.binarySearchCmp=function(t,i,s,n,e){for(var r,h=s,a=n+1;h<a;)e(t[r=h+(a-h>>1)],i)<0?h=r+1:a=r;return h<=n&&0==e(t[h],i)?h:~h},de_polygonal_ds_tools_NativeInt32ArrayTools.binarySearchi=function(t,i,s,n){for(var e,r=s,h=n+1;r<h;)t[e=r+(h-r>>1)]<i?r=e+1:h=e;return r<=n&&t[r]==i?r:~r};var de_polygonal_ds_tools_Shuffle=function(){};de_polygonal_ds_tools_Shuffle.__name__=!0,de_polygonal_ds_tools_Shuffle._f=function(){return Math.random()},de_polygonal_ds_tools_Shuffle.setRandom=function(t){de_polygonal_ds_tools_Shuffle._f=t},de_polygonal_ds_tools_Shuffle.frand=function(){return de_polygonal_ds_tools_Shuffle._f()};var haxe_IMap=function(){};haxe_IMap.__name__=!0;var haxe_ds_ObjectMap=function(){this.h={__keys__:{}}};haxe_ds_ObjectMap.__name__=!0,haxe_ds_ObjectMap.__interfaces__=[haxe_IMap],haxe_ds_ObjectMap.prototype={set:function(t,i){var s=t.__id__||(t.__id__=++haxe_ds_ObjectMap.count);this.h[s]=i,this.h.__keys__[s]=t},remove:function(t){var i=t.__id__;return null!=this.h.__keys__[i]&&(delete this.h[i],delete this.h.__keys__[i],!0)},keys:function(){var t=[];for(var i in this.h.__keys__)this.h.hasOwnProperty(i)&&t.push(this.h.__keys__[i]);return HxOverrides.iter(t)},__class__:haxe_ds_ObjectMap};var haxe_io_FPHelper=function(){};haxe_io_FPHelper.__name__=!0,haxe_io_FPHelper.i32ToFloat=function(t){var i=t>>>23&255,s=8388607&t;return 0==s&&0==i?0:(1-(t>>>31<<1))*(1+Math.pow(2,-23)*s)*Math.pow(2,i-127)},haxe_io_FPHelper.floatToI32=function(t){if(0==t)return 0;var i=t<0?-t:t,s=Math.floor(Math.log(i)/.6931471805599453);s<-127?s=-127:s>128&&(s=128);var n=Math.round(8388608*(i/Math.pow(2,s)-1));return 8388608==n&&s<128&&(n=0,++s),(t<0?-2147483648:0)|s+127<<23|n};var jeash_geom_Matrix=function(t,i,s,n,e,r){this.a=null==t?1:t,this.b=null==i?0:i,this.c=null==s?0:s,this.d=null==n?1:n,this.tx=null==e?0:e,this.ty=null==r?0:r};jeash_geom_Matrix.__name__=!0,jeash_geom_Matrix.prototype={copyFrom:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},clone:function(){return new jeash_geom_Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},concat:function(t){var i=this.a*t.a+this.b*t.c;this.b=this.a*t.b+this.b*t.d,this.a=i;var s=this.c*t.a+this.d*t.c;this.d=this.c*t.b+this.d*t.d,this.c=s;var n=this.tx*t.a+this.ty*t.c+t.tx;this.ty=this.tx*t.b+this.ty*t.d+t.ty,this.tx=n},createBox:function(t,i,s,n,e){this.a=t,this.d=i,this.b=null==s?0:s,this.tx=null==n?0:n,this.ty=null==e?0:e},createGradientBox:function(t,i,s,n,e){if(this.a=t/1638.4,this.d=i/1638.4,null!=s&&0!=s){var r=Math.cos(s),h=Math.sin(s);this.b=h*this.d,this.c=-h*this.a,this.a*=r,this.d*=r}else this.b=this.c=0;this.tx=null!=n?n+t/2:t/2,this.ty=null!=e?e+i/2:i/2},deltaTransformPoint:function(t){return new jeash_geom_Point(t.x*this.a+t.y*this.c,t.x*this.b+t.y*this.d)},identity:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},invert:function(){var t=this.a*this.d-this.b*this.c;if(0==t)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty;else{t=1/t;var i=this.d*t;this.d=this.a*t,this.a=i,this.b*=-t,this.c*=-t;var s=-this.a*this.tx-this.c*this.ty;this.ty=-this.b*this.tx-this.d*this.ty,this.tx=s}return this},mult:function(t){var i=new jeash_geom_Matrix;return i.a=this.a*t.a+this.b*t.c,i.b=this.a*t.b+this.b*t.d,i.c=this.c*t.a+this.d*t.c,i.d=this.c*t.b+this.d*t.d,i.tx=this.tx*t.a+this.ty*t.c+t.tx,i.ty=this.tx*t.b+this.ty*t.d+t.ty,i},rotate:function(t){var i=Math.cos(t),s=Math.sin(t),n=this.a*i-this.b*s;this.b=this.a*s+this.b*i,this.a=n;var e=this.c*i-this.d*s;this.d=this.c*s+this.d*i,this.c=e;var r=this.tx*i-this.ty*s;this.ty=this.tx*s+this.ty*i,this.tx=r},scale:function(t,i){this.a*=t,this.b*=i,this.c*=t,this.d*=i,this.tx*=t,this.ty*=i},setRotation:function(t,i){var s=null==i?1:i;this.a=Math.cos(t)*s,this.c=Math.sin(t)*s,this.b=-this.c,this.d=this.a},setTo:function(t,i,s,n,e,r){this.a=t,this.b=i,this.c=s,this.d=n,this.tx=e,this.ty=r},transformPoint:function(t){return new jeash_geom_Point(t.x*this.a+t.y*this.c+this.tx,t.x*this.b+t.y*this.d+this.ty)},translate:function(t,i){this.tx+=t,this.ty+=i},toString:function(){return"[ "+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.tx+" "+this.ty+" ]"},__class__:jeash_geom_Matrix};var jeash_geom_Point=function(t,i){this.x=null==t?0:t,this.y=null==i?0:i};jeash_geom_Point.__name__=!0,jeash_geom_Point.distance=function(t,i){var s=t.x-i.x,n=t.y-i.y;return Math.sqrt(s*s+n*n)},jeash_geom_Point.interpolate=function(t,i,s){return new jeash_geom_Point(i.x+s*(t.x-i.x),i.y+s*(t.y-i.y))},jeash_geom_Point.polar=function(t,i){return new jeash_geom_Point(t*Math.cos(i),t*Math.sin(i))},jeash_geom_Point.prototype={add:function(t){return new jeash_geom_Point(t.x+this.x,t.y+this.y)},clone:function(){return new jeash_geom_Point(this.x,this.y)},equals:function(t){return t.x==this.x&&t.y==this.y},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(t){if(0==this.x&&0==this.y)this.x=t;else{var i=t/Math.sqrt(this.x*this.x+this.y*this.y);this.x*=i,this.y*=i}},offset:function(t,i){this.x+=t,this.y+=i},subtract:function(t){return new jeash_geom_Point(this.x-t.x,this.y-t.y)},__class__:jeash_geom_Point};var jeash_geom_Rectangle=function(t,i,s,n){this.x=null==t?0:t,this.y=null==i?0:i,this.width=null==s?0:s,this.height=null==n?0:n};jeash_geom_Rectangle.__name__=!0,jeash_geom_Rectangle.prototype={get_left:function(){return this.x},set_left:function(t){return this.width-=t-this.x,this.x=t,t},get_right:function(){return this.x+this.width},set_right:function(t){return this.width=t-this.x,t},get_top:function(){return this.y},set_top:function(t){return this.height-=t-this.y,this.y=t,t},get_bottom:function(){return this.y+this.height},set_bottom:function(t){return this.height=t-this.y,t},get_topLeft:function(){return new jeash_geom_Point(this.x,this.y)},set_topLeft:function(t){return this.x=t.x,this.y=t.y,t.clone()},get_size:function(){return new jeash_geom_Point(this.width,this.height)},set_size:function(t){return this.width=t.x,this.height=t.y,t.clone()},get_bottomRight:function(){return new jeash_geom_Point(this.x+this.width,this.y+this.height)},set_bottomRight:function(t){return this.width=t.x-this.x,this.height=t.y-this.y,t.clone()},clone:function(){return new jeash_geom_Rectangle(this.x,this.y,this.width,this.height)},contains:function(t,i){return t>=this.x&&i>=this.y&&t<this.get_right()&&i<this.get_bottom()},containsPoint:function(t){return this.contains(t.x,t.y)},containsRect:function(t){return!!this.contains(t.x,t.y)&&this.containsPoint(t.get_bottomRight())},equals:function(t){return this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height},inflate:function(t,i){this.x-=t,this.width+=2*t,this.y-=i,this.height+=2*i},inflatePoint:function(t){this.inflate(t.x,t.y)},intersection:function(t){var i=this.x<t.x?t.x:this.x,s=this.get_right()>t.get_right()?t.get_right():this.get_right();if(s<=i)return new jeash_geom_Rectangle;var n=this.y<t.y?t.y:this.y,e=this.get_bottom()>t.get_bottom()?t.get_bottom():this.get_bottom();return e<=n?new jeash_geom_Rectangle:new jeash_geom_Rectangle(i,n,s-i,e-n)},intersects:function(t){var i=this.x<t.x?t.x:this.x;if((this.get_right()>t.get_right()?t.get_right():this.get_right())<=i)return!1;var s=this.y<t.y?t.y:this.y;return(this.get_bottom()>t.get_bottom()?t.get_bottom():this.get_bottom())>s},union:function(t){var i=this.x>t.x?t.x:this.x,s=this.get_right()<t.get_right()?t.get_right():this.get_right(),n=this.y>t.y?t.y:this.y,e=this.get_bottom()<t.get_bottom()?t.get_bottom():this.get_bottom();return new jeash_geom_Rectangle(i,n,s-i,e-n)},isEmpty:function(){return 0==this.width&&0==this.height},offset:function(t,i){this.x+=t,this.y+=i},offsetPoint:function(t){this.x+=t.x,this.y+=t.y},setEmpty:function(){this.x=this.y=this.width=this.height=0},transform:function(t){var i=t.a*this.x+t.c*this.y,s=i,n=t.b*this.x+t.d*this.y,e=i,r=t.a*(this.x+this.width)+t.c*this.y,h=t.b*(this.x+this.width)+t.d*this.y;return r<i&&(i=r),h<n&&(n=h),r>s&&(s=r),h>e&&(e=h),(r=t.a*(this.x+this.width)+t.c*(this.y+this.height))<i&&(i=r),(h=t.b*(this.x+this.width)+t.d*(this.y+this.height))<n&&(n=h),r>s&&(s=r),h>e&&(e=h),(r=t.a*this.x+t.c*(this.y+this.height))<i&&(i=r),(h=t.b*this.x+t.d*(this.y+this.height))<n&&(n=h),r>s&&(s=r),h>e&&(e=h),new jeash_geom_Rectangle(i+t.tx,n+t.ty,s-i,e-n)},extendBounds:function(t){var i=this.x-t.x;i>0&&(this.x-=i,this.width+=i);var s=this.y-t.y;s>0&&(this.y-=s,this.height+=s),t.get_right()>this.get_right()&&this.set_right(t.get_right()),t.get_bottom()>this.get_bottom()&&this.set_bottom(t.get_bottom())},__class__:jeash_geom_Rectangle};var js__$Boot_HaxeError=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,js__$Boot_HaxeError)};js__$Boot_HaxeError.__name__=!0,js__$Boot_HaxeError.wrap=function(t){return t instanceof Error?t:new js__$Boot_HaxeError(t)},js__$Boot_HaxeError.__super__=Error,js__$Boot_HaxeError.prototype=$extend(Error.prototype,{__class__:js__$Boot_HaxeError});var js_Boot=function(){};js_Boot.__name__=!0,js_Boot.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var i=t.__class__;if(null!=i)return i;var s=js_Boot.__nativeClassName(t);return null!=s?js_Boot.__resolveNativeClass(s):null},js_Boot.__string_rec=function(t,i){if(null==t)return"null";if(i.length>=5)return"<...>";var s=typeof t;switch("function"==s&&(t.__name__||t.__ename__)&&(s="object"),s){case"function":return"<function>";case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var n=t[0]+"(";i+="\t";for(var e=2,r=t.length;e<r;){var h=e++;n+=2!=h?","+js_Boot.__string_rec(t[h],i):js_Boot.__string_rec(t[h],i)}return n+")"}var a="[";i+="\t";for(var o=0,l=t.length;o<l;){var c=o++;a+=(c>0?",":"")+js_Boot.__string_rec(t[c],i)}return a+="]"}var x;try{x=t.toString}catch(t){return"???"}if(null!=x&&x!=Object.toString&&"function"==typeof x){var m=t.toString();if("[object Object]"!=m)return m}var u=null,f="{\n";i+="\t";var y=null!=t.hasOwnProperty;for(var u in t)y&&!t.hasOwnProperty(u)||"prototype"!=u&&"__class__"!=u&&"__super__"!=u&&"__interfaces__"!=u&&"__properties__"!=u&&(2!=f.length&&(f+=", \n"),f+=i+u+" : "+js_Boot.__string_rec(t[u],i));return f+="\n"+(i=i.substring(1))+"}";case"string":return t;default:return String(t)}},js_Boot.__interfLoop=function(t,i){if(null==t)return!1;if(t==i)return!0;var s=t.__interfaces__;if(null!=s)for(var n=0,e=s.length;n<e;){var r=s[n++];if(r==i||js_Boot.__interfLoop(r,i))return!0}return js_Boot.__interfLoop(t.__super__,i)},js_Boot.__instanceof=function(t,i){if(null==i)return!1;switch(i){case Array:return t instanceof Array&&null==t.__enum__;case a:return"boolean"==typeof t;case r:return!0;case h:return"number"==typeof t;case e:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof i){if(t instanceof i)return!0;if(js_Boot.__interfLoop(js_Boot.getClass(t),i))return!0}else if("object"==typeof i&&js_Boot.__isNativeObj(i)&&t instanceof i)return!0;return i==o&&null!=t.__name__||(i==l&&null!=t.__ename__||t.__enum__==i)}},js_Boot.__nativeClassName=function(t){var i=js_Boot.__toStr.call(t).slice(8,-1);return"Object"==i||"Function"==i||"Math"==i||"JSON"==i?null:i},js_Boot.__isNativeObj=function(t){return null!=js_Boot.__nativeClassName(t)},js_Boot.__resolveNativeClass=function(t){return i[t]};var js_html_compat_ArrayBuffer=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var i=t;this.a=[];for(var s=0,n=i;s<n;){var e=s++;this.a[e]=0}this.byteLength=i}};js_html_compat_ArrayBuffer.__name__=!0,js_html_compat_ArrayBuffer.sliceImpl=function(t,i){var s=new m(this,t,null==i?null:i-t),n=new c(s.byteLength);return new m(n).set(s),n},js_html_compat_ArrayBuffer.prototype={slice:function(t,i){return new js_html_compat_ArrayBuffer(this.a.slice(t,i))},__class__:js_html_compat_ArrayBuffer};var js_html_compat_Float32Array=function(){};js_html_compat_Float32Array.__name__=!0,js_html_compat_Float32Array._new=function(t,i,s){var n;if("number"==typeof t){n=[];for(var e=0,r=t;e<r;){n[e++]=0}n.byteLength=n.length<<2,n.byteOffset=0;for(var h=[],a=0,o=n.length<<2;a<o;){a++;h.push(0)}n.buffer=new js_html_compat_ArrayBuffer(h)}else if(js_Boot.__instanceof(t,js_html_compat_ArrayBuffer)){var l=t;null==i&&(i=0),null==s&&(s=l.byteLength-i>>2),n=[];for(var c=0,x=s;c<x;){c++;var m=l.a[i++]|l.a[i++]<<8|l.a[i++]<<16|l.a[i++]<<24;n.push(haxe_io_FPHelper.i32ToFloat(m))}n.byteLength=n.length<<2,n.byteOffset=i,n.buffer=l}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO "+Std.string(t));n=t.slice();for(var u=[],f=0;f<n.length;){var y=n[f];++f;var _=haxe_io_FPHelper.floatToI32(y);u.push(255&_),u.push(_>>8&255),u.push(_>>16&255),u.push(_>>>24)}n.byteLength=n.length<<2,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(u)}return n.subarray=js_html_compat_Float32Array._subarray,n.set=js_html_compat_Float32Array._set,n},js_html_compat_Float32Array._set=function(t,i){if(js_Boot.__instanceof(t.buffer,js_html_compat_ArrayBuffer)){var s=t;if(t.byteLength+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var n=0,e=t.byteLength;n<e;){var r=n++;this[r+i]=s[r]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO");var h=t;if(h.length+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var a=0,o=h.length;a<o;){var l=a++;this[l+i]=h[l]}}},js_html_compat_Float32Array._subarray=function(t,i){var s=js_html_compat_Float32Array._new(this.slice(t,i));return s.byteOffset=4*t,s};var js_html_compat_Uint8Array=function(){};js_html_compat_Uint8Array.__name__=!0,js_html_compat_Uint8Array._new=function(t,i,s){var n;if("number"==typeof t){n=[];for(var e=0,r=t;e<r;){n[e++]=0}n.byteLength=n.length,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(n)}else if(js_Boot.__instanceof(t,js_html_compat_ArrayBuffer)){var h=t;null==i&&(i=0),null==s&&(s=h.byteLength-i),(n=0==i?h.a:h.a.slice(i,i+s)).byteLength=n.length,n.byteOffset=i,n.buffer=h}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO "+Std.string(t));(n=t.slice()).byteLength=n.length,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(n)}return n.subarray=js_html_compat_Uint8Array._subarray,n.set=js_html_compat_Uint8Array._set,n},js_html_compat_Uint8Array._set=function(t,i){if(js_Boot.__instanceof(t.buffer,js_html_compat_ArrayBuffer)){var s=t;if(t.byteLength+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var n=0,e=t.byteLength;n<e;){var r=n++;this[r+i]=s[r]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO");var h=t;if(h.length+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var a=0,o=h.length;a<o;){var l=a++;this[l+i]=h[l]}}},js_html_compat_Uint8Array._subarray=function(t,i){var s=js_html_compat_Uint8Array._new(this.slice(t,i));return s.byteOffset=t,s};var systems_collisions_CollisionEvent=function(){this.pos=new util_geom_Vec3,this.normal=new util_geom_Vec3,this.dest=new util_geom_Vec3};systems_collisions_CollisionEvent.__name__=!0,systems_collisions_CollisionEvent.Get=function(t,i,s,n,e,r){var h=null!=systems_collisions_CollisionEvent.COLLECTOR?systems_collisions_CollisionEvent.COLLECTOR:systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent;systems_collisions_CollisionEvent.COLLECTOR=systems_collisions_CollisionEvent.COLLECTOR.next;var a=h.pos;a.x=t.x,a.y=t.y,a.z=t.z;var o=h.normal;o.x=i.x,o.y=i.y,o.z=i.z;var l=h.dest;return l.x=e.x,l.y=e.y,l.z=e.z,h.offset=s,h.t=n,h.geomtype=r,h.next=null,h},systems_collisions_CollisionEvent.GetAs3=function(t,i,s,n,e,r){var h=null!=systems_collisions_CollisionEvent.COLLECTOR?systems_collisions_CollisionEvent.COLLECTOR:systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent;systems_collisions_CollisionEvent.COLLECTOR=systems_collisions_CollisionEvent.COLLECTOR.next;var a=h.pos;a.x=t.x,a.y=t.y,a.z=t.z;var o=h.normal;o.x=i.x,o.y=i.y,o.z=i.z;var l=h.dest;return l.x=e.x,l.y=e.y,l.z=e.z,h.offset=s,h.t=n,h.geomtype=r,h.next=null,h},systems_collisions_CollisionEvent.get=function(t,i,s,n,e,r){return systems_collisions_CollisionEvent.Get(t,i,s,n,e,r)},systems_collisions_CollisionEvent.getGeomTypeString=function(t){switch(t){case 1:return"POINT";case 2:return"EDGE";case 3:return"POLYGON";case 4:return"THING";default:return"UNDEF"}},systems_collisions_CollisionEvent.prototype={getNumEvents:function(){for(var t=1,i=this;null!=(i=i.next);)++t;return t},write:function(t,i,s,n,e,r){var h=this.pos;h.x=t.x,h.y=t.y,h.z=t.z;var a=this.normal;a.x=i.x,a.y=i.y,a.z=i.z;var o=this.dest;o.x=e.x,o.y=e.y,o.z=e.z,this.offset=s,this.t=n,this.geomtype=r},calcFallbackPosition:function(t,i,s,n){n.x=this.dest.x,n.y=this.dest.y,n.z=this.dest.z},dispose:function(){this.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=this},__class__:systems_collisions_CollisionEvent};var systems_collisions_EllipsoidCollider=function(t,i,s,n,e){null==e&&(e=!1),null==n&&(n=.001),this.threshold=n,this.resolveAsParticle=!1,this.timestamp=0,this.requireEvents=e,this.radiusX=t,this.radiusY=i,this.radiusZ=s,this.matrix=new components_Transform3D,this.inverseMatrix=new components_Transform3D,this.sphere=new jeash_geom_Vector3D,this.cornerA=new jeash_geom_Vector3D,this.cornerB=new jeash_geom_Vector3D,this.cornerC=new jeash_geom_Vector3D,this.cornerD=new jeash_geom_Vector3D,this.resultVector=new jeash_geom_Vector3D,this.collisionPoint=new jeash_geom_Vector3D,this.collisionPlane=new jeash_geom_Vector3D,this.resCollisionPoint=new jeash_geom_Vector3D,this.resCollisionPlane=new jeash_geom_Vector3D,this.geometries=[],this.transforms=[],this.numGeometries=0,this.vertices=[],this.normals=[],this.indices=[],this.numI=0,this.displ=new jeash_geom_Vector3D,this.dest=new jeash_geom_Vector3D,this.src=new jeash_geom_Vector3D};systems_collisions_EllipsoidCollider.__name__=!0,systems_collisions_EllipsoidCollider.isNaN2=function(t){return t!=t},systems_collisions_EllipsoidCollider.prototype={calculateSphere:function(t){this.sphere.x=t.d,this.sphere.y=t.h,this.sphere.z=t.l;var i=t.a*this.cornerA.x+t.b*this.cornerA.y+t.c*this.cornerA.z+t.d,s=t.e*this.cornerA.x+t.f*this.cornerA.y+t.g*this.cornerA.z+t.h,n=t.i*this.cornerA.x+t.j*this.cornerA.y+t.k*this.cornerA.z+t.l,e=t.a*this.cornerB.x+t.b*this.cornerB.y+t.c*this.cornerB.z+t.d,r=t.e*this.cornerB.x+t.f*this.cornerB.y+t.g*this.cornerB.z+t.h,h=t.i*this.cornerB.x+t.j*this.cornerB.y+t.k*this.cornerB.z+t.l,a=t.a*this.cornerC.x+t.b*this.cornerC.y+t.c*this.cornerC.z+t.d,o=t.e*this.cornerC.x+t.f*this.cornerC.y+t.g*this.cornerC.z+t.h,l=t.i*this.cornerC.x+t.j*this.cornerC.y+t.k*this.cornerC.z+t.l,c=t.a*this.cornerD.x+t.b*this.cornerD.y+t.c*this.cornerD.z+t.d,x=t.e*this.cornerD.x+t.f*this.cornerD.y+t.g*this.cornerD.z+t.h,m=t.i*this.cornerD.x+t.j*this.cornerD.y+t.k*this.cornerD.z+t.l,u=i-this.sphere.x,f=s-this.sphere.y,y=n-this.sphere.z;this.sphere.w=u*u+f*f+y*y;var _=(u=e-this.sphere.x)*u+(f=r-this.sphere.y)*f+(y=h-this.sphere.z)*y;_>this.sphere.w&&(this.sphere.w=_),(_=(u=a-this.sphere.x)*u+(f=o-this.sphere.y)*f+(y=l-this.sphere.z)*y)>this.sphere.w&&(this.sphere.w=_),(_=(u=c-this.sphere.x)*u+(f=x-this.sphere.y)*f+(y=m-this.sphere.z)*y)>this.sphere.w&&(this.sphere.w=_),this.sphere.w=Math.sqrt(this.sphere.w)},prepare:function(t,i){this.radius=this.radiusX,this.radiusY>this.radius&&(this.radius=this.radiusY),this.radiusZ>this.radius&&(this.radius=this.radiusZ),this.matrix.compose(t.x,t.y,t.z,0,0,0,this.radiusX/this.radius,this.radiusY/this.radius,this.radiusZ/this.radius),this.inverseMatrix.copy(this.matrix),this.inverseMatrix.invert(),this.src.x=0,this.src.y=0,this.src.z=0,this.displ.x=this.inverseMatrix.a*i.x+this.inverseMatrix.b*i.y+this.inverseMatrix.c*i.z,this.displ.y=this.inverseMatrix.e*i.x+this.inverseMatrix.f*i.y+this.inverseMatrix.g*i.z,this.displ.z=this.inverseMatrix.i*i.x+this.inverseMatrix.j*i.y+this.inverseMatrix.k*i.z,this.dest.x=this.src.x+this.displ.x,this.dest.y=this.src.y+this.displ.y,this.dest.z=this.src.z+this.displ.z;var s=this.displ,n=this.radius+Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);this.cornerA.x=-n,this.cornerA.y=-n,this.cornerA.z=-n,this.cornerB.x=n,this.cornerB.y=-n,this.cornerB.z=-n,this.cornerC.x=n,this.cornerC.y=n,this.cornerC.z=-n,this.cornerD.x=-n,this.cornerD.y=n,this.cornerD.z=-n,this.rad=n},loopGeometries:function(){var t=this.rad;this.numFaces=0;for(var i,s=0,n=0,e=0,r=0,h=0,a=this.numGeometries;h<a;){var o=h++,l=this.geometries[o],c=this.transforms[o],x=l.numVertices,m=l.numIndices,u=l.vertices;if(0!=x&&0!=m){i=0;for(var f=3*x;i<f;){var y=u[i],_=u[i+1],v=u[i+2];this.vertices[r]=c.a*y+c.b*_+c.c*v+c.d,++r,this.vertices[r]=c.e*y+c.f*_+c.g*v+c.h,++r,this.vertices[r]=c.i*y+c.j*_+c.k*v+c.l,++r,i+=3}var p=l.indices;for(i=0;i<m;){var d=p[i]+e;++i;var z=3*d,g=this.vertices[z];++z;var b=this.vertices[z];++z;var w=this.vertices[z],Y=p[i]+e;++i,z=3*Y;var X=this.vertices[z];++z;var Z=this.vertices[z];++z;var T=this.vertices[z],P=p[i]+e;++i,z=3*P;var k=this.vertices[z];++z;var L=this.vertices[z];++z;var j=this.vertices[z];if(!(g>t&&X>t&&k>t||g<-t&&X<-t&&k<-t)&&!(b>t&&Z>t&&L>t||b<-t&&Z<-t&&L<-t||w>t&&T>t&&j>t||w<-t&&T<-t&&j<-t)){var C=X-g,M=Z-b,F=T-w,I=k-g,A=L-b,R=j-w,E=R*M-A*F,O=I*F-R*C,S=A*C-I*M,N=E*E+O*O+S*S;if(!(N<.001)){var V=g*(E*=N=1/Math.sqrt(N))+b*(O*=N)+w*(S*=N);V>t||V<-t||(this.indices[s]=d,++s,this.indices[s]=Y,++s,this.indices[s]=P,++s,this.normals[n]=E,++n,this.normals[n]=O,++n,this.normals[n]=S,++n,this.normals[n]=V,++n,this.numFaces++)}}}e+=x}}this.numGeometries=0,this.numI=s},loopGeometriesNaive:function(){this.rad;this.numFaces=0;for(var t,i=0,s=0,n=0,e=0,r=0,h=this.numGeometries;r<h;){var a=r++,o=this.geometries[a],l=this.matrix,c=o.numVertices,x=o.numIndices,m=o.vertices;if(0!=c&&0!=x){t=0;for(var u=3*c;t<u;){var f=m[t],y=m[t+1],_=m[t+2];this.vertices[e]=l.a*f+l.b*y+l.c*_+l.d,++e,this.vertices[e]=l.e*f+l.f*y+l.g*_+l.h,++e,this.vertices[e]=l.i*f+l.j*y+l.k*_+l.l,++e,t+=3}var v=o.indices;for(t=0;t<x;){var p=v[t]+n;++t;var d=3*p,z=this.vertices[d];++d;var g=this.vertices[d];++d;var b=this.vertices[d],w=v[t]+n;++t,d=3*w;var Y=this.vertices[d];++d;var X=this.vertices[d];++d;var Z=this.vertices[d],T=v[t]+n;++t,d=3*T;var P=this.vertices[d];++d;var k=this.vertices[d];++d;var L=Y-z,j=X-g,C=Z-b,M=P-z,F=k-g,I=this.vertices[d]-b,A=I*j-F*C,R=M*C-I*L,E=F*L-M*j,O=A*A+R*R+E*E,S=z*(A*=O=1/Math.sqrt(O))+g*(R*=O)+b*(E*=O);this.indices[i]=p,++i,this.indices[i]=w,++i,this.indices[i]=T,++i,this.normals[s]=A,++s,this.normals[s]=R,++s,this.normals[s]=E,++s,this.normals[s]=S,++s,this.numFaces++}n+=c}}this.numGeometries=0,this.numI=i},calculateCollidableGeometry:function(t,i){this.prepare(t,systems_collisions_EllipsoidCollider.ZERO_VECTOR),i.collectGeometry(this),this.loopGeometriesNaive()},addGeometry:function(t,i){this.geometries[this.numGeometries]=t,this.transforms[this.numGeometries]=i,this.numGeometries++},calculateDestination:function(t,i,s,n,e){if(null==e&&(e=0),null==n&&(n=1),Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)<=this.threshold)return this.gotMoved=!1,new jeash_geom_Vector3D(t.x,t.y,t.z,t.w);this.gotMoved=!0,this.timestamp++,this.prepare(t,i),s.collectGeometry(this),this.loopGeometries();var r,h=n,a=e;if(this.collisions=null,this.numFaces>0){for(var o=0;o++<50&&(r=this.checkCollision())<1;){var l,c,x,m=r*h;a+=m,h-=m,this.resCollisionPoint.x=this.matrix.a*this.collisionPoint.x+this.matrix.b*this.collisionPoint.y+this.matrix.c*this.collisionPoint.z+this.matrix.d,this.resCollisionPoint.y=this.matrix.e*this.collisionPoint.x+this.matrix.f*this.collisionPoint.y+this.matrix.g*this.collisionPoint.z+this.matrix.h,this.resCollisionPoint.z=this.matrix.i*this.collisionPoint.x+this.matrix.j*this.collisionPoint.y+this.matrix.k*this.collisionPoint.z+this.matrix.l,this.collisionPlane.x<this.collisionPlane.y?this.collisionPlane.x<this.collisionPlane.z?(l=0,c=-this.collisionPlane.z,x=this.collisionPlane.y):(l=-this.collisionPlane.y,c=this.collisionPlane.x,x=0):this.collisionPlane.y<this.collisionPlane.z?(l=this.collisionPlane.z,c=0,x=-this.collisionPlane.x):(l=-this.collisionPlane.y,c=this.collisionPlane.x,x=0);var u=this.collisionPlane.z*c-this.collisionPlane.y*x,f=this.collisionPlane.x*x-this.collisionPlane.z*l,y=this.collisionPlane.y*l-this.collisionPlane.x*c,_=this.matrix.a*l+this.matrix.b*c+this.matrix.c*x,v=this.matrix.e*l+this.matrix.f*c+this.matrix.g*x,p=this.matrix.i*l+this.matrix.j*c+this.matrix.k*x,d=this.matrix.a*u+this.matrix.b*f+this.matrix.c*y,z=this.matrix.e*u+this.matrix.f*f+this.matrix.g*y,g=this.matrix.i*u+this.matrix.j*f+this.matrix.k*y;this.resCollisionPlane.x=p*z-v*g,this.resCollisionPlane.y=_*g-p*d,this.resCollisionPlane.z=v*d-_*z;var b=this.resCollisionPlane,w=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z);0!=w&&(b.x/=w,b.y/=w,b.z/=w),this.resCollisionPlane.w=this.resCollisionPoint.x*this.resCollisionPlane.x+this.resCollisionPoint.y*this.resCollisionPlane.y+this.resCollisionPoint.z*this.resCollisionPlane.z;var Y=this.radius+this.threshold+this.collisionPlane.w-this.dest.x*this.collisionPlane.x-this.dest.y*this.collisionPlane.y-this.dest.z*this.collisionPlane.z;if(this.dest.x+=this.collisionPlane.x*Y,this.dest.y+=this.collisionPlane.y*Y,this.dest.z+=this.collisionPlane.z*Y,this.src.x=this.collisionPoint.x+this.collisionPlane.x*(this.radius+this.threshold),this.src.y=this.collisionPoint.y+this.collisionPlane.y*(this.radius+this.threshold),this.src.z=this.collisionPoint.z+this.collisionPlane.z*(this.radius+this.threshold),this.requireEvents){this.resultVector.x=this.matrix.a*this.src.x+this.matrix.b*this.src.y+this.matrix.c*this.src.z+this.matrix.d,this.resultVector.y=this.matrix.e*this.src.x+this.matrix.f*this.src.y+this.matrix.g*this.src.z+this.matrix.h,this.resultVector.z=this.matrix.i*this.src.x+this.matrix.j*this.src.y+this.matrix.k*this.src.z+this.matrix.l;var X=systems_collisions_CollisionEvent.GetAs3(this.resCollisionPoint,this.resCollisionPlane,this.resCollisionPlane.w,a,this.resultVector,3);X.next=this.collisions,this.collisions=X}if(this.resolveAsParticle){var Z=this.collisionPlane.x*this.displ.x+this.collisionPlane.y*this.displ.y+this.collisionPlane.z*this.displ.z;this.displ.x-=this.collisionPlane.x*Z,this.displ.y-=this.collisionPlane.y*Z,this.displ.z-=this.collisionPlane.z*Z}else this.displ.x=this.dest.x-this.src.x,this.displ.y=this.dest.y-this.src.y,this.displ.z=this.dest.z-this.src.z;var T=this.displ;if(Math.sqrt(T.x*T.x+T.y*T.y+T.z*T.z)<this.threshold)break}this.resultVector.x=this.matrix.a*this.dest.x+this.matrix.b*this.dest.y+this.matrix.c*this.dest.z+this.matrix.d,this.resultVector.y=this.matrix.e*this.dest.x+this.matrix.f*this.dest.y+this.matrix.g*this.dest.z+this.matrix.h,this.resultVector.z=this.matrix.i*this.dest.x+this.matrix.j*this.dest.y+this.matrix.k*this.dest.z+this.matrix.l}else this.resultVector.x=t.x+i.x,this.resultVector.y=t.y+i.y,this.resultVector.z=t.z+i.z;var P=this.resultVector.x;return P!=P?new jeash_geom_Vector3D(t.x,t.y,t.z,t.w):this.resultVector},getResultVelocity:function(t){t.x=this.matrix.a*this.displ.x+this.matrix.b*this.displ.y+this.matrix.c*this.displ.z,t.y=this.matrix.e*this.displ.x+this.matrix.f*this.displ.y+this.matrix.g*this.displ.z,t.z=this.matrix.i*this.displ.x+this.matrix.j*this.displ.y+this.matrix.k*this.displ.z},getCollision:function(t,i,s,n,e){if(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)<=this.threshold)return!1;if(this.prepare(t,i),e.collectGeometry(this),this.loopGeometries(),this.numFaces>0){var r=this.checkCollision();if(r<1){var h,a,o;s.x=this.matrix.a*this.collisionPoint.x+this.matrix.b*this.collisionPoint.y+this.matrix.c*this.collisionPoint.z+this.matrix.d,s.y=this.matrix.e*this.collisionPoint.x+this.matrix.f*this.collisionPoint.y+this.matrix.g*this.collisionPoint.z+this.matrix.h,s.z=this.matrix.i*this.collisionPoint.x+this.matrix.j*this.collisionPoint.y+this.matrix.k*this.collisionPoint.z+this.matrix.l,s.w=r,this.collisionPlane.x<this.collisionPlane.y?this.collisionPlane.x<this.collisionPlane.z?(h=0,a=-this.collisionPlane.z,o=this.collisionPlane.y):(h=-this.collisionPlane.y,a=this.collisionPlane.x,o=0):this.collisionPlane.y<this.collisionPlane.z?(h=this.collisionPlane.z,a=0,o=-this.collisionPlane.x):(h=-this.collisionPlane.y,a=this.collisionPlane.x,o=0);var l=this.collisionPlane.z*a-this.collisionPlane.y*o,c=this.collisionPlane.x*o-this.collisionPlane.z*h,x=this.collisionPlane.y*h-this.collisionPlane.x*a,m=this.matrix.a*h+this.matrix.b*a+this.matrix.c*o,u=this.matrix.e*h+this.matrix.f*a+this.matrix.g*o,f=this.matrix.i*h+this.matrix.j*a+this.matrix.k*o,y=this.matrix.a*l+this.matrix.b*c+this.matrix.c*x,_=this.matrix.e*l+this.matrix.f*c+this.matrix.g*x,v=this.matrix.i*l+this.matrix.j*c+this.matrix.k*x;n.x=f*_-u*v,n.y=m*v-f*y,n.z=u*y-m*_;var p=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return 0!=p&&(n.x/=p,n.y/=p,n.z/=p),n.w=s.x*n.x+s.y*n.y+s.z*n.z,!0}return!1}return!1},checkCollision:function(){for(var t,i=1,s=this.displ,n=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z),e=3*this.numFaces,r=0,h=0;h<e;){var a=3*this.indices[h];++h;var o=this.vertices[a];++a;var l=this.vertices[a];++a;var c=this.vertices[a];a=3*this.indices[h],++h;var x=this.vertices[a];++a;var m=this.vertices[a];++a;var u=this.vertices[a];a=3*this.indices[h],++h;var f=this.vertices[a];++a;var y=this.vertices[a];++a;var _=this.vertices[a],v=this.normals[r];++r;var p=this.normals[r];++r;var d=this.normals[r];++r;var z=this.normals[r];++r;var g,b,w,Y=this.src.x*v+this.src.y*p+this.src.z*d-z;Y<this.radius?(g=this.src.x-v*Y,b=this.src.y-p*Y,w=this.src.z-d*Y):(t=(Y-this.radius)/(Y-this.dest.x*v-this.dest.y*p-this.dest.z*d+z),g=this.src.x+this.displ.x*t-v*this.radius,b=this.src.y+this.displ.y*t-p*this.radius,w=this.src.z+this.displ.z*t-d*this.radius);for(var X=0,Z=0,T=0,P=1e22,k=!0,L=0;L<3;){var j,C,M,F,I,A,R=L++;0==R?(j=o,C=l,M=c,F=x,I=m,A=u):1==R?(j=x,C=m,M=u,F=f,I=y,A=_):(j=f,C=y,M=_,F=o,I=l,A=c);var E=F-j,O=I-C,S=A-M,N=g-j,V=b-C,D=w-M,B=D*O-V*S,G=N*S-D*E,q=V*E-N*O;if(B*v+G*p+q*d<0){var U,W=E*E+O*O+S*S,H=(B*B+G*G+q*q)/W;if(H<P)(t=(E/=W=Math.sqrt(W))*N+(O/=W)*V+(S/=W)*D)<0?(U=N*N+V*V+D*D)<P&&(P=U,X=j,Z=C,T=M):t>W?(U=(N=g-F)*N+(V=b-I)*V+(D=w-A)*D)<P&&(P=U,X=F,Z=I,T=A):(P=H,X=j+E*t,Z=C+O*t,T=M+S*t);k=!1}}k&&(X=g,Z=b,T=w);var K=this.src.x-X,J=this.src.y-Z,Q=this.src.z-T;if(K*this.displ.x+J*this.displ.y+Q*this.displ.z<=0){var $=K*K+J*J+Q*Q,tt=K*(-this.displ.x/n)+J*(-this.displ.y/n)+Q*(-this.displ.z/n),it=this.radius*this.radius-$+tt*tt;if(it>0){var st=(tt-Math.sqrt(it))/n;st<i&&(i=st,this.collisionPoint.x=X,this.collisionPoint.y=Z,this.collisionPoint.z=T,k?(this.collisionPlane.x=v,this.collisionPlane.y=p,this.collisionPlane.z=d,this.collisionPlane.w=z):($=Math.sqrt($),this.collisionPlane.x=K/$,this.collisionPlane.y=J/$,this.collisionPlane.z=Q/$,this.collisionPlane.w=this.collisionPoint.x*this.collisionPlane.x+this.collisionPoint.y*this.collisionPlane.y+this.collisionPoint.z*this.collisionPlane.z))}}}return i},__class__:systems_collisions_EllipsoidCollider};var util_LibUtil=function(){};util_LibUtil.__name__=!0,util_LibUtil.is=function(t,i){return js_Boot.__instanceof(t,i)},util_LibUtil.as=function(t,i){return js_Boot.__instanceof(t,i)?t:null};var util_TypeDefs=function(){};util_TypeDefs.__name__=!0,util_TypeDefs.createFloatVector=function(t,i){var s=[];return s.length=t,s},util_TypeDefs.createIntVector=function(t,i){var s=[];return s.length=t,s},util_TypeDefs.createUIntVector=function(t,i){var s=[];return s.length=t,s},util_TypeDefs.createVector=function(t,i){var s=[];return s.length=t,s},util_TypeDefs.setVectorLen=function(t,i,s){null==s&&(s=-1),t.length=i};var util_geom_AABBUtils=function(){};util_geom_AABBUtils.__name__=!0,util_geom_AABBUtils.getRect=function(t,i){null==i&&(i=.1);var s=t.maxX-t.minX,n=t.maxZ-t.minZ;return new jeash_geom_Rectangle(t.minX,t.minZ,s<0||s<i?i:s,n<0||n<i?i:n)},util_geom_AABBUtils.clampMagnitude=function(t,i){return null==i&&(i=.1),t<0||t<i?i:t},util_geom_AABBUtils.abs=function(t){return t<0?-t:t},util_geom_AABBUtils.norm=function(t){return 0!=t?t<0?-1:1:0},util_geom_AABBUtils.getString=function(t){return"AABB: "+Std.string([t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ])},util_geom_AABBUtils.pointInside=function(t,i){return!(i.x<t.minX||i.y<t.minY||i.z<t.minZ||i.x>t.maxX||i.y>t.maxY||i.z>t.maxZ)},util_geom_AABBUtils.intersectsEachOther=function(t,i){return!(t.maxX<i.minX||t.maxY<i.minY||t.maxZ<i.minZ||t.minX>i.maxX||t.minY>i.maxY||t.minZ>i.maxZ)},util_geom_AABBUtils.intersectsBoundValues=function(t,i,s,n,e,r,h){return!(t.maxX<i||t.maxY<s||t.maxZ<n||t.minX>e||t.minY>r||t.minZ>h)},util_geom_AABBUtils.transform=function(t,i){var s=t.minX,n=t.minY,e=t.minZ,r=t.maxX,h=t.maxY,a=t.maxZ;t.minX=17976931348623157e292,t.minY=17976931348623157e292,t.minZ=17976931348623157e292,t.maxX=-17976931348623157e292,t.maxY=-17976931348623157e292,t.maxZ=-17976931348623157e292;var o,l,c,x=s,m=n,u=e;o=x*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),m=n,u=e,o=(x=r)*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),m=h,u=e,o=(x=s)*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),m=n,u=a,o=(x=s)*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),x=t.maxX,m=t.maxY,u=t.minZ,o=x*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),m=h,u=a,o=(x=s)*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),m=n,u=a,o=(x=r)*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c),x=t.maxX,m=t.maxY,u=t.maxZ,o=x*i.a+m*i.b+u*i.c+i.d,l=x*i.e+m*i.f+u*i.g+i.h,c=x*i.i+m*i.j+u*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),c<t.minZ&&(t.minZ=c),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),c>t.maxZ&&(t.maxZ=c)},util_geom_AABBUtils.match=function(t,i){t.minX=i.minX,t.minY=i.minY,t.minZ=i.minZ,t.maxX=i.maxX,t.maxY=i.maxY,t.maxZ=i.maxZ},util_geom_AABBUtils.setToMax=function(t){t.minX=-17976931348623157e292,t.minY=-17976931348623157e292,t.minZ=-17976931348623157e292,t.maxX=17976931348623157e292,t.maxY=17976931348623157e292,t.maxZ=17976931348623157e292},util_geom_AABBUtils.reset=function(t){t.minX=17976931348623157e292,t.minY=17976931348623157e292,t.minZ=17976931348623157e292,t.maxX=-17976931348623157e292,t.maxY=-17976931348623157e292,t.maxZ=-17976931348623157e292},util_geom_AABBUtils.expand2=function(t,i){i.minX<t.minX&&(t.minX=i.minX),i.minY<t.minY&&(t.minY=i.minY),i.minZ<t.minZ&&(t.minZ=i.minZ),i.maxX>t.maxX&&(t.maxX=i.maxX),i.maxY>t.maxY&&(t.maxY=i.maxY),i.maxZ>t.maxZ&&(t.maxZ=i.maxZ)},util_geom_AABBUtils.expand=function(t,i,s,n){t<n.minX&&(n.minX=t),i<n.minY&&(n.minY=i),s<n.minZ&&(n.minZ=s),t>n.maxX&&(n.maxX=t),i>n.maxY&&(n.maxY=i),s>n.maxZ&&(n.maxZ=s)},util_geom_AABBUtils.expandWithPoint=function(t,i){t.x<i.minX&&(i.minX=t.x),t.y<i.minY&&(i.minY=t.y),t.z<i.minZ&&(i.minZ=t.z),t.x>i.maxX&&(i.maxX=t.x),t.y>i.maxY&&(i.maxY=t.y),t.z>i.maxZ&&(i.maxZ=t.z)},util_geom_AABBUtils.checkSphere=function(t,i){return i.x+i.w>t.minX&&i.x-i.w<t.maxX&&i.y+i.w>t.minY&&i.y-i.w<t.maxY&&i.z+i.w>t.minZ&&i.z-i.w<t.maxZ},util_geom_AABBUtils.intersectRay=function(t,i,s){return i.x>=t.minX&&i.x<=t.maxX&&i.y>=t.minY&&i.y<=t.maxY&&i.z>=t.minZ&&i.z<=t.maxZ||!(i.x<t.minX&&s.x<=0)&&(!(i.x>t.maxX&&s.x>=0)&&(!(i.y<t.minY&&s.y<=0)&&(!(i.y>t.maxY&&s.y>=0)&&(!(i.z<t.minZ&&s.z<=0)&&(!(i.z>t.maxZ&&s.z>=0)&&(s.x>1e-6?(n=(t.minX-i.x)/s.x,e=(t.maxX-i.x)/s.x):s.x<-1e-6?(n=(t.maxX-i.x)/s.x,e=(t.minX-i.x)/s.x):(n=-1e22,e=1e22),s.y>1e-6?(r=(t.minY-i.y)/s.y,h=(t.maxY-i.y)/s.y):s.y<-1e-6?(r=(t.maxY-i.y)/s.y,h=(t.minY-i.y)/s.y):(r=-1e22,h=1e22),!(r>=e||h<=n)&&(r<n||(n=r),h<e&&(e=h),s.z>1e-6?(r=(t.minZ-i.z)/s.z,h=(t.maxZ-i.z)/s.z):s.z<-1e-6?(r=(t.maxZ-i.z)/s.z,h=(t.minZ-i.z)/s.z):(r=-1e22,h=1e22),!(r>=e||h<=n))))))));var n,e,r,h};var util_geom_GeomCollisionSceneUtil=function(){};util_geom_GeomCollisionSceneUtil.__name__=!0,util_geom_GeomCollisionSceneUtil.calculateHierarchyBoundBox=function(t,i,s){if(null==s&&(s=new components_BoundBox),null!=i&&t!=i){var n,e=null;util_geom_GeomCollisionSceneUtil.toRootTransform.copy(t.transform);for(var r=t;null!=r._parent;)r=r._parent,util_geom_GeomCollisionSceneUtil.toRootTransform.append(r.transform),r==i&&(e=util_geom_GeomCollisionSceneUtil.toRootTransform);if(n=r,null==e){for(util_geom_GeomCollisionSceneUtil.fromRootTransform.copy(i.inverseTransform),r=i;null!=r._parent;)r=r._parent,util_geom_GeomCollisionSceneUtil.fromRootTransform.prepend(r.inverseTransform);if(n!=r)throw new js__$Boot_HaxeError("Object and boundBoxSpace must be located in the same hierarchy.");util_geom_GeomCollisionSceneUtil.toRootTransform.append(util_geom_GeomCollisionSceneUtil.fromRootTransform),e=util_geom_GeomCollisionSceneUtil.toRootTransform}util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(t,s,e)}else util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(t,s);return s},util_geom_GeomCollisionSceneUtil.transformBounds=function(t,i){var s,n,e;s=t.minX,n=t.minY,e=t.minZ,t.minX=i.a*s+i.b*n+i.c*e+i.d,t.minY=i.e*s+i.f*n+i.g*e+i.h,t.minZ=i.i*s+i.j*n+i.k*e+i.l,s=t.maxX,n=t.maxY,e=t.maxZ,t.maxX=i.a*s+i.b*n+i.c*e+i.d,t.maxY=i.e*s+i.f*n+i.g*e+i.h,t.maxZ=i.i*s+i.j*n+i.k*e+i.l},util_geom_GeomCollisionSceneUtil.updateBounds=function(t,i){i.minX<t.minX&&(t.minX=i.minX),i.maxX>t.maxX&&(t.maxX=i.maxX),i.minY<t.minY&&(t.minY=i.minY),i.maxY>t.maxY&&(t.maxY=i.maxY),i.minZ<t.minZ&&(t.minZ=i.minZ),i.maxZ>t.maxZ&&(t.maxZ=i.maxZ)},util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically=function(t,i,s){if(null!=t.boundBox){var n=t.boundBox;n.minX<i.minX&&(i.minX=n.minX),n.maxX>i.maxX&&(i.maxX=n.maxX),n.minY<i.minY&&(i.minY=n.minY),n.maxY>i.maxY&&(i.maxY=n.maxY),n.minZ<i.minZ&&(i.minZ=n.minZ),n.maxZ>i.maxZ&&(i.maxZ=n.maxZ)}for(var e=t.childrenList;null!=e;)e.localToGlobalTransform.copy(e.transform),null!=s&&e.localToGlobalTransform.append(s),util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(e,i,e.localToGlobalTransform),e=e.next};var util_geom_GeomUtil=function(){};util_geom_GeomUtil.__name__=!0,util_geom_GeomUtil.transformVertices=function(t,i,s){null==s&&(s=-1),s<0&&(s=t.length);for(var n=0;n<s;){var e=t[n],r=t[n+1],h=t[n+2];t[n]=i.a*e+i.b*r+i.c*h+i.d,t[n+1]=i.e*e+i.f*r+i.g*h+i.h,t[n+2]=i.i*e+i.j*r+i.k*h+i.l,n+=3}},util_geom_GeomUtil.boundIntersectSphere=function(t,i,s,n,e,r,h){return t.x+t.w>i&&t.x-t.w<e&&t.y+t.w>s&&t.y-t.w<r&&t.z+t.w>n&&t.z-t.w<h},util_geom_GeomUtil.boundIntersectRay=function(t,i,s,n,e,r,h,a,o){if(t.x>=s&&t.x<=r&&t.y>=n&&t.y<=h&&t.z>=e&&t.z<=a)return!0;if(t.x<s&&i.x<=0)return!1;if(t.x>r&&i.x>=0)return!1;if(t.y<n&&i.y<=0)return!1;if(t.y>h&&i.y>=0)return!1;if(t.z<e&&i.z<=0)return!1;if(t.z>a&&i.z>=0)return!1;var l,c,x,m,u=1e-6;return i.x>u?(l=(s-t.x)/i.x,c=(r-t.x)/i.x):i.x<-1e-6?(l=(r-t.x)/i.x,c=(s-t.x)/i.x):(l=-1e22,c=1e22),i.y>u?(x=(n-t.y)/i.y,m=(h-t.y)/i.y):i.y<-1e-6?(x=(h-t.y)/i.y,m=(n-t.y)/i.y):(x=-1e22,m=1e22),!(x>=c||m<=l)&&(x<l||(l=x),m<c&&(c=m),i.z>u?(x=(e-t.z)/i.z,m=(a-t.z)/i.z):i.z<-1e-6?(x=(a-t.z)/i.z,m=(e-t.z)/i.z):(x=-1e22,m=1e22),x=x>l?x:l,m=m<c?m:c,!(i.w>0&&x>=i.w||o.w>0&&x>=o.w)&&!(x>=c||m<=l))},util_geom_GeomUtil.intersectRayTri=function(t,i,s,n,e,r,h,a,o,l,c,x,m,u,f,y){var _=c-a,v=x-o,p=m-l,d=u-a,z=f-o,g=y-l,b=g*v-z*p,w=d*p-g*_,Y=z*_-d*v,X=b*b+w*w+Y*Y;X>.001&&(b*=X=1/Math.sqrt(X),w*=X,Y*=X);var Z=e*b+r*w+h*Y;if(Z<0){var T=i*b+s*w+n*Y-(a*b+o*w+l*Y);if(T>0){var P=-T/Z,k=i+e*P,L=s+r*P,j=n+h*P;if(((g=j-l)*(v=x-o)-(z=L-o)*(p=m-l))*b+((d=k-a)*p-g*(_=c-a))*w+(z*_-d*v)*Y>=0&&((g=j-m)*(v=f-x)-(z=L-x)*(p=y-m))*b+((d=k-c)*p-g*(_=u-c))*w+(z*_-d*v)*Y>=0&&((g=j-y)*(v=o-f)-(z=L-f)*(p=l-y))*b+((d=k-u)*p-g*(_=a-u))*w+(z*_-d*v)*Y>=0)return t.w=P,t.x=k,t.y=L,t.z=j,!0}}return!1};var util_geom_ITECollidable=function(){};util_geom_ITECollidable.__name__=!0,util_geom_ITECollidable.__interfaces__=[systems_collisions_ITCollidable,systems_collisions_IECollidable];var util_geom_Geometry=function(){this.vertices=[],this.indices=[],this.numVertices=0,this.numIndices=0};util_geom_Geometry.__name__=!0,util_geom_Geometry.__interfaces__=[altern_culling_IFrustumCollectTri,altern_ray_IRaycastImpl,util_geom_ITECollidable],util_geom_Geometry.prototype={setVertices:function(t){this.vertices=t,this.numVertices=t.length/3|0},setIndices:function(t){this.indices=t,this.numIndices=t.length},collectGeometry:function(t){t.geometries[t.numGeometries]=this,t.transforms[t.numGeometries]=t.inverseMatrix,t.numGeometries++},collectGeometryAndTransforms:function(t,i){t.geometries[t.numGeometries]=this,t.transforms[t.numGeometries]=i,t.numGeometries++},intersectRay:function(t,i,s){for(var n=t.x,e=t.y,r=t.z,h=i.x,a=i.y,o=i.z,l=null,c=0!=s.w?s.w:0!=i.w?i.w:1e22,x=3*Math.floor(this.numIndices/3),m=0,u=0;u<x;){var f=this.indices[u],y=this.indices[u+1],_=this.indices[u+2];m=3*f;var v=this.vertices[m++],p=this.vertices[m++],d=this.vertices[m];m=3*y;var z=this.vertices[m++],g=this.vertices[m++],b=this.vertices[m];m=3*_;var w=this.vertices[m++],Y=this.vertices[m++],X=this.vertices[m],Z=z-v,T=g-p,P=b-d,k=w-v,L=Y-p,j=X-d,C=j*T-L*P,M=k*P-j*Z,F=L*Z-k*T,I=C*C+M*M+F*F;I>.001&&(C*=I=1/Math.sqrt(I),M*=I,F*=I);var A=h*C+a*M+o*F;if(A<0){var R=n*C+e*M+r*F-(v*C+p*M+d*F);if(R>0){var E=-R/A;if(null==l||E<c){var O=n+h*E,S=e+a*E,N=r+o*E;((j=N-d)*(T=g-p)-(L=S-p)*(P=b-d))*C+((k=O-v)*P-j*(Z=z-v))*M+(L*Z-k*T)*F>=0&&((j=N-b)*(T=Y-g)-(L=S-g)*(P=X-b))*C+((k=O-z)*P-j*(Z=w-z))*M+(L*Z-k*T)*F>=0&&((j=N-X)*(T=p-Y)-(L=S-Y)*(P=d-X))*C+((k=O-w)*P-j*(Z=v-w))*M+(L*Z-k*T)*F>=0&&E<c&&(c=E,null==l&&(l=util_geom_Geometry.sampleRayPoint),l.x=O,l.y=S,l.z=N,v,p,d,C,z,g,b,M,w,Y,X,F)}}}u+=3}return null!=l?(s.x=l.x,s.y=l.y,s.z=l.z,s.w=c,s):null},collectTrisForFrustum:function(t,i,s,n,e){for(var r,h=n.length,a=e.length,o=this.numIndices,l=0;l<o;){var c=this.indices[l],x=this.indices[l+1],m=this.indices[l+2];r=3*c;var u=this.vertices[r++],f=this.vertices[r++],y=this.vertices[r];r=3*x;var _=this.vertices[r++],v=this.vertices[r++],p=this.vertices[r];r=3*m;var d,z=this.vertices[r++],g=this.vertices[r++],b=this.vertices[r];if(!!altern_culling_DefaultCulling.isInFrontOfFrustum(u,f,y,_,v,p,z,g,b,s)&&(d=altern_culling_DefaultCulling.triInFrustumCover(t,u,f,y,_,v,p,z,g,b))>=0)if(0==d)n[h++]=u,e[a]=a++,n[h++]=f,e[a]=a++,n[h++]=y,e[a]=a++,n[h++]=_,e[a]=a++,n[h++]=v,e[a]=a++,n[h++]=p,e[a]=a++,n[h++]=z,e[a]=a++,n[h++]=g,e[a]=a++,n[h++]=b,e[a]=a++;else{var w,Y,X,Z,T,P;if(Y=altern_culling_DefaultCulling.clippedFace,0!=(1&d)&&null!=Y){for(X=Y.wrapper.vertex,P=(w=Y.wrapper.next).next;null!=P;)Z=w.vertex,T=P.vertex,n[h++]=X.x,e[a]=a++,n[h++]=X.y,e[a]=a++,n[h++]=X.z,e[a]=a++,n[h++]=Z.x,e[a]=a++,n[h++]=Z.y,e[a]=a++,n[h++]=Z.z,e[a]=a++,n[h++]=T.x,e[a]=a++,n[h++]=T.y,e[a]=a++,n[h++]=T.z,e[a]=a++,w=w.next,P=P.next;var k=altern_culling_DefaultCulling.clippedFace;k.destroy(),k.next=altern_geom_Face.collector,altern_geom_Face.collector=k}if(Y=altern_culling_DefaultCulling.clippedFace2,0!=(2&d)&&null!=Y){for(X=Y.wrapper.vertex,P=(w=Y.wrapper.next).next;null!=P;)Z=w.vertex,T=P.vertex,n[h++]=X.x,e[a]=a++,n[h++]=X.y,e[a]=a++,n[h++]=X.z,e[a]=a++,n[h++]=Z.x,e[a]=a++,n[h++]=Z.y,e[a]=a++,n[h++]=Z.z,e[a]=a++,n[h++]=T.x,e[a]=a++,n[h++]=T.y,e[a]=a++,n[h++]=T.z,e[a]=a++,w=w.next,P=P.next;var L=altern_culling_DefaultCulling.clippedFace2;L.destroy(),L.next=altern_geom_Face.collector,altern_geom_Face.collector=L}}l+=3}},__class__:util_geom_Geometry};var util_geom_IMat3=function(){};util_geom_IMat3.__name__=!0,util_geom_IMat3.prototype={__class__:util_geom_IMat3};var util_geom_IMat4=function(){};util_geom_IMat4.__name__=!0,util_geom_IMat4.__interfaces__=[util_geom_IMat3],util_geom_IMat4.prototype={__class__:util_geom_IMat4};var util_geom_Mat3=function(t,i,s,n,e,r,h,a,o){null==o&&(o=1),null==a&&(a=0),null==h&&(h=0),null==r&&(r=0),null==e&&(e=1),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.a=t,this.b=i,this.c=s,this.e=n,this.f=e,this.g=r,this.i=h,this.j=a,this.k=o};util_geom_Mat3.__name__=!0,util_geom_Mat3.__interfaces__=[util_geom_IMat3],util_geom_Mat3.prototype={determinant:function(){return 1/(-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k)},identity:function(){this.a=this.f=this.k=1,this.b=this.c=this.e=this.g=this.i=this.j=0},clone:function(){return new util_geom_Mat3(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)},transformVector:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},transformVectorTransposed:function(t,i){i.x=this.a*t.x+this.e*t.y+this.i*t.z,i.y=this.b*t.x+this.f*t.y+this.j*t.z,i.z=this.c*t.x+this.g*t.y+this.k*t.z},transformVec3To3D:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},invert:function(){var t=1/(-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k);this.a=(this.f*this.k-this.g*this.j)*t,this.b=(this.c*this.g-this.b*this.k)*t,this.c=(this.b*this.g-this.c*this.f)*t,this.e=(this.g*this.i-this.e*this.k)*t,this.f=(this.a*this.k-this.c*this.i)*t,this.g=(this.c*this.e-this.a*this.g)*t,this.i=(this.e*this.j-this.f*this.i)*t,this.j=(this.b*this.i-this.a*this.j)*t,this.k=(this.a*this.f-this.b*this.e)*t},invert_with_determinant:function(t){this.a=(this.f*this.k-this.g*this.j)*t,this.b=(this.c*this.g-this.b*this.k)*t,this.c=(this.b*this.g-this.c*this.f)*t,this.e=(this.g*this.i-this.e*this.k)*t,this.f=(this.a*this.k-this.c*this.i)*t,this.g=(this.c*this.e-this.a*this.g)*t,this.i=(this.e*this.j-this.f*this.i)*t,this.j=(this.b*this.i-this.a*this.j)*t,this.k=(this.a*this.f-this.b*this.e)*t},append:function(t){this.a=t.a*this.a+t.b*this.e+t.c*this.i,this.b=t.a*this.b+t.b*this.f+t.c*this.j,this.c=t.a*this.c+t.b*this.g+t.c*this.k,this.e=t.e*this.a+t.f*this.e+t.g*this.i,this.f=t.e*this.b+t.f*this.f+t.g*this.j,this.g=t.e*this.c+t.f*this.g+t.g*this.k,this.i=t.i*this.a+t.j*this.e+t.k*this.i,this.j=t.i*this.b+t.j*this.f+t.k*this.j,this.k=t.i*this.c+t.j*this.g+t.k*this.k},prepend:function(t){this.a=this.a*t.a+this.b*t.e+this.c*t.i,this.b=this.a*t.b+this.b*t.f+this.c*t.j,this.c=this.a*t.c+this.b*t.g+this.c*t.k,this.e=this.e*t.a+this.f*t.e+this.g*t.i,this.f=this.e*t.b+this.f*t.f+this.g*t.j,this.g=this.e*t.c+this.f*t.g+this.g*t.k,this.i=this.i*t.a+this.j*t.e+this.k*t.i,this.j=this.i*t.b+this.j*t.f+this.k*t.j,this.k=this.i*t.c+this.j*t.g+this.k*t.k},prependTransposed:function(t){this.a=this.a*t.a+this.b*t.b+this.c*t.c,this.b=this.a*t.e+this.b*t.f+this.c*t.g,this.c=this.a*t.i+this.b*t.j+this.c*t.k,this.e=this.e*t.a+this.f*t.b+this.g*t.c,this.f=this.e*t.e+this.f*t.f+this.g*t.g,this.g=this.e*t.i+this.f*t.j+this.g*t.k,this.i=this.i*t.a+this.j*t.b+this.k*t.c,this.j=this.i*t.e+this.j*t.f+this.k*t.g,this.k=this.i*t.i+this.j*t.j+this.k*t.k},add:function(t){this.a+=t.a,this.b+=t.b,this.c+=t.c,this.e+=t.e,this.f+=t.f,this.g+=t.g,this.i+=t.i,this.j+=t.j,this.k+=t.k},subtract:function(t){this.a-=t.a,this.b-=t.b,this.c-=t.c,this.e-=t.e,this.f-=t.f,this.g-=t.g,this.i-=t.i,this.j-=t.j,this.k-=t.k},transpose:function(){var t=this.b;this.b=this.e,this.e=t,t=this.c,this.c=this.i,this.i=t,t=this.g,this.g=this.j,this.j=t},toSkewSymmetric:function(t){this.a=this.f=this.k=0,this.b=-t.z,this.c=t.y,this.e=t.z,this.g=-t.x,this.i=-t.y,this.j=t.x},copyFrom:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f,this.g=t.g,this.i=t.i,this.j=t.j,this.k=t.k},writeToEulerAngles:function(t){-1<this.i&&this.i<1?(t.x=Math.atan2(this.j,this.k),t.y=-Math.asin(this.i),t.z=Math.atan2(this.e,this.a)):(t.x=0,t.y=this.i<=-1?Math.PI:-Math.PI,t.y*=.5,t.z=Math.atan2(-this.b,this.f))},setRotation:function(t,i,s){var n=Math.cos(t),e=Math.sin(t),r=Math.cos(i),h=Math.sin(i),a=Math.cos(s),o=Math.sin(s),l=a*h,c=o*h;this.a=a*r,this.b=l*e-o*n,this.c=l*n+o*e,this.e=o*r,this.f=c*e+a*n,this.g=c*n-a*e,this.i=-h,this.j=r*e,this.k=r*n},setFromAxisAngle:function(t,i){var s=Math.cos(i),n=Math.sin(i),e=1-s,r=t.x,h=t.y,a=t.z;this.a=e*r*r+s,this.b=e*r*h-a*n,this.c=e*r*a+h*n,this.e=e*r*h+a*n,this.f=e*h*h+s,this.g=e*h*a-r*n,this.i=e*r*a-h*n,this.j=e*h*a+r*n,this.k=e*a*a+s},toString:function(){return"[Mat3 ("+this.a+", "+this.b+", "+this.c+"), ("+this.e+", "+this.f+", "+this.g+"), ("+this.i+", "+this.j+", "+this.k+")]"},__class__:util_geom_Mat3};var util_geom_Mat4=function(t,i,s,n,e,r,h,a,o,l,c,x){null==x&&(x=0),null==c&&(c=1),null==l&&(l=0),null==o&&(o=0),null==a&&(a=0),null==h&&(h=0),null==r&&(r=1),null==e&&(e=0),null==n&&(n=0),null==s&&(s=0),null==i&&(i=0),null==t&&(t=1),this.a=t,this.b=i,this.c=s,this.d=n,this.e=e,this.f=r,this.g=h,this.h=a,this.i=o,this.j=l,this.k=c,this.l=x};util_geom_Mat4.__name__=!0,util_geom_Mat4.__interfaces__=[util_geom_IMat4],util_geom_Mat4.prototype={identity:function(){this.a=this.f=this.k=1,this.b=this.c=this.e=this.g=this.i=this.j=this.d=this.h=this.l=0},determinant:function(){return-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k},invert:function(){var t=-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k;this.a=(-this.g*this.j+this.f*this.k)/t,this.b=(this.c*this.j-this.b*this.k)/t,this.c=(-this.c*this.f+this.b*this.g)/t,this.d=(this.d*this.g*this.j-this.c*this.h*this.j-this.d*this.f*this.k+this.b*this.h*this.k+this.c*this.f*this.l-this.b*this.g*this.l)/t,this.e=(this.g*this.i-this.e*this.k)/t,this.f=(-this.c*this.i+this.a*this.k)/t,this.g=(this.c*this.e-this.a*this.g)/t,this.h=(this.c*this.h*this.i-this.d*this.g*this.i+this.d*this.e*this.k-this.a*this.h*this.k-this.c*this.e*this.l+this.a*this.g*this.l)/t,this.i=(-this.f*this.i+this.e*this.j)/t,this.j=(this.b*this.i-this.a*this.j)/t,this.k=(-this.b*this.e+this.a*this.f)/t,this.l=(this.d*this.f*this.i-this.b*this.h*this.i-this.d*this.e*this.j+this.a*this.h*this.j+this.b*this.e*this.l-this.a*this.f*this.l)/t},invert_with_determinant:function(t){this.a=(-this.g*this.j+this.f*this.k)/t,this.b=(this.c*this.j-this.b*this.k)/t,this.c=(-this.c*this.f+this.b*this.g)/t,this.d=(this.d*this.g*this.j-this.c*this.h*this.j-this.d*this.f*this.k+this.b*this.h*this.k+this.c*this.f*this.l-this.b*this.g*this.l)/t,this.e=(this.g*this.i-this.e*this.k)/t,this.f=(-this.c*this.i+this.a*this.k)/t,this.g=(this.c*this.e-this.a*this.g)/t,this.h=(this.c*this.h*this.i-this.d*this.g*this.i+this.d*this.e*this.k-this.a*this.h*this.k-this.c*this.e*this.l+this.a*this.g*this.l)/t,this.i=(-this.f*this.i+this.e*this.j)/t,this.j=(this.b*this.i-this.a*this.j)/t,this.k=(-this.b*this.e+this.a*this.f)/t,this.l=(this.d*this.f*this.i-this.b*this.h*this.i-this.d*this.e*this.j+this.a*this.h*this.j+this.b*this.e*this.l-this.a*this.f*this.l)/t},append:function(t){this.a=t.a*this.a+t.b*this.e+t.c*this.i,this.b=t.a*this.b+t.b*this.f+t.c*this.j,this.c=t.a*this.c+t.b*this.g+t.c*this.k,this.d=t.a*this.d+t.b*this.h+t.c*this.l+t.d,this.e=t.e*this.a+t.f*this.e+t.g*this.i,this.f=t.e*this.b+t.f*this.f+t.g*this.j,this.g=t.e*this.c+t.f*this.g+t.g*this.k,this.h=t.e*this.d+t.f*this.h+t.g*this.l+t.h,this.i=t.i*this.a+t.j*this.e+t.k*this.i,this.j=t.i*this.b+t.j*this.f+t.k*this.j,this.k=t.i*this.c+t.j*this.g+t.k*this.k,this.l=t.i*this.d+t.j*this.h+t.k*this.l+t.l},prepend:function(t){this.a=this.a*t.a+this.b*t.e+this.c*t.i,this.b=this.a*t.b+this.b*t.f+this.c*t.j,this.c=this.a*t.c+this.b*t.g+this.c*t.k,this.d=this.a*t.d+this.b*t.h+this.c*t.l+this.d,this.e=this.e*t.a+this.f*t.e+this.g*t.i,this.f=this.e*t.b+this.f*t.f+this.g*t.j,this.g=this.e*t.c+this.f*t.g+this.g*t.k,this.h=this.e*t.d+this.f*t.h+this.g*t.l+this.h,this.i=this.i*t.a+this.j*t.e+this.k*t.i,this.j=this.i*t.b+this.j*t.f+this.k*t.j,this.k=this.i*t.c+this.j*t.g+this.k*t.k,this.l=this.i*t.d+this.j*t.h+this.k*t.l+this.l},add:function(t){this.a+=t.a,this.b+=t.b,this.c+=t.c,this.d+=t.d,this.e+=t.e,this.f+=t.f,this.g+=t.g,this.h+=t.h,this.i+=t.i,this.j+=t.j,this.k+=t.k,this.l+=t.l},subtract:function(t){this.a-=t.a,this.b-=t.b,this.c-=t.c,this.d-=t.d,this.e-=t.e,this.f-=t.f,this.g-=t.g,this.h-=t.h,this.i-=t.i,this.j-=t.j,this.k-=t.k,this.l-=t.l},transformPoint:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z+this.d,i.y=this.e*t.x+this.f*t.y+this.g*t.z+this.h,i.z=this.i*t.x+this.j*t.y+this.k*t.z+this.l},transformPointTransposed:function(t,i){var s=t.x-this.d,n=t.y-this.h,e=t.z-this.l;i.x=this.a*s+this.e*n+this.i*e,i.y=this.b*s+this.f*n+this.j*e,i.z=this.c*s+this.g*n+this.k*e},transformPoints:function(t,i){for(var s,n,e=0,r=t.length;e<r;){var h=e++;s=t[h],(n=i[h]).x=this.a*s.x+this.b*s.y+this.c*s.z+this.d,n.y=this.e*s.x+this.f*s.y+this.g*s.z+this.h,n.z=h*s.x+this.j*s.y+this.k*s.z+this.l}},transformPointsN:function(t,i,s){for(var n,e,r=0,h=s;r<h;){var a=r++;n=t[a],(e=i[a]).x=this.a*n.x+this.b*n.y+this.c*n.z+this.d,e.y=this.e*n.x+this.f*n.y+this.g*n.z+this.h,e.z=a*n.x+this.j*n.y+this.k*n.z+this.l}},transformPointsTransposed:function(t,i){for(var s,n,e=0,r=t.length;e<r;){var h=e++;s=t[h],n=i[h];var a=s.x-this.d,o=s.y-this.h,l=s.z-this.l;n.x=this.a*a+this.e*o+h*l,n.y=this.b*a+this.f*o+this.j*l,n.z=this.c*a+this.g*o+this.k*l}},transformPointsTransposedN:function(t,i,s){for(var n,e,r=0,h=s;r<h;){var a=r++;n=t[a],e=i[a];var o=n.x-this.d,l=n.y-this.h,c=n.z-this.l;e.x=this.a*o+this.e*l+a*c,e.y=this.b*o+this.f*l+this.j*c,e.z=this.c*o+this.g*l+this.k*c}},getAxis:function(t,i){switch(t){case 0:return i.x=this.a,i.y=this.e,void(i.z=this.i);case 1:return i.x=this.b,i.y=this.f,void(i.z=this.j);case 2:return i.x=this.c,i.y=this.g,void(i.z=this.k);case 3:return i.x=this.d,i.y=this.h,void(i.z=this.l)}},setAxes:function(t,i,s,n){this.a=t.x,this.e=t.y,this.i=t.z,this.b=i.x,this.f=i.y,this.j=i.z,this.c=s.x,this.g=s.y,this.k=s.z,this.d=n.x,this.h=n.y,this.l=n.z},transformVector:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},transformVectorTransposed:function(t,i){i.x=this.a*t.x+this.e*t.y+this.i*t.z,i.y=this.b*t.x+this.f*t.y+this.j*t.z,i.z=this.c*t.x+this.g*t.y+this.k*t.z},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l},copy3:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f,this.g=t.g,this.i=t.i,this.j=t.j,this.k=t.k},getEulerAngles:function(t){-1<this.i&&this.i<1?(t.x=Math.atan2(this.j,this.k),t.y=-Math.asin(this.i),t.z=Math.atan2(this.e,this.a)):(t.x=0,t.y=this.i<=-1?Math.PI:-Math.PI,t.y*=.5,t.z=Math.atan2(-this.b,this.f))},setPosition:function(t){this.d=t.x,this.h=t.y,this.l=t.z},setPositionXYZ:function(t,i,s){this.d=t,this.h=i,this.l=s},clone:function(){return new util_geom_Mat4(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l)},toString:function(){return"[Mat4 ["+this.a+" "+this.b+" "+this.c+" "+this.d+"] ["+this.e+" "+this.f+" "+this.g+" "+this.h+"] ["+this.i+" "+this.j+" "+this.k+" "+this.l+"]]"},setRotation:function(t,i,s){var n=Math.cos(t),e=Math.sin(t),r=Math.cos(i),h=Math.sin(i),a=Math.cos(s),o=Math.sin(s),l=a*h,c=o*h;this.a=a*r,this.b=l*e-o*n,this.c=l*n+o*e,this.e=o*r,this.f=c*e+a*n,this.g=c*n-a*e,this.i=-h,this.j=r*e,this.k=r*n},setFromAxisAngle:function(t,i){var s=Math.cos(i),n=Math.sin(i),e=1-s,r=t.x,h=t.y,a=t.z;this.a=e*r*r+s,this.b=e*r*h-a*n,this.c=e*r*a+h*n,this.e=e*r*h+a*n,this.f=e*h*h+s,this.g=e*h*a-r*n,this.i=e*r*a-h*n,this.j=e*h*a+r*n,this.k=e*a*a+s},__class__:util_geom_Mat4};var util_geom_PMath=function(){};util_geom_PMath.__name__=!0,util_geom_PMath.isNaN=function(t){return t!=t},util_geom_PMath.floatToInt=function(t){return 0|t},util_geom_PMath.intToFloat=function(t){return t},util_geom_PMath.toRad=function(t){return.017453292519943295*t},util_geom_PMath.toDeg=function(t){return 57.29577951308232*t},util_geom_PMath.min=function(t,i){return t<i?t:i},util_geom_PMath.minF=function(t,i){return t<i?t:i},util_geom_PMath.max=function(t,i){return t>i?t:i},util_geom_PMath.maxF=function(t,i){return t>i?t:i},util_geom_PMath.abs=function(t){return t<0?-t:t},util_geom_PMath.absI=function(t){return t<0?-t:t},util_geom_PMath.sgn=function(t){return t>0?1:t<0?-1:0},util_geom_PMath.clamp=function(t,i,s){return t<i?i:t>s?s:t},util_geom_PMath.clampSym=function(t,i){return t<-i?-i:t>i?i:t},util_geom_PMath.wrap=function(t,i,s){return t<i?t-i+s+1:t>s?t-s+i-1:t},util_geom_PMath.fmin=function(t,i){return t<i?t:i},util_geom_PMath.fmax=function(t,i){return t>i?t:i},util_geom_PMath.fabs=function(t){return t<0?-t:t},util_geom_PMath.fsign=function(t){return t>=0?1:-1},util_geom_PMath.fclamp=function(t,i,s){return t<i?i:t>s?s:t},util_geom_PMath.fclampSym=function(t,i){return t<-i?-i:t>i?i:t},util_geom_PMath.fwrap=function(t,i,s){return t<i?t-i+s+1:t>s?t-s+i-1:t},util_geom_PMath.eqSgn=function(t,i){return(t^i)>=0},util_geom_PMath.isEven=function(t){return 0==(1&t)},util_geom_PMath.isPow2=function(t){return t>0&&0==(t&t-1)},util_geom_PMath.lerp=function(t,i,s){return t+(i-t)*s},util_geom_PMath.lerp3=function(t,i,s,n,e){return(s-t)/(s-i)*n+(t-i)/(s-i)*e},util_geom_PMath.biLerp=function(t,i,s,n,e,r,h,a,o,l){return(l-i)/(l-o)*((a-t)/(a-h)*s+(t-h)/(a-h)*e)+(i-o)/(l-o)*((a-t)/(a-h)*n+(t-h)/(a-h)*r)},util_geom_PMath.triLerp=function(t,i,s,n,e,r,h,a,o,l,c,x,m,u,f,y,_){return(_-s)/(_-y)*((f-i)/(f-u)*((m-t)/(m-x)*n+(t-x)/(m-x)*a)+(i-u)/(f-u)*((m-t)/(m-x)*e+(t-x)/(m-x)*o))+(s-y)/(_-y)*((f-i)/(f-u)*((m-t)/(m-x)*r+(t-x)/(m-x)*l)+(i-u)/(f-u)*((m-t)/(m-x)*h+(t-x)/(m-x)*c))},util_geom_PMath.slerp=function(t,i,s){var n=Math,e=n.sin(.5*t),r=n.cos(.5*t),h=n.sin(.5*i),a=n.cos(.5*i),o=r*a+e*h;if(o<0){if(1+o>1e-6){var l=n.acos(-o),c=n.sin(l),x=n.sin((1-s)*l)/c,m=n.sin(s*l)/c;return 2*n.atan2(x*e-m*h,x*r-m*a)}var u=1-s,f=s;return 2*n.atan2(u*e-f*h,u*r-f*a)}if(1-o>1e-6){var y=n.acos(o),_=n.sin(y),v=n.sin((1-s)*y)/_,p=n.sin(s*y)/_;return 2*n.atan2(v*e+p*h,v*r+p*a)}var d=1-s,z=s;return 2*n.atan2(d*e+z*h,d*r+z*a)},util_geom_PMath.nextPow2=function(t){var i=t;return i|=i>>1,i|=i>>2,i|=i>>3,i|=i>>4,(i|=i>>5)+1},util_geom_PMath.exp=function(t,i){for(var s=1,n=0;;){if(0!=(1&i)&&(s*=t),0==(i>>=1)){n=s;break}t*=t}return n},util_geom_PMath.roundTo=function(t,i){var s=t/i;return(0|(s>0?s+.5:s<0?s-.5:0))*i},util_geom_PMath.round=function(t){return 0|(t>0?t+.5:t<0?t-.5:0)},util_geom_PMath.ceil=function(t){if(t>0){var i=t+.5|0;return i<t?i+1:i}if(t<0){var s=t-.5|0;return s<t?s+1:s}return 0},util_geom_PMath.floor=function(t){if(t>0){var i=t+.5|0;return i<t?i:i-1}if(t<0){var s=t-.5|0;return s>t?s-1:s}return 0},util_geom_PMath.invSqrt=function(t){return 1/Math.sqrt(t)},util_geom_PMath.cmpAbs=function(t,i,s){var n=t-i;return n>0?n<s:-n<s},util_geom_PMath.cmpZero=function(t,i){return t>0?t<i:-t<i},util_geom_PMath.snap=function(t,i){var s=(t+.5*i)/i;if(s>0){var n=s+.5|0;return n<s?n:n-1}if(s<0){var e=s-.5|0;return e>s?e-1:e}return 0},util_geom_PMath.inRange=function(t,i,s){return t>=i&&t<=s},util_geom_PMath.rand=function(){return 2147483647*Math.random()|0},util_geom_PMath.randRange=function(t,i){var s=t-.4999+(i+.4999-(t-.4999))*Math.random();return 0|(s>0?s+.5:s<0?s-.5:0)},util_geom_PMath.randRangeSym=function(t){var i=-t,s=i-.4999+(t+.4999-(i-.4999))*Math.random();return 0|(s>0?s+.5:s<0?s-.5:0)},util_geom_PMath.frand=function(){return Math.random()},util_geom_PMath.frandRange=function(t,i){return t+(i-t)*Math.random()},util_geom_PMath.frandRangeSym=function(t){var i=-t;return i+(t-i)*Math.random()},util_geom_PMath.wrapToPi=function(t){var i=t/6.283185307179586,s=0|(i>0?i+.5:i<0?i-.5:0);return t<-3.141592653589793||t>3.141592653589793?t-6.283185307179586*s:t};var util_geom_Vec3Utils=function(){};util_geom_Vec3Utils.__name__=!0,util_geom_Vec3Utils.copy=function(t){return new util_geom_Vec3(t.x,t.y,t.z)},util_geom_Vec3Utils.createCross=function(t,i){return new util_geom_Vec3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},util_geom_Vec3Utils.createAdd=function(t,i){return new util_geom_Vec3(t.x+i.x,t.y+i.y,t.z+i.z)},util_geom_Vec3Utils.createSubtract=function(t,i){return new util_geom_Vec3(t.x-i.x,t.y-i.y,t.z-i.z)},util_geom_Vec3Utils.createScale=function(t,i){return new util_geom_Vec3(t.x*i,t.y*i,t.z*i)},util_geom_Vec3Utils.createProjection=function(t,i){var s=t.x*i.x+t.y*i.y+t.z*i.z;return new util_geom_Vec3(t.x-i.x*s,t.y-i.y*s,t.z-i.z*s)},util_geom_Vec3Utils.matchValues=function(t,i){t.x=i.x,t.y=i.y,t.z=i.z},util_geom_Vec3Utils.matchValuesVector3D=function(t,i){t.x=i.x,t.y=i.y,t.z=i.z},util_geom_Vec3Utils.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},util_geom_Vec3Utils.writeCross=function(t,i,s){s.x=t.y*i.z-t.z*i.y,s.y=t.z*i.x-i.z*t.x,s.z=t.x*i.y-t.y*i.x},util_geom_Vec3Utils.writeProjection=function(t,i,s){var n=t.x*i.x+t.y*i.y+t.z*i.z;s.x=t.x-i.x*n,s.y=t.y-i.y*n,s.z=t.z-i.z*n},util_geom_Vec3Utils.normalize=function(t){var i=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3Utils.subtract=function(t,i){t.x-=i.x,t.y-=i.y,t.z-=i.z},util_geom_Vec3Utils.add=function(t,i){t.x+=i.x,t.y+=i.y,t.z+=i.z},util_geom_Vec3Utils.scale=function(t,i){t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3Utils.writeSubtract=function(t,i,s){t.x=i.x-s.x,t.y=i.y-s.y,t.z=i.z-s.z},util_geom_Vec3Utils.getLength=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},util_geom_Vec3Utils.sqDistBetween=function(t,i){var s=i.x-t.x,n=i.y-t.y,e=i.z-t.z;return s*s+n*n+e*e},util_geom_Vec3Utils.sqDist2DBetween=function(t,i){var s=i.x-t.x,n=i.y-t.y;return s*s+n*n},util_geom_Vec3Utils.distBetween=function(t,i){var s=i.x-t.x,n=i.y-t.y,e=i.z-t.z;return Math.sqrt(s*s+n*n+e*e)},String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var e={__name__:["Int"]},r={__name__:["Dynamic"]},h=Number;h.__name__=["Float"];var a=Boolean;a.__ename__=["Bool"];var o={__name__:["Class"]},l={},c=i.ArrayBuffer||js_html_compat_ArrayBuffer;null==c.prototype.slice&&(c.prototype.slice=js_html_compat_ArrayBuffer.sliceImpl);var x=i.Float32Array||js_html_compat_Float32Array._new,m=i.Uint8Array||js_html_compat_Uint8Array._new;altern_collisions_dbvt_DBVT.COLLIDER_SPHERE=new jeash_geom_Vector3D,altern_culling_DefaultCulling.CLIP_NEAR=!1,altern_culling_TargetBoardTester.IDENTITY=new components_Transform3D,altern_culling_TargetBoardTester.PRIORITY_CONCEALMENT=0,altern_culling_TargetBoardTester.PRIORITY_COVER=1,altern_geom_AMesh.OPTION_CONVEX=1,altern_geom_AMesh.OPTION_CALCULATE_EDGES=2,altern_geom_AMesh.OPTION_WELD_VERTICES=4,altern_geom_AMesh.OPTION_WELD_FACES=8,altern_geom_AMesh.USE_OPTION_OCCLUDER_LEAST_0=3,altern_geom_AMesh.USE_OPTION_OCCLUDER_LEAST_1=11,altern_geom_AMesh.USE_OPTION_OCCLUDER=15,altern_geom_AMesh.DIGIT_THRESHOLD=.001,util_geom_Vec3.ZERO=new util_geom_Vec3(0,0,0),util_geom_Vec3.X_AXIS=new util_geom_Vec3(1,0,0),util_geom_Vec3.Y_AXIS=new util_geom_Vec3(0,1,0),util_geom_Vec3.Z_AXIS=new util_geom_Vec3(0,0,1),util_geom_Vec3.RIGHT=new util_geom_Vec3(1,0,0),util_geom_Vec3.LEFT=new util_geom_Vec3(-1,0,0),util_geom_Vec3.FORWARD=new util_geom_Vec3(0,1,0),util_geom_Vec3.BACK=new util_geom_Vec3(0,-1,0),util_geom_Vec3.UP=new util_geom_Vec3(0,0,1),util_geom_Vec3.DOWN=new util_geom_Vec3(0,0,-1),altern_geom_ClipMacros.DUMMY_VECTOR=new util_geom_Vec3,altern_geom_ClipMacros.transformId=0,altern_geom_IntersectSlopeUtil.RESULT_NONE=0,altern_geom_IntersectSlopeUtil.RESULT_SLOPE=1,altern_geom_IntersectSlopeUtil.RESULT_WALL=-1,altern_geom_IntersectSlopeUtil.RESULT_COLLINEAR=-2,altern_geom_IntersectSlopeUtil.RESULT_COLLINEAR_VALID=2,altern_geom_IntersectSlopeUtil.RESULT_ERROR=-3,altern_partition_js_BVHTree.FLOAT_MAX=340282346638528e24,components_CollisionResult.MAX_GROUND_NORMAL_THRESHOLD=.573576436351046,components_CollisionResult.FLAG_MAX_NORMAL_IMPULSE=1,components_CollisionResult.FLAG_MAX_GROUND_NORMAL=2,components_Jump.EPSILON=1e-5,components_controller_SurfaceMovement.WALK_FORWARD=1,components_controller_SurfaceMovement.WALK_STOP=0,components_controller_SurfaceMovement.WALK_BACK=-1,components_controller_SurfaceMovement.STRAFE_LEFT=-1,components_controller_SurfaceMovement.STRAFE_STOP=0,components_controller_SurfaceMovement.STRAFE_RIGHT=1,components_controller_SurfaceMovement.STOP_VELOCITY_SQ_LENGTH=1,haxe_ds_ObjectMap.count=0,js_Boot.__toStr={}.toString,js_html_compat_Float32Array.BYTES_PER_ELEMENT=4,js_html_compat_Uint8Array.BYTES_PER_ELEMENT=1,systems_collisions_CollisionEvent.GEOMTYPE_POINT=1,systems_collisions_CollisionEvent.GEOMTYPE_EDGE=2,systems_collisions_CollisionEvent.GEOMTYPE_POLYGON=3,systems_collisions_CollisionEvent.GEOMTYPE_THING=4,systems_collisions_CollisionEvent.TOLERANCE_POLYGON_OVERLAP=1e-5,systems_collisions_CollisionEvent.TOLERANCE_BACKWARDS_T=1e-6,systems_collisions_CollisionEvent.TOLERANCE_TRANSVERSE_DISPLACEMENT=1e-6,systems_collisions_CollisionEvent.TOLERANCE_QUADRATIC_DISCRIMINANT=1e-6,systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent,systems_collisions_EllipsoidCollider.ZERO_VECTOR=new jeash_geom_Vector3D,util_geom_AABBUtils.MAX_VALUE=17976931348623157e292,util_geom_AABBUtils.THRESHOLD=.1,util_geom_AABBUtils.THRESHOLD_RAY=1e-6,util_geom_GeomCollisionSceneUtil.toRootTransform=new components_Transform3D,util_geom_GeomCollisionSceneUtil.fromRootTransform=new components_Transform3D,util_geom_Geometry.IDENTITY=new components_Transform3D,util_geom_Geometry.sampleRayPoint=new jeash_geom_Vector3D,util_geom_Mat3.IDENTITY=new util_geom_Mat3,util_geom_Mat3.ZERO=new util_geom_Mat3(0,0,0,0,0,0,0,0,0),util_geom_Mat4.IDENTITY=new util_geom_Mat4,util_geom_PMath.INT8_MIN=-128,util_geom_PMath.INT8_MAX=127,util_geom_PMath.UINT8_MAX=255,util_geom_PMath.INT16_MIN=-32768,util_geom_PMath.INT16_MAX=32767,util_geom_PMath.UINT16_MAX=65535,util_geom_PMath.INT32_MIN=-2147483648,util_geom_PMath.INT32_MAX=2147483647,util_geom_PMath.UINT32_MAX=-1,util_geom_PMath.NaN=NaN,util_geom_PMath.POSITIVE_INFINITY=1/0,util_geom_PMath.NEGATIVE_INFINITY=-1/0,util_geom_PMath.FLOAT_MAX=340282346638528e24,util_geom_PMath.FLOAT_MIN=-340282346638528e24,util_geom_PMath.DOUBLE_MIN=179769313486231e294,util_geom_PMath.DOUBLE_MAX=-179769313486231e294,util_geom_PMath.RAD_DEG=57.29577951308232,util_geom_PMath.DEG_RAD=.017453292519943295,util_geom_PMath.LOG2E=1.4426950408889634,util_geom_PMath.LN2=.6931471805599453,util_geom_PMath.PIHALF=1.5707963267948966,util_geom_PMath.PI=3.141592653589793,util_geom_PMath.PI2=6.283185307179586,util_geom_PMath.EPS=1e-6,s.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(e){var i=0;return function(){return i<e.length?{done:!1,value:e[i++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.makeIterator=function(e){var i="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return i?i.call(e):$jscomp.arrayIterator(e)},$jscomp.arrayFromIterator=function(e){for(var i,n=[];!(i=e.next()).done;)n.push(i.value);return n},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(e){var k=function(){};return k.prototype=e,new k},$jscomp.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,i){if(e.__proto__=i,e.__proto__!==i)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.inherits=function(e,i){if(e.prototype=$jscomp.objectCreate(i.prototype),e.prototype.constructor=e,$jscomp.setPrototypeOf){var n=$jscomp.setPrototypeOf;n(e,i)}else for(n in i)if("prototype"!=n)if(Object.defineProperties){var o=Object.getOwnPropertyDescriptor(i,n);o&&Object.defineProperty(e,n,o)}else e[n]=i[n];e.superClass_=i.prototype},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,i,n){e!=Array.prototype&&e!=Object.prototype&&(e[i]=n.value)},$jscomp.polyfill=function(e,i,n,o){if(i){for(n=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var s=e[o];s in n||(n[s]={}),n=n[s]}(i=i(o=n[e=e[e.length-1]]))!=o&&null!=i&&$jscomp.defineProperty(n,e,{configurable:!0,writable:!0,value:i})}},$jscomp.polyfill("Number.EPSILON",(function(e){return Math.pow(2,-52)}),"es6","es3"),$jscomp.polyfill("Math.sign",(function(e){return e||function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1}}),"es6","es3"),$jscomp.checkEs6ConformanceViaProxy=function(){try{var e={},i=Object.create(new $jscomp.global.Proxy(e,{get:function(n,o,s){return n==e&&"q"==o&&s==i}}));return!0===i.q}catch(e){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.SymbolClass=function(e,i){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:i})},$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_},$jscomp.Symbol=function(){var e=0;return function d(i){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(i||"")+"_"+e++,i)}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}}),$jscomp.initSymbolIterator=function(){}},$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator")),$jscomp.initSymbolAsyncIterator=function(){}},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.owns=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},$jscomp.polyfill("WeakMap",(function(e){function g(){}function r(e){if(!$jscomp.owns(e,i)){var n=new g;$jscomp.defineProperty(e,i,{value:n})}}function q(e){var i=Object[e];i&&(Object[e]=function(e){return e instanceof g?e:(r(e),i(e))})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function k(){if(!e||!Object.seal)return!1;try{var i=Object.seal({}),n=Object.seal({}),o=new e([[i,2],[n,3]]);return 2==o.get(i)&&3==o.get(n)&&(o.delete(i),o.set(n,4),!o.has(i)&&4==o.get(n))}catch(e){return!1}}())return e;var i="$jscomp_hidden_"+Math.random();q("freeze"),q("preventExtensions"),q("seal");var n=0,xa=function(e){if(this.id_=(n+=Math.random()+1).toString(),e){e=$jscomp.makeIterator(e);for(var i;!(i=e.next()).done;)i=i.value,this.set(i[0],i[1])}};return xa.prototype.set=function(e,n){if(r(e),!$jscomp.owns(e,i))throw Error("WeakMap key fail: "+e);return e[i][this.id_]=n,this},xa.prototype.get=function(e){return $jscomp.owns(e,i)?e[i][this.id_]:void 0},xa.prototype.has=function(e){return $jscomp.owns(e,i)&&$jscomp.owns(e[i],this.id_)},xa.prototype.delete=function(e){return!(!$jscomp.owns(e,i)||!$jscomp.owns(e[i],this.id_))&&delete e[i][this.id_]},xa}),"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",(function(e){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function k(){if($jscomp.ASSUME_NO_NATIVE_MAP||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var i=Object.seal({x:4}),n=new e($jscomp.makeIterator([[i,"s"]]));if("s"!=n.get(i)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var o=n.entries(),s=o.next();return!s.done&&s.value[0]==i&&"s"==s.value[1]&&!((s=o.next()).done||4!=s.value[0].x||"t"!=s.value[1]||!o.next().done)}catch(e){return!1}}())return e;$jscomp.initSymbolIterator();var i=new WeakMap,r=function(e){if(this.data_={},this.head_=m(),this.size=0,e){e=$jscomp.makeIterator(e);for(var i;!(i=e.next()).done;)i=i.value,this.set(i[0],i[1])}};r.prototype.set=function(e,i){var n=q(this,e=0===e?0:e);return n.list||(n.list=this.data_[n.id]=[]),n.entry?n.entry.value=i:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:i},n.list.push(n.entry),this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++),this},r.prototype.delete=function(e){return!(!(e=q(this,e)).entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.data_[e.id],e.entry.previous.next=e.entry.next,e.entry.next.previous=e.entry.previous,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=m(),this.size=0},r.prototype.has=function(e){return!!q(this,e).entry},r.prototype.get=function(e){return(e=q(this,e).entry)&&e.value},r.prototype.entries=function(){return t(this,(function(e){return[e.key,e.value]}))},r.prototype.keys=function(){return t(this,(function(e){return e.key}))},r.prototype.values=function(){return t(this,(function(e){return e.value}))},r.prototype.forEach=function(e,i){for(var n,o=this.entries();!(n=o.next()).done;)n=n.value,e.call(i,n[1],n[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var q=function(e,o){var s=o&&typeof o;"object"==s||"function"==s?i.has(o)?s=i.get(o):(s=""+ ++n,i.set(o,s)):s="p_"+o;var h=e.data_[s];if(h&&$jscomp.owns(e.data_,s))for(e=0;e<h.length;e++){var u=h[e];if(o!=o&&u.key!=u.key||o===u.key)return{id:s,list:h,index:e,entry:u}}return{id:s,list:h,index:-1,entry:void 0}},t=function(e,i){var n=e.head_;return $jscomp.iteratorPrototype((function(){if(n){for(;n.head!=e.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:i(n)};n=null}return{done:!0,value:void 0}}))},m=function(){var e={};return e.previous=e.next=e.head=e},n=0;return r}),"es6","es3"),$jscomp.iteratorFromArray=function(e,i){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var n=0,o={next:function(){if(n<e.length){var s=n++;return{value:i(s,e[s]),done:!1}}return o.next=function(){return{done:!0,value:void 0}},o.next()}};return o[Symbol.iterator]=function(){return o},o},$jscomp.polyfill("Array.prototype.values",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e,i){return i}))}}),"es8","es3"),$jscomp.polyfill("Array.from",(function(e){return e||function(e,i,n){i=null!=i?i:function(e){return e};var o=[],s="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof s){e=s.call(e);for(var h=0;!(s=e.next()).done;)o.push(i.call(n,s.value,h++))}else for(s=e.length,h=0;h<s;h++)o.push(i.call(n,e[h],h));return o}}),"es6","es3"),$jscomp.polyfill("Array.prototype.entries",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e,i){return[e,i]}))}}),"es6","es3"),$jscomp.polyfill("Set",(function(e){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function k(){if($jscomp.ASSUME_NO_NATIVE_SET||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var i=Object.seal({x:4}),n=new e($jscomp.makeIterator([i]));if(!n.has(i)||1!=n.size||n.add(i)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var o=n.entries(),s=o.next();return!s.done&&s.value[0]==i&&s.value[1]==i&&(!(s=o.next()).done&&s.value[0]!=i&&4==s.value[0].x&&s.value[1]==s.value[0]&&o.next().done)}catch(e){return!1}}())return e;$jscomp.initSymbolIterator();var g=function(e){if(this.map_=new Map,e){e=$jscomp.makeIterator(e);for(var i;!(i=e.next()).done;)this.add(i.value)}this.size=this.map_.size};return g.prototype.add=function(e){return e=0===e?0:e,this.map_.set(e,e),this.size=this.map_.size,this},g.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},g.prototype.clear=function(){this.map_.clear(),this.size=0},g.prototype.has=function(e){return this.map_.has(e)},g.prototype.entries=function(){return this.map_.entries()},g.prototype.values=function(){return this.map_.values()},g.prototype.keys=g.prototype.values,g.prototype[Symbol.iterator]=g.prototype.values,g.prototype.forEach=function(e,i){var n=this;this.map_.forEach((function(o){return e.call(i,o,o,n)}))},g}),"es6","es3"),$jscomp.polyfill("Object.is",(function(e){return e||function(e,i){return e===i?0!==e||1/e==1/i:e!=e&&i!=i}}),"es6","es3"),$jscomp.polyfill("Array.prototype.includes",(function(e){return e||function(e,i){var n=this;n instanceof String&&(n=String(n));var o=n.length;for(0>(i=i||0)&&(i=Math.max(i+o,0));i<o;i++){var s=n[i];if(s===e||Object.is(s,e))return!0}return!1}}),"es7","es3"),$jscomp.checkStringArgs=function(e,i,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(i instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""},$jscomp.polyfill("String.prototype.includes",(function(e){return e||function(e,i){return-1!==$jscomp.checkStringArgs(this,e,"includes").indexOf(e,i||0)}}),"es6","es3"),$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",(function(e){function k(){this.batch_=null}function g(e){return e instanceof q?e:new q((function(i,n){i(e)}))}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;k.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var i=this;this.asyncExecuteFunction((function(){i.executeBatch_()}))}this.batch_.push(e)};var i=$jscomp.global.setTimeout;k.prototype.asyncExecuteFunction=function(e){i(e,0)},k.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var i=0;i<e.length;++i){var n=e[i];e[i]=null;try{n()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},k.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var q=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var i=this.createResolveAndReject_();try{e(i.resolve,i.reject)}catch(e){i.reject(e)}};q.prototype.createResolveAndReject_=function(){function d(n){return function(o){i||(i=!0,n.call(e,o))}}var e=this,i=!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}},q.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof q)this.settleSameAsPromise_(e);else{t:switch(typeof e){case"object":var i=null!=e;break t;case"function":i=!0;break t;default:i=!1}i?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},q.prototype.resolveToNonPromiseObj_=function(e){var i=void 0;try{i=e.then}catch(e){return void this.reject_(e)}"function"==typeof i?this.settleSameAsThenable_(i,e):this.fulfill_(e)},q.prototype.reject_=function(e){this.settle_(2,e)},q.prototype.fulfill_=function(e){this.settle_(1,e)},q.prototype.settle_=function(e,i){if(0!=this.state_)throw Error("Cannot settle("+e+", "+i+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=i,this.executeOnSettledCallbacks_()},q.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)n.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var n=new k;return q.prototype.settleSameAsPromise_=function(e){var i=this.createResolveAndReject_();e.callWhenSettled_(i.resolve,i.reject)},q.prototype.settleSameAsThenable_=function(e,i){var n=this.createResolveAndReject_();try{e.call(i,n.resolve,n.reject)}catch(e){n.reject(e)}},q.prototype.then=function(e,i){function k(e,i){return"function"==typeof e?function(i){try{n(e(i))}catch(e){o(e)}}:i}var n,o,s=new q((function(e,i){n=e,o=i}));return this.callWhenSettled_(k(e,n),k(i,o)),s},q.prototype.catch=function(e){return this.then(void 0,e)},q.prototype.callWhenSettled_=function(e,i){function k(){switch(o.state_){case 1:e(o.result_);break;case 2:i(o.result_);break;default:throw Error("Unexpected state: "+o.state_)}}var o=this;null==this.onSettledCallbacks_?n.asyncExecute(k):this.onSettledCallbacks_.push(k)},q.resolve=g,q.reject=function(e){return new q((function(i,n){n(e)}))},q.race=function(e){return new q((function(i,n){for(var o=$jscomp.makeIterator(e),s=o.next();!s.done;s=o.next())g(s.value).callWhenSettled_(i,n)}))},q.all=function(e){var i=$jscomp.makeIterator(e),n=i.next();return n.done?g([]):new q((function(e,o){function r(i){return function(n){s[i]=n,0==--h&&e(s)}}var s=[],h=0;do{s.push(void 0),h++,g(n.value).callWhenSettled_(r(s.length-1),o),n=i.next()}while(!n.done)}))},q}),"es6","es3"),function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((e=e||self).YUKA={})}(this,(function(e){function k(e){for(var i=[],n=0,o=e.length;n<o;n++)i.push(e[n].uuid);return i}function g(){!0===this.detectPageVisibility&&!1===document.hidden&&(this.currentTime=this.now())}function r(e,i,n){return 1/Math.sqrt(2*Math.PI*n)*Math.exp(-Math.pow(e-i,2)/(2*n))}function q(e,i){return e<i?-1:e>i?1:0}function t(e,i){return e.cost<i.cost?-1:e.cost>i.cost?1:0}function m(e,i){return e.cost<i.cost?-1:e.cost>i.cost?1:0}function xa(e,i){return e.p-i.p}function F(e,i){return e.cost<i.cost?1:e.cost>i.cost?-1:0}function sd(e,i){var n=e.edge,o=1/0;do{jr.set(n.prev.vertex,n.vertex);var s=jr.closestPointToPointParameter(i);jr.at(s,Rr),(s=Rr.squaredDistanceTo(i))<o&&(o=s,Pr.copy(Rr)),n=n.next}while(n!==e.edge);return Pr}function td(e){for(var i=this.tasks;0<e.timeRemaining()&&0<i.length;)i[0].execute(),i.shift();0<i.length?(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):(this._taskHandle=0,this._active=!1)}var Ra=function(e,i,n,o,s){this.sender=e,this.receiver=i,this.message=n,this.delay=o,this.data=s};Ra.prototype.toJSON=function(){return{type:this.constructor.name,sender:this.sender?this.sender.uuid:null,receiver:this.receiver?this.receiver.uuid:null,message:this.message,delay:this.delay,data:this.data}},Ra.prototype.fromJSON=function(e){return this.sender=e.sender,this.receiver=e.receiver,this.message=e.message,this.delay=e.delay,this.data=e.data,this},Ra.prototype.resolveReferences=function(e){return this.sender=e.get(this.sender),this.receiver=e.get(this.receiver),this};var y=function(){};y.setLevel=function(e){i=e},y.log=function(e){for(var n=[],o=0;o<arguments.length;++o)n[o-0]=arguments[o];i<=y.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(n))},y.warn=function(e){for(var n=[],o=0;o<arguments.length;++o)n[o-0]=arguments[o];i<=y.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(n))},y.error=function(e){for(var n=[],o=0;o<arguments.length;++o)n[o-0]=arguments[o];i<=y.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(n))};var i=(y.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3})).WARN,ta=function(){this.delayedTelegrams=[]};ta.prototype.deliver=function(e){var i=e.receiver;return!1===i.handleMessage(e)&&y.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",i),this},ta.prototype.dispatch=function(e,i,n,o,s){return e=new Ra(e,i,n,o,s),0>=o?this.deliver(e):this.delayedTelegrams.push(e),this},ta.prototype.dispatchDelayedMessages=function(e){for(var i=this.delayedTelegrams.length;i--;){var n=this.delayedTelegrams[i];n.delay-=e,0>=n.delay&&(this.deliver(n),this.delayedTelegrams.pop())}return this},ta.prototype.clear=function(){return this.delayedTelegrams.length=0,this},ta.prototype.toJSON=function(){for(var e={type:this.constructor.name,delayedTelegrams:[]},i=0,n=this.delayedTelegrams.length;i<n;i++)e.delayedTelegrams.push(this.delayedTelegrams[i].toJSON());return e},ta.prototype.fromJSON=function(e){this.clear();for(var i=0,n=(e=e.delayedTelegrams).length;i<n;i++){var o=e[i];o=(new Ra).fromJSON(o),this.delayedTelegrams.push(o)}return this},ta.prototype.resolveReferences=function(e){for(var i=this.delayedTelegrams,n=0,o=i.length;n<o;n++)i[n].resolveReferences(e);return this};for(var n=[],o=0;256>o;o++)n[o]=(16>o?"0":"")+o.toString(16);var M=function(){};M.clamp=function(e,i,n){return Math.max(i,Math.min(n,e))},M.randInt=function(e,i){return e+Math.floor(Math.random()*(i-e+1))},M.randFloat=function(e,i){return e+Math.random()*(i-e)},M.area=function(e,i,n){return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)},M.generateUUID=function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(n[255&e]+n[e>>8&255]+n[e>>16&255]+n[e>>24&255]+"-"+n[255&i]+n[i>>8&255]+"-"+n[i>>16&15|64]+n[i>>24&255]+"-"+n[63&o|128]+n[o>>8&255]+"-"+n[o>>16&255]+n[o>>24&255]+n[255&s]+n[s>>8&255]+n[s>>16&255]+n[s>>24&255]).toUpperCase()};var f=function(e,i,n){this.x=void 0===e?0:e,this.y=void 0===i?0:i,this.z=void 0===n?0:n};f.prototype.set=function(e,i,n){return this.x=e,this.y=i,this.z=n,this},f.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},f.prototype.clone=function(){return(new this.constructor).copy(this)},f.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},f.prototype.addScalar=function(e){return this.x+=e,this.y+=e,this.z+=e,this},f.prototype.addVectors=function(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this},f.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},f.prototype.subScalar=function(e){return this.x-=e,this.y-=e,this.z-=e,this},f.prototype.subVectors=function(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this},f.prototype.multiply=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},f.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},f.prototype.multiplyVectors=function(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this},f.prototype.divide=function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},f.prototype.divideScalar=function(e){return this.x/=e,this.y/=e,this.z/=e,this},f.prototype.divideVectors=function(e,i){return this.x=e.x/i.x,this.y=e.y/i.y,this.z=e.z/i.z,this},f.prototype.reflect=function(e){return this.sub(s.copy(e).multiplyScalar(2*this.dot(e)))},f.prototype.clamp=function(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this.z=Math.max(e.z,Math.min(i.z,this.z)),this},f.prototype.min=function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},f.prototype.max=function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},f.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},f.prototype.cross=function(e){var i=this.x,n=this.y,o=this.z;return this.x=n*e.z-o*e.y,this.y=o*e.x-i*e.z,this.z=i*e.y-n*e.x,this},f.prototype.crossVectors=function(e,i){var n=e.x,o=e.y;e=e.z;var s=i.x,h=i.y;return i=i.z,this.x=o*i-e*h,this.y=e*s-n*i,this.z=n*h-o*s,this},f.prototype.angleTo=function(e){var i=Math.sqrt(this.squaredLength()*e.squaredLength());return 0===i?0:(e=this.dot(e)/i,Math.acos(M.clamp(e,-1,1)))},f.prototype.length=function(){return Math.sqrt(this.squaredLength())},f.prototype.squaredLength=function(){return this.dot(this)},f.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},f.prototype.distanceTo=function(e){return Math.sqrt(this.squaredDistanceTo(e))},f.prototype.squaredDistanceTo=function(e){var i=this.x-e.x,n=this.y-e.y;return i*i+n*n+(e=this.z-e.z)*e},f.prototype.manhattanDistanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},f.prototype.normalize=function(){return this.divideScalar(this.length()||1)},f.prototype.applyMatrix4=function(e){var i=this.x,n=this.y,o=this.z,s=1/((e=e.elements)[3]*i+e[7]*n+e[11]*o+e[15]);return this.x=(e[0]*i+e[4]*n+e[8]*o+e[12])*s,this.y=(e[1]*i+e[5]*n+e[9]*o+e[13])*s,this.z=(e[2]*i+e[6]*n+e[10]*o+e[14])*s,this},f.prototype.applyRotation=function(e){var i=this.x,n=this.y,o=this.z,s=e.x,h=e.y,u=e.z,l=(e=e.w)*i+h*o-u*n,v=e*n+u*i-s*o,S=e*o+s*n-h*i;return i=-s*i-h*n-u*o,this.x=l*e+i*-s+v*-u-S*-h,this.y=v*e+i*-h+S*-s-l*-u,this.z=S*e+i*-u+l*-h-v*-s,this},f.prototype.extractPositionFromMatrix=function(e){return e=e.elements,this.x=e[12],this.y=e[13],this.z=e[14],this},f.prototype.transformDirection=function(e){var i=this.x,n=this.y,o=this.z;return e=e.elements,this.x=e[0]*i+e[4]*n+e[8]*o,this.y=e[1]*i+e[5]*n+e[9]*o,this.z=e[2]*i+e[6]*n+e[10]*o,this.normalize()},f.prototype.fromMatrix3Column=function(e,i){return this.fromArray(e.elements,3*i)},f.prototype.fromMatrix4Column=function(e,i){return this.fromArray(e.elements,4*i)},f.prototype.fromSpherical=function(e,i,n){var o=Math.sin(i)*e;return this.x=o*Math.sin(n),this.y=Math.cos(i)*e,this.z=o*Math.cos(n),this},f.prototype.fromArray=function(e,i){return i=void 0===i?0:i,this.x=e[i+0],this.y=e[i+1],this.z=e[i+2],this},f.prototype.toArray=function(e,i){return e[(i=void 0===i?0:i)+0]=this.x,e[i+1]=this.y,e[i+2]=this.z,e},f.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z};var s=new f,h=new f(0,1,0),u=new f,l=new f,v=new f,S=new f,_=[2,2,1],z=[1,0,0],C=function(){this.elements=[1,0,0,0,1,0,0,0,1]};C.prototype.set=function(e,i,n,o,s,h,u,l,v){var S=this.elements;return S[0]=e,S[3]=i,S[6]=n,S[1]=o,S[4]=s,S[7]=h,S[2]=u,S[5]=l,S[8]=v,this},C.prototype.copy=function(e){var i=this.elements;return e=e.elements,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this},C.prototype.clone=function(){return(new this.constructor).copy(this)},C.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},C.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},C.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},C.prototype.multiplyMatrices=function(e,i){var n=e.elements,o=i.elements;i=this.elements,e=n[0];var s=n[3],h=n[6],u=n[1],l=n[4],v=n[7],S=n[2],_=n[5];n=n[8];var z=o[0],O=o[3],A=o[6],j=o[1],J=o[4],$=o[7],I=o[2],L=o[5];return o=o[8],i[0]=e*z+s*j+h*I,i[3]=e*O+s*J+h*L,i[6]=e*A+s*$+h*o,i[1]=u*z+l*j+v*I,i[4]=u*O+l*J+v*L,i[7]=u*A+l*$+v*o,i[2]=S*z+_*j+n*I,i[5]=S*O+_*J+n*L,i[8]=S*A+_*$+n*o,this},C.prototype.multiplyScalar=function(e){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this},C.prototype.extractBasis=function(e,i,n){return e.fromMatrix3Column(this,0),i.fromMatrix3Column(this,1),n.fromMatrix3Column(this,2),this},C.prototype.makeBasis=function(e,i,n){return this.set(e.x,i.x,n.x,e.y,i.y,n.y,e.z,i.z,n.z),this},C.prototype.lookAt=function(e,i,n){return u.crossVectors(n,e).normalize(),l.crossVectors(h,i).normalize(),0===l.squaredLength()&&(S.copy(i).addScalar(Number.EPSILON),l.crossVectors(h,S).normalize()),v.crossVectors(i,l).normalize(),O.makeBasis(l,v,i),A.makeBasis(u,n,e),this.multiplyMatrices(O,A.transpose()),this},C.prototype.transpose=function(){var e=this.elements,i=e[1];return e[1]=e[3],e[3]=i,i=e[2],e[2]=e[6],e[6]=i,i=e[5],e[5]=e[7],e[7]=i,this},C.prototype.getElementIndex=function(e,i){return 3*e+i},C.prototype.frobeniusNorm=function(){for(var e=this.elements,i=0,n=0;9>n;n++)i+=e[n]*e[n];return Math.sqrt(i)},C.prototype.offDiagonalFrobeniusNorm=function(){for(var e=this.elements,i=0,n=0;3>n;n++){var o=e[this.getElementIndex(_[n],z[n])];i+=2*o*o}return Math.sqrt(i)},C.prototype.eigenDecomposition=function(e){var i=0,n=0;e.unitary.identity(),e.diagonal.copy(this);for(var o=e.unitary,s=e.diagonal,h=Number.EPSILON*s.frobeniusNorm();10>n&&s.offDiagonalFrobeniusNorm()>h;)s.shurDecomposition(O),A.copy(O).transpose(),s.multiply(O),s.premultiply(A),o.multiply(O),2<++i&&(n++,i=0);return e},C.prototype.shurDecomposition=function(e){for(var i=0,n=1,o=this.elements,s=0;3>s;s++){var h=Math.abs(o[this.getElementIndex(_[s],z[s])]);h>i&&(i=h,n=s)}return s=1,h=0,i=z[n],n=_[n],Math.abs(o[this.getElementIndex(n,i)])>Number.EPSILON&&(h=(o=0>(o=((s=o[this.getElementIndex(n,n)])-(h=o[this.getElementIndex(i,i)]))/2/(o=o[this.getElementIndex(n,i)]))?-1/(-o+Math.sqrt(1+o*o)):1/(o+Math.sqrt(1+o*o)))*(s=1/Math.sqrt(1+o*o))),e.identity(),e.elements[this.getElementIndex(i,i)]=s,e.elements[this.getElementIndex(n,n)]=s,e.elements[this.getElementIndex(n,i)]=h,e.elements[this.getElementIndex(i,n)]=-h,e},C.prototype.fromQuaternion=function(e){var i=this.elements,n=e.x,o=e.y,s=e.z,h=e.w,u=n+n,l=o+o,v=s+s;e=n*u;var S=n*l;n*=v;var _=o*l;return o*=v,s*=v,u*=h,l*=h,h*=v,i[0]=1-(_+s),i[3]=S-h,i[6]=n+l,i[1]=S+h,i[4]=1-(e+s),i[7]=o-u,i[2]=n-l,i[5]=o+u,i[8]=1-(e+_),this},C.prototype.fromMatrix4=function(e){var i=this.elements;return e=e.elements,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this},C.prototype.fromArray=function(e,i){i=void 0===i?0:i;for(var n=this.elements,o=0;9>o;o++)n[o]=e[o+i];return this},C.prototype.toArray=function(e,i){i=void 0===i?0:i;var n=this.elements;return e[i+0]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e},C.prototype.equals=function(e){var i=this.elements;e=e.elements;for(var n=0;9>n;n++)if(i[n]!==e[n])return!1;return!0};var O=new C,A=new C,j=new C,J=new f,w=function(e,i,n,o){this.x=void 0===e?0:e,this.y=void 0===i?0:i,this.z=void 0===n?0:n,this.w=void 0===o?1:o};w.prototype.set=function(e,i,n,o){return this.x=e,this.y=i,this.z=n,this.w=o,this},w.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},w.prototype.clone=function(){return(new this.constructor).copy(this)},w.prototype.inverse=function(){return this.conjugate().normalize()},w.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},w.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},w.prototype.length=function(){return Math.sqrt(this.squaredLength())},w.prototype.squaredLength=function(){return this.dot(this)},w.prototype.normalize=function(){var e=this.length();return 0===e?(this.z=this.y=this.x=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},w.prototype.multiply=function(e){return this.multiplyQuaternions(this,e)},w.prototype.premultiply=function(e){return this.multiplyQuaternions(e,this)},w.prototype.multiplyQuaternions=function(e,i){var n=e.x,o=e.y,s=e.z;e=e.w;var h=i.x,u=i.y,l=i.z;return i=i.w,this.x=n*i+e*h+o*l-s*u,this.y=o*i+e*u+s*h-n*l,this.z=s*i+e*l+n*u-o*h,this.w=e*i-n*h-o*u-s*l,this},w.prototype.angleTo=function(e){return 2*Math.acos(Math.abs(M.clamp(this.dot(e),-1,1)))},w.prototype.rotateTo=function(e,i,n){n=void 0===n?1e-4:n;var o=this.angleTo(e);return o<n||(this.slerp(e,Math.min(1,i/o)),!1)},w.prototype.lookAt=function(e,i,n){j.lookAt(e,i,n),this.fromMatrix3(j)},w.prototype.slerp=function(e,i){if(0===i)return this;if(1===i)return this.copy(e);var n=this.x,o=this.y,s=this.z,h=this.w,u=h*e.w+n*e.x+o*e.y+s*e.z;if(0>u?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,u=-u):this.copy(e),1<=u)return this.w=h,this.x=n,this.y=o,this.z=s,this;if(e=Math.sqrt(1-u*u),.001>Math.abs(e))return this.w=.5*(h+this.w),this.x=.5*(n+this.x),this.y=.5*(o+this.y),this.z=.5*(s+this.z),this;var l=Math.atan2(e,u);return u=Math.sin((1-i)*l)/e,i=Math.sin(i*l)/e,this.w=h*u+this.w*i,this.x=n*u+this.x*i,this.y=o*u+this.y*i,this.z=s*u+this.z*i,this},w.prototype.extractRotationFromMatrix=function(e){var i=j.elements,n=e.elements,o=1/J.fromMatrix4Column(e,0).length(),s=1/J.fromMatrix4Column(e,1).length();return e=1/J.fromMatrix4Column(e,2).length(),i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[4]*s,i[4]=n[5]*s,i[5]=n[6]*s,i[6]=n[8]*e,i[7]=n[9]*e,i[8]=n[10]*e,this.fromMatrix3(j),this},w.prototype.fromEuler=function(e,i,n){var o=Math.cos(i/2),s=Math.cos(e/2),h=Math.cos(n/2);return i=Math.sin(i/2),e=Math.sin(e/2),n=Math.sin(n/2),this.w=o*s*h+i*e*n,this.x=o*e*h+i*s*n,this.y=i*s*h-o*e*n,this.z=o*s*n-i*e*h,this},w.prototype.toEuler=function(e){var i=-2*(this.y*this.z-this.x*this.w);return.9999<Math.abs(i)?(e.x=.5*Math.PI*i,e.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),e.z=0):(e.x=Math.asin(i),e.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),e.z=Math.atan2(this.x*this.y+this.w*this.z,.5-this.x*this.x-this.z*this.z)),e},w.prototype.fromMatrix3=function(e){var i=e.elements,n=i[0];e=i[3];var o=i[6],s=i[1],h=i[4],u=i[7],l=i[2],v=i[5],S=n+h+(i=i[8]);return 0<S?(n=.5/Math.sqrt(S+1),this.w=.25/n,this.x=(v-u)*n,this.y=(o-l)*n,this.z=(s-e)*n):n>h&&n>i?(n=2*Math.sqrt(1+n-h-i),this.w=(v-u)/n,this.x=.25*n,this.y=(e+s)/n,this.z=(o+l)/n):h>i?(n=2*Math.sqrt(1+h-n-i),this.w=(o-l)/n,this.x=(e+s)/n,this.y=.25*n,this.z=(u+v)/n):(n=2*Math.sqrt(1+i-n-h),this.w=(s-e)/n,this.x=(o+l)/n,this.y=(u+v)/n,this.z=.25*n),this},w.prototype.fromArray=function(e,i){return i=void 0===i?0:i,this.x=e[i+0],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this},w.prototype.toArray=function(e,i){return e[(i=void 0===i?0:i)+0]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e},w.prototype.equals=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w};var D=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};D.prototype.set=function(e,i,n,o,s,h,u,l,v,S,_,z,O,A,j,J){var $=this.elements;return $[0]=e,$[4]=i,$[8]=n,$[12]=o,$[1]=s,$[5]=h,$[9]=u,$[13]=l,$[2]=v,$[6]=S,$[10]=_,$[14]=z,$[3]=O,$[7]=A,$[11]=j,$[15]=J,this},D.prototype.copy=function(e){var i=this.elements;return e=e.elements,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this},D.prototype.clone=function(){return(new this.constructor).copy(this)},D.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},D.prototype.multiply=function(e){return this.multiplyMatrices(this,e)},D.prototype.premultiply=function(e){return this.multiplyMatrices(e,this)},D.prototype.multiplyMatrices=function(e,i){var n=e.elements,o=i.elements;i=this.elements,e=n[0];var s=n[4],h=n[8],u=n[12],l=n[1],v=n[5],S=n[9],_=n[13],z=n[2],O=n[6],A=n[10],j=n[14],J=n[3],$=n[7],I=n[11];n=n[15];var L=o[0],U=o[4],Y=o[8],H=o[12],Q=o[1],tt=o[5],et=o[9],rt=o[13],it=o[2],nt=o[6],ot=o[10],st=o[14],at=o[3],ht=o[7],ut=o[11];return o=o[15],i[0]=e*L+s*Q+h*it+u*at,i[4]=e*U+s*tt+h*nt+u*ht,i[8]=e*Y+s*et+h*ot+u*ut,i[12]=e*H+s*rt+h*st+u*o,i[1]=l*L+v*Q+S*it+_*at,i[5]=l*U+v*tt+S*nt+_*ht,i[9]=l*Y+v*et+S*ot+_*ut,i[13]=l*H+v*rt+S*st+_*o,i[2]=z*L+O*Q+A*it+j*at,i[6]=z*U+O*tt+A*nt+j*ht,i[10]=z*Y+O*et+A*ot+j*ut,i[14]=z*H+O*rt+A*st+j*o,i[3]=J*L+$*Q+I*it+n*at,i[7]=J*U+$*tt+I*nt+n*ht,i[11]=J*Y+$*et+I*ot+n*ut,i[15]=J*H+$*rt+I*st+n*o,this},D.prototype.multiplyScalar=function(e){var i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this},D.prototype.extractBasis=function(e,i,n){return e.fromMatrix4Column(this,0),i.fromMatrix4Column(this,1),n.fromMatrix4Column(this,2),this},D.prototype.makeBasis=function(e,i,n){return this.set(e.x,i.x,n.x,0,e.y,i.y,n.y,0,e.z,i.z,n.z,0,0,0,0,1),this},D.prototype.compose=function(e,i,n){return this.fromQuaternion(i),this.scale(n),this.setPosition(e),this},D.prototype.scale=function(e){var i=this.elements,n=e.x,o=e.y;return e=e.z,i[0]*=n,i[4]*=o,i[8]*=e,i[1]*=n,i[5]*=o,i[9]*=e,i[2]*=n,i[6]*=o,i[10]*=e,i[3]*=n,i[7]*=o,i[11]*=e,this},D.prototype.setPosition=function(e){var i=this.elements;return i[12]=e.x,i[13]=e.y,i[14]=e.z,this},D.prototype.transpose=function(){var e=this.elements,i=e[1];return e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this},D.prototype.getInverse=function(e){var i=this.elements,n=e.elements,o=i[0],s=i[1],h=i[2],u=i[3],l=i[4],v=i[5],S=i[6],_=i[7],z=i[8],O=i[9],A=i[10],j=i[11],J=i[12],$=i[13],I=i[14],L=O*I*_-$*A*_+$*S*j-v*I*j-O*S*(i=i[15])+v*A*i,U=J*A*_-z*I*_-J*S*j+l*I*j+z*S*i-l*A*i,Y=z*$*_-J*O*_+J*v*j-l*$*j-z*v*i+l*O*i,H=J*O*S-z*$*S-J*v*A+l*$*A+z*v*I-l*O*I,Q=o*L+s*U+h*Y+u*H;return 0===Q?(y.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),this.identity()):(Q=1/Q,n[0]=L*Q,n[1]=($*A*u-O*I*u-$*h*j+s*I*j+O*h*i-s*A*i)*Q,n[2]=(v*I*u-$*S*u+$*h*_-s*I*_-v*h*i+s*S*i)*Q,n[3]=(O*S*u-v*A*u-O*h*_+s*A*_+v*h*j-s*S*j)*Q,n[4]=U*Q,n[5]=(z*I*u-J*A*u+J*h*j-o*I*j-z*h*i+o*A*i)*Q,n[6]=(J*S*u-l*I*u-J*h*_+o*I*_+l*h*i-o*S*i)*Q,n[7]=(l*A*u-z*S*u+z*h*_-o*A*_-l*h*j+o*S*j)*Q,n[8]=Y*Q,n[9]=(J*O*u-z*$*u-J*s*j+o*$*j+z*s*i-o*O*i)*Q,n[10]=(l*$*u-J*v*u+J*s*_-o*$*_-l*s*i+o*v*i)*Q,n[11]=(z*v*u-l*O*u-z*s*_+o*O*_+l*s*j-o*v*j)*Q,n[12]=H*Q,n[13]=(z*$*h-J*O*h+J*s*A-o*$*A-z*s*I+o*O*I)*Q,n[14]=(J*v*h-l*$*h-J*s*S+o*$*S+l*s*I-o*v*I)*Q,n[15]=(l*O*h-z*v*h+z*s*S-o*O*S-l*s*A+o*v*A)*Q,e)},D.prototype.getMaxScale=function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},D.prototype.fromQuaternion=function(e){var i=this.elements,n=e.x,o=e.y,s=e.z,h=e.w,u=n+n,l=o+o,v=s+s;e=n*u;var S=n*l;n*=v;var _=o*l;return o*=v,s*=v,u*=h,l*=h,h*=v,i[0]=1-(_+s),i[4]=S-h,i[8]=n+l,i[1]=S+h,i[5]=1-(e+s),i[9]=o-u,i[2]=n-l,i[6]=o+u,i[10]=1-(e+_),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},D.prototype.fromMatrix3=function(e){var i=this.elements;return e=e.elements,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=0,i[4]=e[3],i[5]=e[4],i[6]=e[5],i[7]=0,i[8]=e[6],i[9]=e[7],i[10]=e[8],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},D.prototype.fromArray=function(e,i){i=void 0===i?0:i;for(var n=this.elements,o=0;16>o;o++)n[o]=e[o+i];return this},D.prototype.toArray=function(e,i){i=void 0===i?0:i;var n=this.elements;return e[i+0]=n[0],e[i+1]=n[1],e[i+2]=n[2],e[i+3]=n[3],e[i+4]=n[4],e[i+5]=n[5],e[i+6]=n[6],e[i+7]=n[7],e[i+8]=n[8],e[i+9]=n[9],e[i+10]=n[10],e[i+11]=n[11],e[i+12]=n[12],e[i+13]=n[13],e[i+14]=n[14],e[i+15]=n[15],e},D.prototype.equals=function(e){var i=this.elements;e=e.elements;for(var n=0;16>n;n++)if(i[n]!==e[n])return!1;return!0};var $=new w,I=new f,L=new w,G=function(){this.name="",this.active=!0,this.children=[],this.parent=null,this.neighbors=[],this.neighborhoodRadius=1,this.updateNeighborhood=!1,this.position=new f,this.rotation=new w,this.scale=new f(1,1,1),this.forward=new f(0,0,1),this.up=new f(0,1,0),this.boundingRadius=0,this.maxTurnRate=Math.PI,this.canAcitivateTrigger=!0,this.worldMatrix=new D,this.manager=null,this._localMatrix=new D,this._cache={position:new f,rotation:new w,scale:new f(1,1,1)},this._renderComponentCallback=this._renderComponent=null,this._started=!1,this._uuid=null};G.prototype.start=function(){},G.prototype.update=function(){},G.prototype.add=function(e){return null!==e.parent&&e.parent.remove(e),this.children.push(e),e.parent=this,this},G.prototype.remove=function(e){var i=this.children.indexOf(e);return this.children.splice(i,1),e.parent=null,this},G.prototype.getDirection=function(e){return e.copy(this.forward).applyRotation(this.rotation).normalize()},G.prototype.lookAt=function(e){return I.subVectors(e,this.position).normalize(),this.rotation.lookAt(this.forward,I,this.up),this},G.prototype.rotateTo=function(e,i,n){return n=void 0===n?1e-4:n,I.subVectors(e,this.position).normalize(),$.lookAt(this.forward,I,this.up),this.rotation.rotateTo($,this.maxTurnRate*i,n)},G.prototype.getWorldDirection=function(e){return L.extractRotationFromMatrix(this.worldMatrix),e.copy(this.forward).applyRotation(L).normalize()},G.prototype.getWorldPosition=function(e){return e.extractPositionFromMatrix(this.worldMatrix)},G.prototype.updateWorldMatrix=function(e,i){i=void 0!==i&&i;var n=this.parent,o=this.children;if(!0===(void 0!==e&&e)&&null!==n&&n.updateWorldMatrix(!0),this._updateMatrix(),null===n?this.worldMatrix.copy(this._localMatrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this._localMatrix),!0===i)for(e=0,i=o.length;e<i;e++)o[e].updateWorldMatrix(!1,!0);return this},G.prototype.setRenderComponent=function(e,i){return this._renderComponent=e,this._renderComponentCallback=i,this},G.prototype.handleMessage=function(){return!1},G.prototype.lineOfSightTest=function(){return null},G.prototype.sendMessage=function(e,i,n,o){return null!==this.manager?this.manager.sendMessage(this,e,i,void 0===n?0:n,void 0===o?null:o):y.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message."),this},G.prototype.toJSON=function(){return{type:this.constructor.name,uuid:this.uuid,name:this.name,active:this.active,children:k(this.children),parent:null!==this.parent?this.parent.uuid:null,neighbors:k(this.neighbors),neighborhoodRadius:this.neighborhoodRadius,updateNeighborhood:this.updateNeighborhood,position:this.position.toArray([]),rotation:this.rotation.toArray([]),scale:this.scale.toArray([]),forward:this.forward.toArray([]),up:this.up.toArray([]),boundingRadius:this.boundingRadius,maxTurnRate:this.maxTurnRate,worldMatrix:this.worldMatrix.toArray([]),_localMatrix:this._localMatrix.toArray([]),_cache:{position:this._cache.position.toArray([]),rotation:this._cache.rotation.toArray([]),scale:this._cache.scale.toArray([])},_started:this._started}},G.prototype.fromJSON=function(e){return this.uuid=e.uuid,this.name=e.name,this.active=e.active,this.neighborhoodRadius=e.neighborhoodRadius,this.updateNeighborhood=e.updateNeighborhood,this.position.fromArray(e.position),this.rotation.fromArray(e.rotation),this.scale.fromArray(e.scale),this.forward.fromArray(e.forward),this.up.fromArray(e.up),this.boundingRadius=e.boundingRadius,this.maxTurnRate=e.maxTurnRate,this.worldMatrix.fromArray(e.worldMatrix),this.children=e.children.slice(),this.neighbors=e.neighbors.slice(),this.parent=e.parent,this._localMatrix.fromArray(e._localMatrix),this._cache.position.fromArray(e._cache.position),this._cache.rotation.fromArray(e._cache.rotation),this._cache.scale.fromArray(e._cache.scale),this._started=e._started,this},G.prototype.resolveReferences=function(e){for(var i=this.neighbors,n=0,o=i.length;n<o;n++)i[n]=e.get(i[n]);for(n=0,o=(i=this.children).length;n<o;n++)i[n]=e.get(i[n]);return this.parent=e.get(this.parent)||null,this},G.prototype._updateMatrix=function(){var e=this._cache;return e.position.equals(this.position)&&e.rotation.equals(this.rotation)&&e.scale.equals(this.scale)||(this._localMatrix.compose(this.position,this.rotation,this.scale),e.position.copy(this.position),e.rotation.copy(this.rotation),e.scale.copy(this.scale)),this},$jscomp.global.Object.defineProperties(G.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){return null===this._uuid&&(this._uuid=M.generateUUID()),this._uuid},set:function(e){this._uuid=e}}});var U=new f,Y=new f,ia=function(){var e=G.call(this)||this;return e.velocity=new f,e.maxSpeed=1,e.updateOrientation=!0,e};$jscomp.inherits(ia,G),ia.prototype.update=function(e){return this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed)),U.copy(this.velocity).multiplyScalar(e),Y.copy(this.position).add(U),this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(Y),this.position.copy(Y),this},ia.prototype.getSpeed=function(){return this.velocity.length()},ia.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()},ia.prototype.toJSON=function(){var e=G.prototype.toJSON.call(this);return e.velocity=this.velocity.toArray([]),e.maxSpeed=this.maxSpeed,e.updateOrientation=this.updateOrientation,e},ia.prototype.fromJSON=function(e){return G.prototype.fromJSON.call(this,e),this.velocity.fromArray(e.velocity),this.maxSpeed=e.maxSpeed,this.updateOrientation=e.updateOrientation,this};var p=function(){this.active=!0,this.weight=1};p.prototype.onAdded=function(e){},p.prototype.onRemoved=function(e){},p.prototype.calculate=function(){},p.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,weight:this.weight}},p.prototype.fromJSON=function(e){return this.active=e.active,this.weight=e.weight,this},p.prototype.resolveReferences=function(){};var H=new f,Q=new f,cc=function(){return p.call(this)||this};$jscomp.inherits(cc,p),cc.prototype.calculate=function(e,i){H.set(0,0,0);for(var n=e.neighbors,o=0,s=n.length;o<s;o++)n[o].getDirection(Q),H.add(Q);return 0<n.length&&(H.divideScalar(n.length),e.getDirection(Q),i.subVectors(H,Q)),i};var tt=new f,et=new f,Da=function(e,i,n){e=void 0===e?new f:e,i=void 0===i?3:i,n=void 0===n?0:n;var o=p.call(this)||this;return o.target=e,o.deceleration=i,o.tolerance=n,o};$jscomp.inherits(Da,p),Da.prototype.calculate=function(e,i){var n=this.deceleration;et.subVectors(this.target,e.position);var o=et.length();return o>this.tolerance?(n=Math.min(o/n,e.maxSpeed),tt.copy(et).multiplyScalar(n/o)):tt.set(0,0,0),i.subVectors(tt,e.velocity)},Da.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.target=this.target.toArray([]),e.deceleration=this.deceleration,e},Da.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.target.fromArray(e.target),this.deceleration=e.deceleration,this};var rt=new f,ya=function(e){e=void 0===e?new f:e;var i=p.call(this)||this;return i.target=e,i};$jscomp.inherits(ya,p),ya.prototype.calculate=function(e,i){return rt.subVectors(this.target,e.position).normalize(),rt.multiplyScalar(e.maxSpeed),i.subVectors(rt,e.velocity)},ya.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.target=this.target.toArray([]),e},ya.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.target.fromArray(e.target),this};var it=new f,ec=function(){var e=p.call(this)||this;return e._seek=new ya,e};$jscomp.inherits(ec,p),ec.prototype.calculate=function(e,i){it.set(0,0,0);for(var n=e.neighbors,o=0,s=n.length;o<s;o++)it.add(n[o].position);return 0<n.length&&(it.divideScalar(n.length),this._seek.target=it,this._seek.calculate(e,i),i.normalize()),i};var nt=new f,Sa=function(e,i){e=void 0===e?new f:e,i=void 0===i?10:i;var n=p.call(this)||this;return n.target=e,n.panicDistance=i,n};$jscomp.inherits(Sa,p),Sa.prototype.calculate=function(e,i){var n=this.target;return e.position.squaredDistanceTo(n)<=this.panicDistance*this.panicDistance&&(nt.subVectors(e.position,n).normalize(),0===nt.squaredLength()&&nt.set(0,0,1),nt.multiplyScalar(e.maxSpeed),i.subVectors(nt,e.velocity)),i},Sa.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.target=this.target.toArray([]),e.panicDistance=this.panicDistance,e},Sa.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.target.fromArray(e.target),this.panicDistance=e.panicDistance,this};var ot=new f,st=new f,at=new f,Ta=function(e,i,n){e=void 0===e?null:e,i=void 0===i?10:i,n=void 0===n?1:n;var o=p.call(this)||this;return o.pursuer=e,o.panicDistance=i,o.predictionFactor=n,o._flee=new Sa,o};$jscomp.inherits(Ta,p),Ta.prototype.calculate=function(e,i){var n=this.pursuer;ot.subVectors(n.position,e.position);var o=ot.length()/(e.maxSpeed+n.getSpeed());return o*=this.predictionFactor,st.copy(n.velocity).multiplyScalar(o),at.addVectors(n.position,st),this._flee.target=at,this._flee.panicDistance=this.panicDistance,this._flee.calculate(e,i),i},Ta.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.pursuer=this.pursuer?this.pursuer.uuid:null,e.panicDistance=this.panicDistance,e.predictionFactor=this.predictionFactor,e},Ta.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.pursuer=e.pursuer,this.panicDistance=e.panicDistance,this.predictionFactor=e.predictionFactor,this},Ta.prototype.resolveReferences=function(e){this.pursuer=e.get(this.pursuer)||null};var za=function(){this.loop=!1,this._waypoints=[],this._index=0};za.prototype.add=function(e){return this._waypoints.push(e),this},za.prototype.clear=function(){return this._index=this._waypoints.length=0,this},za.prototype.current=function(){return this._waypoints[this._index]},za.prototype.finished=function(){var e=this._waypoints.length-1;return!0!==this.loop&&this._index===e},za.prototype.advance=function(){return this._index++,this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--),this},za.prototype.toJSON=function(){for(var e={type:this.constructor.name,loop:this.loop,_waypoints:[],_index:this._index},i=this._waypoints,n=0,o=i.length;n<o;n++)e._waypoints.push(i[n].toArray([]));return e},za.prototype.fromJSON=function(e){this.loop=e.loop,this._index=e._index;for(var i=0,n=(e=e._waypoints).length;i<n;i++){var o=e[i];this._waypoints.push((new f).fromArray(o))}return this};var hb=function(e,i){e=void 0===e?new za:e,i=void 0===i?1:i;var n=p.call(this)||this;return n.path=e,n.nextWaypointDistance=i,n._arrive=new Da,n._seek=new ya,n};$jscomp.inherits(hb,p),hb.prototype.calculate=function(e,i){var n=this.path;n.current().squaredDistanceTo(e.position)<this.nextWaypointDistance*this.nextWaypointDistance&&n.advance();var o=n.current();return!0===n.finished()?(this._arrive.target=o,this._arrive.calculate(e,i)):(this._seek.target=o,this._seek.calculate(e,i)),i},hb.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.path=this.path.toJSON(),e.nextWaypointDistance=this.nextWaypointDistance,e},hb.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.path.fromJSON(e.path),this.nextWaypointDistance=e.nextWaypointDistance,this};var ht=new f,ut=new f,pt=new f,lt=new f,Ua=function(e,i,n){e=void 0===e?null:e,i=void 0===i?null:i,n=void 0===n?3:n;var o=p.call(this)||this;return o.entity1=e,o.entity2=i,o.deceleration=n,o._arrive=new Da,o};$jscomp.inherits(Ua,p),Ua.prototype.calculate=function(e,i){var n=this.entity1,o=this.entity2;ht.addVectors(n.position,o.position).multiplyScalar(.5);var s=e.position.distanceTo(ht)/e.maxSpeed;return ut.copy(n.velocity).multiplyScalar(s),pt.addVectors(n.position,ut),ut.copy(o.velocity).multiplyScalar(s),lt.addVectors(o.position,ut),ht.addVectors(pt,lt).multiplyScalar(.5),this._arrive.deceleration=this.deceleration,this._arrive.target=ht,this._arrive.calculate(e,i),i},Ua.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.entity1=this.entity1?this.entity1.uuid:null,e.entity2=this.entity2?this.entity2.uuid:null,e.deceleration=this.deceleration,e},Ua.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.entity1=e.entity1,this.entity2=e.entity2,this.deceleration=e.deceleration,this},Ua.prototype.resolveReferences=function(e){this.entity1=e.get(this.entity1)||null,this.entity2=e.get(this.entity2)||null};var ct=new f,dt=new f,ft=new f,yt=[new f,new f,new f,new f,new f,new f,new f,new f],E=function(e,i){e=void 0===e?new f:e,i=void 0===i?new f:i,this.min=e,this.max=i};E.prototype.set=function(e,i){return this.min=e,this.max=i,this},E.prototype.copy=function(e){return this.min.copy(e.min),this.max.copy(e.max),this},E.prototype.clone=function(){return(new this.constructor).copy(this)},E.prototype.clampPoint=function(e,i){return i.copy(e).clamp(this.min,this.max),i},E.prototype.containsPoint=function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},E.prototype.expand=function(e){return this.min.min(e),this.max.max(e),this},E.prototype.getCenter=function(e){return e.addVectors(this.min,this.max).multiplyScalar(.5)},E.prototype.getSize=function(e){return e.subVectors(this.max,this.min)},E.prototype.intersectsAABB=function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},E.prototype.intersectsBoundingSphere=function(e){return this.clampPoint(e.center,ct),ct.squaredDistanceTo(e.center)<=e.radius*e.radius},E.prototype.intersectsPlane=function(e){var i=e.normal;return this.getCenter(dt),ft.subVectors(this.max,dt),i=ft.x*Math.abs(i.x)+ft.y*Math.abs(i.y)+ft.z*Math.abs(i.z),e=e.distanceToPoint(dt),Math.abs(e)<=i},E.prototype.getNormalFromSurfacePoint=function(e,i){i.set(0,0,0);var n=1/0;return this.getCenter(dt),this.getSize(ft),ct.copy(e).sub(dt),(e=Math.abs(ft.x-Math.abs(ct.x)))<n&&(n=e,i.set(1*Math.sign(ct.x),0,0)),(e=Math.abs(ft.y-Math.abs(ct.y)))<n&&(n=e,i.set(0,1*Math.sign(ct.y),0)),(e=Math.abs(ft.z-Math.abs(ct.z)))<n&&i.set(0,0,1*Math.sign(ct.z)),i},E.prototype.fromCenterAndSize=function(e,i){return ct.copy(i).multiplyScalar(.5),this.min.copy(e).sub(ct),this.max.copy(e).add(ct),this},E.prototype.fromPoints=function(e){this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0);for(var i=0,n=e.length;i<n;i++)this.expand(e[i]);return this},E.prototype.applyMatrix4=function(e){var i=this.min,n=this.max;return yt[0].set(i.x,i.y,i.z).applyMatrix4(e),yt[1].set(i.x,i.y,n.z).applyMatrix4(e),yt[2].set(i.x,n.y,i.z).applyMatrix4(e),yt[3].set(i.x,n.y,n.z).applyMatrix4(e),yt[4].set(n.x,i.y,i.z).applyMatrix4(e),yt[5].set(n.x,i.y,n.z).applyMatrix4(e),yt[6].set(n.x,n.y,i.z).applyMatrix4(e),yt[7].set(n.x,n.y,n.z).applyMatrix4(e),this.fromPoints(yt)},E.prototype.equals=function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},E.prototype.toJSON=function(){return{type:this.constructor.name,min:this.min.toArray([]),max:this.max.toArray([])}},E.prototype.fromJSON=function(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this};var gt=new E,R=function(e,i){this.center=e=void 0===e?new f:e,this.radius=void 0===i?0:i};R.prototype.set=function(e,i){return this.center=e,this.radius=i,this},R.prototype.copy=function(e){return this.center.copy(e.center),this.radius=e.radius,this},R.prototype.clone=function(){return(new this.constructor).copy(this)},R.prototype.clampPoint=function(e,i){return i.copy(e),this.center.squaredDistanceTo(e)>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},R.prototype.containsPoint=function(e){return e.squaredDistanceTo(this.center)<=this.radius*this.radius},R.prototype.intersectsBoundingSphere=function(e){var i=this.radius+e.radius;return e.center.squaredDistanceTo(this.center)<=i*i},R.prototype.intersectsPlane=function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},R.prototype.getNormalFromSurfacePoint=function(e,i){return i.subVectors(e,this.center).normalize()},R.prototype.fromPoints=function(e){return gt.fromPoints(e),gt.getCenter(this.center),this.radius=this.center.distanceTo(gt.max),this},R.prototype.applyMatrix4=function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScale(),this},R.prototype.equals=function(e){return e.center.equals(this.center)&&e.radius===this.radius},R.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),radius:this.radius}},R.prototype.fromJSON=function(e){return this.center.fromArray(e.center),this.radius=e.radius,this};var vt=new f,mt=new f,xt=new f,wt=new f,St=new f,bt=new D,_t=new D,zt=new E,K=function(e,i){e=void 0===e?new f:e,i=void 0===i?new f:i,this.origin=e,this.direction=i};K.prototype.set=function(e,i){return this.origin=e,this.direction=i,this},K.prototype.copy=function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},K.prototype.clone=function(){return(new this.constructor).copy(this)},K.prototype.at=function(e,i){return i.copy(this.direction).multiplyScalar(e).add(this.origin)},K.prototype.intersectBoundingSphere=function(e,i){vt.subVectors(e.center,this.origin);var n=vt.dot(this.direction),o=vt.dot(vt)-n*n;return o>(e=e.radius*e.radius)?null:(o=n-(e=Math.sqrt(e-o)),n+=e,0>o&&0>n?null:0>o?this.at(n,i):this.at(o,i))},K.prototype.intersectsBoundingSphere=function(e){var i=new f,n=i.subVectors(e.center,this.origin).dot(this.direction);return 0>n?i=this.origin.squaredDistanceTo(e.center):(i.copy(this.direction).multiplyScalar(n).add(this.origin),i=i.squaredDistanceTo(e.center)),i<=e.radius*e.radius},K.prototype.intersectAABB=function(e,i){var n=1/this.direction.x,o=1/this.direction.y,s=1/this.direction.z,h=this.origin;if(0<=n){var u=(e.min.x-h.x)*n;n*=e.max.x-h.x}else u=(e.max.x-h.x)*n,n*=e.min.x-h.x;if(0<=o){var l=(e.min.y-h.y)*o;o*=e.max.y-h.y}else l=(e.max.y-h.y)*o,o*=e.min.y-h.y;return u>o||l>n?null:((l>u||u!=u)&&(u=l),(o<n||n!=n)&&(n=o),0<=s?(l=(e.min.z-h.z)*s,e=(e.max.z-h.z)*s):(l=(e.max.z-h.z)*s,e=(e.min.z-h.z)*s),u>e||l>n?null:((l>u||u!=u)&&(u=l),(e<n||n!=n)&&(n=e),0>n?null:this.at(0<=u?u:n,i)))},K.prototype.intersectsAABB=function(e){return null!==this.intersectAABB(e,vt)},K.prototype.intersectPlane=function(e,i){var n=e.normal.dot(this.direction);if(0===n){if(0!==e.distanceToPoint(this.origin))return null;e=0}else e=-(this.origin.dot(e.normal)+e.constant)/n;return 0<=e?this.at(e,i):null},K.prototype.intersectsPlane=function(e){var i=e.distanceToPoint(this.origin);return 0===i||0>e.normal.dot(this.direction)*i},K.prototype.intersectOBB=function(e,i){return e.getSize(St),zt.fromCenterAndSize(vt.set(0,0,0),St),bt.fromMatrix3(e.rotation),bt.setPosition(e.center),Mt.copy(this).applyMatrix4(bt.getInverse(_t)),Mt.intersectAABB(zt,i)?i.applyMatrix4(bt):null},K.prototype.intersectsOBB=function(e){return null!==this.intersectOBB(e,vt)},K.prototype.intersectConvexHull=function(e,i){for(var n=-1/0,o=1/0,s=0,h=(e=e.faces).length;s<h;s++){var u=e[s].plane,l=u.distanceToPoint(this.origin);if(u=u.normal.dot(this.direction),0<l&&0<=u)return null;if(!(0>=(l=0!==u?-l/u:0))&&(0<u?o=Math.min(l,o):n=Math.max(l,n),n>o))return null}return-1/0!==n?this.at(n,i):this.at(o,i),i},K.prototype.intersectsConvexHull=function(e){return null!==this.intersectConvexHull(e,vt)},K.prototype.intersectTriangle=function(e,i,n){var o=e.a,s=e.c;if(mt.subVectors(e.b,o),xt.subVectors(s,o),wt.crossVectors(mt,xt),0<(e=this.direction.dot(wt))){if(i)return null;i=1}else{if(!(0>e))return null;i=-1,e=-e}return vt.subVectors(this.origin,o),0>(o=i*this.direction.dot(xt.crossVectors(vt,xt)))||0>(s=i*this.direction.dot(mt.cross(vt)))||o+s>e||0>(o=-i*vt.dot(wt))?null:this.at(o/e,n)},K.prototype.intersectBVH=function(e,i){return e.root.intersectRay(this,i)},K.prototype.intersectsBVH=function(e){return e.root.intersectsRay(this)},K.prototype.applyMatrix4=function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},K.prototype.equals=function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)};var Mt=new K,Ot=new D,Nt=new f,Et=new f,Ft=new f,Tt=new R,At=new K(new f(0,0,0),new f(0,0,1)),Va=function(e){e=void 0===e?[]:e;var i=p.call(this)||this;return i.obstacles=e,i.brakingWeight=.2,i.dBoxMinLength=4,i};$jscomp.inherits(Va,p),Va.prototype.calculate=function(e,i){var n=this.obstacles,o=null,s=1/0,h=this.dBoxMinLength+e.getSpeed()/e.maxSpeed*this.dBoxMinLength;e.worldMatrix.getInverse(Ot);for(var u=0,l=n.length;u<l;u++){var v=n[u];if(v!==e&&(Nt.copy(v.position).applyMatrix4(Ot),0<Nt.z&&Math.abs(Nt.z)<h)){var S=v.boundingRadius+e.boundingRadius;Math.abs(Nt.x)<S&&(Tt.center.copy(Nt),Tt.radius=S,At.intersectBoundingSphere(Tt,Ft),Ft.z<s&&(s=Ft.z,o=v,Et.copy(Nt)))}}return null!==o&&(i.x=(o.boundingRadius-Et.x)*(1+(h-Et.z)/h),i.z=(o.boundingRadius-Et.z)*this.brakingWeight,i.applyRotation(e.rotation)),i},Va.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);e.obstacles=[],e.brakingWeight=this.brakingWeight,e.dBoxMinLength=this.dBoxMinLength;for(var i=0,n=this.obstacles.length;i<n;i++)e.obstacles.push(this.obstacles[i].uuid);return e},Va.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.obstacles=e.obstacles,this.brakingWeight=e.brakingWeight,this.dBoxMinLength=e.dBoxMinLength,this},Va.prototype.resolveReferences=function(e){for(var i=this.obstacles,n=0,o=i.length;n<o;n++)i[n]=e.get(i[n])};var Pt=new f,Rt=new f,jt=new f,Dt=new f,Wa=function(e,i){e=void 0===e?null:e,i=void 0===i?new f:i;var n=p.call(this)||this;return n.leader=e,n.offset=i,n._arrive=new Da,n._arrive.deceleration=1.5,n};$jscomp.inherits(Wa,p),Wa.prototype.calculate=function(e,i){var n=this.leader;Pt.copy(this.offset).applyMatrix4(n.worldMatrix),Rt.subVectors(Pt,e.position);var o=Rt.length()/(e.maxSpeed+n.getSpeed());return jt.copy(n.velocity).multiplyScalar(o),Dt.addVectors(Pt,jt),this._arrive.target=Dt,this._arrive.calculate(e,i),i},Wa.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.leader=this.leader?this.leader.uuid:null,e.offset=this.offset,e},Wa.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.leader=e.leader,this.offset=e.offset,this},Wa.prototype.resolveReferences=function(e){this.leader=e.get(this.leader)||null};var kt=new f,Jt=new f,Ct=new f,$t=new f,It=new f,Xa=function(e,i){e=void 0===e?null:e,i=void 0===i?1:i;var n=p.call(this)||this;return n.evader=e,n.predictionFactor=i,n._seek=new ya,n};$jscomp.inherits(Xa,p),Xa.prototype.calculate=function(e,i){var n=this.evader;kt.subVectors(n.position,e.position),e.getDirection(Jt),n.getDirection(Ct);var o=0<kt.dot(Jt),s=-.95>Jt.dot(Ct);return!0===o&&!0===s?(this._seek.target=n.position,this._seek.calculate(e,i),i):(o=kt.length()/(e.maxSpeed+n.getSpeed()),o*=this.predictionFactor,$t.copy(n.velocity).multiplyScalar(o),It.addVectors(n.position,$t),this._seek.target=It,this._seek.calculate(e,i),i)},Xa.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.evader=this.evader?this.evader.uuid:null,e.predictionFactor=this.predictionFactor,e},Xa.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.evader=e.evader,this.predictionFactor=e.predictionFactor,this},Xa.prototype.resolveReferences=function(e){this.evader=e.get(this.evader)||null};var Vt=new f,lc=function(){return p.call(this)||this};$jscomp.inherits(lc,p),lc.prototype.calculate=function(e,i){for(var n=e.neighbors,o=0,s=n.length;o<s;o++){Vt.subVectors(e.position,n[o].position);var h=Vt.length();0===h&&(h=1e-4),Vt.normalize().divideScalar(h),i.add(Vt)}return i};var Bt=new f,qt=new f,jb=function(e,i,n){e=void 0===e?1:e,i=void 0===i?5:i,n=void 0===n?5:n;var o=p.call(this)||this;return o.radius=e,o.distance=i,o.jitter=n,o._targetLocal=new f,e=o.radius,i=o._targetLocal,n=Math.random()*Math.PI*2,i.x=e*Math.cos(n),i.z=e*Math.sin(n),o};$jscomp.inherits(jb,p),jb.prototype.calculate=function(e,i,n){return n*=this.jitter,qt.x=M.randFloat(-1,1)*n,qt.z=M.randFloat(-1,1)*n,this._targetLocal.add(qt),this._targetLocal.normalize(),this._targetLocal.multiplyScalar(this.radius),Bt.copy(this._targetLocal),Bt.z+=this.distance,Bt.applyMatrix4(e.worldMatrix),i.subVectors(Bt,e.position),i},jb.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.radius=this.radius,e.distance=this.distance,e.jitter=this.jitter,e._targetLocal=this._targetLocal.toArray([]),e},jb.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.radius=e.radius,this.distance=e.distance,this.jitter=e.jitter,this._targetLocal.fromArray(e._targetLocal),this};var Lt=new f,ja=function(e){this.vehicle=e,this.behaviors=[],this._steeringForce=new f,this._typesMap=new Map};ja.prototype.add=function(e){return this.behaviors.push(e),e.onAdded(this.vehicle),this},ja.prototype.remove=function(e){var i=this.behaviors.indexOf(e);return this.behaviors.splice(i,1),e.onRemoved(this.vehicle),this},ja.prototype.clear=function(){return this.behaviors.length=0,this},ja.prototype.calculate=function(e,i){return this._calculateByOrder(e),i.copy(this._steeringForce)},ja.prototype._accumulate=function(e){var i=this._steeringForce.length();return!(0>=(i=this.vehicle.maxForce-i))&&(e.length()>i&&e.normalize().multiplyScalar(i),this._steeringForce.add(e),!0)},ja.prototype._calculateByOrder=function(e){var i=this.behaviors;this._steeringForce.set(0,0,0);for(var n=0,o=i.length;n<o;n++){var s=i[n];if(!0===s.active&&(Lt.set(0,0,0),s.calculate(this.vehicle,Lt,e),Lt.multiplyScalar(s.weight),!1===this._accumulate(Lt)))break}},ja.prototype.toJSON=function(){for(var e={type:"SteeringManager",behaviors:[]},i=this.behaviors,n=0,o=i.length;n<o;n++)e.behaviors.push(i[n].toJSON());return e},ja.prototype.fromJSON=function(e){this.clear();for(var i=0,n=(e=e.behaviors).length;i<n;i++){var o=e[i],s=o.type;switch(s){case"SteeringBehavior":o=(new p).fromJSON(o);break;case"AlignmentBehavior":o=(new cc).fromJSON(o);break;case"ArriveBehavior":o=(new Da).fromJSON(o);break;case"CohesionBehavior":o=(new ec).fromJSON(o);break;case"EvadeBehavior":o=(new Ta).fromJSON(o);break;case"FleeBehavior":o=(new Sa).fromJSON(o);break;case"FollowPathBehavior":o=(new hb).fromJSON(o);break;case"InterposeBehavior":o=(new Ua).fromJSON(o);break;case"ObstacleAvoidanceBehavior":o=(new Va).fromJSON(o);break;case"OffsetPursuitBehavior":o=(new Wa).fromJSON(o);break;case"PursuitBehavior":o=(new Xa).fromJSON(o);break;case"SeekBehavior":o=(new ya).fromJSON(o);break;case"SeparationBehavior":o=(new lc).fromJSON(o);break;case"WanderBehavior":o=(new jb).fromJSON(o);break;default:var h=this._typesMap.get(s);if(void 0===h){y.warn("YUKA.SteeringManager: Unsupported steering behavior type:",s);continue}o=(new h).fromJSON(o)}this.add(o)}return this},ja.prototype.registerType=function(e,i){return this._typesMap.set(e,i),this},ja.prototype.resolveReferences=function(e){for(var i=this.behaviors,n=0,o=i.length;n<o;n++)i[n].resolveReferences(e);return this};var Jb=function(e){for(this.count=void 0===e?10:e,this._history=[],e=this._slot=0;e<this.count;e++)this._history[e]=new f};Jb.prototype.calculate=function(e,i){for(i.set(0,0,0),this._slot===this.count&&(this._slot=0),this._history[this._slot].copy(e),this._slot++,e=0;e<this.count;e++)i.add(this._history[e]);return i.divideScalar(this.count),i},Jb.prototype.toJSON=function(){for(var e={type:this.constructor.name,count:this.count,_history:[],_slot:this._slot},i=this._history,n=0,o=i.length;n<o;n++)e._history.push(i[n].toArray([]));return e},Jb.prototype.fromJSON=function(e){this.count=e.count,this._slot=e._slot,e=e._history;for(var i=this._history.length=0,n=e.length;i<n;i++){var o=e[i];this._history.push((new f).fromArray(o))}return this};var Ut=new f,Yt=new f,Ht=new f,Wt=new f,Kt=new f,Ya=function(){var e=ia.call(this)||this;return e.mass=1,e.maxForce=100,e.steering=new ja(e),e.smoother=null,e};$jscomp.inherits(Ya,ia),Ya.prototype.update=function(e){return this.steering.calculate(e,Ut),Ht.copy(Ut).divideScalar(this.mass),this.velocity.add(Ht.multiplyScalar(e)),this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed)),Yt.copy(this.velocity).multiplyScalar(e),Wt.copy(this.position).add(Yt),!0===this.updateOrientation&&null===this.smoother&&1e-8<this.getSpeedSquared()&&this.lookAt(Wt),this.position.copy(Wt),!0===this.updateOrientation&&null!==this.smoother&&(this.smoother.calculate(this.velocity,Kt),Yt.copy(Kt).multiplyScalar(e),Wt.copy(this.position).add(Yt),this.lookAt(Wt)),this},Ya.prototype.toJSON=function(){var e=ia.prototype.toJSON.call(this);return e.mass=this.mass,e.maxForce=this.maxForce,e.steering=this.steering.toJSON(),e.smoother=this.smoother?this.smoother.toJSON():null,e},Ya.prototype.fromJSON=function(e){return ia.prototype.fromJSON.call(this,e),this.mass=e.mass,this.maxForce=e.maxForce,this.steering=new ja(this).fromJSON(e.steering),this.smoother=e.smoother?(new Jb).fromJSON(e.smoother):null,this},Ya.prototype.resolveReferences=function(e){ia.prototype.resolveReferences.call(this,e),this.steering.resolveReferences(e)};var oa=function(){};oa.prototype.touching=function(){return!1},oa.prototype.toJSON=function(){return{type:this.constructor.name}},oa.prototype.fromJSON=function(){return this};var Gt=new R,Ja=function(e,i){return e=void 0===e?new f:e,i=void 0===i?new f:i,this._aabb=new E(e,i),this};$jscomp.inherits(Ja,oa),Ja.prototype.fromPositionAndSize=function(e,i){return this._aabb.fromCenterAndSize(e,i),this},Ja.prototype.touching=function(e){return Gt.set(e.position,e.boundingRadius),this._aabb.intersectsBoundingSphere(Gt)},Ja.prototype.toJSON=function(){var e=oa.prototype.toJSON.call(this);return e._aabb=this._aabb.toJSON(),e},Ja.prototype.fromJSON=function(e){return oa.prototype.fromJSON.call(this,e),this._aabb.fromJSON(e._aabb),this},$jscomp.global.Object.defineProperties(Ja.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},set:function(e){this._aabb.min=e}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(e){this._aabb.max=e}}});var Xt=new R,Za=function(e,i){return e=void 0===e?new f:e,this._boundingSphere=new R(e,void 0===i?0:i),this};$jscomp.inherits(Za,oa),Za.prototype.touching=function(e){return Xt.set(e.position,e.boundingRadius),this._boundingSphere.intersectsBoundingSphere(Xt)},Za.prototype.toJSON=function(){var e=oa.prototype.toJSON.call(this);return e._boundingSphere=this._boundingSphere.toJSON(),e},Za.prototype.fromJSON=function(e){return oa.prototype.fromJSON.call(this,e),this._boundingSphere.fromJSON(e._boundingSphere),this},$jscomp.global.Object.defineProperties(Za.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},set:function(e){this._boundingSphere.center=e}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(e){this._boundingSphere.radius=e}}});var Ka=function(e){e=void 0===e?new oa:e,this.active=!0,this.region=e,this._typesMap=new Map};Ka.prototype.check=function(e){return!0===this.active&&!0===this.region.touching(e)&&this.execute(e),this},Ka.prototype.execute=function(){},Ka.prototype.update=function(){},Ka.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,region:this.region.toJSON()}},Ka.prototype.fromJSON=function(e){this.active=e.active;var i=(e=e.region).type;switch(i){case"TriggerRegion":this.region=(new oa).fromJSON(e);break;case"RectangularTriggerRegion":this.region=(new Ja).fromJSON(e);break;case"SphericalTriggerRegion":this.region=(new Za).fromJSON(e);break;default:void 0!==(i=this._typesMap.get(i))?this.region=(new i).fromJSON(e):y.warn("YUKA.Trigger: Unsupported trigger region type:",e.type)}return this},Ka.prototype.registerType=function(e,i){return this._typesMap.set(e,i),this};var Zt=[],da=function(){this.entities=[],this.triggers=[],this.spatialIndex=null,this._indexMap=new Map,this._typesMap=new Map,this._messageDispatcher=new ta};da.prototype.add=function(e){return this.entities.push(e),e.manager=this,this},da.prototype.remove=function(e){var i=this.entities.indexOf(e);return this.entities.splice(i,1),e.manager=null,this},da.prototype.addTrigger=function(e){return this.triggers.push(e),this},da.prototype.removeTrigger=function(e){return e=this.triggers.indexOf(e),this.triggers.splice(e,1),this},da.prototype.clear=function(){return this.entities.length=0,this.triggers.length=0,this._messageDispatcher.clear(),this},da.prototype.getEntityByName=function(e){for(var i=this.entities,n=0,o=i.length;n<o;n++){var s=i[n];if(s.name===e)return s}return null},da.prototype.update=function(e){for(var i=this.entities,n=this.triggers,o=i.length-1;0<=o;o--)this.updateEntity(i[o],e);for(i=n.length-1;0<=i;i--)this.updateTrigger(n[i],e);return this._messageDispatcher.dispatchDelayedMessages(e),this},da.prototype.updateEntity=function(e,i){if(!0===e.active){this.updateNeighborhood(e),!1===e._started&&(e.start(),e._started=!0),e.update(i),e.updateWorldMatrix();for(var n=e.children,o=n.length-1;0<=o;o--)this.updateEntity(n[o],i);null!==this.spatialIndex&&(i=this._indexMap.get(e)||-1,i=this.spatialIndex.updateEntity(e,i),this._indexMap.set(e,i)),i=e._renderComponent,n=e._renderComponentCallback,null!==i&&null!==n&&n(e,i)}return this},da.prototype.updateNeighborhood=function(e){if(!0===e.updateNeighborhood){e.neighbors.length=0,null!==this.spatialIndex?this.spatialIndex.query(e.position,e.neighborhoodRadius,Zt):(Zt.length=0,Zt.push.apply(Zt,$jscomp.arrayFromIterable(this.entities)));for(var i=e.neighborhoodRadius*e.neighborhoodRadius,n=0,o=Zt.length;n<o;n++){var s=Zt[n];e!==s&&!0===s.active&&e.position.squaredDistanceTo(s.position)<=i&&e.neighbors.push(s)}}return this},da.prototype.updateTrigger=function(e,i){if(!0===e.active){e.update(i);for(var n=(i=this.entities).length-1;0<=n;n--){var o=i[n];!0===o.active&&o.canAcitivateTrigger&&e.check(o)}}return this},da.prototype.sendMessage=function(e,i,n,o,s){return this._messageDispatcher.dispatch(e,i,n,o,s),this},da.prototype.toJSON=function(){function a(i){e.entities.push(i.toJSON());for(var n=0,o=i.children.length;n<o;n++)a(i.children[n])}for(var e={type:this.constructor.name,entities:[],triggers:[],_messageDispatcher:this._messageDispatcher.toJSON()},i=0,n=this.entities.length;i<n;i++)a(this.entities[i]);for(i=0,n=this.triggers.length;i<n;i++)e.triggers.push(this.triggers[i].toJSON());return e},da.prototype.fromJSON=function(e){this.clear();var i=e.entities,n=e.triggers;e=e._messageDispatcher;for(var o=new Map,s=0,h=i.length;s<h;s++){var u=i[s],l=u.type;switch(l){case"GameEntity":u=(new G).fromJSON(u);break;case"MovingEntity":u=(new ia).fromJSON(u);break;case"Vehicle":u=(new Ya).fromJSON(u);break;default:var v=this._typesMap.get(l);if(void 0===v){y.warn("YUKA.EntityManager: Unsupported entity type:",l);continue}u=(new v).fromJSON(u)}o.set(u.uuid,u),null===u.parent&&this.add(u)}for(s=(i=$jscomp.makeIterator(o.values())).next();!s.done;s=i.next())s.value.resolveReferences(o);for(o=0,i=n.length;o<i;o++){if("Trigger"===(h=(s=n[o]).type))s=(new Ka).fromJSON(s);else{if(void 0===(u=this._typesMap.get(h))){y.warn("YUKA.EntityManager: Unsupported trigger type:",h);continue}s=(new u).fromJSON(s)}this.addTrigger(s)}return this._messageDispatcher.fromJSON(e),this},da.prototype.registerType=function(e,i){return this._typesMap.set(e,i),this};var Lb=function(){this._events=new Map};Lb.prototype.addEventListener=function(e,i){var n=this._events;!1===n.has(e)&&n.set(e,[]),-1===(e=n.get(e)).indexOf(i)&&e.push(i)},Lb.prototype.removeEventListener=function(e,i){void 0!==(e=this._events.get(e))&&(-1!==(i=e.indexOf(i))&&e.splice(i,1))},Lb.prototype.hasEventListener=function(e,i){return void 0!==(e=this._events.get(e))&&-1!==e.indexOf(i)},Lb.prototype.dispatchEvent=function(e){var i=this._events.get(e.type);if(void 0!==i){e.target=this;for(var n=0,o=i.length;n<o;n++)i[n].call(this,e)}};var Qt=new f,te=new f,ee=new f,ea=function(e,i){this.normal=e=void 0===e?new f(0,0,1):e,this.constant=void 0===i?0:i};ea.prototype.set=function(e,i){return this.normal=e,this.constant=i,this},ea.prototype.copy=function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},ea.prototype.clone=function(){return(new this.constructor).copy(this)},ea.prototype.distanceToPoint=function(e){return this.normal.dot(e)+this.constant},ea.prototype.fromNormalAndCoplanarPoint=function(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this},ea.prototype.fromCoplanarPoints=function(e,i,n){return Qt.subVectors(n,i).cross(te.subVectors(e,i)).normalize(),this.fromNormalAndCoplanarPoint(Qt,e),this},ea.prototype.intersectPlane=function(e,i){ee.crossVectors(this.normal,e.normal);var n=ee.dot(ee);return 0===n?null:(Qt.copy(e.normal).multiplyScalar(this.constant),te.copy(this.normal).multiplyScalar(e.constant),i.crossVectors(Qt.sub(te),ee).divideScalar(n),i)},ea.prototype.intersectsPlane=function(e){return e=this.normal.dot(e.normal),1!==Math.abs(e)},ea.prototype.projectPoint=function(e,i){return Qt.copy(this.normal).multiplyScalar(this.distanceToPoint(e)),i.subVectors(e,Qt),i},ea.prototype.equals=function(e){return e.normal.equals(this.normal)&&e.constant===this.constant};var re=new R,se={a:new f,b:new f,c:new f},he=new K,ue=new ea,pe=new D,le=new f,ce=new f,de=new f,fe=new f,$a=function(e,i){this.vertices=e=void 0===e?new Float32Array:e,this.indices=void 0===i?null:i,this.backfaceCulling=!0,this.aabb=new E,this.boundingSphere=new R,this.computeBoundingVolume()};$a.prototype.computeBoundingVolume=function(){var e=this.vertices,i=new f,n=this.aabb,o=this.boundingSphere;n.min.set(1/0,1/0,1/0),n.max.set(-1/0,-1/0,-1/0);for(var s=0,h=e.length;s<h;s+=3)i.x=e[s],i.y=e[s+1],i.z=e[s+2],n.expand(i);return n.getCenter(o.center),o.radius=o.center.distanceTo(n.max),this},$a.prototype.intersectRay=function(e,i,n,o,s){if(s=void 0===s?null:s,re.copy(this.boundingSphere).applyMatrix4(i),e.intersectsBoundingSphere(re)&&(i.getInverse(pe),he.copy(e).applyMatrix4(pe),he.intersectsAABB(this.aabb))){e=this.vertices;var h=this.indices,u=1/0,l=!1;if(null===h){h=0;for(var v=e.length;h<v;h+=9)if(se.a.set(e[h],e[h+1],e[h+2]),se.b.set(e[h+3],e[h+4],e[h+5]),se.c.set(e[h+6],e[h+7],e[h+8]),null!==he.intersectTriangle(se,this.backfaceCulling,o)){if(!n){l=!0;break}var S=o.squaredDistanceTo(he.origin);S<u&&(u=S,le.copy(o),ce.copy(se.a),de.copy(se.b),fe.copy(se.c),l=!0)}}else for(v=0,S=h.length;v<S;v+=3){var _=h[v],z=h[v+1],O=h[v+2];if(se.a.set(e[3*_],e[3*_+1],e[3*_+2]),se.b.set(e[3*z],e[3*z+1],e[3*z+2]),se.c.set(e[3*O],e[3*O+1],e[3*O+2]),null!==he.intersectTriangle(se,this.backfaceCulling,o)){if(!n){l=!0;break}(_=o.squaredDistanceTo(he.origin))<u&&(u=_,le.copy(o),ce.copy(se.a),de.copy(se.b),fe.copy(se.c),l=!0)}}if(l)return n&&(o.copy(le),se.a.copy(ce),se.b.copy(de),se.c.copy(fe)),o.applyMatrix4(i),null!==s&&(ue.fromCoplanarPoints(se.a,se.b,se.c),s.copy(ue.normal),s.transformDirection(i)),o}return null},$a.prototype.toTriangleSoup=function(){var e=this.indices,i=this.vertices;if(e)for(var n=new Float32Array(3*e.length),o=0,s=e.length;o<s;o++){var h=e[o];n[3*o]=i[3*h],n[3*o+1]=i[3*h+1],n[3*o+2]=i[3*h+2]}else n=new Float32Array(i);return new $a(n)},$a.prototype.toJSON=function(){var e={type:this.constructor.name};return e.indices={type:this.indices?this.indices.constructor.name:"null",data:this.indices?Array.from(this.indices):null},e.vertices=Array.from(this.vertices),e.backfaceCulling=this.backfaceCulling,e.aabb=this.aabb.toJSON(),e.boundingSphere=this.boundingSphere.toJSON(),e},$a.prototype.fromJSON=function(e){switch(this.aabb=(new E).fromJSON(e.aabb),this.boundingSphere=(new R).fromJSON(e.boundingSphere),this.backfaceCulling=e.backfaceCulling,this.vertices=new Float32Array(e.vertices),e.indices.type){case"Uint16Array":this.indices=new Uint16Array(e.indices.data);break;case"Uint32Array":this.indices=new Uint32Array(e.indices.data);break;case"null":this.indices=null}return this};var nb=function(){this.previousTime=0,this.currentTime=this.now(),this.detectPageVisibility=!0,"undefined"!=typeof document&&void 0!==document.hidden&&(this._pageVisibilityHandler=g.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1)),this._deltaTime=this._elapsedTime=0};nb.prototype.getDelta=function(){return this._deltaTime/1e3},nb.prototype.getElapsed=function(){return this._elapsedTime/1e3},nb.prototype.update=function(){return this.previousTime=this.currentTime,this.currentTime=this.now(),this._deltaTime=this.currentTime-this.previousTime,this._elapsedTime+=this._deltaTime,this},nb.prototype.now=function(){return("undefined"==typeof performance?Date:performance).now()};var Yd=function(e){this.updateFrequency=void 0===e?0:e,this._time=new nb,this._nextUpdateTime=0};Yd.prototype.ready=function(){return this._time.update(),this._time.currentTime>=this._nextUpdateTime&&(this._nextUpdateTime=this._time.currentTime+1e3/this.updateFrequency,!0)};var Fa=function(){};Fa.prototype.enter=function(){},Fa.prototype.execute=function(){},Fa.prototype.exit=function(){},Fa.prototype.toJSON=function(){},Fa.prototype.fromJSON=function(){},Fa.prototype.resolveReferences=function(){},Fa.prototype.onMessage=function(){return!1};var fa=function(e){this.owner=void 0===e?null:e,this.globalState=this.previousState=this.currentState=null,this.states=new Map,this._typesMap=new Map};fa.prototype.update=function(){return null!==this.globalState&&this.globalState.execute(this.owner),null!==this.currentState&&this.currentState.execute(this.owner),this},fa.prototype.add=function(e,i){return i instanceof Fa?this.states.set(e,i):y.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".'),this},fa.prototype.remove=function(e){return this.states.delete(e),this},fa.prototype.get=function(e){return this.states.get(e)},fa.prototype.changeTo=function(e){return e=this.get(e),this._change(e),this},fa.prototype.revert=function(){return this._change(this.previousState),this},fa.prototype.in=function(e){return this.get(e)===this.currentState},fa.prototype.handleMessage=function(e){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,e)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,e)},fa.prototype.toJSON=function(){for(var e={owner:this.owner.uuid,currentState:null,previousState:null,globalState:null,states:[]},i=new Map,n=$jscomp.makeIterator(this.states),o=n.next();!o.done;o=n.next()){var s=$jscomp.makeIterator(o.value);o=s.next().value,s=s.next().value,e.states.push({type:s.constructor.name,id:o,state:s.toJSON()}),i.set(s,o)}return e.currentState=i.get(this.currentState)||null,e.previousState=i.get(this.previousState)||null,e.globalState=i.get(this.globalState)||null,e},fa.prototype.fromJSON=function(e){this.owner=e.owner;for(var i=e.states,n=0,o=i.length;n<o;n++){var s=i[n],h=s.type,u=this._typesMap.get(h);void 0!==u?(h=s.id,s=(new u).fromJSON(s.state),this.add(h,s)):y.warn("YUKA.StateMachine: Unsupported state type:",h)}return this.currentState=null!==e.currentState&&this.get(e.currentState)||null,this.previousState=null!==e.previousState&&this.get(e.previousState)||null,this.globalState=null!==e.globalState&&this.get(e.globalState)||null,this},fa.prototype.resolveReferences=function(e){this.owner=e.get(this.owner)||null;for(var i=$jscomp.makeIterator(this.states.values()),n=i.next();!n.done;n=i.next())n.value.resolveReferences(e);return this},fa.prototype.registerType=function(e,i){return this._typesMap.set(e,i),this},fa.prototype._change=function(e){this.previousState=this.currentState,this.currentState.exit(this.owner),this.currentState=e,this.currentState.enter(this.owner)};var Ga=function(){};Ga.prototype.clearDegreeOfMembership=function(){},Ga.prototype.getDegreeOfMembership=function(){},Ga.prototype.updateDegreeOfMembership=function(){},Ga.prototype.toJSON=function(){return{type:this.constructor.name}};var aa=function(e){return this.terms=e=void 0===e?[]:e,this};$jscomp.inherits(aa,Ga),aa.prototype.clearDegreeOfMembership=function(){for(var e=this.terms,i=0,n=e.length;i<n;i++)e[i].clearDegreeOfMembership();return this},aa.prototype.updateDegreeOfMembership=function(e){for(var i=this.terms,n=0,o=i.length;n<o;n++)i[n].updateDegreeOfMembership(e);return this},aa.prototype.toJSON=function(){var e=Ga.prototype.toJSON.call(this);e.terms=[];for(var i=0,n=this.terms.length;i<n;i++){var o=this.terms[i];o instanceof aa?e.terms.push(o.toJSON()):e.terms.push(o.uuid)}return e};var pc=function(){var e=Array.from(arguments);return aa.call(this,e)||this};$jscomp.inherits(pc,aa),pc.prototype.getDegreeOfMembership=function(){for(var e=this.terms,i=1/0,n=0,o=e.length;n<o;n++){var s=e[n].getDegreeOfMembership();s<i&&(i=s)}return i};var ob=function(e){return aa.call(this,null!==(e=void 0===e?null:e)?[e]:[])||this};$jscomp.inherits(ob,aa),ob.prototype.clearDegreeOfMembership=function(){return this.terms[0].clearDegreeOfMembership(),this},ob.prototype.getDegreeOfMembership=function(){var e=this.terms[0].getDegreeOfMembership();return Math.sqrt(e)},ob.prototype.updateDegreeOfMembership=function(e){return this.terms[0].updateDegreeOfMembership(Math.sqrt(e)),this};var qc=function(){var e=Array.from(arguments);return aa.call(this,e)||this};$jscomp.inherits(qc,aa),qc.prototype.getDegreeOfMembership=function(){for(var e=this.terms,i=-1/0,n=0,o=e.length;n<o;n++){var s=e[n].getDegreeOfMembership();s>i&&(i=s)}return i};var pb=function(e){return aa.call(this,null!==(e=void 0===e?null:e)?[e]:[])||this};$jscomp.inherits(pb,aa),pb.prototype.clearDegreeOfMembership=function(){return this.terms[0].clearDegreeOfMembership(),this},pb.prototype.getDegreeOfMembership=function(){var e=this.terms[0].getDegreeOfMembership();return e*e},pb.prototype.updateDegreeOfMembership=function(e){return this.terms[0].updateDegreeOfMembership(e*e),this};var x=function(e){return this.degreeOfMembership=0,this.representativeValue=void 0===e?0:e,this.right=this.left=0,this._uuid=null,this};$jscomp.inherits(x,Ga),x.prototype.computeDegreeOfMembership=function(){},x.prototype.clearDegreeOfMembership=function(){return this.degreeOfMembership=0,this},x.prototype.getDegreeOfMembership=function(){return this.degreeOfMembership},x.prototype.updateDegreeOfMembership=function(e){return e>this.degreeOfMembership&&(this.degreeOfMembership=e),this},x.prototype.toJSON=function(){var e=Ga.prototype.toJSON.call(this);return e.degreeOfMembership=this.degreeOfMembership,e.representativeValue=this.representativeValue,e.left=this.left,e.right=this.right,e.uuid=this.uuid,e},x.prototype.fromJSON=function(e){return this.degreeOfMembership=e.degreeOfMembership,this.representativeValue=e.representativeValue,this.left=e.left,this.right=e.right,this.uuid=e.uuid,this},$jscomp.global.Object.defineProperties(x.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){return null===this._uuid&&(this._uuid=M.generateUUID()),this._uuid},set:function(e){this._uuid=e}}});var Mb=function(e,i,n){n=void 0===n?0:n;var o=x.call(this,((i=void 0===i?0:i)+(e=void 0===e?0:e))/2)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(Mb,x),Mb.prototype.computeDegreeOfMembership=function(e){var i=this.midpoint,n=this.right;return e>=this.left&&e<=i?1:e>i&&e<=n?e>=(i+n)/2?2*Math.pow((e-n)/(i-n),2):1-2*Math.pow((e-i)/(i-n),2):0},Mb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},Mb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var qb=function(e,i,n){n=void 0===n?0:n;var o=x.call(this,((i=void 0===i?0:i)+(e=void 0===e?0:e))/2)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(qb,x),qb.prototype.computeDegreeOfMembership=function(e){var i=this.midpoint,n=this.right;return e>=this.left&&e<=i?1:e>i&&e<=n?1/(n-i)*(n-e):0},qb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},qb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var rb=function(e,i,n,o){e=void 0===e?0:e,n=void 0===n?0:n,o=void 0===o?0:o;var s=x.call(this,i=void 0===i?0:i)||this;return s.left=e,s.midpoint=i,s.right=n,s.standardDeviation=o,s._cache={},s};$jscomp.inherits(rb,x),rb.prototype.computeDegreeOfMembership=function(e){return this._updateCache(),e>=this.right||e<=this.left?0:r(e,this.midpoint,this._cache.variance)/this._cache.normalizationFactor},rb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e.standardDeviation=this.standardDeviation,e},rb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this.standardDeviation=e.standardDeviation,this},rb.prototype._updateCache=function(){var e=this._cache,i=this.midpoint,n=this.standardDeviation;if(i!==e.midpoint||n!==e.standardDeviation){var o=n*n;e.midpoint=i,e.standardDeviation=n,e.variance=o,e.normalizationFactor=r(i,i,o)}return this};var Nb=function(e,i,n){e=void 0===e?0:e;var o=x.call(this,((i=void 0===i?0:i)+(n=void 0===n?0:n))/2)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(Nb,x),Nb.prototype.computeDegreeOfMembership=function(e){var i=this.midpoint,n=this.left,o=this.right;return e>=n&&e<=i?e<=(n+i)/2?2*Math.pow((e-n)/(i-n),2):1-2*Math.pow((e-i)/(i-n),2):e>i&&e<=o?1:0},Nb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},Nb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var sb=function(e,i,n){e=void 0===e?0:e;var o=x.call(this,((i=void 0===i?0:i)+(n=void 0===n?0:n))/2)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(sb,x),sb.prototype.computeDegreeOfMembership=function(e){var i=this.midpoint,n=this.left,o=this.right;return e>=n&&e<=i?1/(i-n)*(e-n):e>i&&e<=o?1:0},sb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},sb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var tb=function(e,i,n){e=void 0===e?0:e,n=void 0===n?0:n;var o=x.call(this,i=void 0===i?0:i)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(tb,x),tb.prototype.computeDegreeOfMembership=function(e){var i=this.right;return e>=this.left&&e<=i?1:0},tb.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},tb.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var ub=function(e,i,n){e=void 0===e?0:e,n=void 0===n?0:n;var o=x.call(this,i=void 0===i?0:i)||this;return o.left=e,o.midpoint=i,o.right=n,o};$jscomp.inherits(ub,x),ub.prototype.computeDegreeOfMembership=function(e){var i=this.midpoint,n=this.left,o=this.right;return e>=n&&e<=i?1/(i-n)*(e-n):e>i&&e<=o?1/(o-i)*(o-e):0},ub.prototype.toJSON=function(){var e=x.prototype.toJSON.call(this);return e.midpoint=this.midpoint,e},ub.prototype.fromJSON=function(e){return x.prototype.fromJSON.call(this,e),this.midpoint=e.midpoint,this};var vb=function(e,i){this.antecedent=void 0===e?null:e,this.consequence=void 0===i?null:i};vb.prototype.initConsequence=function(){return this.consequence.clearDegreeOfMembership(),this},vb.prototype.evaluate=function(){return this.consequence.updateDegreeOfMembership(this.antecedent.getDegreeOfMembership()),this},vb.prototype.toJSON=function(){var e={},i=this.antecedent,n=this.consequence;return e.type=this.constructor.name,e.antecedent=i instanceof aa?i.toJSON():i.uuid,e.consequence=n instanceof aa?n.toJSON():n.uuid,e},vb.prototype.fromJSON=function(e,i){function c(e){if("string"==typeof e)return i.get(e)||null;var n=e.type;switch(n){case"FuzzyAND":n=new pc;break;case"FuzzyOR":n=new qc;break;case"FuzzyVERY":n=new pb;break;case"FuzzyFAIRLY":n=new ob;break;default:return void y.error("YUKA.FuzzyRule: Unsupported operator type:",n)}for(var o=0,s=(e=e.terms).length;o<s;o++)n.terms.push(c(e[o]));return n}return this.antecedent=c(e.antecedent),this.consequence=c(e.consequence),this};var Ha=function(){this.fuzzySets=[],this.minRange=1/0,this.maxRange=-1/0};Ha.prototype.add=function(e){return this.fuzzySets.push(e),e.left<this.minRange&&(this.minRange=e.left),e.right>this.maxRange&&(this.maxRange=e.right),this},Ha.prototype.remove=function(e){var i=this.fuzzySets;e=i.indexOf(e),i.splice(e,1),this.minRange=1/0,this.maxRange=-1/0,e=0;for(var n=i.length;e<n;e++){var o=i[e];o.left<this.minRange&&(this.minRange=o.left),o.right>this.maxRange&&(this.maxRange=o.right)}return this},Ha.prototype.fuzzify=function(e){if(!(e<this.minRange||e>this.maxRange)){for(var i=this.fuzzySets,n=0,o=i.length;n<o;n++){var s=i[n];s.degreeOfMembership=s.computeDegreeOfMembership(e)}return this}y.warn("YUKA.FuzzyVariable: Value for fuzzification out of range.")},Ha.prototype.defuzzifyMaxAv=function(){for(var e=this.fuzzySets,i=0,n=0,o=0,s=e.length;o<s;o++){var h=e[o];i+=h.degreeOfMembership,n+=h.representativeValue*h.degreeOfMembership}return 0===i?0:n/i},Ha.prototype.defuzzifyCentroid=function(e){e=void 0===e?10:e;for(var i=this.fuzzySets,n=(this.maxRange-this.minRange)/e,o=0,s=0,h=1;h<=e;h++)for(var u=this.minRange+h*n,l=0,v=i.length;l<v;l++){var S=i[l];o+=S=Math.min(S.degreeOfMembership,S.computeDegreeOfMembership(u)),s+=u*S}return 0===o?0:s/o},Ha.prototype.toJSON=function(){for(var e={type:this.constructor.name,fuzzySets:[],minRange:this.minRange.toString(),maxRange:this.maxRange.toString()},i=0,n=this.fuzzySets.length;i<n;i++)e.fuzzySets.push(this.fuzzySets[i].toJSON());return e},Ha.prototype.fromJSON=function(e){this.minRange=parseFloat(e.minRange),this.maxRange=parseFloat(e.maxRange);for(var i=0,n=e.fuzzySets.length;i<n;i++){var o=e.fuzzySets[i];switch(o.type){case"LeftShoulderFuzzySet":this.fuzzySets.push((new qb).fromJSON(o));break;case"RightShoulderFuzzySet":this.fuzzySets.push((new sb).fromJSON(o));break;case"SingletonFuzzySet":this.fuzzySets.push((new tb).fromJSON(o));break;case"TriangularFuzzySet":this.fuzzySets.push((new ub).fromJSON(o));break;default:y.error("YUKA.FuzzyVariable: Unsupported fuzzy set type:",o.type)}}return this};var ha=function(){this.rules=[],this.flvs=new Map};ha.prototype.addFLV=function(e,i){return this.flvs.set(e,i),this},ha.prototype.removeFLV=function(e){return this.flvs.delete(e),this},ha.prototype.addRule=function(e){return this.rules.push(e),this},ha.prototype.removeRule=function(e){var i=this.rules;return e=i.indexOf(e),i.splice(e,1),this},ha.prototype.fuzzify=function(e,i){return this.flvs.get(e).fuzzify(i),this},ha.prototype.defuzzify=function(e,i){i=void 0===i?ha.DEFUZ_TYPE.MAXAV:i;var n=this.flvs,o=this.rules;this._initConsequences();for(var s=0,h=o.length;s<h;s++)o[s].evaluate();switch(e=n.get(e),i){case ha.DEFUZ_TYPE.MAXAV:i=e.defuzzifyMaxAv();break;case ha.DEFUZ_TYPE.CENTROID:i=e.defuzzifyCentroid();break;default:y.warn("YUKA.FuzzyModule: Unknown defuzzification method:",i),i=e.defuzzifyMaxAv()}return i},ha.prototype._initConsequences=function(){for(var e=this.rules,i=0,n=e.length;i<n;i++)e[i].initConsequence();return this},ha.prototype.toJSON=function(){for(var e={rules:[],flvs:[]},i=this.rules,n=0,o=i.length;n<o;n++)e.rules.push(i[n].toJSON());for(n=(i=$jscomp.makeIterator(this.flvs)).next();!n.done;n=i.next())n=(o=$jscomp.makeIterator(n.value)).next().value,o=o.next().value,e.flvs.push({name:n,flv:o.toJSON()});return e},ha.prototype.fromJSON=function(e){for(var i=new Map,n=e.flvs,o=0,s=n.length;o<s;o++){var h=n[o],u=h.name;for(h=(new Ha).fromJSON(h.flv),this.addFLV(u,h),h=(u=$jscomp.makeIterator(h.fuzzySets)).next();!h.done;h=u.next())h=h.value,i.set(h.uuid,h)}for(n=0,o=(e=e.rules).length;n<o;n++)s=e[n],s=(new vb).fromJSON(s,i),this.addRule(s);return this},ha.DEFUZ_TYPE=Object.freeze({MAXAV:0,CENTROID:1});var B=function(e){this.owner=void 0===e?null:e,this.status=B.STATUS.INACTIVE};B.prototype.activate=function(){},B.prototype.execute=function(){},B.prototype.terminate=function(){},B.prototype.handleMessage=function(){return!1},B.prototype.active=function(){return this.status===B.STATUS.ACTIVE},B.prototype.inactive=function(){return this.status===B.STATUS.INACTIVE},B.prototype.completed=function(){return this.status===B.STATUS.COMPLETED},B.prototype.failed=function(){return this.status===B.STATUS.FAILED},B.prototype.replanIfFailed=function(){return!0===this.failed()&&(this.status=B.STATUS.INACTIVE),this},B.prototype.activateIfInactive=function(){return!0===this.inactive()&&(this.status=B.STATUS.ACTIVE,this.activate()),this},B.prototype.toJSON=function(){return{type:this.constructor.name,owner:this.owner.uuid,status:this.status}},B.prototype.fromJSON=function(e){return this.owner=e.owner,this.status=e.status,this},B.prototype.resolveReferences=function(e){return this.owner=e.get(this.owner)||null,this},B.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var ba=function(e){return(e=B.call(this,void 0===e?null:e)||this).subgoals=[],e};$jscomp.inherits(ba,B),ba.prototype.addSubgoal=function(e){return this.subgoals.unshift(e),this},ba.prototype.removeSubgoal=function(e){return e=this.subgoals.indexOf(e),this.subgoals.splice(e,1),this},ba.prototype.clearSubgoals=function(){for(var e=this.subgoals,i=0,n=e.length;i<n;i++)e[i].terminate();return e.length=0,this},ba.prototype.currentSubgoal=function(){var e=this.subgoals.length;return 0<e?this.subgoals[e-1]:null},ba.prototype.executeSubgoals=function(){for(var e=this.subgoals,i=e.length-1;0<=i;i--){var n=e[i];if(!0!==n.completed()&&!0!==n.failed())break;n instanceof ba&&n.clearSubgoals(),n.terminate(),e.pop()}return null!==(i=this.currentSubgoal())?(i.activateIfInactive(),i.execute(),!0===i.completed()&&1<e.length?B.STATUS.ACTIVE:i.status):B.STATUS.COMPLETED},ba.prototype.hasSubgoals=function(){return 0<this.subgoals.length},ba.prototype.handleMessage=function(e){var i=this.currentSubgoal();return null!==i&&i.handleMessage(e)},ba.prototype.toJSON=function(){var e=B.prototype.toJSON.call(this);e.subgoals=[];for(var i=0,n=this.subgoals.length;i<n;i++)e.subgoals.push(this.subgoals[i].toJSON());return e},ba.prototype.resolveReferences=function(e){B.prototype.resolveReferences.call(this,e);for(var i=0,n=this.subgoals.length;i<n;i++)this.subgoals[i].resolveReferences(e);return this};var Ob=function(e){this.characterBias=void 0===e?1:e};Ob.prototype.calculateDesirability=function(){return 0},Ob.prototype.setGoal=function(){},Ob.prototype.toJSON=function(){return{type:this.constructor.name,characterBias:this.characterBias}},Ob.prototype.fromJSON=function(e){return this.characterBias=e.characterBias,this};var ua=function(e){return(e=ba.call(this,void 0===e?null:e)||this).evaluators=[],e._typesMap=new Map,e};$jscomp.inherits(ua,ba),ua.prototype.activate=function(){this.arbitrate()},ua.prototype.execute=function(){this.activateIfInactive();var e=this.executeSubgoals();e!==B.STATUS.COMPLETED&&e!==B.STATUS.FAILED||(this.status=B.STATUS.INACTIVE)},ua.prototype.terminate=function(){this.clearSubgoals()},ua.prototype.addEvaluator=function(e){return this.evaluators.push(e),this},ua.prototype.removeEvaluator=function(e){return e=this.evaluators.indexOf(e),this.evaluators.splice(e,1),this},ua.prototype.arbitrate=function(){for(var e=this.evaluators,i=-1,n=null,o=0,s=e.length;o<s;o++){var h=e[o],u=h.calculateDesirability(this.owner);(u*=h.characterBias)>=i&&(i=u,n=h)}return null!==n?n.setGoal(this.owner):y.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner),this},ua.prototype.toJSON=function(){var e=ba.prototype.toJSON.call(this);e.evaluators=[];for(var i=0,n=this.evaluators.length;i<n;i++)e.evaluators.push(this.evaluators[i].toJSON());return e},ua.prototype.fromJSON=function(e){function b(e){var n=e.type,o=i.get(n);if(void 0!==o){if(n=(new o).fromJSON(e),void 0!==(e=e.subgoals)){o=0;for(var s=e.length;o<s;o++){var h=b(e[o]);h&&n.subgoals.push(h)}}return n}y.warn("YUKA.Think: Unsupported goal evaluator type:",n)}ba.prototype.fromJSON.call(this,e);var i=this._typesMap;this.evaluators.length=0,this.terminate();for(var n=0,o=e.evaluators.length;n<o;n++){var s=e.evaluators[n],h=s.type,u=i.get(h);void 0!==u?(s=(new u).fromJSON(s),this.evaluators.push(s)):y.warn("YUKA.Think: Unsupported goal evaluator type:",h)}for(n=0,o=e.subgoals.length;n<o;n++)(s=b(e.subgoals[n]))&&this.subgoals.push(s);return this},ua.prototype.registerType=function(e,i){return this._typesMap.set(e,i),this};var Aa=function(e,i,n){this.from=void 0===e?-1:e,this.to=void 0===i?-1:i,this.cost=void 0===n?0:n};Aa.prototype.copy=function(e){return this.from=e.from,this.to=e.to,this.cost=e.cost,this},Aa.prototype.clone=function(){return(new this.constructor).copy(this)},Aa.prototype.toJSON=function(){return{type:this.constructor.name,from:this.from,to:this.to,cost:this.cost}},Aa.prototype.fromJSON=function(e){return this.from=e.from,this.to=e.to,this.cost=e.cost,this};var wb=function(e){this.index=void 0===e?-1:e};wb.prototype.toJSON=function(){return{type:this.constructor.name,index:this.index}},wb.prototype.fromJSON=function(e){return this.index=e.index,this};var W=function(){this.digraph=!1,this._nodes=new Map,this._edges=new Map};W.prototype.addNode=function(e){var i=e.index;return this._nodes.set(i,e),this._edges.set(i,[]),this},W.prototype.addEdge=function(e){var i=this._edges.get(e.from);if(i.push(e),!1===this.digraph){var n=e.clone();n.from=e.to,n.to=e.from,(i=this._edges.get(e.to)).push(n)}return this},W.prototype.getNode=function(e){return this._nodes.get(e)||null},W.prototype.getEdge=function(e,i){if(this.hasNode(e)&&this.hasNode(i))for(var n=0,o=(e=this._edges.get(e)).length;n<o;n++){var s=e[n];if(s.to===i)return s}return null},W.prototype.getNodes=function(e){return e.length=0,e.push.apply(e,$jscomp.arrayFromIterable(this._nodes.values())),e},W.prototype.getEdgesOfNode=function(e,i){return void 0!==(e=this._edges.get(e))&&(i.length=0,i.push.apply(i,$jscomp.arrayFromIterable(e))),i},W.prototype.getNodeCount=function(){return this._nodes.size},W.prototype.getEdgeCount=function(){for(var e=0,i=$jscomp.makeIterator(this._edges.values()),n=i.next();!n.done;n=i.next())e+=n.value.length;return e},W.prototype.removeNode=function(e){if(this._nodes.delete(e.index),!1===this.digraph)for(var i=this._edges.get(e.index),n=(i=$jscomp.makeIterator(i)).next();!n.done;n=i.next())for(var o=(n=this._edges.get(n.value.to)).length-1;0<=o;o--){var s=n[o];if(s.to===e.index){o=n.indexOf(s),n.splice(o,1);break}}else for(n=(i=$jscomp.makeIterator(this._edges.values())).next();!n.done;n=i.next())for(o=(n=n.value).length-1;0<=o;o--)s=n[o],this.hasNode(s.to)&&this.hasNode(s.from)||(s=n.indexOf(s),n.splice(s,1));return this._edges.delete(e.index),this},W.prototype.removeEdge=function(e){var i=this._edges.get(e.from);if(void 0!==i){var n=i.indexOf(e);if(i.splice(n,1),!1===this.digraph){n=0;for(var o=(i=this._edges.get(e.to)).length;n<o;n++){var s=i[n];if(s.to===e.from){e=i.indexOf(s),i.splice(e,1);break}}}}return this},W.prototype.hasNode=function(e){return this._nodes.has(e)},W.prototype.hasEdge=function(e,i){if(this.hasNode(e)&&this.hasNode(i))for(var n=0,o=(e=this._edges.get(e)).length;n<o;n++)if(e[n].to===i)return!0;return!1},W.prototype.clear=function(){return this._nodes.clear(),this._edges.clear(),this},W.prototype.toJSON=function(){for(var e={type:this.constructor.name,digraph:this.digraph},i=[],n=[],o=$jscomp.makeIterator(this._nodes.entries()),s=o.next();!s.done;s=o.next()){var h=(s=$jscomp.makeIterator(s.value)).next().value;s=s.next().value;var u=[];this.getEdgesOfNode(h,u),h=0;for(var l=u.length;h<l;h++)i.push(u[h].toJSON());n.push(s.toJSON())}return e._edges=i,e._nodes=n,e},W.prototype.fromJSON=function(e){this.digraph=e.digraph;for(var i=0,n=e._nodes.length;i<n;i++)this.addNode((new wb).fromJSON(e._nodes[i]));for(i=0,n=e._edges.length;i<n;i++)this.addEdge((new Aa).fromJSON(e._edges[i]));return this};var bd=function(){};bd.calculate=function(e,i,n){return i=e.getNode(i),e=e.getNode(n),i.position.distanceTo(e.position)};var Zd=function(){};Zd.calculate=function(e,i,n){return i=e.getNode(i),e=e.getNode(n),i.position.squaredDistanceTo(e.position)};var $d=function(){};$d.calculate=function(e,i,n){return i=e.getNode(i),e=e.getNode(n),i.position.manhattanDistanceTo(e.position)};var ae=function(){};ae.calculate=function(){return 0};var La=function(e){e=void 0===e?q:e,this.data=[],this.length=0,this.compare=e};La.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},La.prototype.pop=function(){if(0===this.length)return null;var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e},La.prototype.peek=function(){return this.data[0]||null},La.prototype._up=function(e){for(var i=this.data,n=this.compare,o=i[e];0<e;){var s=e-1>>1,h=i[s];if(0<=n(o,h))break;i[e]=h,e=s}i[e]=o},La.prototype._down=function(e){for(var i=this.data,n=this.compare,o=i[e],s=this.length>>1;e<s;){var h=1+(e<<1),u=h+1,l=i[h];if(u<this.length&&0>n(i[u],l)&&(h=u,l=i[u]),0<=n(l,o))break;i[e]=l,e=h}i[e]=o};var xb=function(e,i,n){this.graph=void 0===e?null:e,this.source=void 0===i?-1:i,this.target=void 0===n?-1:n,this.found=!1,this.heuristic=bd,this._cost=new Map,this._shortestPathTree=new Map,this._searchFrontier=new Map};xb.prototype.search=function(){var e=[],i=new La(t);for(i.push({cost:0,index:this.source});0<i.length;){var n=i.pop().index;if(!this._shortestPathTree.has(n)){if(!0===this._searchFrontier.has(n)&&this._shortestPathTree.set(n,this._searchFrontier.get(n)),n===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(n,e);for(var o=0,s=e.length;o<s;o++){var h=e[o],u=(this._cost.get(n)||0)+h.cost,l=this.heuristic.calculate(this.graph,h.to,this.target);l=u+l,(!1===this._searchFrontier.has(h.to)||u<this._cost.get(h.to))&&(this._cost.set(h.to,u),this._searchFrontier.set(h.to,h),i.push({cost:l,index:h.to}))}}}return this.found=!1,this},xb.prototype.getPath=function(){var e=[];if(!1===this.found||-1===this.target)return e;var i=this.target;for(e.push(i);i!==this.source;)i=this._shortestPathTree.get(i).from,e.unshift(i);return e},xb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))},xb.prototype.clear=function(){return this.found=!1,this._cost.clear(),this._shortestPathTree.clear(),this._searchFrontier.clear(),this};var Pb=function(e,i,n){this.graph=void 0===e?null:e,this.source=void 0===i?-1:i,this.target=void 0===n?-1:n,this.found=!1,this._route=new Map,this._visited=new Set,this._spanningTree=new Set};Pb.prototype.search=function(){var e=[],i=[],n=new Aa(this.source,this.source);for(e.push(n),this._visited.add(this.source);0<e.length;){var o=e.shift();if(this._route.set(o.to,o.from),o!==n&&this._spanningTree.add(o),o.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(o.to,i),o=0;for(var s=i.length;o<s;o++){var h=i[o];!1===this._visited.has(h.to)&&(e.push(h),this._visited.add(h.to))}}return this.found=!1,this},Pb.prototype.getPath=function(){var e=[];if(!1===this.found||-1===this.target)return e;var i=this.target;for(e.push(i);i!==this.source;)i=this._route.get(i),e.unshift(i);return e},Pb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))},Pb.prototype.clear=function(){return this.found=!1,this._route.clear(),this._visited.clear(),this._spanningTree.clear(),this};var Qb=function(e,i,n){this.graph=void 0===e?null:e,this.source=void 0===i?-1:i,this.target=void 0===n?-1:n,this.found=!1,this._route=new Map,this._visited=new Set,this._spanningTree=new Set};Qb.prototype.search=function(){var e=[],i=[],n=new Aa(this.source,this.source);for(e.push(n);0<e.length;){var o=e.pop();if(this._route.set(o.to,o.from),this._visited.add(o.to),o!==n&&this._spanningTree.add(o),o.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(o.to,i),o=0;for(var s=i.length;o<s;o++){var h=i[o];!1===this._visited.has(h.to)&&e.push(h)}}return this.found=!1,this},Qb.prototype.getPath=function(){var e=[];if(!1===this.found||-1===this.target)return e;var i=this.target;for(e.push(i);i!==this.source;)i=this._route.get(i),e.unshift(i);return e},Qb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))},Qb.prototype.clear=function(){return this.found=!1,this._route.clear(),this._visited.clear(),this._spanningTree.clear(),this};var Rb=function(e,i,n){this.graph=void 0===e?null:e,this.source=void 0===i?-1:i,this.target=void 0===n?-1:n,this.found=!1,this._cost=new Map,this._shortestPathTree=new Map,this._searchFrontier=new Map};Rb.prototype.search=function(){var e=[],i=new La(m);for(i.push({cost:0,index:this.source});0<i.length;){var n=i.pop().index;if(!this._shortestPathTree.has(n)){if(!0===this._searchFrontier.has(n)&&this._shortestPathTree.set(n,this._searchFrontier.get(n)),n===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(n,e);for(var o=0,s=e.length;o<s;o++){var h=e[o],u=(this._cost.get(n)||0)+h.cost;(!1===this._searchFrontier.has(h.to)||u<this._cost.get(h.to))&&(this._cost.set(h.to,u),this._searchFrontier.set(h.to,h),i.push({cost:u,index:h.to}))}}}return this.found=!1,this},Rb.prototype.getPath=function(){var e=[];if(!1===this.found||-1===this.target)return e;var i=this.target;for(e.push(i);i!==this.source;)i=this._shortestPathTree.get(i).from,e.unshift(i);return e},Rb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))},Rb.prototype.clear=function(){return this.found=!1,this._cost.clear(),this._shortestPathTree.clear(),this._searchFrontier.clear(),this};var ye=new f,ge=new f,ve=new f,me=new f(1,0,0),xe=new f(0,1,0),Se=new f(0,0,1),be={a:new f,b:new f,c:new f},_e=new f,ze=[],cd=function(e,i,n){this.branchingFactor=void 0===e?2:e,this.primitivesPerNode=void 0===i?1:i,this.depth=void 0===n?10:n,this.root=null};cd.prototype.fromMeshGeometry=function(e){this.root=new ka,e=e.toTriangleSoup().vertices,this.root.primitives.push.apply(this.root.primitives,$jscomp.arrayFromIterable(e));for(var i=0,n=(e=this.root.primitives).length;i<n;i+=9)ye.fromArray(e,i),ge.fromArray(e,i+3),ve.fromArray(e,i+6),ye.add(ge).add(ve).divideScalar(3),this.root.centroids.push(ye.x,ye.y,ye.z);return this.root.build(this.branchingFactor,this.primitivesPerNode,this.depth,1),this},cd.prototype.traverse=function(e){return this.root.traverse(e),this};var ka=function(){this.parent=null,this.children=[],this.boundingVolume=new E,this.primitives=[],this.centroids=[]};ka.prototype.root=function(){return null===this.parent},ka.prototype.leaf=function(){return 0===this.children.length},ka.prototype.getDepth=function(){for(var e=0,i=this.parent;null!==i;)i=i.parent,e++;return e},ka.prototype.traverse=function(e){e(this);for(var i=0,n=this.children.length;i<n;i++)this.children[i].traverse(e);return this},ka.prototype.build=function(e,i,n,o){this.computeBoundingVolume();var s=Math.floor(this.primitives.length/9/e);if(o<=n&&s>=i)for(this.split(e),s=0;s<e;s++)this.children[s].build(e,i,n,o+1);return this},ka.prototype.computeBoundingVolume=function(){var e=this.primitives,i=this.boundingVolume;i.min.set(1/0,1/0,1/0),i.max.set(-1/0,-1/0,-1/0);for(var n=0,o=e.length;n<o;n+=3)ye.x=e[n],ye.y=e[n+1],ye.z=e[n+2],i.expand(ye);return this},ka.prototype.computeSplitAxis=function(){for(var e,i,n,o,s=i=e=-1/0,h=o=n=1/0,u=this.centroids,l=0,v=u.length;l<v;l+=3){var S=u[l],_=u[l+1],z=u[l+2];S>e&&(e=S),_>i&&(i=_),z>s&&(s=z),S<n&&(n=S),_<o&&(o=_),z<h&&(h=z)}return s-=h,(e-=n)>(i-=o)&&e>s?me:i>s?xe:Se},ka.prototype.split=function(e){for(var i=this.centroids,n=this.primitives,o=0;o<e;o++)this.children[o]=new ka,this.children[o].parent=this;var s=this.computeSplitAxis();o=[];for(var h=0,u=i.length;h<u;h+=3){ye.fromArray(i,h);var l=ye.dot(s);o.push({index:h/3,p:l})}o.sort(xa),s=o.length,h=Math.floor(s/e);for(var v=l=u=0;v<s;v++){++l>h&&u<e-1&&(l=1,u++);var S=this.children[u],_=o[v].index,z=9*_;ye.fromArray(n,z),ge.fromArray(n,z+3),ve.fromArray(n,z+6),S.primitives.push(ye.x,ye.y,ye.z),S.primitives.push(ge.x,ge.y,ge.z),S.primitives.push(ve.x,ve.y,ve.z),ye.fromArray(i,3*_),S.centroids.push(ye.x,ye.y,ye.z)}return this.centroids.length=0,this.primitives.length=0,this},ka.prototype.intersectRay=function(e,i){if(null!==e.intersectAABB(this.boundingVolume,i))if(!0===this.leaf())for(var n=this.primitives,o=0,s=n.length;o<s;o+=9)be.a.fromArray(n,o),be.b.fromArray(n,o+3),be.c.fromArray(n,o+6),null!==e.intersectTriangle(be,!0,i)&&ze.push(i.clone());else for(n=0,o=this.children.length;n<o;n++)this.children[n].intersectRay(e,i);if(!0===this.root()&&0<ze.length){for(n=1/0,o=0,s=ze.length;o<s;o++){var h=e.origin.squaredDistanceTo(ze[o]);h<n&&(n=h,i.copy(ze[o]))}return ze.length=0,i}return null},ka.prototype.intersectsRay=function(e){if(null!==e.intersectAABB(this.boundingVolume,_e))if(!0===this.leaf()){for(var i=this.primitives,n=0,o=i.length;n<o;n+=9)if(be.a.fromArray(i,n),be.b.fromArray(i,n+3),be.c.fromArray(i,n+6),null!==e.intersectTriangle(be,!0,_e))return!0}else for(i=0,n=this.children.length;i<n;i++)if(!0===this.children[i].intersectsRay(e))return!0;return!1};var Me=new f,Oe=new f,la=function(e,i){e=void 0===e?new f:e,i=void 0===i?new f:i,this.from=e,this.to=i};la.prototype.set=function(e,i){return this.from=e,this.to=i,this},la.prototype.copy=function(e){return this.from.copy(e.from),this.to.copy(e.to),this},la.prototype.clone=function(){return(new this.constructor).copy(this)},la.prototype.delta=function(e){return e.subVectors(this.to,this.from)},la.prototype.at=function(e,i){return this.delta(i).multiplyScalar(e).add(this.from)},la.prototype.closestPointToPoint=function(e,i,n){return e=this.closestPointToPointParameter(e,i),this.at(e,n)},la.prototype.closestPointToPointParameter=function(e,i){return i=void 0===i||i,Me.subVectors(e,this.from),Oe.subVectors(this.to,this.from),e=Oe.dot(Oe),e=Oe.dot(Me)/e,i&&(e=M.clamp(e,0,1)),e},la.prototype.equals=function(e){return e.from.equals(this.from)&&e.to.equals(this.to)};var Ne=new f,Ee=new f,Fe=new f,Te=new f,Ae=new f,Pe=new f,Re=new f,Na=function(){};Na.prototype.intersects=function(e,i){return!(this._checkFaceDirections(e,i)||this._checkFaceDirections(i,e)||this._checkEdgeDirections(e,i))},Na.prototype._checkFaceDirections=function(e,i){for(var n=0,o=(e=e.faces).length;n<o;n++){var s=e[n].plane;Ee.copy(s.normal).multiplyScalar(-1);var h=this._getSupportVertex(i,Ee);if(0<s.distanceToPoint(h))return!0}return!1},Na.prototype._checkEdgeDirections=function(e,i){var n=e.edges;i=i.edges;for(var o=0,s=n.length;o<s;o++)for(var h=n[o],u=0,l=i.length;u<l;u++){var v=i[u];if(h.getDirection(Fe),v.getDirection(Te),this._minkowskiFace(h,Fe,v,Te)&&0<this._distanceBetweenEdges(h,Fe,v,Te,e))return!0}return!1},Na.prototype._getSupportVertex=function(e,i){for(var n=-1/0,o=null,s=0,h=(e=e.vertices).length;s<h;s++){var u=e[s],l=u.dot(i);l>n&&(n=l,o=u)}return o},Na.prototype._minkowskiFace=function(e,i,n,o){var s=e.polygon.plane.normal;return e=e.twin.polygon.plane.normal,Ae.copy(n.polygon.plane.normal),Pe.copy(n.twin.polygon.plane.normal),Ae.multiplyScalar(-1),Pe.multiplyScalar(-1),n=Ae.dot(i),i=Pe.dot(i),s=s.dot(o),o=e.dot(o),0>n*i&&0>s*o&&0<n*o},Na.prototype._distanceBetweenEdges=function(e,i,n,o,s){return 1===Math.abs(i.dot(o))?-1/0:(Ne.crossVectors(i,o).normalize(),0>Ne.dot(Re.subVectors(e.vertex,s.centroid))&&Ne.multiplyScalar(-1),Ne.dot(Re.subVectors(n.vertex,e.vertex)))};var Oa=function(e){this.vertex=e=void 0===e?new f:e,this.polygon=this.twin=this.prev=this.next=null};Oa.prototype.tail=function(){return this.prev?this.prev.vertex:null},Oa.prototype.head=function(){return this.vertex},Oa.prototype.length=function(){var e=this.tail(),i=this.head();return null!==e?e.distanceTo(i):-1},Oa.prototype.squaredLength=function(){var e=this.tail(),i=this.head();return null!==e?e.squaredDistanceTo(i):-1},Oa.prototype.linkOpponent=function(e){return this.twin=e,e.twin=this,this},Oa.prototype.getDirection=function(e){return e.subVectors(this.vertex,this.prev.vertex).normalize()};var V=function(){this.centroid=new f,this.edge=null,this.plane=new ea};V.prototype.fromContour=function(e){var i=[];if(3>e.length)return y.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var n=0,o=e.length;n<o;n++){var s=new Oa(e[n]);i.push(s)}for(n=0,o=i.length;n<o;n++){if(0===n){s=i[n];var h=i[o-1],u=i[n+1]}else n===o-1?(s=i[n],h=i[n-1],u=i[0]):(s=i[n],h=i[n-1],u=i[n+1]);s.prev=h,s.next=u,s.polygon=this}return this.edge=i[0],this.plane.fromCoplanarPoints(e[0],e[1],e[2]),this},V.prototype.computeCentroid=function(){var e=this.centroid,i=this.edge,n=0;e.set(0,0,0);do{e.add(i.vertex),n++,i=i.next}while(i!==this.edge);return e.divideScalar(n),this},V.prototype.contains=function(e,i){i=void 0===i?.001:i;var n=this.plane,o=this.edge;do{var s=o.tail(),h=o.head();if(!1==0<=M.area(s,h,e))return!1;o=o.next}while(o!==this.edge);return e=n.distanceToPoint(e),!(Math.abs(e)>i)},V.prototype.convex=function(e){e=void 0===e||e;var i=this.edge;do{var n=i.tail(),o=i.head(),s=i.next.head();if(e){if(!1==0<=M.area(n,o,s))return!1}else if(!1==0<=M.area(s,o,n))return!1;i=i.next}while(i!==this.edge);return!0},V.prototype.coplanar=function(e){e=void 0===e?.001:e;var i=this.plane,n=this.edge;do{var o=i.distanceToPoint(n.vertex);if(Math.abs(o)>e)return!1;n=n.next}while(n!==this.edge);return!0},V.prototype.distanceToPoint=function(e){return this.plane.distanceToPoint(e)},V.prototype.getContour=function(e){var i=this.edge;e.length=0;do{e.push(i.vertex),i=i.next}while(i!==this.edge);return e},V.prototype.getEdgeTo=function(e){var i=this.edge;do{if(null!==i.twin&&i.twin.polygon===e)return i;i=i.next}while(i!==this.edge);return null};var Pa=function(){this.faces=[],this.edges=[],this.vertices=[],this.centroid=new f};Pa.prototype.computeCentroid=function(){var e=this.centroid,i=this.faces;e.set(0,0,0);for(var n=0,o=i.length;n<o;n++)e.add(i[n].centroid);return e.divideScalar(i.length),this},Pa.prototype.computeUniqueVertices=function(){var e=this.faces,i=this.vertices;i.length=0;for(var n=new Set,o=0,s=e.length;o<s;o++){var h=e[o],u=h.edge;do{n.add(u.vertex),u=u.next}while(u!==h.edge)}return i.push.apply(i,$jscomp.arrayFromIterable(n)),this},Pa.prototype.computeUniqueEdges=function(){for(var e=this.faces,i=this.edges,n=i.length=0,o=e.length;n<o;n++){var s=e[n],h=s.edge;do{!1===i.includes(h.twin)&&i.push(h),h=h.next}while(h!==s.edge)}return this},Pa.prototype.fromAABB=function(e){this.faces.length=0,this.vertices.length=0;var i=e.min,n=e.max,o=[new f(n.x,n.y,n.z),new f(n.x,n.y,i.z),new f(n.x,i.y,n.z),new f(n.x,i.y,i.z),new f(i.x,n.y,n.z),new f(i.x,n.y,i.z),new f(i.x,i.y,n.z),new f(i.x,i.y,i.z)];this.vertices.push.apply(this.vertices,$jscomp.arrayFromIterable(o)),i=(new V).fromContour([o[4],o[0],o[1],o[5]]),n=(new V).fromContour([o[2],o[3],o[1],o[0]]);var s=(new V).fromContour([o[6],o[2],o[0],o[4]]),h=(new V).fromContour([o[3],o[7],o[5],o[1]]),u=(new V).fromContour([o[3],o[2],o[6],o[7]]);return o=(new V).fromContour([o[7],o[6],o[4],o[5]]),i.edge.linkOpponent(o.edge.prev),i.edge.next.linkOpponent(s.edge.prev),i.edge.next.next.linkOpponent(n.edge.prev),i.edge.prev.linkOpponent(h.edge.prev),u.edge.linkOpponent(h.edge.next),u.edge.next.linkOpponent(n.edge.next),u.edge.next.next.linkOpponent(s.edge.next),u.edge.prev.linkOpponent(o.edge.next),o.edge.linkOpponent(h.edge.next.next),h.edge.linkOpponent(n.edge.next.next),n.edge.linkOpponent(s.edge.next.next),s.edge.linkOpponent(o.edge.next.next),this.faces.push(i,n,s,h,u,o),i.computeCentroid(),n.computeCentroid(),s.computeCentroid(),h.computeCentroid(),u.computeCentroid(),o.computeCentroid(),e.getCenter(this.centroid),this.computeUniqueEdges(),this};var je,De=new la,ke=new ea,Je=new f,Ce=new f(0,1,0),$e=new Na,N=function(){var e=Pa.call(this)||this;return e._tolerance=-1,e._vertices=[],e._assigned=new pa,e._unassigned=new pa,e._newFaces=[],e};$jscomp.inherits(N,Pa),N.prototype.containsPoint=function(e){for(var i=this.faces,n=0,o=i.length;n<o;n++)if(i[n].distanceToPoint(e)>this._tolerance)return!1;return!0},N.prototype.intersectsAABB=function(e){if(void 0===je)je=(new Pa).fromAABB(e);else{var i=e.min,n=e.max,o=je.vertices;o[0].set(n.x,n.y,n.z),o[1].set(n.x,n.y,i.z),o[2].set(n.x,i.y,n.z),o[3].set(n.x,i.y,i.z),o[4].set(i.x,n.y,n.z),o[5].set(i.x,n.y,i.z),o[6].set(i.x,i.y,n.z),o[7].set(i.x,i.y,i.z),e.getCenter(je.centroid)}return $e.intersects(this,je)},N.prototype.intersectsConvexHull=function(e){return $e.intersects(this,e)},N.prototype.fromPoints=function(e){if(4>e.length)return y.error("YUKA.ConvexHull: The given points array needs at least four points."),this;for(var i=0,n=e.length;i<n;i++)this._vertices.push(new ie(e[i]));return this._generate(),this},N.prototype._addAdjoiningFace=function(e,i){return e=new qa(e.point,i.prev.vertex,i.vertex),this.faces.push(e),e.getEdge(-1).linkOpponent(i.twin),e.getEdge(0)},N.prototype._addNewFaces=function(e,i){this._newFaces=[];for(var n=null,o=null,s=0,h=i.length;s<h;s++){var u=this._addAdjoiningFace(e,i[s]);null===n?n=u:u.next.linkOpponent(o),this._newFaces.push(u.polygon),o=u}return n.next.linkOpponent(o),this},N.prototype._addVertexToFace=function(e,i){return e.face=i,null===i.outside?(this._assigned.append(e),i.outside=e):this._assigned.insertAfter(i.outside,e),this},N.prototype._addVertexToHull=function(e){var i=[];return this._unassigned.clear(),this._computeHorizon(e.point,null,e.face,i),this._addNewFaces(e,i),this._resolveUnassignedPoints(this._newFaces),this},N.prototype._reset=function(){return this._vertices.length=0,this._assigned.clear(),this._unassigned.clear(),this._newFaces.length=0,this},N.prototype._computeInitialHull=function(){var e=this._vertices,i=this._computeExtremes(),n=i.min,o=i.max,s=o.x.point.x-n.x.point.x;i=n.x;var h=o.x,u=o.y.point.y-n.y.point.y;for(u>s&&(i=n.y,h=o.y,s=u),(u=o.z.point.z-n.z.point.z)>s&&(i=n.z,h=o.z),s=-1/0,De.set(i.point,h.point),n=0,o=e.length;n<o;n++){var l=e[n];if(l!==i&&l!==h&&(De.closestPointToPoint(l.point,!0,Je),(u=Je.squaredDistanceTo(l.point))>s)){s=u;var v=l}}for(s=-1/0,ke.fromCoplanarPoints(i.point,h.point,v.point),n=0,o=e.length;n<o;n++)if((l=e[n])!==i&&l!==h&&l!==v&&(u=Math.abs(ke.distanceToPoint(l.point)))>s){s=u;var S=l}if(0===ke.distanceToPoint(S.point))throw"ERROR: YUKA.ConvexHull: All extreme points lie in a single plane. Unable to compute convex hull.";for(n=this.faces,0>ke.distanceToPoint(S.point)?(n.push(new qa(i.point,h.point,v.point),new qa(S.point,h.point,i.point),new qa(S.point,v.point,h.point),new qa(S.point,i.point,v.point)),n[1].getEdge(2).linkOpponent(n[0].getEdge(1)),n[2].getEdge(2).linkOpponent(n[0].getEdge(2)),n[3].getEdge(2).linkOpponent(n[0].getEdge(0)),n[1].getEdge(1).linkOpponent(n[2].getEdge(0)),n[2].getEdge(1).linkOpponent(n[3].getEdge(0)),n[3].getEdge(1).linkOpponent(n[1].getEdge(0))):(n.push(new qa(i.point,v.point,h.point),new qa(S.point,i.point,h.point),new qa(S.point,h.point,v.point),new qa(S.point,v.point,i.point)),n[1].getEdge(2).linkOpponent(n[0].getEdge(0)),n[2].getEdge(2).linkOpponent(n[0].getEdge(2)),n[3].getEdge(2).linkOpponent(n[0].getEdge(1)),n[1].getEdge(0).linkOpponent(n[2].getEdge(1)),n[2].getEdge(0).linkOpponent(n[3].getEdge(1)),n[3].getEdge(0).linkOpponent(n[1].getEdge(1))),o=0,l=e.length;o<l;o++){var _=e[o];if(_!==i&&_!==h&&_!==v&&_!==S){s=this._tolerance;for(var z=null,O=0;4>O;O++)(u=n[O].distanceToPoint(_.point))>s&&(s=u,z=n[O]);null!==z&&this._addVertexToFace(_,z)}}return this},N.prototype._computeExtremes=function(){for(var e=new f(1/0,1/0,1/0),i=new f(-1/0,-1/0,-1/0),n={x:null,y:null,z:null},o={x:null,y:null,z:null},s=0,h=this._vertices.length;s<h;s++){var u=this._vertices[s],l=u.point;l.x<e.x&&(e.x=l.x,n.x=u),l.y<e.y&&(e.y=l.y,n.y=u),l.z<e.z&&(e.z=l.z,n.z=u),l.x>i.x&&(i.x=l.x,o.x=u),l.y>i.y&&(i.y=l.y,o.y=u),l.z>i.z&&(i.z=l.z,o.z=u)}return this._tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(i.x))+Math.max(Math.abs(e.y),Math.abs(i.y))+Math.max(Math.abs(e.z),Math.abs(i.z))),{min:n,max:o}},N.prototype._computeHorizon=function(e,i,n,o){if(n.outside){var s=n.outside;this._removeAllVerticesFromFace(n),this._unassigned.appendChain(s)}n.active=!1,n=null===i?i=n.getEdge(0):i.next;do{var h=(s=n.twin).polygon;h.active&&(h.distanceToPoint(e)>this._tolerance?this._computeHorizon(e,s,h,o):o.push(n)),n=n.next}while(n!==i);return this},N.prototype._generate=function(){this.faces.length=0,this._computeInitialHull();for(var e;e=this._nextVertexToAdd();)this._addVertexToHull(e);return this._updateFaces(),this._mergeFaces(),this._reset(),this},N.prototype._mergeFaces=function(){var e=this.faces,i=this.edges;if(this.computeUniqueEdges(),!this.skipMergeFaces){i.sort((function(e,i){return i.length()-e.length()}));for(var n=0,o=i.length;n<o;n++){var s=i[n];if(this.skipMergePossible||!1!==this._mergePossible(s)){var h=s,u=h.prev,l=h.next,v=h.twin.prev,S=h.twin.next;h.prev.next=h.twin.next,h.next.prev=h.twin.prev,h.twin.prev.next=h.next,h.twin.next.prev=h.prev;var _=h.polygon;_.edge=h.prev;var z=0<=_.plane.normal.dot(Ce);if(!0===_.convex(z)&&!0===_.coplanar(this._tolerance)){u=_.edge;do{u.polygon=_,u=u.next}while(u!==_.edge);s=e.indexOf(s.twin.polygon),e.splice(s,1)}else u.next=h,l.prev=h,v.next=h.twin,S.prev=h.twin,_.edge=h}}}for(i=0,n=e.length;i<n;i++)e[i].computeCentroid();return this.computeCentroid(),this.computeUniqueEdges(),this.computeUniqueVertices(),this},N.prototype._mergePossible=function(e){var i=e.polygon,n=e.twin;do{if(n!==e.twin&&n.twin.polygon===i)return!1;n=n.next}while(e.twin!==n);return!0},N.prototype._nextVertexToAdd=function(){var e=null;if(!1===this._assigned.empty()){var i=0,n=this._assigned.first(),o=n.face;do{var s=o.distanceToPoint(n.point);s>i&&(i=s,e=n),n=n.next}while(null!==n&&n.face===o)}return e},N.prototype._updateFaces=function(){for(var e=this.faces,i=[],n=0,o=e.length;n<o;n++){var s=e[n];s.active&&i.push(s)}return this.faces.length=0,this.faces.push.apply(this.faces,$jscomp.arrayFromIterable(i)),this},N.prototype._removeAllVerticesFromFace=function(e){if(null!==e.outside){var i=e.outside;i.face=null;for(var n=e.outside;null!==n.next&&n.next.face===e;)(n=n.next).face=null;e.outside=null,this._assigned.removeChain(i,n)}return this},N.prototype._removeVertexFromFace=function(e,i){return e.face=null,e===i.outside&&(i.outside=null!==e.next&&e.next.face===i?e.next:null),this._assigned.remove(e),this},N.prototype._resolveUnassignedPoints=function(e){if(!1===this._unassigned.empty()){var i=this._unassigned.first();do{for(var n=i.next,o=this._tolerance,s=null,h=0,u=e.length;h<u;h++){var l=e[h];if(l.active){var v=l.distanceToPoint(i.point);v>o&&(o=v,s=l)}}null!==s&&this._addVertexToFace(i,s),i=n}while(null!==i)}return this};var qa=function(e,i,n){e=void 0===e?new f:e,i=void 0===i?new f:i,n=void 0===n?new f:n;var o=V.call(this)||this;return o.outside=null,o.active=!0,o.fromContour([e,i,n]),o.computeCentroid(),o};$jscomp.inherits(qa,V),qa.prototype.getEdge=function(e){for(var i=this.edge;0<e;)i=i.next,e--;for(;0>e;)i=i.prev,e++;return i};var ie=function(e){this.point=e=void 0===e?new f:e,this.face=this.next=this.prev=null},pa=function(){this.tail=this.head=null};pa.prototype.first=function(){return this.head},pa.prototype.last=function(){return this.tail},pa.prototype.clear=function(){return this.head=this.tail=null,this},pa.prototype.insertAfter=function(e,i){return i.prev=e,i.next=e.next,i.next?i.next.prev=i:this.tail=i,e.next=i,this},pa.prototype.append=function(e){return null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this},pa.prototype.appendChain=function(e){for(null===this.head?this.head=e:this.tail.next=e,e.prev=this.tail;null!==e.next;)e=e.next;return this.tail=e,this},pa.prototype.remove=function(e){return null===e.prev?this.head=e.next:e.prev.next=e.next,null===e.next?this.tail=e.prev:e.next.prev=e.prev,e.prev=null,e.next=null,this},pa.prototype.removeChain=function(e,i){return null===e.prev?this.head=i.next:e.prev.next=i.next,null===i.next?this.tail=e.prev:i.next.prev=e.prev,e.prev=null,i.next=null,this},pa.prototype.empty=function(){return null===this.head};var Ie={unitary:new C,diagonal:new C},Ve=null,Be=[new f,new f,new f],qe=[],Le=null,Ue=[new f,new f,new f],Ye=[],He=[[],[],[]],We=[[],[],[]],Ke=[],Ge=new f,Xe=new f,Ze=new f,Qe=new f,tr=new f,Z=function(e,i,n){e=void 0===e?new f:e,i=void 0===i?new f:i,n=void 0===n?new C:n,this.center=e,this.halfSizes=i,this.rotation=n};Z.prototype.set=function(e,i,n){return this.center=e,this.halfSizes=i,this.rotation=n,this},Z.prototype.copy=function(e){return this.center.copy(e.center),this.halfSizes.copy(e.halfSizes),this.rotation.copy(e.rotation),this},Z.prototype.clone=function(){return(new this.constructor).copy(this)},Z.prototype.getSize=function(e){return e.copy(this.halfSizes).multiplyScalar(2)},Z.prototype.clampPoint=function(e,i){var n=this.halfSizes;return Qe.subVectors(e,this.center),this.rotation.extractBasis(Ge,Xe,Ze),i.copy(this.center),e=M.clamp(Qe.dot(Ge),-n.x,n.x),i.add(Ge.multiplyScalar(e)),e=M.clamp(Qe.dot(Xe),-n.y,n.y),i.add(Xe.multiplyScalar(e)),n=M.clamp(Qe.dot(Ze),-n.z,n.z),i.add(Ze.multiplyScalar(n)),i},Z.prototype.containsPoint=function(e){return Qe.subVectors(e,this.center),this.rotation.extractBasis(Ge,Xe,Ze),Math.abs(Qe.dot(Ge))<=this.halfSizes.x&&Math.abs(Qe.dot(Xe))<=this.halfSizes.y&&Math.abs(Qe.dot(Ze))<=this.halfSizes.z},Z.prototype.intersectsAABB=function(e){return this.intersectsOBB(er.fromAABB(e))},Z.prototype.intersectsBoundingSphere=function(e){return this.clampPoint(e.center,tr),tr.squaredDistanceTo(e.center)<=e.radius*e.radius},Z.prototype.intersectsOBB=function(e,i){for(i=void 0===i?Number.EPSILON:i,Ve=this.center,qe[0]=this.halfSizes.x,qe[1]=this.halfSizes.y,qe[2]=this.halfSizes.z,this.rotation.extractBasis(Be[0],Be[1],Be[2]),Le=e.center,Ye[0]=e.halfSizes.x,Ye[1]=e.halfSizes.y,Ye[2]=e.halfSizes.z,e.rotation.extractBasis(Ue[0],Ue[1],Ue[2]),e=0;3>e;e++)for(var n=0;3>n;n++)He[e][n]=Be[e].dot(Ue[n]);for(Qe.subVectors(Le,Ve),Ke[0]=Qe.dot(Be[0]),Ke[1]=Qe.dot(Be[1]),Ke[2]=Qe.dot(Be[2]),e=0;3>e;e++)for(n=0;3>n;n++)We[e][n]=Math.abs(He[e][n])+i;for(n=0;3>n;n++)if(i=qe[n],e=Ye[0]*We[n][0]+Ye[1]*We[n][1]+Ye[2]*We[n][2],Math.abs(Ke[n])>i+e)return!1;for(n=0;3>n;n++)if(i=qe[0]*We[0][n]+qe[1]*We[1][n]+qe[2]*We[2][n],e=Ye[n],Math.abs(Ke[0]*He[0][n]+Ke[1]*He[1][n]+Ke[2]*He[2][n])>i+e)return!1;return i=qe[1]*We[2][0]+qe[2]*We[1][0],e=Ye[1]*We[0][2]+Ye[2]*We[0][1],!(Math.abs(Ke[2]*He[1][0]-Ke[1]*He[2][0])>i+e)&&(i=qe[1]*We[2][1]+qe[2]*We[1][1],e=Ye[0]*We[0][2]+Ye[2]*We[0][0],!(Math.abs(Ke[2]*He[1][1]-Ke[1]*He[2][1])>i+e)&&(i=qe[1]*We[2][2]+qe[2]*We[1][2],e=Ye[0]*We[0][1]+Ye[1]*We[0][0],!(Math.abs(Ke[2]*He[1][2]-Ke[1]*He[2][2])>i+e)&&(i=qe[0]*We[2][0]+qe[2]*We[0][0],e=Ye[1]*We[1][2]+Ye[2]*We[1][1],!(Math.abs(Ke[0]*He[2][0]-Ke[2]*He[0][0])>i+e)&&(i=qe[0]*We[2][1]+qe[2]*We[0][1],e=Ye[0]*We[1][2]+Ye[2]*We[1][0],!(Math.abs(Ke[0]*He[2][1]-Ke[2]*He[0][1])>i+e)&&(i=qe[0]*We[2][2]+qe[2]*We[0][2],e=Ye[0]*We[1][1]+Ye[1]*We[1][0],!(Math.abs(Ke[0]*He[2][2]-Ke[2]*He[0][2])>i+e)&&(i=qe[0]*We[1][0]+qe[1]*We[0][0],e=Ye[1]*We[2][2]+Ye[2]*We[2][1],!(Math.abs(Ke[1]*He[0][0]-Ke[0]*He[1][0])>i+e)&&(i=qe[0]*We[1][1]+qe[1]*We[0][1],e=Ye[0]*We[2][2]+Ye[2]*We[2][0],!(Math.abs(Ke[1]*He[0][1]-Ke[0]*He[1][1])>i+e)&&(i=qe[0]*We[1][2]+qe[1]*We[0][2],e=Ye[0]*We[2][1]+Ye[1]*We[2][0],!(Math.abs(Ke[1]*He[0][2]-Ke[0]*He[1][2])>i+e)))))))))},Z.prototype.intersectsPlane=function(e){this.rotation.extractBasis(Ge,Xe,Ze);var i=this.halfSizes.x*Math.abs(e.normal.dot(Ge))+this.halfSizes.y*Math.abs(e.normal.dot(Xe))+this.halfSizes.z*Math.abs(e.normal.dot(Ze));return e=e.normal.dot(this.center)-e.constant,Math.abs(e)<=i},Z.prototype.fromAABB=function(e){return e.getCenter(this.center),e.getSize(this.halfSizes).multiplyScalar(.5),this.rotation.identity(),this},Z.prototype.fromPoints=function(e){for(var i=(new N).fromPoints(e).faces,n=[],o=[],s=0,h=i.length;s<h;s++){var u=i[s],l=u.edge;n.length=0;do{n.push(l),l=l.next}while(l!==u.edge);for(u=1,l=n.length-2;u<=l;u++){var v=n[0].vertex,S=n[u+0].vertex,_=n[u+1].vertex;o.push(v.x,v.y,v.z),o.push(S.x,S.y,S.z),o.push(_.x,_.y,_.z)}}v=new f,S=new f,_=new f;for(var z=new f,O=new f,A=new f,j=new f,J=new f,$=0,I=i=n=s=h=u=l=0,L=o.length;I<L;I+=9){v.fromArray(o,I),S.fromArray(o,I+3),_.fromArray(o,I+6),j.set(0,0,0),j.add(v).add(S).add(_).divideScalar(3),z.subVectors(S,v),O.subVectors(_,v);var U=A.crossVectors(z,O).length()/2;J.add(A.copy(j).multiplyScalar(U)),$+=U,i+=U/12*(9*j.x*j.x+v.x*v.x+S.x*S.x+_.x*_.x),n+=U/12*(9*j.x*j.y+v.x*v.y+S.x*S.y+_.x*_.y),s+=U/12*(9*j.x*j.z+v.x*v.z+S.x*S.z+_.x*_.z),h+=U/12*(9*j.y*j.y+v.y*v.y+S.y*S.y+_.y*_.y),u+=U/12*(9*j.y*j.z+v.y*v.z+S.y*S.z+_.y*_.z),l+=U/12*(9*j.z*j.z+v.z*v.z+S.z*S.z+_.z*_.z)}for(J.divideScalar($),i=i/$-J.x*J.x,n=n/$-J.x*J.y,s=s/$-J.x*J.z,h=h/$-J.y*J.y,u=u/$-J.y*J.z,l=l/$-J.z*J.z,(o=new C).elements[0]=i,o.elements[1]=n,o.elements[2]=s,o.elements[3]=n,o.elements[4]=h,o.elements[5]=u,o.elements[6]=s,o.elements[7]=u,o.elements[8]=l,o.eigenDecomposition(Ie),o=Ie.unitary,i=new f,n=new f,s=new f,o.extractBasis(i,n,s),l=u=h=-1/0,_=S=v=1/0,z=0,O=e.length;z<O;z++)A=e[z],h=Math.max(i.dot(A),h),u=Math.max(n.dot(A),u),l=Math.max(s.dot(A),l),v=Math.min(i.dot(A),v),S=Math.min(n.dot(A),S),_=Math.min(s.dot(A),_);return i.multiplyScalar(.5*(v+h)),n.multiplyScalar(.5*(S+u)),s.multiplyScalar(.5*(_+l)),this.center.add(i).add(n).add(s),this.halfSizes.x=h-v,this.halfSizes.y=u-S,this.halfSizes.z=l-_,this.halfSizes.multiplyScalar(.5),this.rotation.copy(o),this},Z.prototype.equals=function(e){return e.center.equals(this.center)&&e.halfSizes.equals(this.halfSizes)&&e.rotation.equals(this.rotation)},Z.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),halfSizes:this.halfSizes.toArray([]),rotation:this.rotation.toArray([])}},Z.prototype.fromJSON=function(e){return this.center.fromArray(e.center),this.halfSizes.fromArray(e.halfSizes),this.rotation.fromArray(e.rotation),this};var er=new Z,vc=function(e,i,n){return Aa.call(this,void 0===e?-1:e,void 0===i?-1:i,void 0===n?0:n)||this};$jscomp.inherits(vc,Aa);var wc=function(e,i,n){return e=void 0===e?-1:e,i=void 0===i?new f:i,n=void 0===n?{}:n,(e=wb.call(this,e)||this).position=i,e.userData=n,e};$jscomp.inherits(wc,wb);var ne=function(){};ne.createGridLayout=function(e,i){var n=new W;n.digraph=!0;var o=e/2;e/=i;for(var s=0,h=0;h<=i;h++)for(var u=h*e-o,l=0;l<=i;l++){var v=new f(l*e-o,0,u);v=new wc(s,v),n.addNode(v),s++}for(i=n.getNodeCount(),o=Math.pow(e+e/2,2),e=0;e<i;e++)for(s=n.getNode(e),h=0;h<i;h++)e!==h&&((u=n.getNode(h).position.squaredDistanceTo(s.position))<=o&&(u=new vc(e,h,Math.sqrt(u)),n.addEdge(u)));return n};var xc=function(){this.portalEdges=[]};xc.prototype.push=function(e,i){return this.portalEdges.push({left:e,right:i}),this},xc.prototype.generate=function(){var e=this.portalEdges,i=[],n=0,o=0,s=e[0].left,h=e[0].left,u=e[0].right;i.push(s);for(var l=1,v=e.length;l<v;l++){var S=e[l].left,_=e[l].right;if(0>=M.area(s,u,_)){if(!(s===u||0<M.area(s,h,_))){i.push(h),u=h=s=h,o=n=l=n;continue}u=_,o=l}0<=M.area(s,h,S)&&(s===h||0>M.area(s,u,S)?(h=S,n=l):(i.push(u),u=h=s=u,o=n=l=o))}return 0!==i.length&&i[i.length-1]===e[e.length-1].left||i.push(e[e.length-1].left),i};var Qa=function(){this._nodeMap=new Map};Qa.prototype.init=function(e){var i=e.graph,n=[];this.clear(),i.getNodes(n),i=0;for(var o=n.length;i<o;i++)for(var s=n[i],h=0,u=n.length;h<u;h++){for(var l=n[h],v=e.findPath(s.position,l.position),S=0,_=0,z=v.length-1;_<z;_++)S+=v[_].distanceTo(v[_+1]);this.set(s.index,l.index,S)}return this},Qa.prototype.clear=function(){return this._nodeMap.clear(),this},Qa.prototype.set=function(e,i,n){var o=this._nodeMap;return!1===o.has(e)&&o.set(e,new Map),o.get(e).set(i,n),this},Qa.prototype.get=function(e,i){return this._nodeMap.get(e).get(i)},Qa.prototype.size=function(){return this._nodeMap.size},Qa.prototype.toJSON=function(){for(var e={nodes:[]},i=$jscomp.makeIterator(this._nodeMap.entries()),n=i.next();!n.done;n=i.next()){var o=$jscomp.makeIterator(n.value);n=o.next().value,o=o.next().value,e.nodes.push({index:n,costs:Array.from(o)})}return e},Qa.prototype.fromJSON=function(e){for(var i=0,n=(e=e.nodes).length;i<n;i++){var o=e[i],s=o.index;o=new Map(o.costs),this._nodeMap.set(s,o)}return this};var rr=new f,ir=new f,nr=new f,or=new f,sr=new la,ar=[],hr={edge:null,closestPoint:new f},ca=function(){this.graph=new W,this.attemptBuildGraph=this.attemptMergePolies=this.graph.digraph=!0,this.regions=[],this.spatialIndex=null,this.epsilonCoplanarTest=.001,this.epsilonContainsTest=1,this._borderEdges=[]};ca.prototype.fromPolygons=function(e){this.clear();for(var i=[],n=[],o=0,s=e.length;o<s;o++){var h=e[o],u=h.edge;do{i.push(u),u=u.next}while(u!==h.edge);this.regions.push(h)}for(e=0,o=i.length;e<o;e++)if(null===(s=i[e]).twin)for(h=e+1,u=i.length;h<u;h++){var l=i[h];if(s.tail().equals(l.head())&&s.head().equals(l.tail())){s.linkOpponent(l),h=s.squaredLength(),n.push({cost:h,edge:s});break}}return n.sort(F),this._buildRegions(n),this.attemptBuildGraph&&this._buildGraph(),this},ca.prototype.clear=function(){return this.graph.clear(),this.regions.length=0,this.spatialIndex=null,this},ca.prototype.getClosestRegion=function(e){for(var i=this.regions,n=null,o=1/0,s=0,h=i.length;s<h;s++){var u=i[s],l=e.squaredDistanceTo(u.centroid);l<o&&(o=l,n=u)}return n},ca.prototype.getRandomRegion=function(){var e=this.regions,i=Math.floor(Math.random()*e.length);return i===e.length&&(i=e.length-1),e[i]},ca.prototype.getRegionForPoint=function(e,i){if(i=void 0===i?.001:i,null!==this.spatialIndex){var n=this.spatialIndex.getIndexForPosition(e);if(!(n=this.spatialIndex.cells[n]))return null;n=n.entries}else n=this.regions;for(var o=0,s=n.length;o<s;o++){var h=n[o];if(!0===h.contains(e,i))return h}return null},ca.prototype.getNodeIndex=function(e){return this.regions.indexOf(e)},ca.prototype.findPath=function(e,i){var n=this.graph,o=[],s=this.getRegionForPoint(e,this.epsilonContainsTest),h=this.getRegionForPoint(i,this.epsilonContainsTest);if(null!==s&&null!==h||(null===s&&(s=this.getClosestRegion(e)),null===h&&(h=this.getClosestRegion(i))),s===h)o.push((new f).copy(e)),o.push((new f).copy(i));else if(s=this.getNodeIndex(s),h=this.getNodeIndex(h),(n=new xb(n,s,h)).search(),!0===n.found){n=n.getPath(),(h=new xc).push(e,e),e={left:null,right:null},s=0;for(var u=n.length-1;s<u;s++)this._getPortalEdge(this.regions[n[s]],this.regions[n[s+1]],e),h.push(e.left,e.right);h.push(i,i),o.push.apply(o,$jscomp.arrayFromIterable(h.generate()))}return o},ca.prototype.clampMovement=function(e,i,n,o){var s=this.getRegionForPoint(n,this.epsilonContainsTest);if(null===s){if(null===e)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");this._getClosestBorderEdge(i,hr);var h=hr.closestPoint;(s=hr.edge).getDirection(ir);var u=0;if(0!==(n=nr.subVectors(n,i).length())&&(nr.divideScalar(n),u=ir.dot(nr)),or.copy(h).add(ir.multiplyScalar(u*n)),sr.set(s.prev.vertex,s.vertex),0<=(s=sr.closestPointToPointParameter(or,!1))&&1>=s)o.copy(or);else{if(null!==(s=this.getRegionForPoint(or,this.epsilonContainsTest)))return o.copy(or),s;o.copy(i)}return e}return s},ca.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var e=this.regions,i=0,n=e.length;i<n;i++)this.spatialIndex.addPolygon(e[i])}return this},ca.prototype._buildRegions=function(e){var i=this.regions;if(this.attemptMergePolies)for(var n,o,s,h,u=0,l=e.length;u<l;u++){var v=e[u],S=v.edge;if(!S.twin||!1!==this._mergePossible(S)){n=S.prev,o=S.next,s=S.twin.prev,h=S.twin.next,S.prev.next=S.twin.next,S.next.prev=S.twin.prev,S.twin.prev.next=S.next,S.twin.next.prev=S.prev;var _=S.polygon;if(_.edge=S.prev,!0===_.convex()&&!0===_.coplanar(this.epsilonCoplanarTest)){n=_.edge;do{n.polygon=_,n=n.next}while(n!==_.edge);v=i.indexOf(v.edge.twin.polygon),i.splice(v,1)}else n.next=S,o.prev=S,s.next=S.twin,h.prev=S.twin,_.edge=S}}for(e=0,u=i.length;e<u;e++){(l=i[e]).computeCentroid(),v=l.edge;do{null===v.twin&&this._borderEdges.push(v),v=v.next}while(v!==l.edge)}},ca.prototype._mergePossible=function(e){var i=e.polygon,n=e.twin;do{if(n!==e.twin&&n.twin&&n.twin.polygon===i)return!1;n=n.next}while(e.twin!==n);return!0},ca.prototype._buildGraph=function(){for(var e=this.graph,i=this.regions,n=[],o=0,s=i.length;o<s;o++){var h=i[o],u=[];n.push(u);var l=h.edge;do{if(null!==l.twin){var v=this.getNodeIndex(l.twin.polygon);u.push(v),!1===e.hasNode(this.getNodeIndex(l.polygon))&&(v=new wc(this.getNodeIndex(l.polygon),l.polygon.centroid),e.addNode(v))}l=l.next}while(l!==h.edge)}for(i=0,o=n.length;i<o;i++)for(h=i,u=0,l=(s=n[i]).length;u<l;u++)if(h!==(v=s[u])&&!1===e.hasEdge(h,v)){var S=e.getNode(h),_=e.getNode(v);S=S.position.distanceTo(_.position),e.addEdge(new vc(h,v,S))}return this},ca.prototype._getClosestBorderEdge=function(e,i){var n=1/0;if(null!==this.spatialIndex){ar.length=0;for(var o=this.spatialIndex.getIndexForPosition(e),s=0,h=(o=this.spatialIndex.cells[o].entries).length;s<h;s++){var u=o[s],l=u.edge;do{null===l.twin&&ar.push(l),l=l.next}while(l!==u.edge)}o=ar}else o=this._borderEdges;for(s=0,h=o.length;s<h;s++)u=o[s],sr.set(u.prev.vertex,u.vertex),l=sr.closestPointToPointParameter(e),sr.at(l,rr),(l=rr.squaredDistanceTo(e))<n&&(n=l,i.edge=u,i.closestPoint.copy(rr));return this},ca.prototype._getPortalEdge=function(e,i,n){var o=e.edge;do{if(null!==o.twin&&o.twin.polygon===i)return n.left=o.prev.vertex,n.right=o.vertex,n;o=o.next}while(o!==e.edge);return n.left=null,n.right=null,n};var oe=function(){};oe.prototype.load=function(e,i){return new Promise((function(n,o){fetch(e).then((function(e){if(200<=e.status&&300>e.status)return e.arrayBuffer();var i=Error(e.statusText||e.status);return i.response=e,Promise.reject(i)})).then((function(n){var o=new Ba,s=new TextDecoder;if("glTF"===s.decode(new Uint8Array(n,0,4))?(o.parseBinary(n),n=o.extensions.get("BINARY").content):n=s.decode(new Uint8Array(n)),void 0===(n=JSON.parse(n)).asset||2>n.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");return s=-1===(s=e.lastIndexOf("/"))?"./":e.substr(0,s+1),o.parse(n,s,i)})).then((function(e){n(e)})).catch((function(e){y.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",e),o(e)}))}))};var Ba=function(){this.path=this.json=null,this.cache=new Map,this.extensions=new Map};Ba.prototype.parse=function(e,i,n){var o=this;return this.json=e,this.path=i,this.getDependency("mesh",0).then((function(e){e=o.parseGeometry(e);var i=new ca;return n&&n.epsilonCoplanarTest&&(i.epsilonCoplanarTest=n.epsilonCoplanarTest),i.fromPolygons(e)}))},Ba.prototype.parseGeometry=function(e){var i=e.index,n=e.position;e=[];for(var o=[],s=0,h=n.length;s<h;s+=3){var u=new f;u.x=n[s+0],u.y=n[s+1],u.z=n[s+2],e.push(u)}if(i)for(n=0,s=i.length;n<s;n+=3)h=[e[i[n+0]],e[i[n+1]],e[i[n+2]]],h=(new V).fromContour(h),o.push(h);else for(i=0,n=e.length;i<n;i+=3)s=[e[i+0],e[i+1],e[i+2]],s=(new V).fromContour(s),o.push(s);return o},Ba.prototype.getDependencies=function(e){var i=this,n=this.cache,o=n.get(e);return o||(o=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map((function(n,o){return i.getDependency(e,o)}))),n.set(e,o)),o},Ba.prototype.getDependency=function(e,i){var n=this.cache,o=e+":"+i,s=n.get(o);if(void 0===s){switch(e){case"accessor":s=this.loadAccessor(i);break;case"buffer":s=this.loadBuffer(i);break;case"bufferView":s=this.loadBufferView(i);break;case"mesh":s=this.loadMesh(i);break;default:throw Error("Unknown type: "+e)}n.set(o,s)}return s},Ba.prototype.loadBuffer=function(e){var i=this,n=this.json.buffers[e];return void 0===n.uri&&0===e?Promise.resolve(this.extensions.get("BINARY").body):new Promise((function(e,o){var s=function Db(e,i){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e}(n.uri,i.path);fetch(s).then((function(e){return e.arrayBuffer()})).then((function(i){e(i)})).catch((function(e){y.error("YUKA.NavMeshLoader: Unable to load buffer.",e),o(e)}))}))},Ba.prototype.loadBufferView=function(e){var i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then((function(e){var n=i.byteOffset||0;return e.slice(n,n+(i.byteLength||0))}))},Ba.prototype.loadAccessor=function(e){var i=this.json.accessors[e];return this.getDependency("bufferView",i.bufferView).then((function(e){return new pr[i.componentType](e,i.byteOffset||0,i.count*ur[i.type])}))},Ba.prototype.loadMesh=function(e){var i=this.json.meshes[e];return this.getDependencies("accessor").then((function(e){var n=i.primitives[0];if(void 0!==n.mode&&4!==n.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:e[n.indices],position:e[n.attributes.POSITION],normal:e[n.attributes.NORMAL]}}))},Ba.prototype.parseBinary=function(e){for(var i=new DataView(e,12),n=0,o=new TextDecoder,s=null,h=null;n<i.byteLength;){var u=i.getUint32(n,!0);n+=4;var l=i.getUint32(n,!0);n+=4,l===lr.JSON?(s=new Uint8Array(e,12+n,u),s=o.decode(s)):l===lr.BIN&&(h=12+n,h=e.slice(h,h+u)),n+=u}this.extensions.set("BINARY",{content:s,body:h})};var ur={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lr={JSON:1313821514,BIN:5130562},va=function(e){this.aabb=e=void 0===e?new E:e,this.entries=[]};va.prototype.add=function(e){return this.entries.push(e),this},va.prototype.remove=function(e){return e=this.entries.indexOf(e),this.entries.splice(e,1),this},va.prototype.makeEmpty=function(){return this.entries.length=0,this},va.prototype.empty=function(){return 0===this.entries.length},va.prototype.intersects=function(e){return this.aabb.intersectsAABB(e)},va.prototype.toJSON=function(){for(var e={type:this.constructor.name,aabb:this.aabb.toJSON(),entries:[]},i=this.entries,n=0,o=i.length;n<o;n++)e.entries.push(i[n].uuid);return e},va.prototype.fromJSON=function(e){return this.aabb.fromJSON(e.aabb),this.entries=e.entries.slice(),this},va.prototype.resolveReferences=function(e){for(var i=this.entries,n=0,o=i.length;n<o;n++)i[n]=e.get(i[n]);return this};var cr=new f,dr=new E,fr=[],wa=function(e,i,n,o,s,h){for(this.cells=[],this.width=e,this.height=i,this.depth=n,this.cellsX=o,this.cellsY=s,this.cellsZ=h,this._halfWidth=this.width/2,this._halfHeight=this.height/2,this._halfDepth=this.depth/2,this._min=new f(-this._halfWidth,-this._halfHeight,-this._halfDepth),this._max=new f(this._halfWidth,this._halfHeight,this._halfDepth),e=this.width/this.cellsX,i=this.height/this.cellsY,n=this.depth/this.cellsZ,o=0;o<this.cellsX;o++)for(s=o*e-this._halfWidth,h=0;h<this.cellsY;h++)for(var u=h*i-this._halfHeight,l=0;l<this.cellsZ;l++){var v=l*n-this._halfDepth,S=new f,_=new f;S.set(s,u,v),_.x=S.x+e,_.y=S.y+i,_.z=S.z+n,v=new E(S,_),v=new va(v),this.cells.push(v)}};wa.prototype.updateEntity=function(e,i){i=void 0===i?-1:i;var n=this.getIndexForPosition(e.position);return i!==n&&(this.addEntityToPartition(e,n),-1!==i&&this.removeEntityFromPartition(e,i)),n},wa.prototype.addEntityToPartition=function(e,i){return this.cells[i].add(e),this},wa.prototype.removeEntityFromPartition=function(e,i){return this.cells[i].remove(e),this},wa.prototype.getIndexForPosition=function(e){cr.copy(e).clamp(this._min,this._max),e=Math.abs(Math.floor(this.cellsX*(cr.x+this._halfWidth)/this.width));var i=Math.abs(Math.floor(this.cellsY*(cr.y+this._halfHeight)/this.height)),n=Math.abs(Math.floor(this.cellsZ*(cr.z+this._halfDepth)/this.depth));return e===this.cellsX&&(e=this.cellsX-1),i===this.cellsY&&(i=this.cellsY-1),n===this.cellsZ&&(n=this.cellsZ-1),e*this.cellsY*this.cellsZ+i*this.cellsZ+n},wa.prototype.query=function(e,i,n){var o=this.cells;for(n.length=0,dr.min.copy(e).subScalar(i),dr.max.copy(e).addScalar(i),e=0,i=o.length;e<i;e++){var s=o[e];!1===s.empty()&&!0===s.intersects(dr)&&n.push.apply(n,$jscomp.arrayFromIterable(s.entries))}return n},wa.prototype.makeEmpty=function(){for(var e=this.cells,i=0,n=e.length;i<n;i++)e[i].makeEmpty();return this},wa.prototype.addPolygon=function(e){var i=this.cells;e.getContour(fr),dr.fromPoints(fr);for(var n=0,o=i.length;n<o;n++){var s=i[n];!0===s.intersects(dr)&&s.add(e)}return this},wa.prototype.toJSON=function(){for(var e={type:this.constructor.name,cells:[],width:this.width,height:this.height,depth:this.depth,cellsX:this.cellsX,cellsY:this.cellsY,cellsZ:this.cellsZ,_halfWidth:this._halfWidth,_halfHeight:this._halfHeight,_halfDepth:this._halfDepth,_min:this._min.toArray([]),_max:this._max.toArray([])},i=0,n=this.cells.length;i<n;i++)e.cells.push(this.cells[i].toJSON());return e},wa.prototype.fromJSON=function(e){this.cells.length=0,this.width=e.width,this.height=e.height,this.depth=e.depth,this.cellsX=e.cellsX,this.cellsY=e.cellsY,this.cellsZ=e.cellsZ,this._halfWidth=e._halfWidth,this._halfDepth=this._halfHeight=e._halfHeight,this._min.fromArray(e._min),this._max.fromArray(e._max);for(var i=0,n=e.cells.length;i<n;i++)this.cells.push((new va).fromJSON(e.cells[i]));return this},wa.prototype.resolveReferences=function(e){for(var i=0,n=this.cells.length;i<n;i++)this.cells[i].resolveReferences(e);return this};var Bb=function(e){this.entity=void 0===e?null:e,this.timeLastSensed=this.timeBecameVisible=-1/0,this.lastSensedPosition=new f,this.visible=!1};Bb.prototype.toJSON=function(){return{type:this.constructor.name,entity:this.entity.uuid,timeBecameVisible:this.timeBecameVisible.toString(),timeLastSensed:this.timeLastSensed.toString(),lastSensedPosition:this.lastSensedPosition.toArray([]),visible:this.visible}},Bb.prototype.fromJSON=function(e){return this.entity=e.entity,this.timeBecameVisible=parseFloat(e.timeBecameVisible),this.timeLastSensed=parseFloat(e.timeLastSensed),this.lastSensedPosition.fromArray(e.lastSensedPosition),this.visible=e.visible,this},Bb.prototype.resolveReferences=function(e){return this.entity=e.get(this.entity)||null,this};var Ca=function(e){this.owner=void 0===e?null:e,this.records=[],this.recordsMap=new Map,this.memorySpan=1};Ca.prototype.getRecord=function(e){return this.recordsMap.get(e)},Ca.prototype.createRecord=function(e){var i=new Bb(e);return this.records.push(i),this.recordsMap.set(e,i),this},Ca.prototype.deleteRecord=function(e){var i=this.getRecord(e);return i=this.records.indexOf(i),this.records.splice(i,1),this.recordsMap.delete(e),this},Ca.prototype.hasRecord=function(e){return this.recordsMap.has(e)},Ca.prototype.clear=function(){return this.records.length=0,this.recordsMap.clear(),this},Ca.prototype.getValidMemoryRecords=function(e,i){for(var n=this.records,o=i.length=0,s=n.length;o<s;o++){var h=n[o];e-h.timeLastSensed<=this.memorySpan&&i.push(h)}return i},Ca.prototype.toJSON=function(){for(var e={type:this.constructor.name,owner:this.owner.uuid,records:[],memorySpan:this.memorySpan},i=this.records,n=0,o=i.length;n<o;n++)e.records.push(i[n].toJSON());return e},Ca.prototype.fromJSON=function(e){this.owner=e.owner,this.memorySpan=e.memorySpan;for(var i=0,n=(e=e.records).length;i<n;i++){var o=e[i];o=(new Bb).fromJSON(o),this.records.push(o)}return this},Ca.prototype.resolveReferences=function(e){this.owner=e.get(this.owner)||null;for(var i=this.records,n=0,o=i.length;n<o;n++){var s=i[n];s.resolveReferences(e),this.recordsMap.set(s.entity,s)}return this};var yr=new f,gr=new f,vr=new K,mr=new f,xr=new f,eb=function(e){this.owner=void 0===e?null:e,this.fieldOfView=Math.PI,this.range=1/0,this.obstacles=[]};eb.prototype.addObstacle=function(e){return this.obstacles.push(e),this},eb.prototype.removeObstacle=function(e){return e=this.obstacles.indexOf(e),this.obstacles.splice(e,1),this},eb.prototype.visible=function(e){var i=this.owner,n=this.obstacles;if(i.getWorldPosition(xr),yr.subVectors(e,xr),(e=yr.length())>this.range)return!1;if(i.getWorldDirection(gr),gr.angleTo(yr)>.5*this.fieldOfView)return!1;vr.origin.copy(xr),vr.direction.copy(yr).divideScalar(e||1),i=0;for(var o=n.length;i<o;i++)if(null!==n[i].lineOfSightTest(vr,mr)&&mr.squaredDistanceTo(xr)<=e*e)return!1;return!0},eb.prototype.toJSON=function(){for(var e={type:this.constructor.name,owner:this.owner.uuid,fieldOfView:this.fieldOfView,range:this.range.toString(),obstacles:[]},i=0,n=this.obstacles.length;i<n;i++)e.obstacles.push(this.obstacles[i].uuid);return e},eb.prototype.fromJSON=function(e){this.owner=e.owner,this.fieldOfView=e.fieldOfView,this.range=parseFloat(e.range);for(var i=0,n=e.obstacles.length;i<n;i++)this.obstacles.push(e.obstacles[i]);return this},eb.prototype.resolveReferences=function(e){this.owner=e.get(this.owner)||null;for(var i=this.obstacles,n=0,o=i.length;n<o;n++)i[n]=e.get(i[n]);return this};var wr=new f,Sr=new f,br=new f,_r=new la,zr=new f,Wb=function(e,i,n){e=void 0===e?new za:e,i=void 0===i?.1:i,n=void 0===n?1:n;var o=p.call(this)||this;return o.path=e,o.radius=i,o.predictionFactor=n,o._seek=new ya,o};$jscomp.inherits(Wb,p),Wb.prototype.calculate=function(e,i){var n=this.path;wr.copy(e.velocity).multiplyScalar(this.predictionFactor),Sr.addVectors(e.position,wr);var o=1/0,s=n._waypoints.length;s=!0===n.loop?s:s-1;for(var h=0;h<s;h++){_r.from=n._waypoints[h],_r.to=!0===n.loop&&h===s-1?n._waypoints[0]:n._waypoints[h+1],_r.closestPointToPoint(Sr,!0,br);var u=Sr.squaredDistanceTo(br);u<o&&(o=u,zr.copy(br))}return o>this.radius*this.radius&&1<n._waypoints.length&&(this._seek.target=zr,this._seek.calculate(e,i)),i},Wb.prototype.toJSON=function(){var e=p.prototype.toJSON.call(this);return e.path=this.path.toJSON(),e.radius=this.radius,e.predictionFactor=this.predictionFactor,e},Wb.prototype.fromJSON=function(e){return p.prototype.fromJSON.call(this,e),this.path.fromJSON(e.path),this.radius=e.radius,this.predictionFactor=e.predictionFactor,this};var T=function(e){var i=f.call(this)||this;return i.vertex=e,i};$jscomp.inherits(T,f),T.prototype.initSpinning=function(e,i,n,o,s){return this.spinningOnRight=i,this.splitNormal=new f,this},T.prototype.initFinal=function(e){return this.final=!0,this};var Mr=-1,Or=!1,P=function(e,i){if(e.polygon!==i.polygon)throw Error("Invalid portals -- dont belong to same polygon!");this.fromPortal=e,this.nextPortal=i;var n=this.fromPortal.polygon,o=i.next!==e&&i.prev!==e;if(o&&(this.diagonal=new f(-(i.prev.vertex.z-e.prev.vertex.z)*Mr,0,(i.prev.vertex.x-e.prev.vertex.x)*Mr),0===this.diagonal.squaredLength()&&(console.log(this),console.error("Diagonal zero length detected")),this.diagonal.normalize(),this.diagonal.offset=this.diagonal.x*e.prev.vertex.x+this.diagonal.z*e.prev.vertex.z),n.edge.next.next.next.next!==n.edge||!o){i.next!==e&&(this.leftEdgeDirs=[new f],this.leftEdgeFlows=[P.calculateDirForFanEdge(e.prev.vertex,i.vertex,this.leftEdgeDirs[0],!1)]),i.prev!==e&&(this.rightEdgeDirs=[new f],this.rightEdgeFlows=[P.calculateDirForFanEdge(e.vertex,i.prev.vertex,this.rightEdgeDirs[0],!0)]);var s=n.edge,h=0,u=0;do{if(u++,s.vertex!==e.vertex&&s.vertex!==e.prev.vertex&&s.vertex!==i.vertex&&s.vertex!==i.prev.vertex){var l=this.leftEdgeDirs?this.leftEdgeDirs[0]:null,v=!1;l&&l.x*s.vertex.x+l.z*s.vertex.z>l.offset&&(l=new f,v=P.calculateDirForFanEdge(s.vertex,i.vertex,l,!1),this.leftEdgeDirs.push(l),this.leftEdgeFlows.push(v),h++,v=!0),(l=this.rightEdgeDirs?this.rightEdgeDirs[0]:null)&&l.x*s.vertex.x+l.z*s.vertex.z>l.offset&&(l=new f,v=P.calculateDirForFanEdge(s.vertex,i.prev.vertex,l,!0),this.rightEdgeDirs.push(l),this.rightEdgeFlows.push(v),h++,v=!0),v||console.warn("Failed to resolve vertex side...:"+(this.leftEdgeDirs?" 1 ":"")+", "+(this.rightEdgeDirs?" 2 ":""))}s=s.next}while(s!==n.edge);h!==u-(o?4:3)&&(console.warn("Debug count assertion mismatch!!: "+h+" / "+u),console.log(this),s.polygon.gotErrorTriangulation=this,this.debugInfo={leftEdgeDirs:this.leftEdgeDirs,rightEdgeDirs:this.rightEdgeDirs,leftEdgeFlows:this.leftEdgeFlows,rightEdgeFlows:this.rightEdgeFlows}),s.polygon.debugTriangulation=this,this.leftEdgeDirs&&1===this.leftEdgeDirs.length&&(this.leftEdgeFlows=this.leftEdgeDirs=null),this.rightEdgeDirs&&1===this.rightEdgeDirs.length&&(this.rightEdgeFlows=this.rightEdgeDirs=null)}};P.setRightHanded=function(e){Mr=e?1:-1},P.setDiscontinuous=function(e){Or=void 0===e||e},P.updateTriRegion=function(e,i,n){e=n.has(e.edge)?e.edge:n.has(e.edge.prev)?e.edge.prev:e.edge.next,i.a=n.get(e.next.vertex),e=n.get(e),i.b=e[1],i.c=e[0],i.prevEdge&&!P.checkPrevFlowVertices(i,i.prevEdge)&&(i.prevEdge=null),i.lastSavedEdge&&i.lastSavedEdge!==i.prevEdge&&!P.checkPrevFlowVertices(i,i.lastSavedEdge)&&(i.lastSavedEdge=null)},P.updateNgonFinalTri=function(e,i,n,o,s){var h=e.edge,u=null,l=Mr;do{var v=-h.prev.vertex.x+s.x,S=h.prev.vertex.z-s.z;if(0>(v*=l)*i.z+S*i.x)h=h.next;else{if(v=-h.vertex.x+s.x,S=h.vertex.z-s.z,!(0<(v*=l)*i.z+S*i.x)){u=h;break}h=h.next}}while(h!==e.edge);if(null===u)throw console.log(e),Error("Failed to find final destination center fan triangle");n.a=o.get(s),n.b=o.get(u.prev.vertex),n.c=o.get(u.vertex),n.prevEdge&&!P.checkPrevFlowVertices(n,n.prevEdge)&&(n.prevEdge=null),n.lastSavedEdge&&n.lastSavedEdge!==n.prevEdge&&!P.checkPrevFlowVertices(n,n.lastSavedEdge)&&(n.lastSavedEdge=null)},P.checkPrevFlowVertices=function(e,i){if(Or)return!1;var n=!1;return i[0]&&e.a.vertex===i[0].vertex?(e.a=i[0],n=!0):i[1]&&e.a.vertex===i[1].vertex&&(e.a=i[1],n=!0),i[0]&&e.b.vertex===i[0].vertex?(e.b=i[0],n=!0):i[1]&&e.b.vertex===i[1].vertex&&(e.b=i[1],n=!0),i[0]&&e.c.vertex===i[0].vertex?(e.c=i[0],n=!0):i[1]&&e.c.vertex===i[1].vertex&&(e.c=i[1],n=!0),n},P.prototype.updateFlowTriLaned=function(e,i,n){if(0===i.lane)if(this.diagonal){var o=this.diagonal,s=n.get(this.fromPortal)[0];o.x*e.x+o.z*e.z>=o.offset?(e=n.get(this.nextPortal)[1],n=n.get(this.nextPortal)[0]):(e=n.get(this.fromPortal)[1],n=n.get(this.nextPortal)[1])}else s=n.get(this.fromPortal)[0],e=n.get(this.fromPortal)[1],n=n.get(this.nextPortal)[this.nextPortal.vertex!==s.vertex&&this.nextPortal.vertex!==e.vertex?0:1];else{var h=(s=0>i.lane)?this.leftEdgeFlows:this.rightEdgeFlows;n=s?1:0,e=h[o=s?-i.lane-1:i.lane-1][n],n=h[++o][n],o=h[o][s?0:1],s?(s=e,e=o):(s=e,e=n,n=o)}if(!s||!e||!n)throw Error("Should have abc vertices! "+i.lane+" / "+(h?h.length:"")+" ::"+s+","+e+","+n+"["+(leftwards?"<":">")+"]");i.a=s,i.b=e,i.c=n,i.prevEdge&&!P.checkPrevFlowVertices(i,i.prevEdge)&&(i.prevEdge=null),i.lastSavedEdge&&i.lastSavedEdge!==i.prevEdge&&!P.checkPrevFlowVertices(i,i.lastSavedEdge)&&(i.lastSavedEdge=null)},P.prototype.updateLane=function(e,i){var n,o;if((n=!!this.leftEdgeDirs&&this.leftEdgeDirs[0])&&n.x*e.x+n.z*e.z>n.offset){var s=-1,h=this.leftEdgeDirs.length-1;for(o=1;o<h&&!((n=this.leftEdgeDirs[o]).offset>=n.x*e.x+n.z*e.z);o++)s--;s<i.lane?(i.lastSavedEdge=null,i.prevEdge=null):s>i.lane&&(e=s-1,i.prevEdge=-e<this.leftEdgeDirs.length-1?this.leftEdgeDirs[-e]:null,i.lastSavedEdge||(i.lastSavedEdge=i.prevEdge),null===i.prevEdge&&(i.lastSavedEdge=null,console.warn("Out of bounds detected for position..left")))}else if((n=!!this.rightEdgeDirs&&this.rightEdgeDirs[0])&&n.x*e.x+n.z*e.z>n.offset){for(s=1,h=this.rightEdgeDirs.length-1,o=1;o<h&&!((n=this.rightEdgeDirs[o]).offset>=n.x*e.x+n.z*e.z);o++)s++;s>i.lane?(i.lastSavedEdge=null,i.prevEdge=null):s<i.lane&&(e=s+1,i.prevEdge=e<this.rightEdgeDirs.length-1?this.rightEdgeDirs[e]:null,i.lastSavedEdge||(i.lastSavedEdge=i.prevEdge),null===i.prevEdge&&(i.lastSavedEdge=null,console.warn("Out of bounds detected for position..right")))}else s=0;0!=s&&console.log("Lane != 0 case detected:"+s+" / "+(0>s?this.leftEdgeDirs:this.rightEdgeDirs).length),i.lane=s},P.calculateDirForFanEdge=function(e,i,n,o){var s=i.x-e.x;i=i.z-e.z;var h=new T(e);h.x=s,h.z=i,h.normalize();var u=o?-Mr:Mr;return n.x=-i*u,n.z=s*u,n.normalize(),n.offset=n.x*e.x+n.z*e.z,o?[h,null]:[null,h]};var Nr=new f,Er=new f,Fr=new f,X=function(e){this.navMesh=e,this._flowedFinal=!1};X.cacheRegionIndexLookup=function(e){if(!e.regionIndexMap){e.regionIndexMap=new Map;for(var i=e.regions.length,n=0;n<i;n++)e.regionIndexMap.set(e.regions[n],n);e.getNodeIndex=X.getCachedNodeIndexForRegionProto}},X.getCachedNodeIndexForRegionProto=function(e){return this.regionIndexMap.has(e)?this.regionIndexMap.get(e):-1},X.prototype.initPersistant=function(e){this.edgeFieldMap=new Map,this.triangulationMap=new Map,this.savedRegionFlows=new Map,this.pathRef=e},X.prototype.resetPersistant=function(e){this.edgeFieldMap.clear(),this.triangulationMap.clear(),this.savedRegionFlows.clear(),this.pathRef=e},X.prototype.initTransitional=function(e,i,n){return this.edgeFieldMap=new Map,this.pathRef=this.savedRegionFlows=this.triangulationMap=null,this.calcRegionFlow(e,i,n),""},X.prototype.hasFlowFromRegion=function(e,i){return i||(i=this.pathRef),Array.isArray(i)?0<=i.indexOf(this.navMesh.getNodeIndex(e)):i._cost.has(this.navMesh.getNodeIndex(e))},X.prototype.getFlowEdges=function(e,i,n){var o,s=[],h=null;if(this._flowedFinal=!1,Array.isArray(i)){var u=i.indexOf(e);if(0>u)return null;if(u>=i.length-1)return this._flowedFinal=!0,s;var l=i[++u];for(h=this.navMesh.regions[e].getEdgeTo(this.navMesh.regions[l]),s.push(h),o=l;null!==o&&(l=i[++u]);)o=this.navMesh.regions[o].getEdgeTo(this.navMesh.regions[l]),s.push(o),o=o.vertex===h.vertex||o.prev.vertex===h.prev.vertex?l:null,n&&(o=l);this._flowedFinal=u>=i.length-1}else{if(!(u=i._cost).has(e))return null;var v=1/0;if(o=e,e===i.source)return this._flowedFinal=!0,s;for(;null!==o;){var S=(e=this.navMesh.graph._edges.get(o)).length;l=null;for(var _=0;_<S;_++){var z=e[_].to;if(z===i.source){l=z;break}u.has(z)&&u.get(z)<v&&(v=u.get(z),l=z)}if(null!==l){if(o=this.navMesh.regions[o].getEdgeTo(this.navMesh.regions[l]),null!==h?(s.push(o),o=o.vertex===h.vertex||o.prev.vertex===h.prev.vertex?l:null,n&&(o=l)):(h=o,s.push(o),o=l),l===i.source){this._flowedFinal=!0;break}}else o=null}}return s},X.prototype.collinear=function(e,i){var n=e.prev.vertex.z,o=e.vertex.z,s=(i=e.prev===i?i.prev.vertex:i.vertex).z;return(e=0==e.prev.vertex.x*(o-s)+e.vertex.x*(s-n)+i.x*(n-o))&&console.log("Collinear detected"),e},X.prototype.setupTriangulation=function(e,i,n){if(!e){var o=0,s=i.polygon.edge;do{if(s!==i&&!this.collinear(i,s)){var h=s.squaredLength();h>=o&&(o=h,e=s)}s=s.next}while(s!==i.polygon.edge)}return this.triangulationMap?(n||(n=e),(o=(s=this.triangulationMap).get(n))||(o=new P(e,i),s.set(n,o))):(this.localTriangulation||(this.localTriangulation=new P(e,i)),o=this.localTriangulation),o},X.prototype._calcTriRegionField=function(e,i,n){var o=this.edgeFieldMap;e=e.edge;var s=i[0];e!==s&&((e=e.next)!==s&&(e=e.next)),s=e.next.vertex,Nr.x=s.x,Nr.z=s.z,Er.x=.5*(e.vertex.x+e.prev.vertex.x),Er.z=.5*(e.vertex.z+e.prev.vertex.z),o.set(s,new T(s).subVectors(Er,Nr).normalize()),this._calcDestPortalField(i,s,null,n)},X.prototype._calcDestPortalField=function(e,i,n,o){var s=this.edgeFieldMap,h=Mr,u=0,l=i,v=e[0];for(Nr.x=v.vertex.x-l.x,Nr.z=v.vertex.z-l.z,Fr.x=Nr.z*h,Fr.z=-Nr.x*h,tryEdge=e[++u];tryEdge&&v.vertex===tryEdge.vertex;)tryEdge=e[++u];if(tryEdge){Er.x=tryEdge.vertex.x-v.vertex.x,Er.z=tryEdge.vertex.z-v.vertex.z;var S=new T(v.vertex).copy(0<=Er.x*Fr.x+Er.z*Fr.z?Er:Nr).normalize()}else tryEdge?S=new T(v.vertex).copy(Nr).normalize():(Er.x=o.x-v.vertex.x,Er.z=o.z-v.vertex.z,S=new T(v.vertex).copy(0<=Er.x*Fr.x+Er.z*Fr.z?Er:Nr).normalize().initFinal(o));for(l=1;l<u;l++)if(tryEdge=e[l],Nr.x=tryEdge.prev.vertex.x-tryEdge.vertex.x,Nr.z=tryEdge.prev.vertex.z-tryEdge.vertex.z,Fr.x=-Nr.z*h,Fr.z=Nr.x*h,0>S.x*Fr.x+S.z*Fr.z){S.initSpinning(tryEdge,!1,e[l+1],o);break}for(u===e.length-1&&(tryEdge=e[u],tryEdge.next.next.next!==tryEdge&&tryEdge.prev.vertex!==v.vertex&&(Nr.x=tryEdge.prev.vertex.x-v.vertex.x,Nr.z=tryEdge.prev.vertex.z-v.vertex.z,Fr.x=-Nr.z*h,Fr.z=Nr.x*h,0>S.x*Fr.x+S.z*Fr.z&&S.initSpinning(tryEdge,!1,null,o,!0))),u=0,v=e[0],l=n||i,Nr.x=v.prev.vertex.x-l.x,Nr.z=v.prev.vertex.z-l.z,Fr.x=-Nr.z*h,Fr.z=Nr.x*h,tryEdge=e[++u];tryEdge&&v.prev.vertex===tryEdge.prev.vertex;)tryEdge=e[++u];for(tryEdge?(Er.x=tryEdge.prev.vertex.x-v.prev.vertex.x,Er.z=tryEdge.prev.vertex.z-v.prev.vertex.z,i=new T(v.prev.vertex).copy(0<=Er.x*Fr.x+Er.z*Fr.z?Er:Nr).normalize()):tryEdge?i=new T(v.prev.vertex).copy(Nr).normalize():(Er.x=o.x-v.prev.vertex.x,Er.z=o.z-v.prev.vertex.z,i=new T(v.prev.vertex).copy(0<=Er.x*Fr.x+Er.z*Fr.z?Er:Nr).normalize().initFinal(o)),l=1;l<u;l++)if(tryEdge=e[l],Nr.x=tryEdge.prev.vertex.x-tryEdge.vertex.x,Nr.z=tryEdge.prev.vertex.z-tryEdge.vertex.z,Fr.x=-Nr.z*h,Fr.z=Nr.x*h,0>i.x*Fr.x+i.z*Fr.z){i.initSpinning(tryEdge,!0,e[l+1],o);break}return e=[S,i],s.set(v,e),e},X.prototype._calcNonTriRegionField=function(e,i,n){var o=this.edgeFieldMap,s=e.fromPortal,h=e.nextPortal;if(h!==i[0])throw Error("Assertion failed: nextPortal of triangulation should match edgeFlows[0] assumption!");var u=null,l=null;if(s.prev.vertex!==h.vertex&&(Nr.x=s.prev.vertex.x,Nr.z=s.prev.vertex.z,Er.x=h.vertex.x,Er.z=h.vertex.z,u=new T(s.prev.vertex).subVectors(Er,Nr).normalize()),s.vertex!==h.prev.vertex&&(Nr.x=s.vertex.x,Nr.z=s.vertex.z,Er.x=h.prev.vertex.x,Er.z=h.prev.vertex.z,l=new T(s.vertex).subVectors(Er,Nr).normalize()),o.set(s,s=[u,l]),u=this._calcDestPortalField(i,u?u.vertex:l.vertex,u&&l?l.vertex:null,n),s[0]||(s[0]=u[0]),s[1]||(s[1]=u[1]),l=u,!s[0]||!s[1])throw Error("Could not resolve fromPortalVectors:"+s);if((o=o.get(e.nextPortal))!==u)throw Error("Should match!");if(!o[0]||!o[1])throw Error("Should have all vectors!");if(e.leftEdgeFlows){for(s=(h=e.leftEdgeFlows).length,o=1;o<s;o++)if(u=this._calcDestPortalField(i,h[o][1].vertex,null,n),h[o][0]=u[0],!h[o][0]||!h[o][1])throw Error("Did not fill up fan edge flows...left");if(h[0][0]=l[0],!h[0][0]||!h[0][1])throw Error("Did not fill up fan edge flows...left000")}if(e.rightEdgeFlows){for(s=(h=e.rightEdgeFlows).length,o=1;o<s;o++)if(u=this._calcDestPortalField(i,h[o][0].vertex,null,n),h[o][1]=u[1],!h[o][0]||!h[o][1])throw Error("Did not fill up fan edge flows...right");if(h[0][1]=l[1],!h[0][0]||!h[0][1])throw Error("Did not fill up fan edge flows...right000")}},X.calcFinalRegionField=function(e,i,n){if(!n.has(e.edge.vertex)){edge=e.edge;do{n.set(edge.vertex,new T(edge.vertex)),edge=edge.next}while(edge!==e.edge)}n.has(i)||n.set(i,new T(i)),edge=e.edge;do{flowVertex=n.get(edge.vertex),Nr.x=edge.vertex.x,Nr.z=edge.vertex.z,Er.x=i.x,Er.z=i.z,flowVertex.subVectors(Er,Nr).initFinal(i),flowVertex.normalize(),edge=edge.next}while(edge!==e.edge)},X.prototype.getFromNodeIndex=function(e,i,n){var o=this.navMesh.getNodeIndex(e);if(i=this.navMesh.getNodeIndex(i),n||(n=this.pathRef),Array.isArray(n))return 0>=(i=n.indexOf(i))?-1:n[i-1];n=n._cost,e=1/0;for(var s=o,h=null;null!==s;){var u=this.navMesh.graph._edges.get(s),l=u.length;o=null;for(var v=0;v<l;v++){var S=u[v].to;if(S===i)return s;n.has(S)&&n.get(S)<e&&(e=n.get(S),o=S)}if(null===o)break;s=this.navMesh.regions[s].getEdgeTo(this.navMesh.regions[o]),null!==h?s=s.vertex===h.vertex||s.prev.vertex===h.prev.vertex?o:null:(h=s,s=o)}return-1},X.prototype.calcRegionFlow=function(e,i,n,o){if(!n&&!(n=this.pathRef))throw Error("calcRegionFlow:: unable to retrieve pathRef!");var s=e+","+i;if(this.savedRegionFlows&&this.savedRegionFlows.has(s))return this.savedRegionFlows.get(s);var h=this.navMesh.regions[i],u=this.edgeFieldMap;return edgeFlows=this.getFlowEdges(i,n),this.savedRegionFlows&&this.savedRegionFlows.set(s,edgeFlows),null===edgeFlows?null:0===edgeFlows.length?(X.calcFinalRegionField(h,o,u),edgeFlows):(i=edgeFlows[0],u.has(i)||u.set(i,[new T(i.vertex),new T(i.prev.vertex)]),(e=h.edge.next.next.next===h.edge?null:0<=e?this.navMesh.regions[e].getEdgeTo(h).twin:null)&&(u.has(e)||u.set(e,[new T(e.vertex),new T(e.prev.vertex)])),this._flowedFinal||(o=null),h.edge.next.next.next!==h.edge?(h=this.setupTriangulation(null,i,i),this._calcNonTriRegionField(h,edgeFlows,o),this.lastTriangulation=h):this._calcTriRegionField(h,edgeFlows,o),edgeFlows)};var Tr=new f,sa=function(){};sa.prototype.calcDir=function(e,i){var n=this.a.vertex,o=this.b.vertex,s=this.c.vertex,h=0,u=0,l=this.c,v=(e.x-n.x)*(o.z-n.z)-(o.x-n.x)*(e.z-n.z),S=0+v;(l.spinning||l.splitNormal&&l.splitNormal.x*e.x+l.splitNormal.z*e.z>l.splitNormal.offset)&&((l=Tr).x=e.x-s.x,l.z=e.z-s.z,l.normalize()),h+=v*l.x,u+=v*l.z,l=this.a,S+=v=(e.x-o.x)*(s.z-o.z)-(s.x-o.x)*(e.z-o.z),(l.spinning||l.splitNormal&&l.splitNormal.x*e.x+l.splitNormal.z*e.z>l.splitNormal.offset)&&((l=Tr).x=e.x-n.x,l.z=e.z-n.z,l.normalize()),h+=v*l.x,u+=v*l.z,l=this.b,S+=v=(e.x-s.x)*(n.z-s.z)-(n.x-s.x)*(e.z-s.z),(l.spinning||l.splitNormal&&l.splitNormal.x*e.x+l.splitNormal.z*e.z>l.splitNormal.offset)&&((l=Tr).x=e.x-o.x,l.z=e.z-o.z,l.normalize()),h+=v*l.x,u+=v*l.z,i.x=h/S,i.z=u/S},sa.prototype.reset=function(e){this.lane=this.lastSavedEdge=this.prevEdge=null,e&&(this.curRegion=null)},sa.prototype.withinFlowPlane=function(e,i){return i=void 0===i?.001:i,Math.abs((this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:this.curRegion).distanceToPoint(e))<=i},sa.pointWithinTriangleBounds=function(e,i,n,o){var s=e.x;return e=e.z,0<=(o.x-s)*(i.z-e)-(i.x-s)*(o.z-e)&&0<=(i.x-s)*(n.z-e)-(n.x-s)*(i.z-e)&&0<=(n.x-s)*(o.z-e)-(o.x-s)*(n.z-e)},sa.prototype.currentTriArea=function(){var e=this.a.vertex,i=this.b.vertex,n=this.c.vertex;return(n.x-e.x)*(i.z-e.z)-(i.x-e.x)*(n.z-e.z)},sa.prototype.withinCurrentTriangleBounds=function(e){var i=e.x;e=e.z;var n=this.a.vertex,o=this.b.vertex,s=this.c.vertex;return 0<=(s.x-i)*(n.z-e)-(n.x-i)*(s.z-e)&&0<=(n.x-i)*(o.z-e)-(o.x-i)*(n.z-e)&&0<=(o.x-i)*(s.z-e)-(s.x-i)*(o.z-e)},sa.prototype.getCurRegion=function(){return this.curRegion&&this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:this.curRegion},sa.pointWithinRegion=function(e,i){var n=i.edge;do{var o=n.tail(),s=n.head();if(0>(e.x-o.x)*(s.z-o.z)-(s.x-o.x)*(e.z-o.z))return!1;n=n.next}while(n!==i.edge)},sa.prototype.withinCurrentRegionBounds=function(e){var i=this.curRegion.fromPortal?this.curRegion.fromPortal.polygon:this.curRegion,n=i.edge;do{var o=n.tail(),s=n.head();if(0>(e.x-o.x)*(s.z-o.z)-(s.x-o.x)*(e.z-o.z))return!1;n=n.next}while(n!==i.edge)};var Ar=new f,Pr=new f,Rr=new f,jr=new la,Cb=function(e,i,n,o,s,h){o=void 0===o?.001:o,s=void 0===s?0:s,h=void 0===h?null:h;var u=p.call(this)||this;return u.flowField=e,u.finalDestPt=i,u.epsilon=o,u.pathRef=n,u.arrivalSqDist=0===s?u.epsilon:s,u.arrivalSqDist*=u.arrivalSqDist,u.arrivalCallback=h,u};$jscomp.inherits(Cb,p),Cb.prototype.onAdded=function(e){e.agent=new sa},Cb.prototype.onRemoved=function(e){e.agent=null},Cb.prototype.calculate=function(e,i){var n=e.agent;Ar.x=0,Ar.z=0;var o=e.position;if(!1===n.lane||!0===n.lane)return e.position.squaredDistanceTo(this.finalDestPt)<this.arrivalSqDist?!1===n.lane&&(null!==this.arrivalCallback&&this.arrivalCallback(e),n.lane=!0):n.calcDir(o,Ar),Ar.x*=e.maxSpeed,Ar.z*=e.maxSpeed,i.x=Ar.x-e.velocity.x,i.z=Ar.z-e.velocity.z,i;if(n.curRegion){if(null===n.lane){var s=n.getCurRegion();if(!this.flowField.hasFlowFromRegion(s))return i.x=-e.velocity.x,i.z=-e.velocity.z,i;this.setCurRegion(e,s)}if(!n.withinCurrentTriangleBounds(o))if((s=n.getCurRegion()).edge.next.next.next!==s.edge&&n.withinCurrentRegionBounds(e.position)&&n.withinFlowPlane(e.position,this.epsilon))n.curRegion.updateLane(o,n),n.curRegion.updateFlowTriLaned(o,n,this.flowField.edgeFieldMap);else{var h=n.curRegion;if(!1===this.setCurRegion(e))return n.lane=!1,n.calcDir(o,Ar),Ar.x*=e.maxSpeed,Ar.z*=e.maxSpeed,i.x=Ar.x-e.velocity.x,i.z=Ar.z-e.velocity.z,i;n.curRegion||(o=sd(s,o),n.curRegion=h,s.edge.next.next.next!==s.edge&&h!==s&&(h.updateLane(o,n),h.updateFlowTriLaned(o,n,this.flowField.edgeFieldMap)))}}else if(this.setCurRegion(e),!n.curRegion)return i.x=-e.velocity.x,i.z=-e.velocity.z,i;return n.calcDir(o,Ar),Ar.x*=e.maxSpeed,Ar.z*=e.maxSpeed,i.x=Ar.x-e.velocity.x,i.z=Ar.z-e.velocity.z,i},Cb.prototype.setCurRegion=function(e,i){var n=e.agent,o=this.flowField,s=i?null:n.getCurRegion(),h=i||o.navMesh.getRegionForPoint(e.position,this.epsilon);if(!h)return n.curRegion=null;if(e=e.position,void 0===i||sa.pointWithinRegion(e,h)||(e=sd(h,e)),h===s)return n.curRegion!==h&&(n.curRegion.updateLane(e,n),n.curRegion.updateFlowTriLaned(e,n,o.edgeFieldMap)),!0;if(i=s?o.getFromNodeIndex(s,h,this.pathRef):-1,!(i=o.calcRegionFlow(i,o.navMesh.getNodeIndex(h),this.pathRef,this.finalDestPt)))return n.curRegion=null,console.log("setCurRegion:: Could not find flow path from current position"),0;if(h.edge.next.next.next===h.edge){if(n.curRegion=h,0===i.length)return P.updateNgonFinalTri(h,e,n,o.edgeFieldMap,this.finalDestPt,this.epsilon),!1;n.lane=0,P.updateTriRegion(n.curRegion,n,o.edgeFieldMap)}else{if(0===i.length)return n.curRegion=h,P.updateNgonFinalTri(h,e,n,o.edgeFieldMap,this.finalDestPt,this.epsilon),!1;n.curRegion=o.triangulationMap.get(i[0]),n.curRegion||(n.curRegion=o.setupTriangulation(null,i[0],i[0])),n.curRegion.updateLane(e,n),n.curRegion.updateFlowTriLaned(e,n,o.edgeFieldMap)}return 1};var we=function(){};we.prototype.execute=function(){};var rd=function(){this.tasks=[],this.options={timeout:1e3},this._active=!1,this._handler=td.bind(this),this._taskHandle=0};rd.prototype.enqueue=function(e){return this.tasks.push(e),this},rd.prototype.update=function(){return 0<this.tasks.length?!1===this._active&&(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):this._active=!1,this},e.AABB=E,e.AStar=xb,e.AlignmentBehavior=cc,e.ArriveBehavior=Da,e.BFS=Pb,e.BVH=cd,e.BVHNode=ka,e.BoundingSphere=R,e.CHFace=qa,e.CHVertex=ie,e.CHVertexList=pa,e.Cell=va,e.CellSpacePartitioning=wa,e.CohesionBehavior=ec,e.CompositeGoal=ba,e.ConvexHull=N,e.Corridor=xc,e.CostTable=Qa,e.DFS=Qb,e.Dijkstra=Rb,e.Edge=Aa,e.EntityManager=da,e.EvadeBehavior=Ta,e.EventDispatcher=Lb,e.FleeBehavior=Sa,e.FlowAgent=sa,e.FlowVertex=T,e.FollowPathBehavior=hb,e.FuzzyAND=pc,e.FuzzyCompositeTerm=aa,e.FuzzyFAIRLY=ob,e.FuzzyModule=ha,e.FuzzyOR=qc,e.FuzzyRule=vb,e.FuzzySet=x,e.FuzzyTerm=Ga,e.FuzzyVERY=pb,e.FuzzyVariable=Ha,e.GameEntity=G,e.Goal=B,e.GoalEvaluator=Ob,e.Graph=W,e.GraphUtils=ne,e.HalfEdge=Oa,e.HeuristicPolicyDijkstra=ae,e.HeuristicPolicyEuclid=bd,e.HeuristicPolicyEuclidSquared=Zd,e.HeuristicPolicyManhattan=$d,e.InterposeBehavior=Ua,e.LeftSCurveFuzzySet=Mb,e.LeftShoulderFuzzySet=qb,e.LineSegment=la,e.Logger=y,e.MathUtils=M,e.Matrix3=C,e.Matrix4=D,e.MemoryRecord=Bb,e.MemorySystem=Ca,e.MeshGeometry=$a,e.MessageDispatcher=ta,e.MovingEntity=ia,e.NavEdge=vc,e.NavMesh=ca,e.NavMeshFlowField=X,e.NavMeshFlowFieldBehavior=Cb,e.NavMeshLoader=oe,e.NavNode=wc,e.Node=wb,e.NormalDistFuzzySet=rb,e.OBB=Z,e.ObstacleAvoidanceBehavior=Va,e.OffsetPursuitBehavior=Wa,e.OnPathBehavior=Wb,e.Path=za,e.Plane=ea,e.Polygon=V,e.Polyhedron=Pa,e.PriorityQueue=La,e.PursuitBehavior=Xa,e.Quaternion=w,e.Ray=K,e.RectangularTriggerRegion=Ja,e.Regulator=Yd,e.RightSCurveFuzzySet=Nb,e.RightShoulderFuzzySet=sb,e.SAT=Na,e.SeekBehavior=ya,e.SeparationBehavior=lc,e.SingletonFuzzySet=tb,e.Smoother=Jb,e.SphericalTriggerRegion=Za,e.State=Fa,e.StateMachine=fa,e.SteeringBehavior=p,e.SteeringManager=ja,e.Task=we,e.TaskQueue=rd,e.Telegram=Ra,e.Think=ua,e.Time=nb,e.TriangularFuzzySet=ub,e.Trigger=Ka,e.TriggerRegion=oa,e.Vector3=f,e.Vehicle=Ya,e.Vision=eb,e.WanderBehavior=jb,e.WorldUp=h,Object.defineProperty(e,"__esModule",{value:!0})}));var Vehicle=pc.createScript("vehicle");Vehicle.attributes.add("wheelBL",{type:"entity"}),Vehicle.attributes.add("wheelBR",{type:"entity"}),Vehicle.attributes.add("wheelFL",{type:"entity"}),Vehicle.attributes.add("wheelFR",{type:"entity"}),Vehicle.attributes.add("tiltNode",{type:"entity"}),Vehicle.attributes.add("foreSphere",{type:"entity"}),Vehicle.attributes.add("aftSphere",{type:"entity"}),Vehicle.attributes.add("groundNormalThreshold",{type:"number",default:.53,min:0,max:1}),Vehicle.attributes.add("gravForce",{type:"number",default:1.7}),Vehicle.attributes.add("damp",{type:"number",default:.5}),Vehicle.attributes.add("gravSuspensionDist",{description:"If vehicle shakes while motionless on ground, add a positive number to ensure gravity grounded test works stable",type:"number",default:0}),Vehicle.attributes.add("orientStyle",{type:"number",default:2,enum:[{"Fore/Aft Tilt":2},{"4-Wheel Tilt":4}]}),Vehicle.COLLIDER=null;var SpherePart=function(t){this.pos=t.getLocalPosition().clone(),this.ent=t,this.vel=new pc.Vec3,this.tPos=new pc.Vec3,this.grounded=null,this.c=!1,this.t=1/0},Constraint=function(t,e){this.a=t,this.b=e,this.rLength=this.a.pos.distance(this.b.pos)};Constraint.prototype.satisfyVel=function(){var t=this.a,e=this.b,i=this.a.ent.getPosition(),s=this.b.ent.getPosition(),h=s.x+e.vel.x-(i.x+t.vel.x),o=s.y+e.vel.y-(i.y+t.vel.y),r=s.z+e.vel.z-(i.z+t.vel.z),n=Math.sqrt(h*h+o*o+r*r),l=.5*(n-this.rLength)/n;h*=l,o*=l,r*=l,t.vel.x+=h,t.vel.y+=o,t.vel.z+=r,e.vel.x-=h,e.vel.y-=o,e.vel.z-=r},Constraint.prototype.satisfyPos=function(){var t=this.a,e=this.b;null===t.ev&&null===e.ev||e.t<t.t&&(e=this.a,t=this.a);var i=this.a.ent.getPosition(),s=this.b.ent.getPosition(),h=s.x-i.x,o=s.y-i.y,r=s.z-i.z,n=Math.sqrt(h*h+o*o+r*r),l=this.rLength-n;h=l*h/n*.5,o=l*o/n*.5,r=l*r/n*.5,this.b.ent.setPosition(s.x-h,s.y-o,s.z-r)},Vehicle.prototype.initialize=function(){if(null===Vehicle.COLLIDER&&(Vehicle.COLLIDER=new altern.EllipsoidCollider(1,1,1,1e-5,!0)),this.testMask=48,this.testColliderMask=48,this.testMask=64,this.testColliderMask=112,this.testMask=64,this.testColliderMask=-1,this.collider=Vehicle.COLLIDER,this.maxFrameTime=1/24,this.groundedCount=0,this.sphereParts=[this.bl=new SpherePart(this.wheelBL),this.br=new SpherePart(this.wheelBR),this.fl=new SpherePart(this.wheelFL),this.fr=new SpherePart(this.wheelFR)],this.constraints=[this.bl_br=new Constraint(this.bl,this.br),this.bl_fl=new Constraint(this.bl,this.fl),this.bl_fr=new Constraint(this.bl,this.fr),this.br_fl=new Constraint(this.br,this.fl),this.br_fr=new Constraint(this.br,this.fr),this.fl_fr=new Constraint(this.fl,this.fr)],this.fore=null,this.aft=null,this.foreSphere&&(this.sphereParts.push(this.fore=new SpherePart(this.foreSphere)),this.constraints.push(new Constraint(this.fore,this.fl),new Constraint(this.fore,this.fr)),this.constraints.push(new Constraint(this.fore,this.bl),new Constraint(this.fore,this.br))),this.aftSphere&&(this.sphereParts.push(this.aft=new SpherePart(this.aftSphere)),this.constraints.push(new Constraint(this.aft,this.bl),new Constraint(this.aft,this.br)),this.constraints.push(new Constraint(this.aft,this.fl),new Constraint(this.aft,this.fr))),this.fore&&this.aft&&this.constraints.push(new Constraint(this.fore,this.aft)),null!==this.entity.collision&&this.entity.collision.enabled){var t=new pc.GraphNode;t.collision=this.entity.collision,this.entity.addChild(t),this.hull=new SpherePart(t)}if(this.hull){var e,i=this.sphereParts.length;for(e=0;e<i;e++)this.constraints.push(new Constraint(this.hull,this.sphereParts[e]));this.sphereParts.push(this.hull)}this.steeringForce=new pc.Vec3,this.displacement=new altern.Vector3D,this.source=new altern.Vector3D,this.resCollisionPoint=new altern.Vector3D,this.resCollisionPlane=new altern.Vector3D,this.moveResult=new altern.MoveResult,this.collisionResult=new altern.CollisionResult,this.steer=0,this.pivot=null,this.gear=0,this.right=new pc.Vec3,this.forward=new pc.Vec3,this.up=new pc.Vec3},Vehicle.prototype.applyForce=function(t,e,i,s){this.steer=s||0,this.pivot=e,this.gear=i||0,0!==this.groundedCount&&this.steeringForce.add(t)},Vehicle.prototype.calcVelocities=function(t){var e,i,s,h,o=null,r=null,n=null,l=this.gravForce*t,a=this.steeringForce.x*this.steeringForce.x+this.steeringForce.y*this.steeringForce.y+this.steeringForce.z*this.steeringForce.z>1e-6,c=this.steeringForce.x*t,u=this.steeringForce.y*t,p=this.steeringForce.z*t;for(i=this.sphereParts.length,e=0;e<i;e++)(s=(h=this.sphereParts[e]).vel).y-=!a&&h.grounded?0:l;var d=this.gear<2;if(0!==this.steer)this.steer<0?(o=d?this.fl:this.bl,r=d?this.fr:this.br):(o=d?this.fr:this.br,r=d?this.fl:this.bl),n=d?this.fore:this.aft;else for(i=this.sphereParts.length,e=0;e<i;e++)(s=this.sphereParts[e].vel).x+=c,s.y+=u,s.z+=p;for(o&&(o.vel.x+=c,o.vel.y+=u,o.vel.z+=p),r&&(r.vel.x+=c,r.vel.y+=u,r.vel.z+=p),n&&(n.vel.x+=c,n.vel.y+=u,n.vel.z+=p),i=this.constraints.length,e=0;e<i;e++)this.constraints[e].satisfyVel();return!0},Vehicle.prototype.postInitialize=function(){this.collisionScene=this.collisionSceneEntity?this.collisionSceneEntity.collisionScene:this.app.root.collisionScene||(this.app.root.children.length?this.app.root.children[0].collisionScene||(this.app.root.children[0].children.length?this.app.root.children[0].children[0].collisionScene:null):null)||(window.Rootscene?Rootscene.SCENE:null),this.collisionScene||alert("Vehicle:: Failed to find collision scene!"),null==this.collisionScene&&(console.warn("Vehicle :: Collision scene currently empty!"),this.collisionScene=new altern.CollisionBoundNode)},Vehicle.prototype.processMoveResult=function(t,e,i){var s,h,o,r=1/0,n=null,l=!1;for(s=t.collisions;s;s=h)h=s.next,(o=s.normal.y>=this.groundNormalThreshold)&&(l=!0),!o&&s.t<r&&(n=s,r=s.t),s.next=altern.CollisionEvent.COLLECTOR,altern.CollisionEvent.COLLECTOR=s;e.grounded=l,e.t=r,e.c=null!==n,t.collisions=null,this.collider.getResultVelocity(e.vel)},Vehicle.prototype.update=function(t){var e,i,s,h;t>this.maxFrameTime&&(t=this.maxFrameTime);var o,r,n=1/0,l=null,a=1/0,c=null;if(this.calcVelocities(t)){this.groundedCount=0,h=this.sphereParts.length;var u=this.gravSuspensionDist>0?-this.gravSuspensionDist:-this.gravForce*t;for(s=0;s<h;s++)o=this.sphereParts[s],this.collider.radiusX=o.ent.collision.radius,this.collider.radiusZ=o.ent.collision.radius,this.collider.radiusY="sphere"!==o.ent.collision.type?.5*o.ent.collision.height:o.ent.collision.radius,e=o.ent.getPosition(),this.displacement.x=o.vel.x,this.displacement.y=o.vel.y,this.displacement.z=o.vel.z,i=0!=(1<<s&this.testColliderMask)?this.calcDestination(e,this.collisionScene):this.calcDestinationNoCollision(e),o.tPos.x=i.x,o.tPos.y=i.y,o.tPos.z=i.z,o.ent.setPosition(i.x,i.y,i.z),o.grounded=!1,o.t=1/0,o.c=!1,this.moveResult.collisions?(this.processMoveResult(this.moveResult,o,t),o.c&&s<4&&o.t<=a&&(a=o.t,c=o),o.c&&o.t<=n&&0!=(1<<s&this.testMask)&&(n=o.t,l=o),o.grounded&&s<4&&this.groundedCount++):(this.displacement.x=0,this.displacement.y=u,this.displacement.z=0,this.collider.getCollision(this.source,this.displacement,this.resCollisionPoint,this.resCollisionPlane,this.collisionScene)&&(o.grounded=this.resCollisionPlane.y>=this.groundNormalThreshold,o.grounded&&s<4&&this.groundedCount++))}var p=this.gear<2;if(e=(o=null!==l?l:p&&16&this.testMask?this.fore:32&this.testMask?this.aft:this.hull?this.hull:this.fr).ent.getPosition(),4===this.orientStyle){var d=this.fr,f=this.fl;null!==c&&(c===this.fr||c===this.fl?(r=c!==this.fl,d=this.fr,f=this.fl):(r=c!==this.bl,d=this.br,f=this.bl)),this.right.sub2(d.ent.getPosition(),f.ent.getPosition()),this.forward.sub2((r?this.fr:this.fl).ent.getPosition(),(r?this.br:this.bl).ent.getPosition()),this.right.normalize(),this.forward.normalize(),this.up.cross(this.right,this.forward)}else this.forward.sub2(this.fore.ent.getPosition(),this.aft.ent.getPosition()),this.forward.normalize(),this.right.x=-this.forward.z,this.right.z=this.forward.x,this.right.y=0,this.right.normalize(),this.up.x=0,this.up.y=1,this.up.z=0;this.entity.setPosition(e.x+this.right.x*o.pos.x-this.up.x*o.pos.y-this.forward.x*o.pos.z,e.y-this.up.y*o.pos.y+this.right.y*o.pos.x-this.forward.y*o.pos.z,e.z-this.forward.z*o.pos.z+this.right.z*o.pos.x-this.up.z*o.pos.y),e=this.entity.getPosition(),this.entity.lookAt(e.x-this.forward.x,e.y-this.forward.y,e.z-this.forward.z,this.up.x,this.up.y,this.up.z);this.collider.threshold,this.collider.threshold;for(s=0;s<h;s++)o=this.sphereParts[s],0!=(1<<s&this.testColliderMask)?o.ent.setPosition(o.tPos.x,o.tPos.y,o.tPos.z):o.ent.setLocalPosition(o.pos.x,o.pos.y,o.pos.z);var y=this.damp;for(this.steeringForce.x-=1*this.steeringForce.x,this.steeringForce.y-=1*this.steeringForce.y,this.steeringForce.z-=1*this.steeringForce.z,this.steeringForce.x*this.steeringForce.x+this.steeringForce.y*this.steeringForce.y+this.steeringForce.z*this.steeringForce.z<1e-6&&(this.steeringForce.x=0,this.steeringForce.y=0,this.steeringForce.z=0),h=this.sphereParts.length,s=0;s<h;s++)o=this.sphereParts[s],v=o.vel,v.x-=v.x*y,v.y-=v.y*y,v.z-=v.z*y,v.x*v.x+v.y*v.y+v.z*v.z<1e-6&&(v.x=0,v.y=0,v.z=0)},Vehicle.prototype.calcDestinationNoCollision=function(t){return this.moveResult.x=t.x+this.displacement.x,this.moveResult.y=t.y+this.displacement.y,this.moveResult.z=t.z+this.displacement.z,this.moveResult.collisions=null,this.moveResult},Vehicle.prototype.calcDestination=function(t,e){this.source.x=t.x,this.source.y=t.y,this.source.z=t.z;var i=this.collider.calculateDestination(this.source,this.displacement,e);return this.moveResult.x=i.x,this.moveResult.y=i.y,this.moveResult.z=i.z,this.moveResult.collisions=this.collider.collisions,this.collider.collisions=null,i};