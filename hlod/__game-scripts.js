!function(t,i){"use strict";t.hxPixels=t.hxPixels||{};var e={},$estr=function(){return js_Boot.__string_rec(this,"")};function $extend(t,i){function Inherit(){}Inherit.prototype=t;var e=new Inherit;for(var n in i)e[n]=i[n];return i.toString!==Object.prototype.toString&&(e.toString=i.toString),e}var HxOverrides=function(){};e.HxOverrides=HxOverrides,HxOverrides.__name__=["HxOverrides"],HxOverrides.cca=function(t,i){var e=t.charCodeAt(i);if(e==e)return e},HxOverrides.remove=function(t,i){var e=t.indexOf(i);return-1!=e&&(t.splice(e,1),!0)},HxOverrides.iter=function(t){return{cur:0,arr:t,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var Lambda=function(){};e.Lambda=Lambda,Lambda.__name__=["Lambda"],Lambda.array=function(t){for(var i=[],e=function $iterator(t){return t instanceof Array?function(){return HxOverrides.iter(t)}:"function"==typeof t.iterator?$bind(t,t.iterator):t.iterator}(t)();e.hasNext();){var n=e.next();i.push(n)}return i};var n=t.altern=function(){};e.MainJS=n,n.__name__=["MainJS"],n.main=function(){var t=n;t.LODBatchHierachy=altern_culling_LODBatchHierachy,t.ResultType=m,t.WindingRule=u,t.Tess2=hxGeomAlgo_Tess2,t.IsoContoursPixels=hxGeomAlgo_IsoContoursPixels,t.TerrainCollidable=altern_terrain_TerrainCollidable,t.CullingPlane=altern_culling_CullingPlane,t.GeometryResult=altern_terrain_GeometryResult,t.QuadCornerData=altern_terrain_QuadCornerData,t.TerrainGeomTools=altern_terrain_TerrainGeomTools,t.TerrainLOD=altern_terrain_TerrainLOD,t.HeightMapInfo=altern_terrain_HeightMapInfo,t.TerrainChunkStateList=altern_terrain_TerrainChunkStateList,t.TerrainChunkState=altern_terrain_TerrainChunkState,t.QuadChunkCornerData=altern_terrain_QuadChunkCornerData,t.QuadSquareChunk=altern_terrain_QuadSquareChunk,t.QuadTreePage=altern_terrain_QuadTreePage,t.Bytes=haxe_io_Bytes,t.Serializer=hxbit_Serializer,t.IntersectSlopeUtil=altern_geom_IntersectSlopeUtil,t.BVHTree=altern_partition_js_BVHTree,t.DefaultCulling=altern_culling_DefaultCulling,t.CullingPlane=altern_culling_CullingPlane,t.GeomCollisionSceneUtil=util_geom_GeomCollisionSceneUtil,t.GeomUtil=util_geom_GeomUtil,t.Raycaster=altern_ray_Raycaster,t.DBVTProxy=altern_collisions_dbvt_DBVTProxy,t.DBVTNode=altern_collisions_dbvt_DBVTNode,t.DBVT=altern_collisions_dbvt_DBVT,t.IRaycastImpl=altern_ray_IRaycastImpl,t.ITCollidable=systems_collisions_ITCollidable,t.Geometry=util_geom_Geometry,t.BoundBox=components_BoundBox,t.Transform3D=components_Transform3D,t.AABBUtils=util_geom_AABBUtils,t.CollisionBoundNode=altern_collisions_CollisionBoundNode,t.Vec3=util_geom_Vec3,t.Vector3D=jeash_geom_Vector3D,t.LibUtil=util_LibUtil,t.Jump=components_Jump,t.SurfaceMovement=components_controller_SurfaceMovement,t.CollisionResult=components_CollisionResult,t.MoveResult=components_MoveResult,t.EllipsoidCollider=systems_collisions_EllipsoidCollider},Math.__name__=["Math"];var Reflect=function(){};e.Reflect=Reflect,Reflect.__name__=["Reflect"],Reflect.field=function(t,i){try{return t[i]}catch(t){return null}},Reflect.fields=function(t){var i=[];if(null!=t){var e=Object.prototype.hasOwnProperty;for(var n in t)"__id__"!=n&&"hx__closures__"!=n&&e.call(t,n)&&i.push(n)}return i},Reflect.compare=function(t,i){return t==i?0:t>i?1:-1},Reflect.isEnumValue=function(t){return null!=t&&null!=t.__enum__};var Std=function(){};e.Std=Std,Std.__name__=["Std"],Std.string=function(t){return js_Boot.__string_rec(t,"")};var s=e.ValueType={__ename__:!0,__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};s.TNull=["TNull",0],s.TNull.toString=$estr,s.TNull.__enum__=s,s.TInt=["TInt",1],s.TInt.toString=$estr,s.TInt.__enum__=s,s.TFloat=["TFloat",2],s.TFloat.toString=$estr,s.TFloat.__enum__=s,s.TBool=["TBool",3],s.TBool.toString=$estr,s.TBool.__enum__=s,s.TObject=["TObject",4],s.TObject.toString=$estr,s.TObject.__enum__=s,s.TFunction=["TFunction",5],s.TFunction.toString=$estr,s.TFunction.__enum__=s,s.TClass=function(t){var i=["TClass",6,t];return i.__enum__=s,i.toString=$estr,i},s.TEnum=function(t){var i=["TEnum",7,t];return i.__enum__=s,i.toString=$estr,i},s.TUnknown=["TUnknown",8],s.TUnknown.toString=$estr,s.TUnknown.__enum__=s;var Type=function(){};e.Type=Type,Type.__name__=["Type"],Type.getSuperClass=function(t){return t.__super__},Type.getClassName=function(t){var i=t.__name__;return null==i?null:i.join(".")},Type.resolveClass=function(t){var i=e[t];return null!=i&&i.__name__?i:null},Type.resolveEnum=function(t){var i=e[t];return null!=i&&i.__ename__?i:null},Type.createEmptyInstance=function(t){function empty(){}return empty.prototype=t.prototype,new empty},Type.typeof=function(t){switch(typeof t){case"boolean":return s.TBool;case"function":return t.__name__||t.__ename__?s.TObject:s.TFunction;case"number":return Math.ceil(t)==t%2147483648?s.TInt:s.TFloat;case"object":if(null==t)return s.TNull;var i=t.__enum__;if(null!=i)return s.TEnum(i);var e=js_Boot.getClass(t);return null!=e?s.TClass(e):s.TObject;case"string":return s.TClass(String);case"undefined":return s.TNull;default:return s.TUnknown}},Type.enumEq=function(t,i){if(t==i)return!0;try{if(t[0]!=i[0])return!1;for(var e=2,n=t.length;e<n;){var s=e++;if(!Type.enumEq(t[s],i[s]))return!1}var r=t.__enum__;if(r!=i.__enum__||null==r)return!1}catch(t){return!1}return!0};var systems_collisions_IECollidable=function(){};e["systems.collisions.IECollidable"]=systems_collisions_IECollidable,systems_collisions_IECollidable.__name__=["systems","collisions","IECollidable"],systems_collisions_IECollidable.prototype={__class__:systems_collisions_IECollidable};var altern_collisions_CollisionBoundNode=function(){};e["altern.collisions.CollisionBoundNode"]=altern_collisions_CollisionBoundNode,altern_collisions_CollisionBoundNode.__name__=["altern","collisions","CollisionBoundNode"],altern_collisions_CollisionBoundNode.__interfaces__=[systems_collisions_IECollidable],altern_collisions_CollisionBoundNode.calculateLocalToGlobal2=function(t,i){(i=null!=i?i:new components_Transform3D).copy(t.transform);for(var e=t;null!=e._parent;)e=e._parent,i.append(e.transform);return i},altern_collisions_CollisionBoundNode.calculateGlobalToLocal2=function(t,i){(i=null!=i?i:new components_Transform3D).copy(t.inverseTransform);for(var e=t;null!=e._parent;)e=e._parent,i.prepend(e.inverseTransform);return i},altern_collisions_CollisionBoundNode.create=function(t,i){var e=new altern_collisions_CollisionBoundNode;return e.transform=t,null==i?(e.inverseTransform=new components_Transform3D,e.inverseTransform.calculateInversion(e.transform)):e.inverseTransform=i,e.localToGlobalTransform=new components_Transform3D,e.globalToLocalTransform=new components_Transform3D,e},altern_collisions_CollisionBoundNode.createNew=function(t,i,e,n){var s=altern_collisions_CollisionBoundNode.create(null!=t?t:new components_Transform3D,i);return s.collidable=e,s.raycastable=null!=n?n:js_Boot.__instanceof(e,altern_ray_IRaycastImpl)?e:null,s},altern_collisions_CollisionBoundNode.prototype={calculateLocalGlobalTransforms:function(){var t=this.localToGlobalTransform;(t=null!=t?t:new components_Transform3D).copy(this.transform);for(var i=this;null!=i._parent;)i=i._parent,t.append(i.transform);this.globalToLocalTransform.calculateInversion(this.localToGlobalTransform)},calculateLocalWorldTransforms:function(){null==this.worldToLocalTransform&&(this.worldToLocalTransform=new components_Transform3D),null==this.localToWorldTransform&&(this.localToWorldTransform=new components_Transform3D);var t=this.localToWorldTransform;(t=null!=t?t:new components_Transform3D).copy(this.transform);for(var i=this;null!=i._parent;)i=i._parent,t.append(i.transform);this.worldToLocalTransform.calculateInversion(this.localToWorldTransform)},mirrorClone:function(){var t=altern_collisions_CollisionBoundNode.create(this.transform,this.inverseTransform);t.collidable=this.collidable,t.boundBox=this.boundBox,t.raycastable=this.raycastable;for(var i=this.childrenList,e=null;null!=i;){var n=i.mirrorClone();null!=t.childrenList?e.next=n:t.childrenList=n,e=n,n._parent=t,i=i.next}return t},updateTransform:function(t){this.transform.copy(t),this.inverseTransform.calculateInversion(this.transform)},collectGeometry:function(t){this.globalToLocalTransform.combine(this.inverseTransform,t.matrix),t.calculateSphere(this.globalToLocalTransform),this.localToGlobalTransform.combine(t.inverseMatrix,this.transform),null!=this.collidable&&this.collidable.collectGeometryAndTransforms(t,this.localToGlobalTransform),null!=this.childrenList&&this.visitChildren(t)},intersectRay:function(t,i,e){for(var n=null!=this.raycastable?this.raycastable.intersectRay(t,i,e):null,s=null!=n?n.w:0!=e.w?e.w:0!=i.w?i.w:1e22,r=null,a=null,h=this.childrenList;null!=h;)if(null==r&&(r=new jeash_geom_Vector3D,a=new jeash_geom_Vector3D),r.x=h.inverseTransform.a*t.x+h.inverseTransform.b*t.y+h.inverseTransform.c*t.z+h.inverseTransform.d,r.y=h.inverseTransform.e*t.x+h.inverseTransform.f*t.y+h.inverseTransform.g*t.z+h.inverseTransform.h,r.z=h.inverseTransform.i*t.x+h.inverseTransform.j*t.y+h.inverseTransform.k*t.z+h.inverseTransform.l,a.x=h.inverseTransform.a*i.x+h.inverseTransform.b*i.y+h.inverseTransform.c*i.z,a.y=h.inverseTransform.e*i.x+h.inverseTransform.f*i.y+h.inverseTransform.g*i.z,a.z=h.inverseTransform.i*i.x+h.inverseTransform.j*i.y+h.inverseTransform.k*i.z,a.w=s,null==h.boundBox||util_geom_AABBUtils.intersectRay(h.boundBox,r,a)){var o=h.intersectRay(r,a,e);null!=o&&o.w<s&&(s=o.w,n=o),h=h.next}else h=h.next;return n},visitChildren:function(t){for(var i=this.childrenList;null!=i;){i.globalToLocalTransform.combine(i.inverseTransform,this.globalToLocalTransform);var e=!0;if(t.calculateSphere(i.globalToLocalTransform),null!=i.boundBox){var n=i.boundBox,s=t.sphere;e=s.x+s.w>n.minX&&s.x-s.w<n.maxX&&s.y+s.w>n.minY&&s.y-s.w<n.maxY&&s.z+s.w>n.minZ&&s.z-s.w<n.maxZ}e&&(i.localToGlobalTransform.combine(this.localToGlobalTransform,i.transform),null!=i.collidable&&i.collidable.collectGeometryAndTransforms(t,i.localToGlobalTransform),null!=i.childrenList&&i.visitChildren(t)),i=i.next}},addChild:function(t){if(null==t)throw new js__$Boot_HaxeError("Parameter child must be non-null.");if(t==this)throw new js__$Boot_HaxeError("An object cannot be added as a child of itself.");for(var i=this._parent;null!=i;){if(i==t)throw new js__$Boot_HaxeError("An object cannot be added as a child to one of it's children (or children's children, etc.).");i=i._parent}if(t._parent!=this)null!=t._parent&&t._parent.removeChild(t),this.addToList(t),t._parent=this;else{if(null==(t=this.removeFromList(t)))throw new js__$Boot_HaxeError("Cannot add child.");this.addToList(t)}return t},removeChild:function(t){if(null==t)throw new js__$Boot_HaxeError("Parameter child must be non-null.");if(t._parent!=this)throw new js__$Boot_HaxeError("The supplied CollisionBoundNode must be a child of the caller.");if(null==(t=this.removeFromList(t)))throw new js__$Boot_HaxeError("Cannot remove child.");return t._parent=null,t},addToList:function(t,i){if(t.next=i,i==this.childrenList)this.childrenList=t;else for(var e=this.childrenList;null!=e;){if(e.next==i){e.next=t;break}e=e.next}},removeFromList:function(t){for(var i=null,e=this.childrenList;null!=e;){if(e==t)return null!=i?i.next=e.next:this.childrenList=e.next,e.next=null,t;i=e,e=e.next}return null},_prepend:function(t){t.next=this.childrenList,this.childrenList=t,t._parent=this},_removeHead:function(){var t=this.childrenList;null!=t&&(this.childrenList=t.next),t._parent=null},__class__:altern_collisions_CollisionBoundNode};var r={};e["altern.collisions.dbvt._AbstractAABB.AbstractAABB_Impl_"]=r,r.__name__=["altern","collisions","dbvt","_AbstractAABB","AbstractAABB_Impl_"],r.get_minX=function(t){return t.minX},r.get_minY=function(t){return t.minY},r.get_minZ=function(t){return t.minZ},r.get_maxX=function(t){return t.maxX},r.get_maxY=function(t){return t.maxY},r.get_maxZ=function(t){return t.maxZ},r._new=function(t,i,e,n,s,r){null==r&&(r=0),null==s&&(s=0),null==n&&(n=0),null==e&&(e=0),null==i&&(i=0),null==t&&(t=0);var a=new components_BoundBox;return a.minX=t,a.maxX=i,a.minY=e,a.maxY=n,a.minZ=s,a.maxZ=r,a},r.init=function(t,i,e,n,s,r,a){null==a&&(a=0),null==r&&(r=0),null==s&&(s=0),null==n&&(n=0),null==e&&(e=0),null==i&&(i=0),t.minX=i,t.maxX=e,t.minY=n,t.maxY=s,t.minZ=r,t.maxZ=a},r.combine=function(t,i,e){i.minX<e.minX?t.minX=i.minX:t.minX=e.minX,i.maxX>e.maxX?t.maxX=i.maxX:t.maxX=e.maxX,i.minY<e.minY?t.minY=i.minY:t.minY=e.minY,i.maxY>e.maxY?t.maxY=i.maxY:t.maxY=e.maxY,i.minZ<e.minZ?t.minZ=i.minZ:t.minZ=e.minZ,i.maxZ>e.maxZ?t.maxZ=i.maxZ:t.maxZ=e.maxZ;t.minX-=0,t.minY-=0,t.minZ-=0,t.maxX+=0,t.maxY+=0,t.maxZ+=0},r.matchWith=function(t,i){t.minX=i.minX,t.minY=i.minY,t.minZ=i.minZ,t.maxX=i.maxX,t.maxY=i.maxY,t.maxZ=i.maxZ},r.surfaceArea=function(t){var i=t.maxY-t.minY,e=t.maxZ-t.minZ;return 2*((t.maxX-t.minX)*(i+e)+i*e)},r.intersectsWithPoint=function(t,i,e,n){return i>=t.minX&&i<=t.maxX&&e>=t.minY&&e<=t.maxY&&n>=t.minZ&&n<=t.maxZ};var altern_ray_IRaycastImpl=function(){};e["altern.ray.IRaycastImpl"]=altern_ray_IRaycastImpl,altern_ray_IRaycastImpl.__name__=["altern","ray","IRaycastImpl"],altern_ray_IRaycastImpl.prototype={__class__:altern_ray_IRaycastImpl};var systems_collisions_ITCollidable=function(){};e["systems.collisions.ITCollidable"]=systems_collisions_ITCollidable,systems_collisions_ITCollidable.__name__=["systems","collisions","ITCollidable"],systems_collisions_ITCollidable.prototype={__class__:systems_collisions_ITCollidable};var util_geom_XYZW=function(){};e["util.geom.XYZW"]=util_geom_XYZW,util_geom_XYZW.__name__=["util","geom","XYZW"],util_geom_XYZW.prototype={__class__:util_geom_XYZW};var jeash_geom_Vector3D=function(t,i,e,n){null==n&&(n=0),null==e&&(e=0),null==i&&(i=0),null==t&&(t=0),this.w=n,this.x=t,this.y=i,this.z=e};e["jeash.geom.Vector3D"]=jeash_geom_Vector3D,jeash_geom_Vector3D.__name__=["jeash","geom","Vector3D"],jeash_geom_Vector3D.__interfaces__=[util_geom_XYZW],jeash_geom_Vector3D.angleBetween=function(t,i){var e=new jeash_geom_Vector3D(t.x,t.y,t.z,t.w),n=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);0!=n&&(e.x/=n,e.y/=n,e.z/=n);var s=new jeash_geom_Vector3D(i.x,i.y,i.z,i.w),r=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return 0!=r&&(s.x/=r,s.y/=r,s.z/=r),Math.acos(e.x*s.x+e.y*s.y+e.z*s.z)},jeash_geom_Vector3D.distance=function(t,i){var e=i.x-t.x,n=i.y-t.y,s=i.z-t.z;return Math.sqrt(e*e+n*n+s*s)},jeash_geom_Vector3D.get_X_AXIS=function(){return new jeash_geom_Vector3D(1,0,0)},jeash_geom_Vector3D.get_Y_AXIS=function(){return new jeash_geom_Vector3D(0,1,0)},jeash_geom_Vector3D.get_Z_AXIS=function(){return new jeash_geom_Vector3D(0,0,1)},jeash_geom_Vector3D.prototype={get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},get_lengthSquared:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)*Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},add:function(t){return new jeash_geom_Vector3D(this.x+t.x,this.y+t.y,this.z+t.z)},clone:function(){return new jeash_geom_Vector3D(this.x,this.y,this.z,this.w)},crossProduct:function(t){return new jeash_geom_Vector3D(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,1)},decrementBy:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},dotProduct:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},equals:function(t,i){return null==i&&(i=!1),this.x==t.x&&this.y==t.y&&this.z==t.z&&(!i||this.w==t.w)},incrementBy:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},nearEquals:function(t,i,e){return null==e&&(e=!1),Math.abs(this.x-t.x)<i&&Math.abs(this.y-t.y)<i&&Math.abs(this.z-t.z)<i&&(!e||Math.abs(this.w-t.w)<i)},negate:function(){this.x*=-1,this.y*=-1,this.z*=-1},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0!=t&&(this.x/=t,this.y/=t,this.z/=t),t},project:function(){this.x/=this.w,this.y/=this.w,this.z/=this.w},scaleBy:function(t){this.x*=t,this.y*=t,this.z*=t},subtract:function(t){return new jeash_geom_Vector3D(this.x-t.x,this.y-t.y,this.z-t.z)},toString:function(){return"Vector3D("+this.x+", "+this.y+", "+this.z+")"},__class__:jeash_geom_Vector3D};var altern_collisions_dbvt_DBVT=function(){this._stack=[],this.freeNodes=[],this.numFreeNodes=0,this.aabb=r._new()};e["altern.collisions.dbvt.DBVT"]=altern_collisions_dbvt_DBVT,altern_collisions_dbvt_DBVT.__name__=["altern","collisions","dbvt","DBVT"],altern_collisions_dbvt_DBVT.__interfaces__=[altern_ray_IRaycastImpl,systems_collisions_ITCollidable],altern_collisions_dbvt_DBVT.prototype={purge:function(){this._stack.length=0},moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,e,n=t.aabb,s=this.root;null==s.proxy;){var r=s.child1,a=s.child2,h=s.aabb,o=r.aabb,l=a.aabb,u=h.maxY-h.minY,m=h.maxZ-h.minZ;i=2*((h.maxX-h.minX)*(u+m)+u*m);var c=this.aabb;n.minX<h.minX?c.minX=n.minX:c.minX=h.minX,n.maxX>h.maxX?c.maxX=n.maxX:c.maxX=h.maxX,n.minY<h.minY?c.minY=n.minY:c.minY=h.minY,n.maxY>h.maxY?c.maxY=n.maxY:c.maxY=h.maxY,n.minZ<h.minZ?c.minZ=n.minZ:c.minZ=h.minZ,n.maxZ>h.maxZ?c.maxZ=n.maxZ:c.maxZ=h.maxZ;c.minX-=0,c.minY-=0,c.minZ-=0,c.maxX+=0,c.maxY+=0,c.maxZ+=0;var f=this.aabb,x=f.maxY-f.minY,d=f.maxZ-f.minZ,_=2*(e=2*((f.maxX-f.minX)*(x+d)+x*d)),g=2*(e-i),p=g,v=this.aabb;n.minX<o.minX?v.minX=n.minX:v.minX=o.minX,n.maxX>o.maxX?v.maxX=n.maxX:v.maxX=o.maxX,n.minY<o.minY?v.minY=n.minY:v.minY=o.minY,n.maxY>o.maxY?v.maxY=n.maxY:v.maxY=o.maxY,n.minZ<o.minZ?v.minZ=n.minZ:v.minZ=o.minZ,n.maxZ>o.maxZ?v.maxZ=n.maxZ:v.maxZ=o.maxZ;if(v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,null!=r.proxy){var y=this.aabb,b=y.maxY-y.minY,w=y.maxZ-y.minZ;p+=2*((y.maxX-y.minX)*(b+w)+b*w)}else{var z=this.aabb,Y=z.maxY-z.minY,S=z.maxZ-z.minZ,X=o.maxY-o.minY,Z=o.maxZ-o.minZ;p+=2*((z.maxX-z.minX)*(Y+S)+Y*S)-2*((o.maxX-o.minX)*(X+Z)+X*Z)}var P=g,T=this.aabb;n.minX<l.minX?T.minX=n.minX:T.minX=l.minX,n.maxX>l.maxX?T.maxX=n.maxX:T.maxX=l.maxX,n.minY<l.minY?T.minY=n.minY:T.minY=l.minY,n.maxY>l.maxY?T.maxY=n.maxY:T.maxY=l.maxY,n.minZ<l.minZ?T.minZ=n.minZ:T.minZ=l.minZ,n.maxZ>l.maxZ?T.maxZ=n.maxZ:T.maxZ=l.maxZ;if(T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,null!=a.proxy){var L=this.aabb,I=L.maxY-L.minY,O=L.maxZ-L.minZ;P+=2*((L.maxX-L.minX)*(I+O)+I*O)}else{var E=this.aabb,C=E.maxY-E.minY,D=E.maxZ-E.minZ,k=l.maxY-l.minY,A=l.maxZ-l.minZ;P+=2*((E.maxX-E.minX)*(C+D)+C*D)-2*((l.maxX-l.minX)*(k+A)+k*A)}if(p<P){if(_<p)break;s=r}else{if(_<P)break;s=a}}var M,R=s.parent;(M=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new altern_collisions_dbvt_DBVTNode).parent=R,M.child1=t,M.child2=s;var B=M.aabb,N=t.aabb,V=s.aabb;N.minX<V.minX?B.minX=N.minX:B.minX=V.minX,N.maxX>V.maxX?B.maxX=N.maxX:B.maxX=V.maxX,N.minY<V.minY?B.minY=N.minY:B.minY=V.minY,N.maxY>V.maxY?B.maxY=N.maxY:B.maxY=V.maxY,N.minZ<V.minZ?B.minZ=N.minZ:B.minZ=V.minZ,N.maxZ>V.maxZ?B.maxZ=N.maxZ:B.maxZ=V.maxZ;for(B.minX-=0,B.minY-=0,B.minZ-=0,B.maxX+=0,B.maxY+=0,B.maxZ+=0,M.height=s.height+1,s.parent=M,t.parent=M,s==this.root?this.root=M:R.child1==s?R.child1=M:R.child2=M;;){var F=(M=this.balance(M)).child1,j=M.child2,U=M.aabb,q=F.aabb,G=j.aabb;q.minX<G.minX?U.minX=q.minX:U.minX=G.minX,q.maxX>G.maxX?U.maxX=q.maxX:U.maxX=G.maxX,q.minY<G.minY?U.minY=q.minY:U.minY=G.minY,q.maxY>G.maxY?U.maxY=q.maxY:U.maxY=G.maxY,q.minZ<G.minZ?U.minZ=q.minZ:U.minZ=G.minZ,q.maxZ>G.maxZ?U.maxZ=q.maxZ:U.maxZ=G.maxZ;U.minX-=0,U.minY-=0,U.minZ-=0,U.maxX+=0,U.maxY+=0,U.maxZ+=0;var H=F.height,W=j.height;if(M.height=H<W?W+1:H+1,null==(M=M.parent))break}}else this.root=t},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,e=t.parent;if(i=e.child1==t?e.child2:e.child1,e==this.root)return this.root=i,void(i.parent=null);var n=e.parent;for(i.parent=n,n.child1==e?n.child1=i:n.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=e);;){var s=(n=this.balance(n)).child1,r=n.child2,a=n.aabb,h=s.aabb,o=r.aabb;h.minX<o.minX?a.minX=h.minX:a.minX=o.minX,h.maxX>o.maxX?a.maxX=h.maxX:a.maxX=o.maxX,h.minY<o.minY?a.minY=h.minY:a.minY=o.minY,h.maxY>o.maxY?a.maxY=h.maxY:a.maxY=o.maxY,h.minZ<o.minZ?a.minZ=h.minZ:a.minZ=o.minZ,h.maxZ>o.maxZ?a.maxZ=h.maxZ:a.maxZ=o.maxZ;a.minX-=0,a.minY-=0,a.minZ-=0,a.maxX+=0,a.maxY+=0,a.maxZ+=0;var l=s.height,u=r.height;if(n.height=l<u?u+1:l+1,null==(n=n.parent))break}}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var e,n=t.parent,s=t.child1,r=t.child2,a=s.height,h=r.height,o=a-h;if(o>1){var l=s.child1,u=s.child2,m=l.height,c=u.height;if(m>c){s.child2=t,t.parent=s,t.child1=u,u.parent=t;var f=t.aabb,x=u.aabb,d=r.aabb;x.minX<d.minX?f.minX=x.minX:f.minX=d.minX,x.maxX>d.maxX?f.maxX=x.maxX:f.maxX=d.maxX,x.minY<d.minY?f.minY=x.minY:f.minY=d.minY,x.maxY>d.maxY?f.maxY=x.maxY:f.maxY=d.maxY,x.minZ<d.minZ?f.minZ=x.minZ:f.minZ=d.minZ,x.maxZ>d.maxZ?f.maxZ=x.maxZ:f.maxZ=d.maxZ;f.minX-=0,f.minY-=0,f.minZ-=0,f.maxX+=0,f.maxY+=0,f.maxZ+=0,e=c-h,t.height=c-(e&e>>31)+1;var _=s.aabb,g=l.aabb,p=t.aabb;g.minX<p.minX?_.minX=g.minX:_.minX=p.minX,g.maxX>p.maxX?_.maxX=g.maxX:_.maxX=p.maxX,g.minY<p.minY?_.minY=g.minY:_.minY=p.minY,g.maxY>p.maxY?_.maxY=g.maxY:_.maxY=p.maxY,g.minZ<p.minZ?_.minZ=g.minZ:_.minZ=p.minZ,g.maxZ>p.maxZ?_.maxZ=g.maxZ:_.maxZ=p.maxZ;_.minX-=0,_.minY-=0,_.minZ-=0,_.maxX+=0,_.maxY+=0,_.maxZ+=0,e=m-i,s.height=m-(e&e>>31)+1}else{s.child1=t,t.parent=s,t.child1=l,l.parent=t;var v=t.aabb,y=l.aabb,b=r.aabb;y.minX<b.minX?v.minX=y.minX:v.minX=b.minX,y.maxX>b.maxX?v.maxX=y.maxX:v.maxX=b.maxX,y.minY<b.minY?v.minY=y.minY:v.minY=b.minY,y.maxY>b.maxY?v.maxY=y.maxY:v.maxY=b.maxY,y.minZ<b.minZ?v.minZ=y.minZ:v.minZ=b.minZ,y.maxZ>b.maxZ?v.maxZ=y.maxZ:v.maxZ=b.maxZ;v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,e=m-h,t.height=m-(e&e>>31)+1;var w=s.aabb,z=t.aabb,Y=u.aabb;z.minX<Y.minX?w.minX=z.minX:w.minX=Y.minX,z.maxX>Y.maxX?w.maxX=z.maxX:w.maxX=Y.maxX,z.minY<Y.minY?w.minY=z.minY:w.minY=Y.minY,z.maxY>Y.maxY?w.maxY=z.maxY:w.maxY=Y.maxY,z.minZ<Y.minZ?w.minZ=z.minZ:w.minZ=Y.minZ,z.maxZ>Y.maxZ?w.maxZ=z.maxZ:w.maxZ=Y.maxZ;w.minX-=0,w.minY-=0,w.minZ-=0,w.maxX+=0,w.maxY+=0,w.maxZ+=0,e=i-c,s.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=s:n.child2=s:this.root=s,s.parent=n,s}if(o<-1){var S=r.child1,X=r.child2,Z=S.height,P=X.height;if(Z>P){r.child2=t,t.parent=r,t.child2=X,X.parent=t;var T=t.aabb,L=s.aabb,I=X.aabb;L.minX<I.minX?T.minX=L.minX:T.minX=I.minX,L.maxX>I.maxX?T.maxX=L.maxX:T.maxX=I.maxX,L.minY<I.minY?T.minY=L.minY:T.minY=I.minY,L.maxY>I.maxY?T.maxY=L.maxY:T.maxY=I.maxY,L.minZ<I.minZ?T.minZ=L.minZ:T.minZ=I.minZ,L.maxZ>I.maxZ?T.maxZ=L.maxZ:T.maxZ=I.maxZ;T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,e=a-P,t.height=a-(e&e>>31)+1;var O=r.aabb,E=S.aabb,C=t.aabb;E.minX<C.minX?O.minX=E.minX:O.minX=C.minX,E.maxX>C.maxX?O.maxX=E.maxX:O.maxX=C.maxX,E.minY<C.minY?O.minY=E.minY:O.minY=C.minY,E.maxY>C.maxY?O.maxY=E.maxY:O.maxY=C.maxY,E.minZ<C.minZ?O.minZ=E.minZ:O.minZ=C.minZ,E.maxZ>C.maxZ?O.maxZ=E.maxZ:O.maxZ=C.maxZ;O.minX-=0,O.minY-=0,O.minZ-=0,O.maxX+=0,O.maxY+=0,O.maxZ+=0,e=Z-i,r.height=Z-(e&e>>31)+1}else{r.child1=t,t.parent=r,t.child2=S,S.parent=t;var D=t.aabb,k=s.aabb,A=S.aabb;k.minX<A.minX?D.minX=k.minX:D.minX=A.minX,k.maxX>A.maxX?D.maxX=k.maxX:D.maxX=A.maxX,k.minY<A.minY?D.minY=k.minY:D.minY=A.minY,k.maxY>A.maxY?D.maxY=k.maxY:D.maxY=A.maxY,k.minZ<A.minZ?D.minZ=k.minZ:D.minZ=A.minZ,k.maxZ>A.maxZ?D.maxZ=k.maxZ:D.maxZ=A.maxZ;D.minX-=0,D.minY-=0,D.minZ-=0,D.maxX+=0,D.maxY+=0,D.maxZ+=0,e=a-Z,t.height=a-(e&e>>31)+1;var M=r.aabb,R=t.aabb,B=X.aabb;R.minX<B.minX?M.minX=R.minX:M.minX=B.minX,R.maxX>B.maxX?M.maxX=R.maxX:M.maxX=B.maxX,R.minY<B.minY?M.minY=R.minY:M.minY=B.minY,R.maxY>B.maxY?M.maxY=R.maxY:M.maxY=B.maxY,R.minZ<B.minZ?M.minZ=R.minZ:M.minZ=B.minZ,R.maxZ>B.maxZ?M.maxZ=R.maxZ:M.maxZ=B.maxZ;M.minX-=0,M.minY-=0,M.minZ-=0,M.maxX+=0,M.maxY+=0,M.maxZ+=0,e=i-P,r.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=r:n.child2=r:this.root=r,r.parent=n,r}return t},fix:function(t){var i=t.child1,e=t.child2,n=t.aabb,s=i.aabb,r=e.aabb;s.minX<r.minX?n.minX=s.minX:n.minX=r.minX,s.maxX>r.maxX?n.maxX=s.maxX:n.maxX=r.maxX,s.minY<r.minY?n.minY=s.minY:n.minY=r.minY,s.maxY>r.maxY?n.maxY=s.maxY:n.maxY=r.maxY,s.minZ<r.minZ?n.minZ=s.minZ:n.minZ=r.minZ,s.maxZ>r.maxZ?n.maxZ=s.maxZ:n.maxZ=r.maxZ;n.minX-=0,n.minY-=0,n.minZ-=0,n.maxX+=0,n.maxY+=0,n.maxZ+=0;var a=i.height,h=e.height;t.height=a<h?h+1:a+1},collectGeometryAndTransforms:function(t,i){var e=0,n=this._stack;n[e++]=this.root;var s=altern_collisions_dbvt_DBVT.COLLIDER_SPHERE;for(s.x=t.sphere.x,s.y=t.sphere.y,s.z=t.sphere.z,s.w=t.sphere.w;--e>=0;){var r=n[e];s.x+s.w>r.aabb.minX&&s.x-s.w<r.aabb.maxX&&s.y+s.w>r.aabb.minY&&s.y-s.w<r.aabb.maxY&&s.z+s.w>r.aabb.minZ&&s.z-s.w<r.aabb.maxZ&&(null!=r.child1&&(n[e++]=r.child1),null!=r.child2&&(n[e++]=r.child2),null!=r.proxy&&null!=r.proxy.collidable&&(null!=r.proxy.transform?(r.proxy.globalToLocalTransform.combine(r.proxy.inverseTransform,t.matrix),t.calculateSphere(r.proxy.globalToLocalTransform),r.proxy.localToGlobalTransform.combine(t.inverseMatrix,r.proxy.transform),r.proxy.collidable.collectGeometryAndTransforms(t,r.proxy.localToGlobalTransform)):r.proxy.collidable.collectGeometryAndTransforms(t,i)))}},intersectRay:function(t,i,e){var n=0,s=this._stack;s[n++]=this.root;for(var r=null,a=0!=e.w?e.w:0!=i.w?i.w:1e22;--n>=0;){var h=s[n];if(util_geom_GeomUtil.boundIntersectRay(t,i,h.aabb.minX,h.aabb.minY,h.aabb.minZ,h.aabb.maxX,h.aabb.maxY,h.aabb.maxZ,e)&&(null!=h.child1&&(s[n++]=h.child1),null!=h.child2&&(s[n++]=h.child2),null!=h.proxy&&null!=h.proxy.raycastable)){var o=e,l=i;if(null!=h.proxy.transform){o=new jeash_geom_Vector3D,l=new jeash_geom_Vector3D;var u=h.proxy.inverseTransform;o.x=u.a*t.x+u.b*t.y+u.c*t.z+u.d,o.y=u.e*t.x+u.f*t.y+u.g*t.z+u.h,o.z=u.i*t.x+u.j*t.y+u.k*t.z+u.l,l.x=u.a*i.x+u.b*i.y+u.c*i.z,l.y=u.e*i.x+u.f*i.y+u.g*i.z,l.z=u.i*i.x+u.j*i.y+u.k*i.z,l.w=a}var m=h.proxy.raycastable.intersectRay(o,l,e);null!=m&&m.w<a&&(a=m.w,r=m)}}return r},__class__:altern_collisions_dbvt_DBVT};var altern_collisions_dbvt_DBVTNode=function(){this.aabb=r._new()};e["altern.collisions.dbvt.DBVTNode"]=altern_collisions_dbvt_DBVTNode,altern_collisions_dbvt_DBVTNode.__name__=["altern","collisions","dbvt","DBVTNode"],altern_collisions_dbvt_DBVTNode.createFrom=function(t,i,e){var n=new altern_collisions_dbvt_DBVTNode,s=new altern_collisions_dbvt_DBVTProxy,r=n.aabb;return r.minX=i.minX,r.minY=i.minY,r.minZ=i.minZ,r.maxX=i.maxX,r.maxY=i.maxY,r.maxZ=i.maxZ,s.collidable=js_Boot.__instanceof(t,systems_collisions_ITCollidable)?t:null,s.raycastable=js_Boot.__instanceof(t,altern_ray_IRaycastImpl)?t:null,null!=e&&(s.transform=e,s.inverseTransform=new components_Transform3D,s.inverseTransform.calculateInversion(e),s.localToGlobalTransform=new components_Transform3D,s.globalToLocalTransform=new components_Transform3D),n.proxy=s,n},altern_collisions_dbvt_DBVTNode.prototype={__class__:altern_collisions_dbvt_DBVTNode};var altern_collisions_dbvt_DBVTProxy=function(){};e["altern.collisions.dbvt.DBVTProxy"]=altern_collisions_dbvt_DBVTProxy,altern_collisions_dbvt_DBVTProxy.__name__=["altern","collisions","dbvt","DBVTProxy"],altern_collisions_dbvt_DBVTProxy.prototype={__class__:altern_collisions_dbvt_DBVTProxy};var altern_culling_CullingPlane=function(){};e["altern.culling.CullingPlane"]=altern_culling_CullingPlane,altern_culling_CullingPlane.__name__=["altern","culling","CullingPlane"],altern_culling_CullingPlane.create=function(){if(null!=altern_culling_CullingPlane.collector){var t=altern_culling_CullingPlane.collector;return altern_culling_CullingPlane.collector=t.next,t.next=null,t}return new altern_culling_CullingPlane},altern_culling_CullingPlane.prototype={__class__:altern_culling_CullingPlane};var altern_terrain_ICuller=function(){};e["altern.terrain.ICuller"]=altern_terrain_ICuller,altern_terrain_ICuller.__name__=["altern","terrain","ICuller"],altern_terrain_ICuller.prototype={__class__:altern_terrain_ICuller};var altern_culling_DefaultCulling=function(){};e["altern.culling.DefaultCulling"]=altern_culling_DefaultCulling,altern_culling_DefaultCulling.__name__=["altern","culling","DefaultCulling"],altern_culling_DefaultCulling.__interfaces__=[altern_terrain_ICuller],altern_culling_DefaultCulling.cullingInFrustumOf=function(t,i,e,n,s,r,a,h){for(var o=1,l=t;null!=l;){if(0!=(i&o))if(l.x>=0)if(l.y>=0)if(l.z>=0){if(r*l.x+a*l.y+h*l.z<=l.offset)return-1;e*l.x+n*l.y+s*l.z>l.offset&&(i&=63&~o)}else{if(r*l.x+a*l.y+s*l.z<=l.offset)return-1;e*l.x+n*l.y+h*l.z>l.offset&&(i&=63&~o)}else if(l.z>=0){if(r*l.x+n*l.y+h*l.z<=l.offset)return-1;e*l.x+a*l.y+s*l.z>l.offset&&(i&=63&~o)}else{if(r*l.x+n*l.y+s*l.z<=l.offset)return-1;e*l.x+a*l.y+h*l.z>l.offset&&(i&=63&~o)}else if(l.y>=0)if(l.z>=0){if(e*l.x+a*l.y+h*l.z<=l.offset)return-1;r*l.x+n*l.y+s*l.z>l.offset&&(i&=63&~o)}else{if(e*l.x+a*l.y+s*l.z<=l.offset)return-1;r*l.x+n*l.y+h*l.z>l.offset&&(i&=63&~o)}else if(l.z>=0){if(e*l.x+n*l.y+h*l.z<=l.offset)return-1;r*l.x+a*l.y+s*l.z>l.offset&&(i&=63&~o)}else{if(e*l.x+n*l.y+s*l.z<=l.offset)return-1;r*l.x+a*l.y+h*l.z>l.offset&&(i&=63&~o)}o<<=1,l=l.next}return i},altern_culling_DefaultCulling.isInFrontOfFrustum=function(t,i,e,n,s,r,a,h,o,l){var u,m,c,f,x,d,_,g,p,v,y,b,w=n-t,z=t*(m=(u=o-e)*(g=s-i)-(x=h-i)*(d=r-e))+i*(c=(f=a-t)*d-u*w)+e*(_=x*w-f*g);if(m*l[0].x+c*l[0].y+_*l[0].z<=z)return!1;v=!1,y=!1,b=!1;for(var Y=0,S=l.length;Y<S;){if(m*(p=l[Y++]).x+c*p.y+_*p.z>=z?y=!0:v=!0,y&&v){b=!0;break}}return b},altern_culling_DefaultCulling.createNewTri=function(){var t,i,e=new altern_geom_Face;return t=new altern_geom_Wrapper,e.wrapper=t,i=new altern_geom_Vertex,t.vertex=i,t=t.next=new altern_geom_Wrapper,i=new altern_geom_Vertex,t.vertex=i.next=i,t=t.next=new altern_geom_Wrapper,i=new altern_geom_Vertex,t.vertex=i.next=i,e},altern_culling_DefaultCulling.collectClippedFace=function(){var t=altern_culling_DefaultCulling.clippedFace;t.destroy(),t.next=altern_geom_Face.collector,altern_geom_Face.collector=t},altern_culling_DefaultCulling.triInFrustumCover=function(t,i,e,n,s,r,a,h,o,l){for(var u=null,m=t;null!=m;){if(i*m.x+e*m.y+n*m.z<m.offset&&s*m.x+r*m.y+a*m.z<m.offset&&h*m.x+o*m.y+l*m.z<m.offset)return-1;u=m,m=m.next}return i*(m=u).x+e*m.y+n*m.z<m.offset||s*m.x+r*m.y+a*m.z<m.offset||h*m.x+o*m.y+l*m.z<m.offset?(null==altern_culling_DefaultCulling.clippingTri&&(altern_culling_DefaultCulling.clippingTri=altern_culling_DefaultCulling.createNewTri(),altern_culling_DefaultCulling.clippingNormal=new util_geom_Vec3),altern_culling_DefaultCulling.clippingTri.wrapper.vertex.x=i,altern_culling_DefaultCulling.clippingTri.wrapper.vertex.y=e,altern_culling_DefaultCulling.clippingTri.wrapper.vertex.z=n,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.x=s,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.y=r,altern_culling_DefaultCulling.clippingTri.wrapper.next.vertex.z=a,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.x=h,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.y=o,altern_culling_DefaultCulling.clippingTri.wrapper.next.next.vertex.z=l,altern_culling_DefaultCulling.clippingNormal.x=m.x,altern_culling_DefaultCulling.clippingNormal.y=m.y,altern_culling_DefaultCulling.clippingNormal.z=m.z,altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(altern_culling_DefaultCulling.clippingTri,altern_culling_DefaultCulling.clippingNormal),altern_culling_DefaultCulling.clippedFace=altern_geom_ClipMacros.newPositiveClipFace(altern_culling_DefaultCulling.clippingTri,altern_culling_DefaultCulling.clippingNormal,m.offset),1):0},altern_culling_DefaultCulling.pointInFrustum=function(t,i,e,n){for(var s=t;null!=s;){if(i*s.x+e*s.y+n*s.z<s.offset)return!1;s=s.next}return!0},altern_culling_DefaultCulling.prototype={cullingInFrustum:function(t,i,e,n,s,r,a){for(var h=1,o=this.frustum;null!=o;){if(0!=(t&h))if(o.x>=0)if(o.y>=0)if(o.z>=0){if(s*o.x+r*o.y+a*o.z<=o.offset)return-1;i*o.x+e*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(s*o.x+r*o.y+n*o.z<=o.offset)return-1;i*o.x+e*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.z>=0){if(s*o.x+e*o.y+a*o.z<=o.offset)return-1;i*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(s*o.x+e*o.y+n*o.z<=o.offset)return-1;i*o.x+r*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.y>=0)if(o.z>=0){if(i*o.x+r*o.y+a*o.z<=o.offset)return-1;s*o.x+e*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(i*o.x+r*o.y+n*o.z<=o.offset)return-1;s*o.x+e*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.z>=0){if(i*o.x+e*o.y+a*o.z<=o.offset)return-1;s*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(i*o.x+e*o.y+n*o.z<=o.offset)return-1;s*o.x+r*o.y+a*o.z>o.offset&&(t&=63&~h)}h<<=1,o=o.next}return t},__class__:altern_culling_DefaultCulling};var altern_culling_IFrustumCollectTri=function(){};e["altern.culling.IFrustumCollectTri"]=altern_culling_IFrustumCollectTri,altern_culling_IFrustumCollectTri.__name__=["altern","culling","IFrustumCollectTri"],altern_culling_IFrustumCollectTri.prototype={__class__:altern_culling_IFrustumCollectTri};var altern_culling_LODBatchHierachy=function(t,i,e){if(this.sampleAABB=new components_BoundBox,this._stack2=[],this._stack=[],this.tree=new altern_ds_DBVHTree_$altern_$culling_$LODNodeData,this.lodTimestamp=0,this.minLODVertical=0,null!=i){this.numLODs=i.length,this.lodDistances=new I(this.numLODs);for(var n=0,s=i.length;n<s;){var r=n++;this.lodDistances[r]=i[r]}}if(this.culler=t,this.tree.nodeDataFactoryMethod=altern_culling_LODNodeData.create,this.lodBatches=[],null!=i){for(var a=0,h=i.length;a<h;){var o=a++;this.lodBatches[o]=new altern_culling_LODBatch}}else this.lodBatches[0]=new altern_culling_LODBatch};e["altern.culling.LODBatchHierachy"]=altern_culling_LODBatchHierachy,altern_culling_LODBatchHierachy.__name__=["altern","culling","LODBatchHierachy"],altern_culling_LODBatchHierachy.prototype={getLeafWithAABB:function(t,i){var e=new altern_ds_DBVHNode_$altern_$culling_$LODNodeData;return r.init(e.aabb,t.minX,t.maxX,t.minY,t.maxY,t.minZ,t.maxZ),e.data=new altern_culling_LODNodeData,e.data.instance=i,e},createWithAABBAndPositions:function(t,i){for(var e=i.length,n=0,s=0;n<e;){var a=i[n],h=i[n+1],o=i[n+2];this.sampleAABB.minX=a+t.minX,this.sampleAABB.minY=h+t.minY,this.sampleAABB.minZ=o+t.minZ,this.sampleAABB.maxX=a+t.maxX,this.sampleAABB.maxY=h+t.maxY,this.sampleAABB.maxZ=o+t.maxZ;var l=this.tree,u=this.sampleAABB,m=new altern_ds_DBVHNode_$altern_$culling_$LODNodeData;r.init(m.aabb,u.minX,u.maxX,u.minY,u.maxY,u.minZ,u.maxZ),m.data=new altern_culling_LODNodeData,m.data.instance=s++,l.insertLeaf(m),n+=3}},createWithAABBAndPositionAndRots:function(t,i,e){null==e&&(e=!0)},createWithAABBAndTransforms:function(t,i,e,n){null==n&&(n=!1),null==e&&(e=!0)},cull:function(t){for(var i=0,e=this.lodBatches.length;i<e;){var n=i++,s=this.lodBatches[n];s.addCount=0,s.removeCount=0,s.lastInstanceLen=s.instanceLen}var r,a,h,o=0,l=0,u=this._stack,m=this._stack2,c=63,f=this.tree.root;if(c=this.culler.cullingInFrustum(c,f.aabb.minX,f.aabb.minY,f.aabb.minZ,f.aabb.maxX,f.aabb.maxY,f.aabb.maxZ),f.data.culling=c,c>=0){if(u[o++]=this.tree.root,this.tree.root.data.lodTimestamp!=this.lodTimestamp){var x=f.data.maxLOD>=1?this.getLOD(t,this.tree.root,this.numLODs):0;this.tree.root.data.maxLOD=x,this.tree.root.data.lodTimestamp=this.lodTimestamp}}else m[l++]=this.tree.root;for(;--o>=0;){if(a=(f=u[o]).child1,h=f.data.culling>=1?this.culler.cullingInFrustum(f.data.culling,a.aabb.minX,a.aabb.minY,a.aabb.minZ,a.aabb.maxX,a.aabb.maxY,a.aabb.maxZ):f.data.culling,a.data.culling!=h||h>=1)if(h>=0){if(null!=a.child1){if(a.data.lodTimestamp!=this.lodTimestamp){var d=f.data.maxLOD>=1?this.getLOD(t,a,f.data.maxLOD):0;a.data.maxLOD=d,a.data.lodTimestamp=this.lodTimestamp}u[o++]=a}else if(-1==a.data.culling){if(a.data.lodTimestamp!=this.lodTimestamp){var _=f.data.maxLOD>=1?this.getLOD(t,a,f.data.maxLOD):0;a.data.maxLOD=_,a.data.lodTimestamp=this.lodTimestamp}(r=this.lodBatches[a.data.maxLOD]).addIndices[r.addCount++]=a.data.instance}a.data.culling=h}else m[l++]=a;if(a=f.child2,h=f.data.culling>=1?this.culler.cullingInFrustum(f.data.culling,a.aabb.minX,a.aabb.minY,a.aabb.minZ,a.aabb.maxX,a.aabb.maxY,a.aabb.maxZ):f.data.culling,a.data.culling!=h||h>=1)if(h>=0){if(null!=a.child1){if(a.data.lodTimestamp!=this.lodTimestamp){var g=f.data.maxLOD>=1?this.getLOD(t,a,f.data.maxLOD):0;a.data.maxLOD=g,a.data.lodTimestamp=this.lodTimestamp}u[o++]=a}else if(-1==a.data.culling){if(a.data.lodTimestamp!=this.lodTimestamp){var p=f.data.maxLOD>=1?this.getLOD(t,a,f.data.maxLOD):0;a.data.maxLOD=p,a.data.lodTimestamp=this.lodTimestamp}(r=this.lodBatches[a.data.maxLOD]).addIndices[r.addCount++]=a.data.instance}a.data.culling=h}else m[l++]=a}for(;--l>=0;){var v=(f=m[l]).data.culling;f.data.culling=-1,null!=f.child1?(m[l++]=f.child1,m[l++]=f.child2):v>=0&&((r=this.lodBatches[f.data.maxLOD]).removeIndices[r.removeCount++]=f.data.instance)}for(var y=0,b=this.lodBatches.length;y<b;){var w=y++,z=this.lodBatches[w];z.instanceLen+=z.addCount-z.removeCount}},getLOD:function(t,i,e){var n=.5*(i.aabb.maxX-i.aabb.minX),s=.5*(i.aabb.maxZ-i.aabb.minZ),r=i.aabb.minX+n,a=i.aabb.minZ+s,h=.5*(i.aabb.maxY-i.aabb.minY),o=i.aabb.minY+h;for(null==i.child1&&(n=0,h=0,s=0);e>=1;){var l=this.lodDistances[e],u=Math.abs(r-t.x)-n,m=Math.abs(a-t.z)-s,c=u>=m?u:m;if(e>this.minLODVertical&&(m=Math.abs(o-t.y)-h)>c&&(c=m),c<l)break;--e}return e},cullAndUpdateLOD:function(t){for(var i=0,e=this.lodBatches.length;i<e;){var n=i++,s=this.lodBatches[n];s.addCount=0,s.removeCount=0,s.lastInstanceLen=s.instanceLen}this.lodTimestamp++;var r,a,h,o,l=0,u=0,m=this._stack,c=this._stack2,f=63,x=this.tree.root;for(f=this.culler.cullingInFrustum(f,x.aabb.minX,x.aabb.minY,x.aabb.minZ,x.aabb.maxX,x.aabb.maxY,x.aabb.maxZ),x.data.culling=f,f>=0?(m[l++]=this.tree.root,this.tree.root.data.maxLOD=this.getLOD(t,this.tree.root,this.numLODs),this.tree.root.data.lodTimestamp=this.lodTimestamp):c[u++]=this.tree.root;--l>=0;)a=(x=m[l]).child1,(h=x.data.culling>=1?this.culler.cullingInFrustum(x.data.culling,a.aabb.minX,a.aabb.minY,a.aabb.minZ,a.aabb.maxX,a.aabb.maxY,a.aabb.maxZ):x.data.culling)>=0?(o=x.data.maxLOD>=1?this.getLOD(t,a,x.data.maxLOD):0,null!=a.child1?m[l++]=a:-1==a.data.culling?(r=this.lodBatches[o]).addIndices[r.addCount++]=a.data.instance:o!=a.data.maxLOD&&((r=this.lodBatches[a.data.maxLOD]).removeIndices[r.removeCount++]=a.data.instance,(r=this.lodBatches[o]).addIndices[r.addCount++]=a.data.instance),a.data.lodTimestamp=this.lodTimestamp,a.data.maxLOD=o,a.data.culling=h):c[u++]=a,a=x.child2,(h=x.data.culling>=1?this.culler.cullingInFrustum(x.data.culling,a.aabb.minX,a.aabb.minY,a.aabb.minZ,a.aabb.maxX,a.aabb.maxY,a.aabb.maxZ):x.data.culling)>=0?(o=x.data.maxLOD>=1?this.getLOD(t,a,x.data.maxLOD):0,null!=a.child1?m[l++]=a:-1==a.data.culling?(r=this.lodBatches[o]).addIndices[r.addCount++]=a.data.instance:o!=a.data.maxLOD&&((r=this.lodBatches[a.data.maxLOD]).removeIndices[r.removeCount++]=a.data.instance,(r=this.lodBatches[o]).addIndices[r.addCount++]=a.data.instance),a.data.lodTimestamp=this.lodTimestamp,a.data.maxLOD=o,a.data.culling=h):c[u++]=a;for(;--u>=0;){var d=(x=c[u]).data.culling;x.data.culling=-1,null!=x.child1?(c[u++]=x.child1,c[u++]=x.child2):d>=0&&((r=this.lodBatches[x.data.maxLOD]).removeIndices[r.removeCount++]=x.data.instance)}for(var _=0,g=this.lodBatches.length;_<g;){var p=_++,v=this.lodBatches[p];v.instanceLen+=v.addCount-v.removeCount}},scanLOD:function(t){for(var i=0,e=this.lodBatches.length;i<e;){var n=i++,s=this.lodBatches[n];s.addCount=0,s.removeCount=0,s.lastInstanceLen=s.instanceLen}var r,a,h=0,o=this._stack,l=this.getLOD(t,this.tree.root,this.numLODs);for((l>=1||this.tree.root.data.maxLOD!=l)&&(o[h++]=this.tree.root,this.tree.root.data.maxLOD=l,this.tree.root.data.lodTimestamp=this.lodTimestamp);--h>=0;){if(r=(a=o[h]).child1,l=a.data.maxLOD>=1?this.getLOD(t,r,a.data.maxLOD):0,null==r.child1){if(r.data.culling>=0&&r.data.maxLOD!=l){var u=this.lodBatches[r.data.maxLOD];u.removeIndices[u.removeCount++]=r.data.instance;var m=this.lodBatches[l];m.addIndices[m.addCount++]=r.data.instance}}else(l>=1||r.data.maxLOD!=l)&&(o[h++]=r);if(r.data.maxLOD=l,r.data.lodTimestamp=this.lodTimestamp,r=a.child2,l=a.data.maxLOD>=1?this.getLOD(t,r,a.data.maxLOD):0,null==r.child1){if(r.data.culling>=0&&r.data.maxLOD!=l){var c=this.lodBatches[r.data.maxLOD];c.removeIndices[c.removeCount++]=r.data.instance;var f=this.lodBatches[l];f.addIndices[f.addCount++]=r.data.instance}}else(l>=1||r.data.maxLOD!=l)&&(o[h++]=r);r.data.maxLOD=l,r.data.lodTimestamp=this.lodTimestamp}for(var x=0,d=this.lodBatches.length;x<d;){var _=x++,g=this.lodBatches[_];g.instanceLen+=g.addCount-g.removeCount}},__class__:altern_culling_LODBatchHierachy};var altern_culling_LODNodeData=function(){this.lodTimestamp=-1,this.maxLOD=0,this.culling=-1};e["altern.culling.LODNodeData"]=altern_culling_LODNodeData,altern_culling_LODNodeData.__name__=["altern","culling","LODNodeData"],altern_culling_LODNodeData.create=function(){return new altern_culling_LODNodeData},altern_culling_LODNodeData.prototype={__class__:altern_culling_LODNodeData};var altern_culling_LODBatch=function(){this.instanceLen=0,this.lastInstanceLen=0,this.removeCount=0,this.addCount=0,this.addIndices=[],this.removeIndices=[]};e["altern.culling.LODBatch"]=altern_culling_LODBatch,altern_culling_LODBatch.__name__=["altern","culling","LODBatch"],altern_culling_LODBatch.prototype={reset:function(){this.addCount=0,this.removeCount=0,this.lastInstanceLen=this.instanceLen},updateInstanceLen:function(){this.instanceLen+=this.addCount-this.removeCount},addInstance:function(t){this.addIndices[this.addCount++]=t},removeInstance:function(t){this.removeIndices[this.removeCount++]=t},__class__:altern_culling_LODBatch};var altern_ds_DBVHNode_$altern_$culling_$LODNodeData=function(){this.aabb=r._new()};e["altern.ds.DBVHNode_altern_culling_LODNodeData"]=altern_ds_DBVHNode_$altern_$culling_$LODNodeData,altern_ds_DBVHNode_$altern_$culling_$LODNodeData.__name__=["altern","ds","DBVHNode_altern_culling_LODNodeData"],altern_ds_DBVHNode_$altern_$culling_$LODNodeData.prototype={isLeaf:function(){return null==this.child1},__class__:altern_ds_DBVHNode_$altern_$culling_$LODNodeData};var altern_ds_DBVHTree=function(){this._stack=[],this.freeNodes=[],this.numFreeNodes=0,this.aabb=r._new()};e["altern.ds.DBVHTree"]=altern_ds_DBVHTree,altern_ds_DBVHTree.__name__=["altern","ds","DBVHTree"],altern_ds_DBVHTree.prototype={purge:function(){this._stack.length=0},moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,e,n=t.aabb,s=this.root;null!=s.child1;){var r=s.child1,a=s.child2,h=s.aabb,o=r.aabb,l=a.aabb,u=h.maxY-h.minY,m=h.maxZ-h.minZ;i=2*((h.maxX-h.minX)*(u+m)+u*m);var c=this.aabb;n.minX<h.minX?c.minX=n.minX:c.minX=h.minX,n.maxX>h.maxX?c.maxX=n.maxX:c.maxX=h.maxX,n.minY<h.minY?c.minY=n.minY:c.minY=h.minY,n.maxY>h.maxY?c.maxY=n.maxY:c.maxY=h.maxY,n.minZ<h.minZ?c.minZ=n.minZ:c.minZ=h.minZ,n.maxZ>h.maxZ?c.maxZ=n.maxZ:c.maxZ=h.maxZ;c.minX-=0,c.minY-=0,c.minZ-=0,c.maxX+=0,c.maxY+=0,c.maxZ+=0;var f=this.aabb,x=f.maxY-f.minY,d=f.maxZ-f.minZ,_=2*(e=2*((f.maxX-f.minX)*(x+d)+x*d)),g=2*(e-i),p=g,v=this.aabb;n.minX<o.minX?v.minX=n.minX:v.minX=o.minX,n.maxX>o.maxX?v.maxX=n.maxX:v.maxX=o.maxX,n.minY<o.minY?v.minY=n.minY:v.minY=o.minY,n.maxY>o.maxY?v.maxY=n.maxY:v.maxY=o.maxY,n.minZ<o.minZ?v.minZ=n.minZ:v.minZ=o.minZ,n.maxZ>o.maxZ?v.maxZ=n.maxZ:v.maxZ=o.maxZ;if(v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,null==r.child1){var y=this.aabb,b=y.maxY-y.minY,w=y.maxZ-y.minZ;p+=2*((y.maxX-y.minX)*(b+w)+b*w)}else{var z=this.aabb,Y=z.maxY-z.minY,S=z.maxZ-z.minZ,X=o.maxY-o.minY,Z=o.maxZ-o.minZ;p+=2*((z.maxX-z.minX)*(Y+S)+Y*S)-2*((o.maxX-o.minX)*(X+Z)+X*Z)}var P=g,T=this.aabb;n.minX<l.minX?T.minX=n.minX:T.minX=l.minX,n.maxX>l.maxX?T.maxX=n.maxX:T.maxX=l.maxX,n.minY<l.minY?T.minY=n.minY:T.minY=l.minY,n.maxY>l.maxY?T.maxY=n.maxY:T.maxY=l.maxY,n.minZ<l.minZ?T.minZ=n.minZ:T.minZ=l.minZ,n.maxZ>l.maxZ?T.maxZ=n.maxZ:T.maxZ=l.maxZ;if(T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,null==a.child1){var L=this.aabb,I=L.maxY-L.minY,O=L.maxZ-L.minZ;P+=2*((L.maxX-L.minX)*(I+O)+I*O)}else{var E=this.aabb,C=E.maxY-E.minY,D=E.maxZ-E.minZ,k=l.maxY-l.minY,A=l.maxZ-l.minZ;P+=2*((E.maxX-E.minX)*(C+D)+C*D)-2*((l.maxX-l.minX)*(k+A)+k*A)}if(p<P){if(_<p)break;s=r}else{if(_<P)break;s=a}}var M,R=s.parent;this.numFreeNodes>0?M=this.freeNodes[--this.numFreeNodes]:(M=new altern_ds_DBVHNode,null!=this.nodeDataFactoryMethod&&(M.data=this.nodeDataFactoryMethod())),M.parent=R,M.child1=t,M.child2=s;var B=M.aabb,N=t.aabb,V=s.aabb;N.minX<V.minX?B.minX=N.minX:B.minX=V.minX,N.maxX>V.maxX?B.maxX=N.maxX:B.maxX=V.maxX,N.minY<V.minY?B.minY=N.minY:B.minY=V.minY,N.maxY>V.maxY?B.maxY=N.maxY:B.maxY=V.maxY,N.minZ<V.minZ?B.minZ=N.minZ:B.minZ=V.minZ,N.maxZ>V.maxZ?B.maxZ=N.maxZ:B.maxZ=V.maxZ;for(B.minX-=0,B.minY-=0,B.minZ-=0,B.maxX+=0,B.maxY+=0,B.maxZ+=0,M.height=s.height+1,s.parent=M,t.parent=M,s==this.root?this.root=M:R.child1==s?R.child1=M:R.child2=M;;){var F=(M=this.balance(M)).child1,j=M.child2,U=M.aabb,q=F.aabb,G=j.aabb;q.minX<G.minX?U.minX=q.minX:U.minX=G.minX,q.maxX>G.maxX?U.maxX=q.maxX:U.maxX=G.maxX,q.minY<G.minY?U.minY=q.minY:U.minY=G.minY,q.maxY>G.maxY?U.maxY=q.maxY:U.maxY=G.maxY,q.minZ<G.minZ?U.minZ=q.minZ:U.minZ=G.minZ,q.maxZ>G.maxZ?U.maxZ=q.maxZ:U.maxZ=G.maxZ;U.minX-=0,U.minY-=0,U.minZ-=0,U.maxX+=0,U.maxY+=0,U.maxZ+=0;var H=F.height,W=j.height;if(M.height=H<W?W+1:H+1,null==(M=M.parent))break}}else this.root=t},getBalance:function(t){return null==t.child1?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,e=t.parent;if(i=e.child1==t?e.child2:e.child1,e==this.root)return this.root=i,void(i.parent=null);var n=e.parent;for(i.parent=n,n.child1==e?n.child1=i:n.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=e);;){var s=(n=this.balance(n)).child1,r=n.child2,a=n.aabb,h=s.aabb,o=r.aabb;h.minX<o.minX?a.minX=h.minX:a.minX=o.minX,h.maxX>o.maxX?a.maxX=h.maxX:a.maxX=o.maxX,h.minY<o.minY?a.minY=h.minY:a.minY=o.minY,h.maxY>o.maxY?a.maxY=h.maxY:a.maxY=o.maxY,h.minZ<o.minZ?a.minZ=h.minZ:a.minZ=o.minZ,h.maxZ>o.maxZ?a.maxZ=h.maxZ:a.maxZ=o.maxZ;a.minX-=0,a.minY-=0,a.minZ-=0,a.maxX+=0,a.maxY+=0,a.maxZ+=0;var l=s.height,u=r.height;if(n.height=l<u?u+1:l+1,null==(n=n.parent))break}}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var e,n=t.parent,s=t.child1,r=t.child2,a=s.height,h=r.height,o=a-h;if(o>1){var l=s.child1,u=s.child2,m=l.height,c=u.height;if(m>c){s.child2=t,t.parent=s,t.child1=u,u.parent=t;var f=t.aabb,x=u.aabb,d=r.aabb;x.minX<d.minX?f.minX=x.minX:f.minX=d.minX,x.maxX>d.maxX?f.maxX=x.maxX:f.maxX=d.maxX,x.minY<d.minY?f.minY=x.minY:f.minY=d.minY,x.maxY>d.maxY?f.maxY=x.maxY:f.maxY=d.maxY,x.minZ<d.minZ?f.minZ=x.minZ:f.minZ=d.minZ,x.maxZ>d.maxZ?f.maxZ=x.maxZ:f.maxZ=d.maxZ;f.minX-=0,f.minY-=0,f.minZ-=0,f.maxX+=0,f.maxY+=0,f.maxZ+=0,e=c-h,t.height=c-(e&e>>31)+1;var _=s.aabb,g=l.aabb,p=t.aabb;g.minX<p.minX?_.minX=g.minX:_.minX=p.minX,g.maxX>p.maxX?_.maxX=g.maxX:_.maxX=p.maxX,g.minY<p.minY?_.minY=g.minY:_.minY=p.minY,g.maxY>p.maxY?_.maxY=g.maxY:_.maxY=p.maxY,g.minZ<p.minZ?_.minZ=g.minZ:_.minZ=p.minZ,g.maxZ>p.maxZ?_.maxZ=g.maxZ:_.maxZ=p.maxZ;_.minX-=0,_.minY-=0,_.minZ-=0,_.maxX+=0,_.maxY+=0,_.maxZ+=0,e=m-i,s.height=m-(e&e>>31)+1}else{s.child1=t,t.parent=s,t.child1=l,l.parent=t;var v=t.aabb,y=l.aabb,b=r.aabb;y.minX<b.minX?v.minX=y.minX:v.minX=b.minX,y.maxX>b.maxX?v.maxX=y.maxX:v.maxX=b.maxX,y.minY<b.minY?v.minY=y.minY:v.minY=b.minY,y.maxY>b.maxY?v.maxY=y.maxY:v.maxY=b.maxY,y.minZ<b.minZ?v.minZ=y.minZ:v.minZ=b.minZ,y.maxZ>b.maxZ?v.maxZ=y.maxZ:v.maxZ=b.maxZ;v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,e=m-h,t.height=m-(e&e>>31)+1;var w=s.aabb,z=t.aabb,Y=u.aabb;z.minX<Y.minX?w.minX=z.minX:w.minX=Y.minX,z.maxX>Y.maxX?w.maxX=z.maxX:w.maxX=Y.maxX,z.minY<Y.minY?w.minY=z.minY:w.minY=Y.minY,z.maxY>Y.maxY?w.maxY=z.maxY:w.maxY=Y.maxY,z.minZ<Y.minZ?w.minZ=z.minZ:w.minZ=Y.minZ,z.maxZ>Y.maxZ?w.maxZ=z.maxZ:w.maxZ=Y.maxZ;w.minX-=0,w.minY-=0,w.minZ-=0,w.maxX+=0,w.maxY+=0,w.maxZ+=0,e=i-c,s.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=s:n.child2=s:this.root=s,s.parent=n,s}if(o<-1){var S=r.child1,X=r.child2,Z=S.height,P=X.height;if(Z>P){r.child2=t,t.parent=r,t.child2=X,X.parent=t;var T=t.aabb,L=s.aabb,I=X.aabb;L.minX<I.minX?T.minX=L.minX:T.minX=I.minX,L.maxX>I.maxX?T.maxX=L.maxX:T.maxX=I.maxX,L.minY<I.minY?T.minY=L.minY:T.minY=I.minY,L.maxY>I.maxY?T.maxY=L.maxY:T.maxY=I.maxY,L.minZ<I.minZ?T.minZ=L.minZ:T.minZ=I.minZ,L.maxZ>I.maxZ?T.maxZ=L.maxZ:T.maxZ=I.maxZ;T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,e=a-P,t.height=a-(e&e>>31)+1;var O=r.aabb,E=S.aabb,C=t.aabb;E.minX<C.minX?O.minX=E.minX:O.minX=C.minX,E.maxX>C.maxX?O.maxX=E.maxX:O.maxX=C.maxX,E.minY<C.minY?O.minY=E.minY:O.minY=C.minY,E.maxY>C.maxY?O.maxY=E.maxY:O.maxY=C.maxY,E.minZ<C.minZ?O.minZ=E.minZ:O.minZ=C.minZ,E.maxZ>C.maxZ?O.maxZ=E.maxZ:O.maxZ=C.maxZ;O.minX-=0,O.minY-=0,O.minZ-=0,O.maxX+=0,O.maxY+=0,O.maxZ+=0,e=Z-i,r.height=Z-(e&e>>31)+1}else{r.child1=t,t.parent=r,t.child2=S,S.parent=t;var D=t.aabb,k=s.aabb,A=S.aabb;k.minX<A.minX?D.minX=k.minX:D.minX=A.minX,k.maxX>A.maxX?D.maxX=k.maxX:D.maxX=A.maxX,k.minY<A.minY?D.minY=k.minY:D.minY=A.minY,k.maxY>A.maxY?D.maxY=k.maxY:D.maxY=A.maxY,k.minZ<A.minZ?D.minZ=k.minZ:D.minZ=A.minZ,k.maxZ>A.maxZ?D.maxZ=k.maxZ:D.maxZ=A.maxZ;D.minX-=0,D.minY-=0,D.minZ-=0,D.maxX+=0,D.maxY+=0,D.maxZ+=0,e=a-Z,t.height=a-(e&e>>31)+1;var M=r.aabb,R=t.aabb,B=X.aabb;R.minX<B.minX?M.minX=R.minX:M.minX=B.minX,R.maxX>B.maxX?M.maxX=R.maxX:M.maxX=B.maxX,R.minY<B.minY?M.minY=R.minY:M.minY=B.minY,R.maxY>B.maxY?M.maxY=R.maxY:M.maxY=B.maxY,R.minZ<B.minZ?M.minZ=R.minZ:M.minZ=B.minZ,R.maxZ>B.maxZ?M.maxZ=R.maxZ:M.maxZ=B.maxZ;M.minX-=0,M.minY-=0,M.minZ-=0,M.maxX+=0,M.maxY+=0,M.maxZ+=0,e=i-P,r.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=r:n.child2=r:this.root=r,r.parent=n,r}return t},fix:function(t){var i=t.child1,e=t.child2,n=t.aabb,s=i.aabb,r=e.aabb;s.minX<r.minX?n.minX=s.minX:n.minX=r.minX,s.maxX>r.maxX?n.maxX=s.maxX:n.maxX=r.maxX,s.minY<r.minY?n.minY=s.minY:n.minY=r.minY,s.maxY>r.maxY?n.maxY=s.maxY:n.maxY=r.maxY,s.minZ<r.minZ?n.minZ=s.minZ:n.minZ=r.minZ,s.maxZ>r.maxZ?n.maxZ=s.maxZ:n.maxZ=r.maxZ;n.minX-=0,n.minY-=0,n.minZ-=0,n.maxX+=0,n.maxY+=0,n.maxZ+=0;var a=i.height,h=e.height;t.height=a<h?h+1:a+1},__class__:altern_ds_DBVHTree};var altern_ds_DBVHNode=function(){this.aabb=r._new()};e["altern.ds.DBVHNode"]=altern_ds_DBVHNode,altern_ds_DBVHNode.__name__=["altern","ds","DBVHNode"],altern_ds_DBVHNode.prototype={isLeaf:function(){return null==this.child1},__class__:altern_ds_DBVHNode};var altern_ds_DBVHTree_$altern_$culling_$LODNodeData=function(){this._stack=[],this.freeNodes=[],this.numFreeNodes=0,this.aabb=r._new()};e["altern.ds.DBVHTree_altern_culling_LODNodeData"]=altern_ds_DBVHTree_$altern_$culling_$LODNodeData,altern_ds_DBVHTree_$altern_$culling_$LODNodeData.__name__=["altern","ds","DBVHTree_altern_culling_LODNodeData"],altern_ds_DBVHTree_$altern_$culling_$LODNodeData.prototype={purge:function(){this._stack.length=0},moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,e,n=t.aabb,s=this.root;null!=s.child1;){var r=s.child1,a=s.child2,h=s.aabb,o=r.aabb,l=a.aabb,u=h.maxY-h.minY,m=h.maxZ-h.minZ;i=2*((h.maxX-h.minX)*(u+m)+u*m);var c=this.aabb;n.minX<h.minX?c.minX=n.minX:c.minX=h.minX,n.maxX>h.maxX?c.maxX=n.maxX:c.maxX=h.maxX,n.minY<h.minY?c.minY=n.minY:c.minY=h.minY,n.maxY>h.maxY?c.maxY=n.maxY:c.maxY=h.maxY,n.minZ<h.minZ?c.minZ=n.minZ:c.minZ=h.minZ,n.maxZ>h.maxZ?c.maxZ=n.maxZ:c.maxZ=h.maxZ;c.minX-=0,c.minY-=0,c.minZ-=0,c.maxX+=0,c.maxY+=0,c.maxZ+=0;var f=this.aabb,x=f.maxY-f.minY,d=f.maxZ-f.minZ,_=2*(e=2*((f.maxX-f.minX)*(x+d)+x*d)),g=2*(e-i),p=g,v=this.aabb;n.minX<o.minX?v.minX=n.minX:v.minX=o.minX,n.maxX>o.maxX?v.maxX=n.maxX:v.maxX=o.maxX,n.minY<o.minY?v.minY=n.minY:v.minY=o.minY,n.maxY>o.maxY?v.maxY=n.maxY:v.maxY=o.maxY,n.minZ<o.minZ?v.minZ=n.minZ:v.minZ=o.minZ,n.maxZ>o.maxZ?v.maxZ=n.maxZ:v.maxZ=o.maxZ;if(v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,null==r.child1){var y=this.aabb,b=y.maxY-y.minY,w=y.maxZ-y.minZ;p+=2*((y.maxX-y.minX)*(b+w)+b*w)}else{var z=this.aabb,Y=z.maxY-z.minY,S=z.maxZ-z.minZ,X=o.maxY-o.minY,Z=o.maxZ-o.minZ;p+=2*((z.maxX-z.minX)*(Y+S)+Y*S)-2*((o.maxX-o.minX)*(X+Z)+X*Z)}var P=g,T=this.aabb;n.minX<l.minX?T.minX=n.minX:T.minX=l.minX,n.maxX>l.maxX?T.maxX=n.maxX:T.maxX=l.maxX,n.minY<l.minY?T.minY=n.minY:T.minY=l.minY,n.maxY>l.maxY?T.maxY=n.maxY:T.maxY=l.maxY,n.minZ<l.minZ?T.minZ=n.minZ:T.minZ=l.minZ,n.maxZ>l.maxZ?T.maxZ=n.maxZ:T.maxZ=l.maxZ;if(T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,null==a.child1){var L=this.aabb,I=L.maxY-L.minY,O=L.maxZ-L.minZ;P+=2*((L.maxX-L.minX)*(I+O)+I*O)}else{var E=this.aabb,C=E.maxY-E.minY,D=E.maxZ-E.minZ,k=l.maxY-l.minY,A=l.maxZ-l.minZ;P+=2*((E.maxX-E.minX)*(C+D)+C*D)-2*((l.maxX-l.minX)*(k+A)+k*A)}if(p<P){if(_<p)break;s=r}else{if(_<P)break;s=a}}var M,R=s.parent;this.numFreeNodes>0?M=this.freeNodes[--this.numFreeNodes]:(M=new altern_ds_DBVHNode_$altern_$culling_$LODNodeData,null!=this.nodeDataFactoryMethod&&(M.data=this.nodeDataFactoryMethod())),M.parent=R,M.child1=t,M.child2=s;var B=M.aabb,N=t.aabb,V=s.aabb;N.minX<V.minX?B.minX=N.minX:B.minX=V.minX,N.maxX>V.maxX?B.maxX=N.maxX:B.maxX=V.maxX,N.minY<V.minY?B.minY=N.minY:B.minY=V.minY,N.maxY>V.maxY?B.maxY=N.maxY:B.maxY=V.maxY,N.minZ<V.minZ?B.minZ=N.minZ:B.minZ=V.minZ,N.maxZ>V.maxZ?B.maxZ=N.maxZ:B.maxZ=V.maxZ;for(B.minX-=0,B.minY-=0,B.minZ-=0,B.maxX+=0,B.maxY+=0,B.maxZ+=0,M.height=s.height+1,s.parent=M,t.parent=M,s==this.root?this.root=M:R.child1==s?R.child1=M:R.child2=M;;){var F=(M=this.balance(M)).child1,j=M.child2,U=M.aabb,q=F.aabb,G=j.aabb;q.minX<G.minX?U.minX=q.minX:U.minX=G.minX,q.maxX>G.maxX?U.maxX=q.maxX:U.maxX=G.maxX,q.minY<G.minY?U.minY=q.minY:U.minY=G.minY,q.maxY>G.maxY?U.maxY=q.maxY:U.maxY=G.maxY,q.minZ<G.minZ?U.minZ=q.minZ:U.minZ=G.minZ,q.maxZ>G.maxZ?U.maxZ=q.maxZ:U.maxZ=G.maxZ;U.minX-=0,U.minY-=0,U.minZ-=0,U.maxX+=0,U.maxY+=0,U.maxZ+=0;var H=F.height,W=j.height;if(M.height=H<W?W+1:H+1,null==(M=M.parent))break}}else this.root=t},getBalance:function(t){return null==t.child1?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,e=t.parent;if(i=e.child1==t?e.child2:e.child1,e==this.root)return this.root=i,void(i.parent=null);var n=e.parent;for(i.parent=n,n.child1==e?n.child1=i:n.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=e);;){var s=(n=this.balance(n)).child1,r=n.child2,a=n.aabb,h=s.aabb,o=r.aabb;h.minX<o.minX?a.minX=h.minX:a.minX=o.minX,h.maxX>o.maxX?a.maxX=h.maxX:a.maxX=o.maxX,h.minY<o.minY?a.minY=h.minY:a.minY=o.minY,h.maxY>o.maxY?a.maxY=h.maxY:a.maxY=o.maxY,h.minZ<o.minZ?a.minZ=h.minZ:a.minZ=o.minZ,h.maxZ>o.maxZ?a.maxZ=h.maxZ:a.maxZ=o.maxZ;a.minX-=0,a.minY-=0,a.minZ-=0,a.maxX+=0,a.maxY+=0,a.maxZ+=0;var l=s.height,u=r.height;if(n.height=l<u?u+1:l+1,null==(n=n.parent))break}}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var e,n=t.parent,s=t.child1,r=t.child2,a=s.height,h=r.height,o=a-h;if(o>1){var l=s.child1,u=s.child2,m=l.height,c=u.height;if(m>c){s.child2=t,t.parent=s,t.child1=u,u.parent=t;var f=t.aabb,x=u.aabb,d=r.aabb;x.minX<d.minX?f.minX=x.minX:f.minX=d.minX,x.maxX>d.maxX?f.maxX=x.maxX:f.maxX=d.maxX,x.minY<d.minY?f.minY=x.minY:f.minY=d.minY,x.maxY>d.maxY?f.maxY=x.maxY:f.maxY=d.maxY,x.minZ<d.minZ?f.minZ=x.minZ:f.minZ=d.minZ,x.maxZ>d.maxZ?f.maxZ=x.maxZ:f.maxZ=d.maxZ;f.minX-=0,f.minY-=0,f.minZ-=0,f.maxX+=0,f.maxY+=0,f.maxZ+=0,e=c-h,t.height=c-(e&e>>31)+1;var _=s.aabb,g=l.aabb,p=t.aabb;g.minX<p.minX?_.minX=g.minX:_.minX=p.minX,g.maxX>p.maxX?_.maxX=g.maxX:_.maxX=p.maxX,g.minY<p.minY?_.minY=g.minY:_.minY=p.minY,g.maxY>p.maxY?_.maxY=g.maxY:_.maxY=p.maxY,g.minZ<p.minZ?_.minZ=g.minZ:_.minZ=p.minZ,g.maxZ>p.maxZ?_.maxZ=g.maxZ:_.maxZ=p.maxZ;_.minX-=0,_.minY-=0,_.minZ-=0,_.maxX+=0,_.maxY+=0,_.maxZ+=0,e=m-i,s.height=m-(e&e>>31)+1}else{s.child1=t,t.parent=s,t.child1=l,l.parent=t;var v=t.aabb,y=l.aabb,b=r.aabb;y.minX<b.minX?v.minX=y.minX:v.minX=b.minX,y.maxX>b.maxX?v.maxX=y.maxX:v.maxX=b.maxX,y.minY<b.minY?v.minY=y.minY:v.minY=b.minY,y.maxY>b.maxY?v.maxY=y.maxY:v.maxY=b.maxY,y.minZ<b.minZ?v.minZ=y.minZ:v.minZ=b.minZ,y.maxZ>b.maxZ?v.maxZ=y.maxZ:v.maxZ=b.maxZ;v.minX-=0,v.minY-=0,v.minZ-=0,v.maxX+=0,v.maxY+=0,v.maxZ+=0,e=m-h,t.height=m-(e&e>>31)+1;var w=s.aabb,z=t.aabb,Y=u.aabb;z.minX<Y.minX?w.minX=z.minX:w.minX=Y.minX,z.maxX>Y.maxX?w.maxX=z.maxX:w.maxX=Y.maxX,z.minY<Y.minY?w.minY=z.minY:w.minY=Y.minY,z.maxY>Y.maxY?w.maxY=z.maxY:w.maxY=Y.maxY,z.minZ<Y.minZ?w.minZ=z.minZ:w.minZ=Y.minZ,z.maxZ>Y.maxZ?w.maxZ=z.maxZ:w.maxZ=Y.maxZ;w.minX-=0,w.minY-=0,w.minZ-=0,w.maxX+=0,w.maxY+=0,w.maxZ+=0,e=i-c,s.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=s:n.child2=s:this.root=s,s.parent=n,s}if(o<-1){var S=r.child1,X=r.child2,Z=S.height,P=X.height;if(Z>P){r.child2=t,t.parent=r,t.child2=X,X.parent=t;var T=t.aabb,L=s.aabb,I=X.aabb;L.minX<I.minX?T.minX=L.minX:T.minX=I.minX,L.maxX>I.maxX?T.maxX=L.maxX:T.maxX=I.maxX,L.minY<I.minY?T.minY=L.minY:T.minY=I.minY,L.maxY>I.maxY?T.maxY=L.maxY:T.maxY=I.maxY,L.minZ<I.minZ?T.minZ=L.minZ:T.minZ=I.minZ,L.maxZ>I.maxZ?T.maxZ=L.maxZ:T.maxZ=I.maxZ;T.minX-=0,T.minY-=0,T.minZ-=0,T.maxX+=0,T.maxY+=0,T.maxZ+=0,e=a-P,t.height=a-(e&e>>31)+1;var O=r.aabb,E=S.aabb,C=t.aabb;E.minX<C.minX?O.minX=E.minX:O.minX=C.minX,E.maxX>C.maxX?O.maxX=E.maxX:O.maxX=C.maxX,E.minY<C.minY?O.minY=E.minY:O.minY=C.minY,E.maxY>C.maxY?O.maxY=E.maxY:O.maxY=C.maxY,E.minZ<C.minZ?O.minZ=E.minZ:O.minZ=C.minZ,E.maxZ>C.maxZ?O.maxZ=E.maxZ:O.maxZ=C.maxZ;O.minX-=0,O.minY-=0,O.minZ-=0,O.maxX+=0,O.maxY+=0,O.maxZ+=0,e=Z-i,r.height=Z-(e&e>>31)+1}else{r.child1=t,t.parent=r,t.child2=S,S.parent=t;var D=t.aabb,k=s.aabb,A=S.aabb;k.minX<A.minX?D.minX=k.minX:D.minX=A.minX,k.maxX>A.maxX?D.maxX=k.maxX:D.maxX=A.maxX,k.minY<A.minY?D.minY=k.minY:D.minY=A.minY,k.maxY>A.maxY?D.maxY=k.maxY:D.maxY=A.maxY,k.minZ<A.minZ?D.minZ=k.minZ:D.minZ=A.minZ,k.maxZ>A.maxZ?D.maxZ=k.maxZ:D.maxZ=A.maxZ;D.minX-=0,D.minY-=0,D.minZ-=0,D.maxX+=0,D.maxY+=0,D.maxZ+=0,e=a-Z,t.height=a-(e&e>>31)+1;var M=r.aabb,R=t.aabb,B=X.aabb;R.minX<B.minX?M.minX=R.minX:M.minX=B.minX,R.maxX>B.maxX?M.maxX=R.maxX:M.maxX=B.maxX,R.minY<B.minY?M.minY=R.minY:M.minY=B.minY,R.maxY>B.maxY?M.maxY=R.maxY:M.maxY=B.maxY,R.minZ<B.minZ?M.minZ=R.minZ:M.minZ=B.minZ,R.maxZ>B.maxZ?M.maxZ=R.maxZ:M.maxZ=B.maxZ;M.minX-=0,M.minY-=0,M.minZ-=0,M.maxX+=0,M.maxY+=0,M.maxZ+=0,e=i-P,r.height=i-(e&e>>31)+1}return null!=n?n.child1==t?n.child1=r:n.child2=r:this.root=r,r.parent=n,r}return t},fix:function(t){var i=t.child1,e=t.child2,n=t.aabb,s=i.aabb,r=e.aabb;s.minX<r.minX?n.minX=s.minX:n.minX=r.minX,s.maxX>r.maxX?n.maxX=s.maxX:n.maxX=r.maxX,s.minY<r.minY?n.minY=s.minY:n.minY=r.minY,s.maxY>r.maxY?n.maxY=s.maxY:n.maxY=r.maxY,s.minZ<r.minZ?n.minZ=s.minZ:n.minZ=r.minZ,s.maxZ>r.maxZ?n.maxZ=s.maxZ:n.maxZ=r.maxZ;n.minX-=0,n.minY-=0,n.minZ-=0,n.maxX+=0,n.maxY+=0,n.maxZ+=0;var a=i.height,h=e.height;t.height=a<h?h+1:a+1},__class__:altern_ds_DBVHTree_$altern_$culling_$LODNodeData};var util_geom_Vec3=function(t,i,e){null==e&&(e=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=e};e["util.geom.Vec3"]=util_geom_Vec3,util_geom_Vec3.__name__=["util","geom","Vec3"],util_geom_Vec3.copy=function(t){return new util_geom_Vec3(t.x,t.y,t.z)},util_geom_Vec3.createCross=function(t,i){return new util_geom_Vec3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},util_geom_Vec3.createAdd=function(t,i){return new util_geom_Vec3(t.x+i.x,t.y+i.y,t.z+i.z)},util_geom_Vec3.createSubtract=function(t,i){return new util_geom_Vec3(t.x-i.x,t.y-i.y,t.z-i.z)},util_geom_Vec3.createScale=function(t,i){return new util_geom_Vec3(t.x*i,t.y*i,t.z*i)},util_geom_Vec3.createProjection=function(t,i){var e=t.x*i.x+t.y*i.y+t.z*i.z;return new util_geom_Vec3(t.x-i.x*e,t.y-i.y*e,t.z-i.z*e)},util_geom_Vec3.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},util_geom_Vec3.lengthOf=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},util_geom_Vec3.squareLengthOf=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},util_geom_Vec3.writeCross=function(t,i,e){e.x=t.y*i.z-t.z*i.y,e.y=t.z*i.x-i.z*t.x,e.z=t.x*i.y-t.y*i.x},util_geom_Vec3.writeProjection=function(t,i,e){var n=t.x*i.x+t.y*i.y+t.z*i.z;e.x=t.x-i.x*n,e.y=t.y-i.y*n,e.z=t.z-i.z*n},util_geom_Vec3.writeSubtract=function(t,i){t.x-=i.x,t.y-=i.y,t.z-=i.z},util_geom_Vec3.writeAdd=function(t,i){t.x+=i.x,t.y+=i.y,t.z+=i.z},util_geom_Vec3.writeScale=function(t,i){t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3.prototype={length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSqr:function(){return this.x*this.x+this.y*this.y+this.z*this.z},dotProduct:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossProduct:function(t){return new util_geom_Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},clone:function(){return new util_geom_Vec3(this.x,this.y,this.z)},isZeroVector:function(){return this.x*this.x+this.y*this.y+this.z*this.z==0},crossProductSet:function(t){this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this.z=this.x*t.y-this.y*t.x},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},addScaled:function(t,i){this.x+=t*i.x,this.y+=t*i.y,this.z+=t*i.z},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},sum:function(t,i){this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z},diff:function(t,i){this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z},scale:function(t){this.x*=t,this.y*=t,this.z*=t},reverse:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},transform3:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z,this.y=t.e*this.x+t.f*this.y+t.g*this.z,this.z=t.i*this.x+t.j*this.y+t.k*this.z},transformTransposed3:function(t){this.x=t.a*this.x+t.e*this.y+t.i*this.z,this.y=t.b*this.x+t.f*this.y+t.j*this.z,this.z=t.c*this.x+t.g*this.y+t.k*this.z},reset:function(){this.x=this.y=this.z=0},set:function(t,i,e){this.x=t,this.y=i,this.z=e},saveTo:function(t){t.x=this.x,t.y=this.y,t.z=this.z},copyFrom:function(t){this.x=t.x,this.y=t.y,this.z=t.z},transform4:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z+t.d,this.y=t.e*this.x+t.f*this.y+t.g*this.z+t.h,this.z=t.i*this.x+t.j*this.y+t.k*this.z+t.l},transformTransposed4:function(t){this.x,t.d,this.y,t.h,this.z,t.l;this.x=t.a*this.x+t.e*this.y+t.i*this.z,this.y=t.b*this.x+t.f*this.y+t.j*this.z,this.z=t.c*this.x+t.g*this.y+t.k*this.z},transformVector4:function(t){this.x=t.a*this.x+t.b*this.y+t.c*this.z,this.y=t.e*this.x+t.f*this.y+t.g*this.z,this.z=t.i*this.x+t.j*this.y+t.k*this.z},assignAddition:function(t,i){this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z},normalize:function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x*=t,this.y*=t,this.z*=t},normalizeWithSquared:function(t){var i=1/Math.sqrt(t);this.x*=i,this.y*=i,this.z*=i},setLength:function(t){var i=t/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);this.x*=i,this.y*=i,this.z*=i},removeComponent:function(t){var i=this.x*t.x+this.y*t.y+this.z*t.z;this.x-=t.x*i,this.y-=t.y*i,this.z-=t.z*i},distanceTo:function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return Math.sqrt(i*i+e*e+n*n)},toString:function(){return"Vec3("+this.x+", "+this.y+", "+this.z+")"},__class__:util_geom_Vec3};var altern_geom_ClipMacros=function(){};e["altern.geom.ClipMacros"]=altern_geom_ClipMacros,altern_geom_ClipMacros.__name__=["altern","geom","ClipMacros"],altern_geom_ClipMacros.computeMeshVerticesLocalOffsets=function(t,i){var e,n;for(altern_geom_ClipMacros.transformId++,n=t;null!=n;){for(e=n.wrapper;null!=e;){var s=e.vertex;s.transformId!=altern_geom_ClipMacros.transformId&&(s.offset=s.x*i.x+s.y*i.y+s.z*i.z,s.transformId=altern_geom_ClipMacros.transformId),e=e.next}n=n.processNext}},altern_geom_ClipMacros.getClippedVerticesForFace=function(t,i,e,n,s){var r,a,h,o,l,u,m,c=null,f=n.vertex,x=f.offset;for(a=s;null!=a;)r=a.next,((o=(l=a.vertex).offset)>e&&x<=e||o<=e&&x>e)&&(u=(e-x)/(o-x),(m=altern_geom_Vertex.create()).cameraX=f.cameraX+(l.cameraX-f.cameraX)*u,m.cameraY=f.cameraY+(l.cameraY-f.cameraY)*u,m.cameraZ=f.cameraZ+(l.cameraZ-f.cameraZ)*u,m.x=f.x+(l.x-f.x)*u,m.y=f.y+(l.y-f.y)*u,m.z=f.z+(l.z-f.z)*u,(h=altern_geom_Wrapper.create()).vertex=m,null!=c?n.next=h:c=h,n=h),o>e?(null!=c?n.next=a:c=a,n=a,a.next=null):(a.vertex=null,a.next=altern_geom_Wrapper.collector,altern_geom_Wrapper.collector=a),f=l,x=o,a=r;return c},altern_geom_ClipMacros.calculateFaceCoordinates2=function(t,i){var e,n,s,r,a=++altern_geom_ClipMacros.transformId,h=i.wrapper.next.vertex,o=i.wrapper.vertex,l=i.wrapper.next.next.vertex,u=o.x-h.x,m=o.y-h.y,c=o.z-h.z,f=l.x-h.x,x=l.y-h.y,d=l.z-h.z;u*=e=1/Math.sqrt(u*u+m*m+c*c),m*=e,c*=e,f*=e=1/Math.sqrt(f*f+x*x+d*d),x*=e,d*=e;for(var _=t;null!=_;){for(var g=_.wrapper;null!=g;){var p=g.vertex;p.transformId!=a&&(p.transformId=a,n=p.x-h.x,s=p.y-h.y,r=p.z-h.z,p.cameraX=n*f+s*x+r*d,p.cameraY=n*u+s*m+r*c),g=g.next}_=_.next}},altern_geom_ClipMacros.calculateFaceCoordinates=function(t,i,e,n){for(var s,r,a,h=++altern_geom_ClipMacros.transformId,o=i.x,l=i.y,u=i.z,m=e.x,c=e.y,f=e.z,x=t;null!=x;){for(var d=x.wrapper;null!=d;){var _=d.vertex;_.transformId!=h&&(_.transformId=h,s=_.x-n.x,r=_.y-n.y,a=_.z-n.z,_.cameraX=s*m+r*c+a*f,_.cameraY=s*o+r*l+a*u),d=d.next}x=x.next}},altern_geom_ClipMacros.updateClipFace=function(t,i,e){for(var n=t.wrapper,s=n;null!=n;)s=n,n=n.next;t.wrapper=altern_geom_ClipMacros.getClippedVerticesForFace(t,i,e,s,t.wrapper)},altern_geom_ClipMacros.newPositiveClipFace=function(t,i,e){var n=altern_geom_Face.create();n.offset=t.offset,n.normalX=t.normalX,n.normalY=t.normalY,n.normalZ=t.normalZ;var s=t.wrapper,r=altern_geom_Wrapper.create();r.vertex=s.vertex;for(var a,h=s.next,o=r;null!=h;)(a=altern_geom_Wrapper.create()).vertex=h.vertex,o.next=a,o=a,h=h.next;return n.wrapper=altern_geom_ClipMacros.getClippedVerticesForFace(t,i,e,o,r),n},altern_geom_ClipMacros.getOverlapClipFace=function(t,i){var e,n,s,r,a,h,o,l,u=null;s=t.normalX,r=t.normalY,a=t.normalZ;var m=altern_geom_ClipMacros.DUMMY_VECTOR;for(n=t.wrapper;null!=n;){e=n.vertex;var c=null!=n.next?n.next.vertex:t.wrapper.vertex;h=c.x-e.x,o=c.y-e.y,l=c.z-e.z;var f=1/Math.sqrt(h*h+o*o+l*l);h*=f,o*=f,l*=f,m.x=l*r-o*a,m.y=h*a-l*s,m.z=o*s-h*r;var x=e.x*m.x+e.y*m.y+e.z*m.z;if(altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(i,m),null==u?u=altern_geom_ClipMacros.newPositiveClipFace(i,m,x):altern_geom_ClipMacros.updateClipFace(i,m,x),null==u.wrapper&&(u=null),null==(i=u))break;n=n.next}return null!=u?u:null},altern_geom_ClipMacros.clipWithPlaneList=function(t,i,e){var n;null==e&&(e=0);var s=i,r=null,a=altern_geom_ClipMacros.DUMMY_VECTOR,h=0;for(n=t;null!=n;)if(0==(e&1<<h)){a.x=-n.x,a.y=-n.y,a.z=-n.z;var o=-n.offset;if(altern_geom_ClipMacros.computeMeshVerticesLocalOffsets(s,a),null==r?r=altern_geom_ClipMacros.newPositiveClipFace(s,a,o):altern_geom_ClipMacros.updateClipFace(s,a,o),null==r.wrapper&&(r=null),null==(s=r))break;++h,n=n.next}else++h,n=n.next;return null!=r?r:null},altern_geom_ClipMacros.prototype={deepCloneWrapper:function(t){var i=altern_geom_Wrapper.create();i.vertex=t.vertex;for(var e=t.next,n=i;null!=e;){var s=altern_geom_Wrapper.create();s.vertex=e.vertex,n.next=s,n=s,e=e.next}return i},__class__:altern_geom_ClipMacros};var altern_geom_Face=function(){};e["altern.geom.Face"]=altern_geom_Face,altern_geom_Face.__name__=["altern","geom","Face"],altern_geom_Face.create=function(){if(null!=altern_geom_Face.collector){var t=altern_geom_Face.collector;return altern_geom_Face.collector=t.next,t.next=null,t}return new altern_geom_Face},altern_geom_Face.getQuad=function(t,i,e,n,s,r){var a,h,o,l,u=new altern_geom_Face,m=new altern_geom_Wrapper;return u.wrapper=m,a=new altern_geom_Vertex,m.vertex=a,h=t.x,o=t.y,l=t.z,h+=i.x*s,o+=i.y*s,l+=i.z*s,h-=e.x*n,o-=e.y*n,l-=e.z*n,a.x=r.a*h+r.b*o+r.c*l+r.d,a.y=r.e*h+r.f*o+r.g*l+r.h,a.z=r.i*h+r.j*o+r.k*l+r.l,m=m.next=new altern_geom_Wrapper,a=new altern_geom_Vertex,m.vertex=a.next=a,h=t.x,o=t.y,l=t.z,h-=i.x*s,o-=i.y*s,l-=i.z*s,h-=e.x*n,o-=e.y*n,l-=e.z*n,a.x=r.a*h+r.b*o+r.c*l+r.d,a.y=r.e*h+r.f*o+r.g*l+r.h,a.z=r.i*h+r.j*o+r.k*l+r.l,m=m.next=new altern_geom_Wrapper,a=new altern_geom_Vertex,m.vertex=a.next=a,h=t.x,o=t.y,l=t.z,h-=i.x*s,o-=i.y*s,l-=i.z*s,h+=e.x*n,o+=e.y*n,l+=e.z*n,a.x=r.a*h+r.b*o+r.c*l+r.d,a.y=r.e*h+r.f*o+r.g*l+r.h,a.z=r.i*h+r.j*o+r.k*l+r.l,m=m.next=new altern_geom_Wrapper,a=new altern_geom_Vertex,m.vertex=a.next=a,h=t.x,o=t.y,l=t.z,h+=i.x*s,o+=i.y*s,l+=i.z*s,h+=e.x*n,o+=e.y*n,l+=e.z*n,a.x=r.a*h+r.b*o+r.c*l+r.d,a.y=r.e*h+r.f*o+r.g*l+r.h,a.z=r.i*h+r.j*o+r.k*l+r.l,u.calculateNormal(),u},altern_geom_Face.setupQuad=function(t,i,e,n,s,r,a){var h,o,l,u,m=t.wrapper;return h=m.vertex,o=i.x,l=i.y,u=i.z,o+=e.x*r,l+=e.y*r,u+=e.z*r,o-=n.x*s,l-=n.y*s,u-=n.z*s,h.x=a.a*o+a.b*l+a.c*u+a.d,h.y=a.e*o+a.f*l+a.g*u+a.h,h.z=a.i*o+a.j*l+a.k*u+a.l,h=(m=m.next).vertex,o=i.x,l=i.y,u=i.z,o-=e.x*r,l-=e.y*r,u-=e.z*r,o-=n.x*s,l-=n.y*s,u-=n.z*s,h.x=a.a*o+a.b*l+a.c*u+a.d,h.y=a.e*o+a.f*l+a.g*u+a.h,h.z=a.i*o+a.j*l+a.k*u+a.l,h=(m=m.next).vertex,o=i.x,l=i.y,u=i.z,o-=e.x*r,l-=e.y*r,u-=e.z*r,o+=n.x*s,l+=n.y*s,u+=n.z*s,h.x=a.a*o+a.b*l+a.c*u+a.d,h.y=a.e*o+a.f*l+a.g*u+a.h,h.z=a.i*o+a.j*l+a.k*u+a.l,h=(m=m.next).vertex,o=i.x,l=i.y,u=i.z,o+=e.x*r,l+=e.y*r,u+=e.z*r,o+=n.x*s,l+=n.y*s,u+=n.z*s,h.x=a.a*o+a.b*l+a.c*u+a.d,h.y=a.e*o+a.f*l+a.g*u+a.h,h.z=a.i*o+a.j*l+a.k*u+a.l,t.calculateNormal(),t},altern_geom_Face.prototype={collect:function(){this.next=altern_geom_Face.collector,altern_geom_Face.collector=this},destroy:function(){for(var t=this.wrapper;null!=t;){var i=t.next;t.next=altern_geom_Wrapper.collector,altern_geom_Wrapper.collector=t,t.vertex=null,t=i}this.wrapper=null,this.processNext=null,this.visible=!1},calculateNormal:function(){var t,i,e,n,s,r,a,h,o,l,u,m,c,f;f=(n=this.wrapper).vertex,c=(n=n.next).vertex,m=(n=n.next).vertex,l=c.x-f.x,o=c.y-f.y,h=c.z-f.z,a=m.x-f.x,r=m.y-f.y,(u=(e=(s=m.z-f.z)*o-r*h)*e+(i=a*h-s*l)*i+(t=r*l-a*o)*t)>0&&(e*=u=1/Math.sqrt(u),i*=u,t*=u,this.normalX=e,this.normalY=i,this.normalZ=t),f.x,f.y,f.z},calculateBestSequenceAndNormal:function(){var t,i,e,n,s,r,a,h,o,l,u,m,c,f;if(null!=this.wrapper.next.next.next){var x,d,_=-1e22,g=null;for(s=this.wrapper;null!=s;){var p=null!=s.next?s.next:this.wrapper,v=null!=p.next?p.next:this.wrapper;f=s.vertex,c=p.vertex,m=v.vertex,u=c.x-f.x,l=c.y-f.y,o=c.z-f.z,h=m.x-f.x,a=m.y-f.y,(t=(n=(r=m.z-f.z)*l-a*o)*n+(e=h*o-r*u)*e+(i=a*u-h*l)*i)>_&&(_=t,g=s)}if(g!=this.wrapper){for(x=this.wrapper.next.next.next;null!=x.next;)x=x.next;for(d=this.wrapper;d.next!=g&&null!=d.next;)d=d.next;x.next=this.wrapper,d.next=null,this.wrapper=g}}f=(s=this.wrapper).vertex,c=(s=s.next).vertex,m=(s=s.next).vertex,u=c.x-f.x,l=c.y-f.y,o=c.z-f.z,h=m.x-f.x,a=m.y-f.y,(t=(n=(r=m.z-f.z)*l-a*o)*n+(e=h*o-r*u)*e+(i=a*u-h*l)*i)>0&&(n*=t=1/Math.sqrt(t),e*=t,i*=t,this.normalX=n,this.normalY=e,this.normalZ=i),this.offset=f.x*n+f.y*e+f.z*i},getArea:function(){for(var t,i=this.wrapper.vertex,e=0,n=(t=this.wrapper.next).next;null!=n;){var s=t.vertex,r=n.vertex,a=s.x-i.x,h=s.y-i.y,o=s.z-i.z,l=r.x-i.x,u=r.y-i.y,m=r.z-i.z,c=h*m-o*u,f=o*l-a*m,x=a*u-h*l;e+=.5*Math.sqrt(c*c+f*f+x*x),t=t.next,n=n.next}return e},overlapsOther2D:function(t){var i,e,n,s,r,a,h,o=null,l=null;for(e=this.wrapper;null!=e;)l=e.vertex,e=e.next;for(a=l,e=t.wrapper;null!=e;)l=e.vertex,e=e.next;for(h=l,l=a,e=this.wrapper;null!=e;){var u=l;l=e.vertex;var m=null!=e.next?e.next.vertex:this.wrapper.vertex;for(o=h,i=t.wrapper;null!=i;){var c=o;o=i.vertex;var f=null!=i.next?i.next.vertex:t.wrapper.vertex;n=-(o.cameraY-l.cameraY),s=o.cameraX-l.cameraX,r=n*l.cameraX+s*l.cameraY;var x=n*u.cameraX+s*u.cameraY-r,d=x>0?1:x<0?-1:0,_=n*m.cameraX+s*m.cameraY-r,g=_>0?1:_<0?-1:0,p=d*g,v=p<0?-2:p>0?d:0==d?g:0==g?d:-2;if(v<-1)i=i.next;else{var y=n*c.cameraX+s*c.cameraY-r,b=y>0?1:y<0?-1:0,w=n*f.cameraX+s*f.cameraY-r,z=w>0?1:w<0?-1:0,Y=b*z,S=Y<0?-2:Y>0?b:0==b?z:0==z?b:-2;if(S<-1)i=i.next;else{if(v*S<0)return!1;i=i.next}}}e=e.next}return!0},isPointInside2D:function(t,i){for(var e,n,s,r=this.wrapper;null!=r;){e=r.vertex;var a=null!=r.next?r.next.vertex:this.wrapper.vertex;if((n=-(a.cameraY-e.cameraY))*t+(s=a.cameraX-e.cameraX)*i<n*e.cameraX+s*e.cameraY)return!1;r=r.next}return!0},get_side:function(t,i,e,n,s){var r=t*n.cameraX+i*n.cameraY-e,a=r>0?1:r<0?-1:0,h=t*s.cameraX+i*s.cameraY-e,o=h>0?1:h<0?-1:0,l=a*o;return l<0?-2:l>0?a:0==a?o:0==o?a:-2},__class__:altern_geom_Face};var altern_geom_IntersectSlopeUtil=function(){this.intersectZ=new I(2),this.intersectTimes=new I(2),this.intersectSides=new Array(2),this.startPosition=new jeash_geom_Vector3D,this.velocity=new jeash_geom_Vector3D,this.pt3=new jeash_geom_Vector3D(70,180,100),this.pt1=new jeash_geom_Vector3D(100,60,60),this.pt2=new jeash_geom_Vector3D(90,60,80),this.endPt=new jeash_geom_Vector3D,this.startPt=new jeash_geom_Vector3D(30,60)};e["altern.geom.IntersectSlopeUtil"]=altern_geom_IntersectSlopeUtil,altern_geom_IntersectSlopeUtil.__name__=["altern","geom","IntersectSlopeUtil"],altern_geom_IntersectSlopeUtil.prototype={sqDistBetween2DVector:function(t,i){var e=i.x-t.x,n=i.y-t.y;return e*e+n*n},rBetween2DVec:function(t,i,e){var n=i.x-t.x,s=i.y-t.y;return n*(e.x-t.x)+s*(e.y-t.y)},setupRay:function(t,i){this.startPt.x=t.x,this.startPt.y=t.y,this.startPt.z=t.z,this.velocity.x=i.x,this.velocity.y=i.y,this.velocity.z=0,this.endPt.x=this.startPt.x+this.velocity.x,this.endPt.y=this.startPt.y+this.velocity.y,this.endPt.z=0},getTriSlopeTrajTime:function(t,i,e){var n=Math.sqrt(t.x*t.x+t.y*t.y);this._unitDist=n,this.velocity.x=n,this.velocity.y=t.z,this.velocity.z=0;var s=this.velocity,r=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return 0!=r&&(s.x/=r,s.y/=r,s.z/=r),this.velocity.x*=e,this.velocity.y*=e,this.startPosition.x=-this.intersectTimes[0],this.startPosition.y=this.startPt.z-this.intersectZ[0],this.getTrajectoryTimeOfFlight2(this.startPosition.y,this.velocity.y,i)},setupTri:function(t,i,e,n,s,r,a,h,o){this.pt1.x=t,this.pt1.y=i,this.pt1.z=e,this.pt2.x=n,this.pt2.y=s,this.pt2.z=r,this.pt3.x=a,this.pt3.y=h,this.pt3.z=o},getTrajHeightAtTime:function(t,i,e){return this.startPt.z-.5*i*e*e+t.y*e},getTrajHeightAtTime2:function(t,i,e,n){return this.startPt.z-.5*i*n*n+t.y*e*n},getGradHeightAtTime:function(t){return this.intersectZ[0]+(t-this.intersectTimes[0])*this.gradient},getFlatTrajTime:function(t,i,e,n){null==n&&(n=0),this.velocity.x=Math.sqrt(t.x*t.x+t.y*t.y),this.velocity.y=t.z,this.velocity.z=0;var s=this.velocity,r=Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);return 0!=r&&(s.x/=r,s.y/=r,s.z/=r),this.velocity.x*=e,this.velocity.y*=e,this.startPosition.x=0,this.startPosition.y=0,this.gradient=n,this.getTrajectoryTimeOfFlight2(this.startPosition.y,this.velocity.y,i)},getTrajectoryTimeOfFlight2:function(t,i,e){var n=i/e;Math.sqrt(i*i+2*e*t);this._tRise=n,this._h=t+i*i/(2*e);var s,r,a=this.gradient,h=-this.startPosition.x*this.gradient,o=-t,l=0,u=0;s=e/2;var m=(r=-i+a*this.velocity.x)*r-4*s*(o-h);return m>0?(a*(l=(-r+Math.sqrt(m))/(2*s))+h,a*(u=(-r-Math.sqrt(m))/(2*s))+h,l>u?l:u):0==m?(a*(l=-r/(2*s))+h,l):-1},getTriIntersections:function(){var t,i=0;this._coincident=!1,this.IsIntersecting(this.startPt,this.endPt,this.pt1,this.pt2)&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt2.z*this.s-this.pt1.z*this.s+this.pt1.z,this.intersectSides[i]=3,++i),this.IsIntersecting(this.startPt,this.endPt,this.pt2,this.pt3)&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt3.z*this.s-this.pt2.z*this.s+this.pt2.z,this.intersectSides[i]=6,++i),this.IsIntersecting(this.startPt,this.endPt,this.pt3,this.pt1)&&i<2&&(this.intersectTimes[i]=this.r,this.intersectZ[i]=this.pt1.z*this.s-this.pt3.z*this.s+this.pt3.z,this.intersectSides[i]=5,++i);this.endPt.x,this.startPt.x,this.endPt.y,this.startPt.y;var e=this.intersectTimes[0],n=this.intersectZ[0],s=this.intersectSides[0];return this.intersectTimes[1]<e&&(this.intersectTimes[0]=this.intersectTimes[1],this.intersectZ[0]=this.intersectZ[1],this.intersectSides[0]=this.intersectSides[1],this.intersectTimes[1]=e,this.intersectZ[1]=n,this.intersectSides[1]=s),this.intersectTimes[0]<0&&(this.intersectZ[0]-=this.intersectTimes[0]/(this.intersectTimes[1]-this.intersectTimes[0])*(this.intersectZ[1]-this.intersectZ[0]),this.intersectTimes[0]=0),this._coincident?i>1?(t=this.intersectTimes[1]-this.intersectTimes[0],this.gradient=(this.intersectZ[1]-this.intersectZ[0])/t,2):-2:0!=i?(t=this.intersectTimes[1]-this.intersectTimes[0],i>1?t>0?(this.gradient=(this.intersectZ[1]-this.intersectZ[0])/t,1):-1:-3):0},IsIntersecting:function(t,i,e,n){var s=(i.x-t.x)*(n.y-e.y)-(i.y-t.y)*(n.x-e.x),r=(t.y-e.y)*(n.x-e.x)-(t.x-e.x)*(n.y-e.y),a=(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y);if(0==s){var h,o,l=e.x-t.x,u=e.y-t.y,m=n.x-t.x,c=n.y-t.y;if(h=l*l+u*u<m*m+c*c?0:1,this.s=h,0!=this.s){var f=i.x-t.x,x=i.y-t.y;o=f*(n.x-t.x)+x*(n.y-t.y)}else{var d=i.x-t.x,_=i.y-t.y;o=d*(e.x-t.x)+_*(e.y-t.y)}return this.r=o,this._coincident=!0,!1}return this.r=r/s,this.s=a/s,this.s>=0&&this.s<=1},__class__:altern_geom_IntersectSlopeUtil};var altern_geom_Vertex=function(){this.transformId=0};e["altern.geom.Vertex"]=altern_geom_Vertex,altern_geom_Vertex.__name__=["altern","geom","Vertex"],altern_geom_Vertex.create=function(){if(null!=altern_geom_Vertex.collector){var t=altern_geom_Vertex.collector;return altern_geom_Vertex.collector=t.next,t.next=null,t.transformId=0,t}return new altern_geom_Vertex},altern_geom_Vertex.prototype={__class__:altern_geom_Vertex};var altern_geom_Wrapper=function(){};e["altern.geom.Wrapper"]=altern_geom_Wrapper,altern_geom_Wrapper.__name__=["altern","geom","Wrapper"],altern_geom_Wrapper.create=function(){if(null!=altern_geom_Wrapper.collector){var t=altern_geom_Wrapper.collector;return altern_geom_Wrapper.collector=altern_geom_Wrapper.collector.next,t.next=null,t}return new altern_geom_Wrapper},altern_geom_Wrapper.prototype={__class__:altern_geom_Wrapper};var altern_partition_js_BVHTree=function(t){this.aabbTriCount=0,this.aabbTris=new Int32Array(64),this._stackCulling=[],this._stack=[],this.geom=new util_geom_Geometry,this._result=new jeash_geom_Vector3D,this.bvh=t};e["altern.partition.js.BVHTree"]=altern_partition_js_BVHTree,altern_partition_js_BVHTree.__name__=["altern","partition","js","BVHTree"],altern_partition_js_BVHTree.__interfaces__=[altern_culling_IFrustumCollectTri,altern_ray_IRaycastImpl,systems_collisions_ITCollidable],altern_partition_js_BVHTree.prototype={setBufferAlloc:function(t){this.aabbTris=new Int32Array(t)},collectGeometryFromAABB:function(t){var i=0,e=this._stack;e[i++]=this.bvh._rootNode;var n=this.bvh._bboxArray,s=this.bvh._trianglesArray;this.geom.numIndices=0,this.geom.numVertices=0;var r=0,a=0;for(this.aabbTriCount=0;--i>=0;){var h=e[i];if(!(t.maxX<h._extentsMin.x||t.maxY<h._extentsMin.y||t.maxZ<h._extentsMin.z||t.minX>h._extentsMax.x||t.minY>h._extentsMax.y||t.minZ>h._extentsMax.z)){null!=h._node0&&(e[i++]=h._node0),null!=h._node1&&(e[i++]=h._node1);for(var o=h._startIndex,l=h._endIndex;o<l;){var u=n[7*o++];this.aabbTris[this.aabbTriCount++]=u,u*=9,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++,this.geom.vertices[a++]=s[u++],this.geom.indices[r]=r++}}}return r>0&&(this.geom.numVertices=this.geom.numIndices=r),this.geom},collectGeometryAndTransforms:function(t,i){var e=0,n=this._stack;n[e++]=this.bvh._rootNode;var s=this.bvh._bboxArray,r=this.bvh._trianglesArray;this.geom.numIndices=0,this.geom.numVertices=0;for(var a=0,h=0;--e>=0;){var o=n[e],l=t.sphere;if(l.x+l.w>o._extentsMin.x&&l.x-l.w<o._extentsMax.x&&l.y+l.w>o._extentsMin.y&&l.y-l.w<o._extentsMax.y&&l.z+l.w>o._extentsMin.z&&l.z-l.w<o._extentsMax.z){null!=o._node0&&(n[e++]=o._node0),null!=o._node1&&(n[e++]=o._node1);for(var u=o._startIndex,m=o._endIndex;u<m;){var c=s[7*u++];c*=9,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++,this.geom.vertices[h++]=r[c++],this.geom.indices[a]=a++}}}a>0&&(this.geom.numVertices=this.geom.numIndices=a,t.geometries[t.numGeometries]=this.geom,t.transforms[t.numGeometries]=i,t.numGeometries++)},purge:function(){this._stack.length=0},intersectRay:function(t,i,e){var n=this.bvh.intersectRay(t,i,!0);if(null!=n&&0!=n.length){var s=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),r=null,a=0!=i.w?i.w:1e22;a*=a;for(var h=0,o=n.length;h<o;){var l=n[h++],u=l.intersectionPoint.x-t.x,m=l.intersectionPoint.y-t.y,c=l.intersectionPoint.z-t.z,f=u*u+m*m+c*c;f<=a&&(r=l,a=f)}if(null!=r)return this._result.x=r.intersectionPoint.x,this._result.y=r.intersectionPoint.y,this._result.z=r.intersectionPoint.z,this._result.w=Math.sqrt(a)/s,this.allResults=n,this.lastResult=r,this._result}return null},collectTrisForFrustum:function(t,i,e,n,s){var r=n.length,a=s.length,h=0,o=this._stack,l=this._stackCulling;o[h]=this.bvh._rootNode,l[h]=i,++h;var u=this.bvh._bboxArray,m=this.bvh._trianglesArray;for(this.geom.numIndices=0,this.geom.numVertices=0,this.aabbTriCount=0;--h>=0;){var c=o[h],f=l[h];if((f=altern_culling_DefaultCulling.cullingInFrustumOf(t,f,c._extentsMin.x,c._extentsMin.y,c._extentsMin.z,c._extentsMax.x,c._extentsMax.y,c._extentsMax.z))>=0){null!=c._node0&&(o[h]=c._node0,l[h]=f,++h),null!=c._node1&&(o[h]=c._node1,l[h]=f,++h);for(var x=c._startIndex,d=c._endIndex;x<d;){var _=u[7*x++];_*=9;var g,p=m[_++],v=m[_++],y=m[_++],b=m[_++],w=m[_++],z=m[_++],Y=m[_++],S=m[_++],X=m[_++];if(!!altern_culling_DefaultCulling.isInFrontOfFrustum(p,v,y,b,w,z,Y,S,X,e)&&(g=altern_culling_DefaultCulling.triInFrustumCover(t,p,v,y,b,w,z,Y,S,X))>=0)if(0==g)n[r++]=p,s[a]=a++,n[r++]=v,s[a]=a++,n[r++]=y,s[a]=a++,n[r++]=b,s[a]=a++,n[r++]=w,s[a]=a++,n[r++]=z,s[a]=a++,n[r++]=Y,s[a]=a++,n[r++]=S,s[a]=a++,n[r++]=X,s[a]=a++;else if(null!=altern_culling_DefaultCulling.clippedFace){for(var Z,P=altern_culling_DefaultCulling.clippedFace,T=P.wrapper.vertex,L=(Z=P.wrapper.next).next;null!=L;){var I=Z.vertex,O=L.vertex;n[r++]=T.x,s[a]=a++,n[r++]=T.y,s[a]=a++,n[r++]=T.z,s[a]=a++,n[r++]=I.x,s[a]=a++,n[r++]=I.y,s[a]=a++,n[r++]=I.z,s[a]=a++,n[r++]=O.x,s[a]=a++,n[r++]=O.y,s[a]=a++,n[r++]=O.z,s[a]=a++,Z=Z.next,L=L.next}var E=altern_culling_DefaultCulling.clippedFace;E.destroy(),E.next=altern_geom_Face.collector,altern_geom_Face.collector=E}}}}},__class__:altern_partition_js_BVHTree};var altern_ray_Raycaster=function(t){this._output=new jeash_geom_Vector3D,this._direction=new jeash_geom_Vector3D,this._origin=new jeash_geom_Vector3D,this.source=t};e["altern.ray.Raycaster"]=altern_ray_Raycaster,altern_ray_Raycaster.__name__=["altern","ray","Raycaster"],altern_ray_Raycaster.prototype={setTarget:function(t){return this.source=t,this},position:function(t,i,e){return this._origin.x=t,this._origin.y=i,this._origin.z=e,this},direction:function(t,i,e){return this._direction.x=t,this._direction.y=i,this._direction.z=e,this},positionAndDirection:function(t,i,e,n,s,r){return this._origin.x=t,this._origin.y=i,this._origin.z=e,this._direction.x=n,this._direction.y=s,this._direction.z=r,this},setIgnoreDistance:function(t){this._direction.w=t},gotHit:function(){this._output.w=0;var t=this.source.intersectRay(this._origin,this._direction,this._output);return null!=t&&(t.x=this._origin.x+t.w*this._direction.x,t.y=this._origin.y+t.w*this._direction.y,t.z=this._origin.z+t.w*this._direction.z),t},__class__:altern_ray_Raycaster};var altern_terrain_GeometryResult=function(){};e["altern.terrain.GeometryResult"]=altern_terrain_GeometryResult,altern_terrain_GeometryResult.__name__=["altern","terrain","GeometryResult"],altern_terrain_GeometryResult.prototype={getIndexAtUV:function(t,i){return this.indexLookup[(i/this.uvSeg|0)*this.verticesAcross+(t/this.uvSeg|0)]},getIndex:function(t,i){return this.indexLookup[i*this.verticesAcross+t]},__class__:altern_terrain_GeometryResult};var altern_terrain_GridQuadChunkCornerData=function(){this.originY=0,this.originX=0};e["altern.terrain.GridQuadChunkCornerData"]=altern_terrain_GridQuadChunkCornerData,altern_terrain_GridQuadChunkCornerData.__name__=["altern","terrain","GridQuadChunkCornerData"],altern_terrain_GridQuadChunkCornerData.prototype={getCornerData:function(t,i,e){return++e,this.vec[(i-this.originY>>e)*this.cols+(t-this.originX>>e)]},__class__:altern_terrain_GridQuadChunkCornerData};var hxbit_Serializable=function(){};e["hxbit.Serializable"]=hxbit_Serializable,hxbit_Serializable.__name__=["hxbit","Serializable"],hxbit_Serializable.prototype={__class__:hxbit_Serializable};var hxbit_Serializer=function(){this.usedClasses=[],null==hxbit_Serializer.CLIDS&&hxbit_Serializer.initClassIDS()};e["hxbit.Serializer"]=hxbit_Serializer,hxbit_Serializer.__name__=["hxbit","Serializer"],hxbit_Serializer.resetCounters=function(){hxbit_Serializer.UID=0,hxbit_Serializer.SEQ=0},hxbit_Serializer.allocUID=function(){return hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID},hxbit_Serializer.registerClass=function(t){if(null!=hxbit_Serializer.CLIDS)throw new js__$Boot_HaxeError("Too late to register class");var i=hxbit_Serializer.CLASSES.length;return hxbit_Serializer.CLASSES.push(t),i},hxbit_Serializer.hash=function(t){for(var i=1,e=0,n=t.length;e<n;){var s=e++;i=223*i+t.charCodeAt(s)|0}return i=1+(1073741823&i)%65423},hxbit_Serializer.initClassIDS=function(){for(var t=hxbit_Serializer.CLASSES,i=[],e=0;e<t.length;){t[e];++e,i.push([])}for(var n=i,s=[],r=0,a=t.length;r<a;)for(var h=r++,o=t[h];null!=(o=Type.getSuperClass(o));){var l=t.indexOf(o);if(l<0)break;n[l].push(h),s[h]=!0}for(var u=[],m=0,c=hxbit_Serializer.CLASSES.length;m<c;){var f,x=m++;if(0!=n[x].length||s[x]){for(var d=Type.getClassName(t[x]),_=1,g=0,p=d.length;g<p;){var v=g++;_=223*_+d.charCodeAt(v)|0}f=_=1+(1073741823&_)%65423}else f=0;u.push(f)}hxbit_Serializer.CLIDS=u,hxbit_Serializer.CL_BYID=[];for(var y=0,b=hxbit_Serializer.CLIDS.length;y<b;){var w=y++,z=hxbit_Serializer.CLIDS[w];if(0!=z){if(null!=hxbit_Serializer.CL_BYID[z])throw new js__$Boot_HaxeError("Conflicting CLID between "+Type.getClassName(hxbit_Serializer.CL_BYID[z])+" and "+Type.getClassName(t[w]));hxbit_Serializer.CL_BYID[z]=t[w]}}},hxbit_Serializer.isClassFinal=function(t){return 0==hxbit_Serializer.CLIDS[t]},hxbit_Serializer.prototype={set_remapIds:function(t){return this.remapObjs=t?new haxe_ds_ObjectMap:null,t},get_remapIds:function(){return null!=this.remapObjs},remap:function(t){null==this.remapObjs.h.__keys__[t.__id__]&&(this.remapObjs.set(t,t.__uid),t.__uid=hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID)},begin:function(){this.out=new haxe_io_BytesBuffer,this.refs=new haxe_ds_IntMap,this.knownStructs=[]},end:function(){var t=this.out.getBytes();return this.out=null,this.refs=null,this.knownStructs=null,t},setInput:function(t,i){this.input=t,this.inPos=i,null==this.refs&&(this.refs=new haxe_ds_IntMap),null==this.knownStructs&&(this.knownStructs=[])},serialize:function(t){return this.begin(),this.addKnownRef(t),this.out.getBytes()},unserialize:function(t,i,e){return null==e&&(e=0),this.refs=new haxe_ds_IntMap,this.knownStructs=[],this.setInput(t,e),this.getRef(i,i.__clid)},getByte:function(){return this.input.b[this.inPos++]},addByte:function(t){this.out.b.push(t)},addInt:function(t){t>=0&&t<128?this.out.b.push(t):(this.out.b.push(128),this.out.addInt32(t))},addInt32:function(t){this.out.addInt32(t)},addInt64:function(t){this.out.addInt64(t)},addFloat:function(t){this.out.addInt32(haxe_io_FPHelper.floatToI32(t))},addDouble:function(t){this.out.addInt64(haxe_io_FPHelper.doubleToI64(t))},addBool:function(t){this.out.b.push(t?1:0)},addArray:function(t,i){if(null!=t){var e=t.length+1;e>=0&&e<128?this.out.b.push(e):(this.out.b.push(128),this.out.addInt32(e));for(var n=0;n<t.length;){var s=t[n];++n,i(s)}}else this.out.b.push(0)},addVector:function(t,i){if(null!=t){var e=t.length+1;e>=0&&e<128?this.out.b.push(e):(this.out.b.push(128),this.out.addInt32(e));for(var n=0;n<t.length;){var s=t[n];++n,i(s)}}else this.out.b.push(0)},getArray:function(t){var i=this.input.b[this.inPos++];128==i&&(i=this.input.getInt32(this.inPos),this.inPos+=4);var e=i;if(0==e)return null;for(var n=[],s=0,r=--e;s<r;){n[s++]=t()}return n},getVector:function(t){var i=this.input.b[this.inPos++];128==i&&(i=this.input.getInt32(this.inPos),this.inPos+=4);var e=i;if(0==e)return null;--e;for(var n=new Array(e),s=0,r=e;s<r;){n[s++]=t()}return n},addMap:function(t,i,e){if(null!=t){var n=t,s=Lambda.array({iterator:function(){return n.keys()}}),r=s.length+1;r>=0&&r<128?this.out.b.push(r):(this.out.b.push(128),this.out.addInt32(r));for(var a=0;a<s.length;){var h=s[a];++a,i(h),e(t.get(h))}}else this.out.b.push(0)},getBool:function(){return 0!=this.input.b[this.inPos++]},getInt:function(){var t=this.input.b[this.inPos++];return 128==t&&(t=this.input.getInt32(this.inPos),this.inPos+=4),t},skip:function(t){this.inPos+=t},getInt32:function(){var t=this.input.getInt32(this.inPos);return this.inPos+=4,t},getInt64:function(){var t=this.input.getInt64(this.inPos);return this.inPos+=8,t},getDouble:function(){var t=this.input.getDouble(this.inPos);return this.inPos+=8,t},getFloat:function(){var t=this.input.getFloat(this.inPos);return this.inPos+=4,t},addString:function(t){if(null==t)this.out.b.push(0);else{var i=haxe_io_Bytes.ofString(t),e=i.length+1;e>=0&&e<128?this.out.b.push(e):(this.out.b.push(128),this.out.addInt32(e));for(var n=this.out,s=(n.b,i.b),r=0,a=i.length;r<a;){var h=r++;n.b.push(s[h])}}},addBytes:function(t){if(null==t)this.out.b.push(0);else{var i=t.length+1;i>=0&&i<128?this.out.b.push(i):(this.out.b.push(128),this.out.addInt32(i));for(var e=this.out,n=(e.b,t.b),s=0,r=t.length;s<r;){var a=s++;e.b.push(n[a])}}},addBytesSub:function(t,i,e){if(null==t)this.out.b.push(0);else{var n=e+1;n>=0&&n<128?this.out.b.push(n):(this.out.b.push(128),this.out.addInt32(n));var s=this.out;if(i<0||e<0||i+e>t.length)throw new js__$Boot_HaxeError(a.OutsideBounds);s.b;for(var r=t.b,h=i,o=i+e;h<o;){var l=h++;s.b.push(r[l])}}},getString:function(){var t=this.input.b[this.inPos++];128==t&&(t=this.input.getInt32(this.inPos),this.inPos+=4);var i=t;if(0==i)return null;--i;var e=this.input.getString(this.inPos,i);return this.inPos+=i,e},getBytes:function(){var t=this.input.b[this.inPos++];128==t&&(t=this.input.getInt32(this.inPos),this.inPos+=4);var i=t;if(0==i)return null;--i;var e=this.input.sub(this.inPos,i);return this.inPos+=i,e},getDynamic:function(){var t=this.input.b[this.inPos++];switch(t){case 0:return null;case 1:return!1;case 2:return!0;case 3:var i=this.input.b[this.inPos++];return 128==i&&(i=this.input.getInt32(this.inPos),this.inPos+=4),i;case 4:var e=this.input.getFloat(this.inPos);return this.inPos+=4,e;case 5:var n={},s=0,r=this.input.b[this.inPos++];128==r&&(r=this.input.getInt32(this.inPos),this.inPos+=4);for(var a=r;s<a;){s++;var h=this.input.b[this.inPos++];128==h&&(h=this.input.getInt32(this.inPos),this.inPos+=4);var o,l=h;if(0==l)o=null;else{--l;var u=this.input.getString(this.inPos,l);this.inPos+=l,o=u}n[o]=this.getDynamic()}return n;case 6:var m=this.input.b[this.inPos++];128==m&&(m=this.input.getInt32(this.inPos),this.inPos+=4);var c=m;if(0==c)return null;--c;var f=this.input.getString(this.inPos,c);return this.inPos+=c,f;case 7:var x=[],d=0,_=this.input.b[this.inPos++];128==_&&(_=this.input.getInt32(this.inPos),this.inPos+=4);for(var g=_;d<g;){d++;x.push(this.getDynamic())}return x;case 8:var p=this.input.b[this.inPos++];128==p&&(p=this.input.getInt32(this.inPos),this.inPos+=4);var v=p;if(0==v)return null;--v;var y=this.input.sub(this.inPos,v);return this.inPos+=v,y;default:throw new js__$Boot_HaxeError("Invalid dynamic prefix "+t)}},addDynamic:function(t){if(null!=t){var i=Type.typeof(t);switch(i[1]){case 1:this.out.b.push(3);var e=t;e>=0&&e<128?this.out.b.push(e):(this.out.b.push(128),this.out.addInt32(e));break;case 2:this.out.b.push(4),this.out.addInt32(haxe_io_FPHelper.floatToI32(t));break;case 3:this.out.b.push(t?2:1);break;case 4:var n=Reflect.fields(t);this.out.b.push(5);var s=n.length;s>=0&&s<128?this.out.b.push(s):(this.out.b.push(128),this.out.addInt32(s));for(var r=0;r<n.length;){var a=n[r];if(++r,null==a)this.out.b.push(0);else{var h=haxe_io_Bytes.ofString(a),o=h.length+1;o>=0&&o<128?this.out.b.push(o):(this.out.b.push(128),this.out.addInt32(o));for(var l=this.out,u=(l.b,h.b),m=0,c=h.length;m<c;){var f=m++;l.b.push(u[f])}}this.addDynamic(Reflect.field(t,a))}break;case 6:var x=i[2];switch(x){case Array:this.out.b.push(7);var d=t,_=d.length;_>=0&&_<128?this.out.b.push(_):(this.out.b.push(128),this.out.addInt32(_));for(var g=0;g<d.length;){var p=d[g];++g,this.addDynamic(p)}break;case String:this.out.b.push(6);var v=t;if(null==v)this.out.b.push(0);else{var y=haxe_io_Bytes.ofString(v),b=y.length+1;b>=0&&b<128?this.out.b.push(b):(this.out.b.push(128),this.out.addInt32(b));for(var w=this.out,z=(w.b,y.b),Y=0,S=y.length;Y<S;){var X=Y++;w.b.push(z[X])}}break;case haxe_io_Bytes:this.out.b.push(8);var Z=t;if(null==Z)this.out.b.push(0);else{var P=Z.length+1;P>=0&&P<128?this.out.b.push(P):(this.out.b.push(128),this.out.addInt32(P));for(var T=this.out,L=(T.b,Z.b),I=0,O=Z.length;I<O;){var E=I++;T.b.push(L[E])}}break;default:throw new js__$Boot_HaxeError("Unsupported dynamic "+Std.string(x))}break;default:throw new js__$Boot_HaxeError("Unsupported dynamic "+Std.string(i))}}else this.out.b.push(0)},addCLID:function(t){this.out.b.push(t>>8),this.out.b.push(255&t)},getCLID:function(){return this.input.b[this.inPos++]<<8|this.input.b[this.inPos++]},addStruct:function(t){if(null!=t){var i=js_Boot.__instanceof(t,hxbit_Serializable)?t:null;if(null!=i)return this.out.b.push(1),void this.addAnyRef(i);var e=this.knownStructs.indexOf(t);if(e>=0)return this.out.b.push(2),void(e>=0&&e<128?this.out.b.push(e):(this.out.b.push(128),this.out.addInt32(e)));this.knownStructs.push(t),this.out.b.push(3);var n=null==t?null:js_Boot.getClass(t);if(null==n)throw new js__$Boot_HaxeError(Std.string(t)+" does not have a class ?");var s=Type.getClassName(n);if(null==s)this.out.b.push(0);else{var r=haxe_io_Bytes.ofString(s),a=r.length+1;a>=0&&a<128?this.out.b.push(a):(this.out.b.push(128),this.out.addInt32(a));for(var h=this.out,o=(h.b,r.b),l=0,u=r.length;l<u;){var m=l++;h.b.push(o[m])}}t.customSerialize(this),this.out.b.push(255)}else this.out.b.push(0)},getStruct:function(){switch(this.input.b[this.inPos++]){case 0:return null;case 1:return this.getAnyRef();case 2:var t=this.knownStructs,i=this.input.b[this.inPos++];return 128==i&&(i=this.input.getInt32(this.inPos),this.inPos+=4),t[i];case 3:var e=this.input.b[this.inPos++];128==e&&(e=this.input.getInt32(this.inPos),this.inPos+=4);var n,s=e;if(0==s)n=null;else{--s;var r=this.input.getString(this.inPos,s);this.inPos+=s,n=r}var a=Type.resolveClass(n);if(null==a)throw new js__$Boot_HaxeError("Missing struct class "+n);var h=Type.createEmptyInstance(a);if(this.knownStructs.push(h),h.customUnserialize(this),255!=this.input.b[this.inPos++])throw new js__$Boot_HaxeError("Invalid customUnserialize for "+Std.string(h));return h;default:throw new js__$Boot_HaxeError("assert")}},addObjRef:function(t){var i=t.__uid;i>=0&&i<128?this.out.b.push(i):(this.out.b.push(128),this.out.addInt32(i))},getObjRef:function(){var t=this.input.b[this.inPos++];return 128==t&&(t=this.input.getInt32(this.inPos),this.inPos+=4),t},addAnyRef:function(t){if(null!=t){if(null!=this.remapObjs&&this.remap(t),this.addObjRef(t),null==this.refs.h[t.__uid]){this.refs.h[t.__uid]=t;var i=t.getCLID();this.usedClasses[i]=!0,this.out.b.push(i>>8),this.out.b.push(255&i),t.serialize(this)}}else this.out.b.push(0)},addKnownRef:function(t){if(null!=t){if(null!=this.remapObjs&&this.remap(t),this.addObjRef(t),null==this.refs.h[t.__uid]){this.refs.h[t.__uid]=t;var i=t.getCLID();this.usedClasses[i]=!0;var e=hxbit_Serializer.CLIDS[i];0!=e&&(this.out.b.push(e>>8),this.out.b.push(255&e)),t.serialize(this)}}else this.out.b.push(0)},getAnyRef:function(){var t=this.getObjRef();if(0==t)return null;if(null!=this.refs.h[t])return this.refs.h[t];var i=16777215&t;hxbit_Serializer.UID<i&&(hxbit_Serializer.UID=i);var e=this.input.b[this.inPos++]<<8|this.input.b[this.inPos++];null!=this.mapIndexes&&(e=this.mapIndexes[e]);var n=Type.createEmptyInstance(hxbit_Serializer.CLASSES[e]);return null!=this.newObjects&&this.newObjects.push(n),n.__uid=t,n.unserializeInit(),this.refs.h[t]=n,null!=this.convert&&null!=this.convert[e]?this.convertRef(n,this.convert[e]):n.unserialize(this),n},getRef:function(t,i){var e=this.getObjRef();if(0==e)return null;if(null!=this.refs.h[e])return this.refs.h[e];var n=16777215&e;if(hxbit_Serializer.UID<n&&(hxbit_Serializer.UID=n),0!=hxbit_Serializer.CLIDS[i]){var s=this.input.b[this.inPos++]<<8|this.input.b[this.inPos++];t=hxbit_Serializer.CL_BYID[s],null!=this.convert&&(i=t.__clid)}var r=Type.createEmptyInstance(t);return null!=this.newObjects&&this.newObjects.push(r),r.__uid=e,r.unserializeInit(),this.refs.h[e]=r,null!=this.convert&&null!=this.convert[i]?this.convertRef(r,this.convert[i]):r.unserialize(this),r},getKnownRef:function(t){return this.getRef(t,t.__clid)},beginSave:function(){this.begin(),this.usedClasses=[]},endSave:function(t){null==t&&(t=0);var i=this.end();this.begin();for(var e=[],n=[],s=hxbit_Serializer.CLASSES.indexOf(hxbit_Schema),r=0,h=this.usedClasses.length;r<h;){var o=r++;if(this.usedClasses[o]&&o!=s){var l=hxbit_Serializer.CLASSES[o],u=Type.createEmptyInstance(l).getSerializeSchema();n.push(u),e.push(o),this.addKnownRef(u),this.refs.remove(u.__uid)}}var m=this.end();this.begin();var c=this.out;if(t<0||t>i.length)throw new js__$Boot_HaxeError(a.OutsideBounds);c.b;for(var f=i.b,x=0,d=t;x<d;){var _=x++;c.b.push(f[_])}var g=haxe_io_Bytes.ofString("HXS"),p=g.length+1;p>=0&&p<128?this.out.b.push(p):(this.out.b.push(128),this.out.addInt32(p));for(var v=this.out,y=(v.b,g.b),b=0,w=g.length;b<w;){var z=b++;v.b.push(y[z])}this.out.b.push(1);for(var Y=0,S=e.length;Y<S;){var X=Y++,Z=e[X],P=Type.getClassName(hxbit_Serializer.CLASSES[Z]);if(null==P)this.out.b.push(0);else{var T=haxe_io_Bytes.ofString(P),L=T.length+1;L>=0&&L<128?this.out.b.push(L):(this.out.b.push(128),this.out.addInt32(L));for(var I=this.out,O=(I.b,T.b),E=0,C=T.length;E<C;){var D=E++;I.b.push(O[D])}}this.out.b.push(Z>>8),this.out.b.push(255&Z);var k=n[X].get_checkSum();this.out.addInt32(k)}this.out.b.push(0);var A=m.length;A>=0&&A<128?this.out.b.push(A):(this.out.b.push(128),this.out.addInt32(A));for(var M=this.out,R=(M.b,m.b),B=0,N=m.length;B<N;){var V=B++;M.b.push(R[V])}var F=this.out,j=i.length-t;if(t<0||j<0||t+j>i.length)throw new js__$Boot_HaxeError(a.OutsideBounds);F.b;for(var U=i.b,q=t,G=t+j;q<G;){var H=q++;F.b.push(U[H])}return this.end()},beginLoad:function(t,i){null==i&&(i=0),this.setInput(t,i);for(var e=new haxe_ds_StringMap,n=[],s=[],r=[],a=!1,h=!1,o=0,l=hxbit_Serializer.CLASSES.length;o<l;){var u=o++,m=Type.getClassName(hxbit_Serializer.CLASSES[u]);null!=Z[m]?e.setReserved(m,u):e.h[m]=u,s[u]=u}var c=this.input.b[this.inPos++];128==c&&(c=this.input.getInt32(this.inPos),this.inPos+=4);var f,x=c;if(0==x)f=null;else{--x;var d=this.input.getString(this.inPos,x);this.inPos+=x,f=d}if("HXS"!=f)throw new js__$Boot_HaxeError("Invalid HXS data");var _=this.input.b[this.inPos++];if(1!=_)throw new js__$Boot_HaxeError("Unsupported HXS version "+_);for(;;){var g=this.input.b[this.inPos++];128==g&&(g=this.input.getInt32(this.inPos),this.inPos+=4);var p,v=g;if(0==v)p=null;else{--v;var y=this.input.getString(this.inPos,v);this.inPos+=v,p=y}if(null==p)break;var b=this.input.b[this.inPos++]<<8|this.input.b[this.inPos++],w=this.input.getInt32(this.inPos);this.inPos+=4;var z=w,Y=null!=Z[p]?e.getReserved(p):e.h[p];if(null==Y)throw new js__$Boot_HaxeError("Missing class "+p+" found in HXS data");var S=Type.createEmptyInstance(hxbit_Serializer.CLASSES[Y]).getSerializeSchema();S.get_checkSum()!=z&&(a=!0,n[b]=S),b!=Y&&(h=!0,s[b]=Y),r.push(b)}var X=this.input.b[this.inPos++];128==X&&(X=this.input.getInt32(this.inPos),this.inPos+=4);var P=X;if(a){this.convert=[];for(var T=0;T<r.length;){var L=r[T];++T;var I=n[L],O=hxbit_Schema,E=this.getRef(O,O.__clid);this.refs.remove(E.__uid),null!=I&&(this.convert[s[L]]=new hxbit_Convert(I,E))}}else this.inPos+=P;h&&(this.mapIndexes=s)},endLoad:function(){this.convert=null,this.mapIndexes=null,this.setInput(null,0)},convertRef:function(t,i){for(var e=i.read.length,n=new Array(e),s=0,r=i.read;s<r.length;){var a=r[s];++s,n[a.index]=this.readValue(a.from)}var h=this.out;this.out=new haxe_io_BytesBuffer;for(var o=0,l=i.write;o<l.length;){var u,m=l[o];++o,null==m.from?u=m.defaultValue:(u=n[m.index],m.same||(u=null==u?m.defaultValue:this.convertValue(u,m.from,m.to))),this.writeValue(u,m.to)}var c=this.out.getBytes();this.out=h;var f=this.input,x=this.inPos;this.setInput(c,0),t.unserialize(this),this.setInput(f,x)},isNullable:function(t){switch(t[1]){case 0:case 1:case 2:return!1;default:return!0}},convertValue:function(t,i,e){if(null==t&&this.isNullable(e))return null;if(hxbit_Convert.sameType(i,e))return t;if(9==i[1]&&9==e[1]){for(var n=i[2],s=e[2],r={},a=0;a<s.length;){var h=s[a];++a;for(var o=!1,l=null,u=0;u<n.length;){var m=n[u];if(++u,m.name==h.name){o=!0,l=this.convertValue(Reflect.field(t,m.name),m.type,h.type);break}}if(o){if(null==l&&h.opt)continue}else{if(h.opt)continue;l=hxbit_Convert.getDefault(h.type)}r[h.name]=l}return r}throw new js__$Boot_HaxeError("Cannot convert "+Std.string(t)+" from "+Std.string(i)+" to "+Std.string(e))},readValue:function(t){var i=this;switch(t[1]){case 0:var e=this.input.b[this.inPos++];return 128==e&&(e=this.input.getInt32(this.inPos),this.inPos+=4),e;case 1:var n=this.input.getFloat(this.inPos);return this.inPos+=4,n;case 2:return 0!=this.input.b[this.inPos++];case 3:var s=this.input.b[this.inPos++];128==s&&(s=this.input.getInt32(this.inPos),this.inPos+=4);var r=s;if(0==r)return null;--r;var a=this.input.getString(this.inPos,r);return this.inPos+=r,a;case 4:var h=this.input.b[this.inPos++];128==h&&(h=this.input.getInt32(this.inPos),this.inPos+=4);var o=h;if(0==o)return null;--o;var l=this.input.sub(this.inPos,o);return this.inPos+=o,l;case 5:var u=t[2];return this.getKnownRef(Type.resolveClass(u));case 6:var m=t[2],c=Type.resolveClass("hxbit.enumSer."+m.split(".").join("_"));if(null==c){var f,x=Type.resolveEnum(m);if(null!=x){var d=haxe_rtti_Meta.getType(x);f=Object.prototype.hasOwnProperty.call(d,"skipSerialize")}else f=!1;if(f){var _=this.input.b[this.inPos++];return 128==_&&(_=this.input.getInt32(this.inPos),this.inPos+=4),null}throw new js__$Boot_HaxeError("No enum unserializer found for "+m)}return c.doUnserialize(this);case 7:var g=t[3],p=t[2];switch(p[1]){case 0:var v=this.input.b[this.inPos++];128==v&&(v=this.input.getInt32(this.inPos),this.inPos+=4);var y,b=v;if(0==b)y=null;else{for(var w=new haxe_ds_IntMap;--b>0;){var z=i.readValue(p),Y=i.readValue(g);w.h[z]=Y}y=w}return y;case 3:var S=this.input.b[this.inPos++];128==S&&(S=this.input.getInt32(this.inPos),this.inPos+=4);var X,P=S;if(0==P)X=null;else{for(var T=new haxe_ds_StringMap;--P>0;){var L=i.readValue(p),I=i.readValue(g);null!=Z[L]?T.setReserved(L,I):T.h[L]=I}X=T}return X;case 6:var O=this.input.b[this.inPos++];128==O&&(O=this.input.getInt32(this.inPos),this.inPos+=4);var E=O;if(0==E)return null;for(var C=new haxe_ds_EnumValueMap;--E>0;){var D=this.readValue(p),k=this.readValue(g);C.set(D,k)}return C;default:var A=this.input.b[this.inPos++];128==A&&(A=this.input.getInt32(this.inPos),this.inPos+=4);var M,R=A;if(0==R)M=null;else{for(var B=new haxe_ds_ObjectMap;--R>0;){var N=i.readValue(p),V=i.readValue(g);B.set(N,V)}M=B}return M}break;case 8:var F=t[2],j=this.input.b[this.inPos++];128==j&&(j=this.input.getInt32(this.inPos),this.inPos+=4);var U=j;if(0==U)return null;for(var q=[],G=0,H=--U;G<H;){q[G++]=i.readValue(F)}return q;case 9:var W=t[2],Q=this.input.b[this.inPos++];128==Q&&(Q=this.input.getInt32(this.inPos),this.inPos+=4);var K=Q;if(0==K)return null;var $={};--K;for(var J=[],tt=0;tt<W.length;){var it=W[tt];++tt,this.isNullable(it.type)&&J.push(it)}for(var et=J,nt=0;nt<W.length;){var st=W[nt];++nt;var rt=et.indexOf(st);rt>=0&&0==(K&1<<rt)||($[st.name]=this.readValue(st.type))}return $;case 10:var at=t[2];return this.readValue(at);case 11:var ht=t[2],ot=this.input.b[this.inPos++];128==ot&&(ot=this.input.getInt32(this.inPos),this.inPos+=4);var lt=ot;if(0==lt)return null;--lt;for(var ut=new Array(lt),mt=0,ct=lt;mt<ct;){ut[mt++]=i.readValue(ht)}return ut;case 12:var ft=t[2];return 0==this.input.b[this.inPos++]?null:this.readValue(ft);case 13:throw new js__$Boot_HaxeError("assert");case 14:return this.getDynamic();case 15:var xt=this.input.getInt64(this.inPos);return this.inPos+=8,xt;case 16:var dt=this.input.b[this.inPos++];return 128==dt&&(dt=this.input.getInt32(this.inPos),this.inPos+=4),dt;case 17:return this.getStruct()}},writeValue:function(t,i){var e=this;switch(i[1]){case 0:var n=t;n>=0&&n<128?this.out.b.push(n):(this.out.b.push(128),this.out.addInt32(n));break;case 1:this.out.addInt32(haxe_io_FPHelper.floatToI32(t));break;case 2:this.out.b.push(t?1:0);break;case 3:var s=t;if(null==s)this.out.b.push(0);else{var r=haxe_io_Bytes.ofString(s),a=r.length+1;a>=0&&a<128?this.out.b.push(a):(this.out.b.push(128),this.out.addInt32(a));for(var h=this.out,o=(h.b,r.b),l=0,u=r.length;l<u;){var m=l++;h.b.push(o[m])}}break;case 4:var c=t;if(null==c)this.out.b.push(0);else{var f=c.length+1;f>=0&&f<128?this.out.b.push(f):(this.out.b.push(128),this.out.addInt32(f));for(var x=this.out,d=(x.b,c.b),_=0,g=c.length;_<g;){var p=_++;x.b.push(d[p])}}break;case 5:this.addKnownRef(t);break;case 6:var v=i[2],y="hxbit.enumSer."+v.split(".").join("_");if(null==y)throw new js__$Boot_HaxeError("No enum unserializer found for "+v);Type.resolveClass(y).doSerialize(this,t);break;case 7:var b=i[3],w=i[2];switch(w[1]){case 0:var z=t;if(null==z)this.out.b.push(0);else{var Y=z,S=Lambda.array({iterator:function(){return Y.keys()}}),X=S.length+1;X>=0&&X<128?this.out.b.push(X):(this.out.b.push(128),this.out.addInt32(X));for(var P=0;P<S.length;){var T=S[P];++P,e.writeValue(T,w),e.writeValue(z.h[T],b)}}break;case 3:var L=t;if(null==L)this.out.b.push(0);else{var I=L,O=Lambda.array({iterator:function(){return I.keys()}}),E=O.length+1;E>=0&&E<128?this.out.b.push(E):(this.out.b.push(128),this.out.addInt32(E));for(var C=0;C<O.length;){var D=O[C];++C,e.writeValue(D,w),e.writeValue(null!=Z[D]?L.getReserved(D):L.h[D],b)}}break;case 6:var k=t;if(null==k)return void this.out.b.push(0);var A=Lambda.array({iterator:$bind(k,k.keys)}),M=A.length+1;M>=0&&M<128?this.out.b.push(M):(this.out.b.push(128),this.out.addInt32(M));for(var R=0;R<A.length;){var B=A[R];++R,this.writeValue(B,w),this.writeValue(k.get(B),b)}break;default:var N=t;if(null==N)this.out.b.push(0);else{var V=N,F=Lambda.array({iterator:function(){return V.keys()}}),j=F.length+1;j>=0&&j<128?this.out.b.push(j):(this.out.b.push(128),this.out.addInt32(j));for(var U=0;U<F.length;){var q=F[U];++U,e.writeValue(q,w),e.writeValue(N.h[q.__id__],b)}}}break;case 8:var G=i[2],H=t;if(null==H)this.out.b.push(0);else{var W=H.length+1;W>=0&&W<128?this.out.b.push(W):(this.out.b.push(128),this.out.addInt32(W));for(var Q=0;Q<H.length;){var K=H[Q];++Q,e.writeValue(K,G)}}break;case 9:var $=i[2];if(null==t)this.out.b.push(0);else{for(var J=0,tt=[],it=0;it<$.length;){var et=$[it];++it,this.isNullable(et.type)&&tt.push(et)}for(var nt=tt,st=0,rt=nt.length;st<rt;){var at=st++;null!=Reflect.field(t,nt[at].name)&&(J|=1<<at)}var ht=J+1;ht>=0&&ht<128?this.out.b.push(ht):(this.out.b.push(128),this.out.addInt32(ht));for(var ot=0;ot<$.length;){var lt=$[ot];++ot;var ut=nt.indexOf(lt);ut>=0&&0==(J&1<<ut)||this.writeValue(Reflect.field(t,lt.name),lt.type)}}break;case 10:var mt=i[2];this.writeValue(t,mt);break;case 11:var ct=i[2],ft=t;if(null==ft)this.out.b.push(0);else{var xt=ft.length+1;xt>=0&&xt<128?this.out.b.push(xt):(this.out.b.push(128),this.out.addInt32(xt));for(var dt=0;dt<ft.length;){var _t=ft[dt];++dt,e.writeValue(_t,ct)}}break;case 12:var gt=i[2];null==t?this.out.b.push(0):(this.out.b.push(1),this.writeValue(t,gt));break;case 13:throw new js__$Boot_HaxeError("assert");case 14:this.addDynamic(t);break;case 15:this.out.addInt64(t);break;case 16:var pt=t;pt>=0&&pt<128?this.out.b.push(pt):(this.out.b.push(128),this.out.addInt32(pt));break;case 17:this.addStruct(t)}},__class__:hxbit_Serializer};var altern_terrain_HeightMapInfo=function(){this.__uid=hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID,this.Scale=8,this.ZOrigin=0,this.XOrigin=0};e["altern.terrain.HeightMapInfo"]=altern_terrain_HeightMapInfo,altern_terrain_HeightMapInfo.__name__=["altern","terrain","HeightMapInfo"],altern_terrain_HeightMapInfo.__interfaces__=[hxbit_Serializable],altern_terrain_HeightMapInfo.isBase2=function(t){return Math.pow(2,Math.round(1.4426950408889634*Math.log(t)))==t},altern_terrain_HeightMapInfo.createFlat=function(t,i){null==i&&(i=256);var e=new altern_terrain_HeightMapInfo;e.Scale=Math.round(1.4426950408889634*Math.log(i));var n=t+1;return e.RowWidth=n,e.XSize=n,e.ZSize=n,e.Data=new Int32Array(n*n),e},altern_terrain_HeightMapInfo.createFromBytes=function(t,i,e,n,s,r,a){null==a&&(a=256),null==r&&(r=0);var h=new altern_terrain_HeightMapInfo;return h.XOrigin=t,h.ZOrigin=i,h.setFromBytes(e,n,s,r,a),h},altern_terrain_HeightMapInfo.prototype={customSerialize:function(t){var i=this.Data.length;t.out.addInt32(i);for(var e=0;e<i;)t.out.addInt32(this.Data[e]),++e},customUnserialize:function(t){var i=t.input.getInt32(t.inPos);t.inPos+=4,this.Data=new Int32Array(i);for(var e=this.Data.length,n=0;n<e;){var s=this.Data,r=t.input.getInt32(t.inPos);t.inPos+=4,s[n]=r,++n}},getData:function(t,i){return this.Data[t+i*this.RowWidth]},fillDataWithValue:function(t){for(var i=this.Data.length;--i>-1;)this.Data[i]=t},setFixed:function(t){this.Data.length=this.Data.length},BoxFilterHeightMap:function(t){null==t&&(t=!0);var i=0,e=0,n=this.XSize,s=t?n:n-1,r=t?n:n-1,a=s*r,h=new Int32Array(this.Data.length),o=this.Data;for(e=t?0:1;e<r;){for(i=t?0:1;i<s;){var l=0,u=1;i-1+(e-1)*n>=0&&i-1+(e-1)*n<a&&(l+=o[i-1+(e-1)*n],++u),i+(e-1)*n>=0&&i+(e-1)*n<a&&(l+=o[i+(e-1)*n],++u),i+1+(e-1)*n>=0&&i+1+(e-1)*n<a&&(l+=o[i+1+(e-1)*n],++u),i-1+e*n>=0&&i-1+e*n<a&&(l+=o[i-1+e*n],++u),l+=o[i+e*n],i+1+e*n>=0&&i+1+e*n<a&&(l+=o[i+1+e*n],++u),i-1+(e+1)*n>=0&&i-1+(e+1)*n<a&&(l+=o[i-1+(e+1)*n],++u),i+(e+1)*n>=0&&i+(e+1)*n<a&&(l+=o[i+(e+1)*n],++u),i+1+(e+1)*n>=0&&i+1+(e+1)*n<a&&(l+=o[i+1+(e+1)*n],++u),h[i+e*n]=l/u|0,++i}++e}this.Data=h},Sample:function(t,i){var e=t-this.XOrigin>>this.Scale,n=i-this.ZOrigin>>this.Scale,s=(1<<this.Scale)-1,r=t-this.XOrigin&s,a=i-this.ZOrigin&s;(e<0||e>this.XSize-1||n<0||n>this.ZSize-1)&&(e<0&&(e=0),n<0&&(n=0),e>=this.XSize&&(e=this.XSize-1),n>=this.ZSize&&(n=this.ZSize-1));var h=r/(s+1),o=a/(s+1),l=e<this.XSize-1?1:0,u=n<this.ZSize-1?1:0;return(this.Data[e+n*this.RowWidth]*(1-h)+this.Data[e+l+n*this.RowWidth]*h)*(1-o)+(this.Data[e+(n+u)*this.RowWidth]*(1-h)+this.Data[e+l+(n+u)*this.RowWidth]*h)*o|0},SampleInd:function(t,i){return this.Data[i*this.RowWidth+t]},clone:function(){var t=new altern_terrain_HeightMapInfo;t.XOrigin=this.XOrigin,t.ZOrigin=this.ZOrigin,t.XSize=this.XSize,t.ZSize=this.ZSize,t.RowWidth=this.RowWidth,t.Scale=this.Scale;for(var i=this.Data,e=i.length,n=new Int32Array(e),s=0,r=e;s<r;){var a=s++;n[a]=i[a]}return t.Data=n,t},flatten:function(t){null==t&&(t=0);for(var i=this.Data.length,e=0;e<i;)this.Data[e]=t,++e},slopeAlongXY:function(t,i){null==i&&(i=1);this.Data.length;for(var e=0;e<this.ZSize;){for(var n=0;n<this.XSize;)this.Data[e*this.XSize+n]+=(t*n+t*e)*i|0,++n;++e}},slopeAlongY:function(t){this.Data.length;for(var i=0;i<this.ZSize;){for(var e=0;e<this.XSize;)this.Data[i*this.XSize+e]+=t*i,++e;++i}},slopeAltAlongY:function(t){for(this.Data.length;0<this.ZSize;)for(;0<this.XSize;)this.Data[0*this.XSize+0]+=-1*t},randomise:function(t){t*=0;for(var i=this.Data.length,e=0;e<i;)this.Data[e]+=-Math.random()*t+2*t|0,++e},copyData:function(t,i,e,n,s,r,a){null==a&&(a=0),null==r&&(r=0);for(var h=s.Data,o=t+e,l=i+n,u=i;u<l;){for(var m=t;m<o;){var c=m<0?0:m>=s.XSize?s.XSize-1:m,f=u<0?0:u>=s.ZSize?s.ZSize-1:u;this.Data[(u-i+a)*this.XSize+m-t+r]=h[f*s.XSize+c],++m}++u}},setFromBytes:function(t,i,e,n,s){if(null==s&&(s=256),null==n&&(n=0),!altern_terrain_HeightMapInfo.isBase2(s))throw new js__$Boot_HaxeError("Tile size isn't base 2!");this.Scale=Math.round(1.4426950408889634*Math.log(s));var r=e+1,a=e+1;this.RowWidth=r,this.XSize=this.RowWidth,this.ZSize=a;var h=Math.sqrt(t.length),o=0|h,l=1;if(o!=h)throw new js__$Boot_HaxeError("Non-square Bytes length detected!");if((l=o/e|0)!=o/e)throw new js__$Boot_HaxeError("MAP_SIZE(patchesAcross) must be divisible by SRC_SIZE(bytes)");for(var u=this.Data=new Int32Array(r*r),m=e+1,c=0,f=0;f<m;){for(var x=0;x<m;){var d=x*l,_=f*l,g=d<o?d:o-1,p=_<o?_:o-1;t.length;if(g*o+p>=t.length)throw new js__$Boot_HaxeError("Buffer overflow:"+(g*o+p));c=t.b[g*o+p],u[f*m+x]=n+c*i|0,++x}++f}},setFlat:function(t,i){null==i&&(i=256),this.Scale=Math.round(1.4426950408889634*Math.log(i));var e=t+1;this.RowWidth=e,this.XSize=e,this.ZSize=e,null==this.Data?this.Data=new Int32Array(e*e):this.flatten()},reset:function(){this.Data=new Int32Array(this.RowWidth*this.RowWidth)},paddEdgeDataValues:function(){var t,i;t=this.XSize-1,i=this.ZSize-1;for(var e=0;e<i;)this.Data[e*this.RowWidth+t]=this.Data[e*this.RowWidth+t-1],++e;for(e=this.ZSize-1,i=this.XSize-1,t=0;t<i;)this.Data[e*this.RowWidth+t]=this.Data[(e-1)*this.RowWidth+t],++t;t=this.XSize-1,e=this.ZSize-1,this.Data[e*this.RowWidth+t]=this.Data[(e-1)*this.RowWidth+t-1]},getCLID:function(){return altern_terrain_HeightMapInfo.__clid},serialize:function(t){var i=this.XOrigin;i>=0&&i<128?t.out.b.push(i):(t.out.b.push(128),t.out.addInt32(i));var e=this.ZOrigin;e>=0&&e<128?t.out.b.push(e):(t.out.b.push(128),t.out.addInt32(e));var n=this.XSize;n>=0&&n<128?t.out.b.push(n):(t.out.b.push(128),t.out.addInt32(n));var s=this.ZSize;s>=0&&s<128?t.out.b.push(s):(t.out.b.push(128),t.out.addInt32(s));var r=this.RowWidth;r>=0&&r<128?t.out.b.push(r):(t.out.b.push(128),t.out.addInt32(r));var a=this.Scale;a>=0&&a<128?t.out.b.push(a):(t.out.b.push(128),t.out.addInt32(a)),this.customSerialize(t)},getSerializeSchema:function(){var t=new hxbit_Schema;return t.fieldsNames.push("XOrigin"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("ZOrigin"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("XSize"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("ZSize"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("RowWidth"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("Scale"),t.fieldsTypes.push(v.PInt),t.isFinal=hxbit_Serializer.isClassFinal(altern_terrain_HeightMapInfo.__clid),t},unserializeInit:function(){this.XOrigin=0,this.ZOrigin=0,this.Scale=8},unserialize:function(t){var i=t.input.b[t.inPos++];128==i&&(i=t.input.getInt32(t.inPos),t.inPos+=4),this.XOrigin=i;var e=t.input.b[t.inPos++];128==e&&(e=t.input.getInt32(t.inPos),t.inPos+=4),this.ZOrigin=e;var n=t.input.b[t.inPos++];128==n&&(n=t.input.getInt32(t.inPos),t.inPos+=4),this.XSize=n;var s=t.input.b[t.inPos++];128==s&&(s=t.input.getInt32(t.inPos),t.inPos+=4),this.ZSize=s;var r=t.input.b[t.inPos++];128==r&&(r=t.input.getInt32(t.inPos),t.inPos+=4),this.RowWidth=r;var a=t.input.b[t.inPos++];128==a&&(a=t.input.getInt32(t.inPos),t.inPos+=4),this.Scale=a,this.customUnserialize(t)},__class__:altern_terrain_HeightMapInfo};var altern_terrain_QuadChunkCornerData=function(){this.__uid=hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID};e["altern.terrain.QuadChunkCornerData"]=altern_terrain_QuadChunkCornerData,altern_terrain_QuadChunkCornerData.__name__=["altern","terrain","QuadChunkCornerData"],altern_terrain_QuadChunkCornerData.__interfaces__=[hxbit_Serializable],altern_terrain_QuadChunkCornerData.create=function(){var t;return altern_terrain_QuadChunkCornerData.BI<altern_terrain_QuadChunkCornerData.BLEN?t=altern_terrain_QuadChunkCornerData.BUFFER[altern_terrain_QuadChunkCornerData.BI]:(t=new altern_terrain_QuadChunkCornerData,altern_terrain_QuadChunkCornerData.BUFFER[altern_terrain_QuadChunkCornerData.BLEN++]=t),altern_terrain_QuadChunkCornerData.BI++,t},altern_terrain_QuadChunkCornerData.setFixedBufferSize=function(t){altern_terrain_QuadChunkCornerData.BUFFER.length=t,altern_terrain_QuadChunkCornerData.BLEN=t},altern_terrain_QuadChunkCornerData.fillBuffer=function(){for(var t=altern_terrain_QuadChunkCornerData.BLEN,i=altern_terrain_QuadChunkCornerData.BUFFER,e=0;e<t;)i[e]=new altern_terrain_QuadChunkCornerData,++e},altern_terrain_QuadChunkCornerData.prototype={getCLID:function(){return altern_terrain_QuadChunkCornerData.__clid},serialize:function(t){t.addKnownRef(this.Square);var i=this.Level;i>=0&&i<128?t.out.b.push(i):(t.out.b.push(128),t.out.addInt32(i));var e=this.xorg;e>=0&&e<128?t.out.b.push(e):(t.out.b.push(128),t.out.addInt32(e));var n=this.zorg;n>=0&&n<128?t.out.b.push(n):(t.out.b.push(128),t.out.addInt32(n))},getSerializeSchema:function(){var t=new hxbit_Schema;return t.fieldsNames.push("Square"),t.fieldsTypes.push(v.PSerializable("altern.terrain.QuadSquareChunk")),t.fieldsNames.push("Level"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("xorg"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("zorg"),t.fieldsTypes.push(v.PInt),t.isFinal=hxbit_Serializer.isClassFinal(altern_terrain_QuadChunkCornerData.__clid),t},unserializeInit:function(){},unserialize:function(t){this.Square=t.getRef(altern_terrain_QuadSquareChunk,altern_terrain_QuadSquareChunk.__clid);var i=t.input.b[t.inPos++];128==i&&(i=t.input.getInt32(t.inPos),t.inPos+=4),this.Level=i;var e=t.input.b[t.inPos++];128==e&&(e=t.input.getInt32(t.inPos),t.inPos+=4),this.xorg=e;var n=t.input.b[t.inPos++];128==n&&(n=t.input.getInt32(t.inPos),t.inPos+=4),this.zorg=n},__class__:altern_terrain_QuadChunkCornerData};var altern_terrain_QuadCornerData=function(){var t=[];t.length=4,this.Verts=t};e["altern.terrain.QuadCornerData"]=altern_terrain_QuadCornerData,altern_terrain_QuadCornerData.__name__=["altern","terrain","QuadCornerData"],altern_terrain_QuadCornerData.create=function(){var t;return altern_terrain_QuadCornerData.BI<altern_terrain_QuadCornerData.BLEN?t=altern_terrain_QuadCornerData.BUFFER[altern_terrain_QuadCornerData.BI]:(t=new altern_terrain_QuadCornerData,altern_terrain_QuadCornerData.BUFFER[altern_terrain_QuadCornerData.BLEN++]=t),altern_terrain_QuadCornerData.BI++,t},altern_terrain_QuadCornerData.setFixedBufferSize=function(t){altern_terrain_QuadCornerData.BUFFER.length=t},altern_terrain_QuadCornerData.fillBuffer=function(){altern_terrain_QuadCornerData.BLEN;for(var t=altern_terrain_QuadCornerData.BUFFER,i=0;i<0;)t[i]=new altern_terrain_QuadCornerData,++i},altern_terrain_QuadCornerData.createRoot=function(t,i,e){var n=new altern_terrain_QuadCornerData;if(n.xorg=t,n.zorg=i,Math.pow(2,Math.round(1.4426950408889634*Math.log(e)))!=e)throw new js__$Boot_HaxeError("Size isn't base 2!"+e);e>>=1,n.Level=Math.round(1.4426950408889634*Math.log(e));new altern_terrain_QuadSquare(n);return n},altern_terrain_QuadCornerData.clearBuffer=function(){for(var t=altern_terrain_QuadCornerData.BUFFER.length,i=0;i<t;)altern_terrain_QuadCornerData.BUFFER[i].dispose(),++i;altern_terrain_QuadCornerData.BUFFER.length=0,altern_terrain_QuadCornerData.BI=0,altern_terrain_QuadCornerData.BLEN=0},altern_terrain_QuadCornerData.isBase2=function(t){return Math.pow(2,Math.round(1.4426950408889634*Math.log(t)))==t},altern_terrain_QuadCornerData.prototype={clone:function(){var t=new altern_terrain_QuadCornerData;return t.Parent=this.Parent,t.Square=this.Square,t.xorg=this.xorg,t.zorg=this.zorg,t.Level=this.Level,t.ChildIndex=this.ChildIndex,t.Verts[0]=this.Verts[0],t.Verts[1]=this.Verts[1],t.Verts[2]=this.Verts[2],t.Verts[3]=this.Verts[3],t},dispose:function(){this.Parent=null,this.Square=null,this.Verts=null},__class__:altern_terrain_QuadCornerData};var altern_terrain_QuadSquare=function(t){var i=[];i.length=6,this.errorList=i;var e=[];e.length=5,this.Vertex=e,this.Child=[],t.Square=this,this.MinY=32767,this.MaxY=-32768,this.Vertex[0]=.25*(t.Verts[0]+t.Verts[1]+t.Verts[2]+t.Verts[3])|0,this.Vertex[1]=.5*(t.Verts[3]+t.Verts[0])|0,this.Vertex[2]=.5*(t.Verts[0]+t.Verts[1])|0,this.Vertex[3]=.5*(t.Verts[1]+t.Verts[2])|0,this.Vertex[4]=.5*(t.Verts[2]+t.Verts[3])|0;for(var n=0;n<2;)this.errorList[n]=0,++n;for(n=0;n<4;)this.errorList[n+2]=.25*Math.abs(this.Vertex[0]+t.Verts[n]-(this.Vertex[n+1]+this.Vertex[1+(n+1&3)]))|0,++n;for(this.MinY=this.MaxY=t.Verts[0],n=0;n<4;){var s=t.Verts[n];s<this.MinY&&(this.MinY=s),s>this.MaxY&&(this.MaxY=s),++n}};e["altern.terrain.QuadSquare"]=altern_terrain_QuadSquare,altern_terrain_QuadSquare.__name__=["altern","terrain","QuadSquare"],altern_terrain_QuadSquare.prototype={destroy:function(){for(var t=0;t<4;)null!=this.Child[t]&&(this.Child[t].destroy(),this.Child[t]=null),++t;this.Child=null,this.Vertex=null,this.errorList=null},SetupCornerData:function(t,i,e){var n=1<<i.Level;switch(t.Parent=i,t.Square=this.Child[e],t.Level=i.Level-1,t.ChildIndex=e,e){case 0:t.xorg=i.xorg+n,t.zorg=i.zorg,t.Verts[0]=i.Verts[0],t.Verts[1]=this.Vertex[2],t.Verts[2]=this.Vertex[0],t.Verts[3]=this.Vertex[1];break;case 1:t.xorg=i.xorg,t.zorg=i.zorg,t.Verts[0]=this.Vertex[2],t.Verts[1]=i.Verts[1],t.Verts[2]=this.Vertex[3],t.Verts[3]=this.Vertex[0];break;case 2:t.xorg=i.xorg,t.zorg=i.zorg+n,t.Verts[0]=this.Vertex[0],t.Verts[1]=this.Vertex[3],t.Verts[2]=i.Verts[2],t.Verts[3]=this.Vertex[4];break;case 3:t.xorg=i.xorg+n,t.zorg=i.zorg+n,t.Verts[0]=this.Vertex[1],t.Verts[1]=this.Vertex[0],t.Verts[2]=this.Vertex[4],t.Verts[3]=i.Verts[3]}},SampleFromHeightMap:function(t,i){var e=2<<t.Level;if(!(t.xorg>i.XOrigin+(i.XSize+2<<i.Scale)||t.xorg+e<i.XOrigin-(1<<i.Scale)||t.zorg>i.ZOrigin+(i.ZSize+2<<i.Scale)||t.zorg+e<i.ZOrigin-(1<<i.Scale))){var n;t.Verts[0]=i.Sample(t.xorg+e,t.zorg),t.Verts[1]=i.Sample(t.xorg,t.zorg),t.Verts[2]=i.Sample(t.xorg,t.zorg+e),t.Verts[3]=i.Sample(t.xorg+e,t.zorg+e);var s=1<<t.Level,r=[];r.length=5;var a=r;for(a[0]=i.Sample(t.xorg+s,t.zorg+s),a[1]=i.Sample(t.xorg+(s<<1),t.zorg+s),a[2]=i.Sample(t.xorg+s,t.zorg),a[3]=i.Sample(t.xorg,t.zorg+s),a[4]=i.Sample(t.xorg+s,t.zorg+(s<<1)),n=0;n<5;)this.Vertex[n]=a[n],++n}},AddHeightMap:function(t,i){var e=2<<t.Level;if(!(t.xorg>i.XOrigin+(i.XSize+2<<i.Scale)||t.xorg+e<i.XOrigin-(1<<i.Scale)||t.zorg>i.ZOrigin+(i.ZSize+2<<i.Scale)||t.zorg+e<i.ZOrigin-(1<<i.Scale))){var n;t.Verts[0]=i.Sample(t.xorg+e,t.zorg),t.Verts[1]=i.Sample(t.xorg,t.zorg),t.Verts[2]=i.Sample(t.xorg,t.zorg+e),t.Verts[3]=i.Sample(t.xorg+e,t.zorg+e);var s=1<<t.Level;if(t.Level>=i.Scale)for(n=0;n<4;){var r=new altern_terrain_QuadCornerData;this.SetupCornerData(r,t,n),null==this.Child[n]&&(this.Child[n]=new altern_terrain_QuadSquare(r)),this.Child[n].AddHeightMap(r,i),++n}this.Vertex[0]=i.Sample(t.xorg+s,t.zorg+s),this.Vertex[1]=i.Sample(t.xorg+(s<<1),t.zorg+s),this.Vertex[2]=i.Sample(t.xorg+s,t.zorg),this.Vertex[3]=i.Sample(t.xorg,t.zorg+s),this.Vertex[4]=i.Sample(t.xorg+s,t.zorg+(s<<1))}},GetQuadSquareChunk:function(t,i,e){if(null==e&&(e=12),t.Level<e)throw new js__$Boot_HaxeError("LOD of current quad square is too fine for target chunk LOD level!");var n=new altern_terrain_QuadSquareChunk;if(n.MinY=this.MinY,n.MaxY=this.MaxY,this.MaxY==this.MinY&&(n.MaxY=n.MinY+1),n.error=i,t.Level==e)return n;var s=new altern_terrain_QuadCornerData;return this.SetupCornerData(s,t,0),n.Child[0]=this.GetQuadSquareChunk(s,this.errorList[0],e),s=new altern_terrain_QuadCornerData,this.SetupCornerData(s,t,1),n.Child[1]=this.GetQuadSquareChunk(s,this.errorList[1],e),s=new altern_terrain_QuadCornerData,this.SetupCornerData(s,t,2),n.Child[2]=this.GetQuadSquareChunk(s,this.errorList[2],e),s=new altern_terrain_QuadCornerData,this.SetupCornerData(s,t,3),n.Child[3]=this.GetQuadSquareChunk(s,this.errorList[3],e),n},RecomputeErrorAndLighting:function(t){var i,e,n,s=0;for((n=0!=(1&t.ChildIndex)?Math.round(Math.abs(this.Vertex[0]-.5*(t.Verts[1]+t.Verts[3]))):Math.round(Math.abs(this.Vertex[0]-.5*(t.Verts[0]+t.Verts[2]))))>s&&(s=n),this.MaxY=this.Vertex[0],this.MinY=this.Vertex[0],i=0;i<4;)(e=t.Verts[i])<this.MinY&&(this.MinY=e),e>this.MaxY&&(this.MaxY=e),++i;for((n=Math.round(Math.abs(this.Vertex[1]-.5*(t.Verts[0]+t.Verts[3]))))>s&&(s=n),this.errorList[0]=n,(n=Math.round(Math.abs(this.Vertex[4]-.5*(t.Verts[2]+t.Verts[3]))))>s&&(s=n),this.errorList[1]=n,i=0;i<4;)(e=this.Vertex[1+i])<this.MinY&&(this.MinY=e),e>this.MaxY&&(this.MaxY=e),++i;for(i=0;i<4;){if(null!=this.Child[i]){var r=new altern_terrain_QuadCornerData;this.SetupCornerData(r,t,i),this.errorList[i+2]=0|this.Child[i].RecomputeErrorAndLighting(r),this.Child[i].MinY<this.MinY&&(this.MinY=this.Child[i].MinY),this.Child[i].MaxY>this.MaxY&&(this.MaxY=this.Child[i].MaxY)}else this.errorList[i+2]=.25*Math.abs(this.Vertex[0]+t.Verts[i]-(this.Vertex[i+1]+this.Vertex[1+(i+1&3)]))|0;this.errorList[i+2]>s&&(s=this.errorList[i+2]),++i}return s},__class__:altern_terrain_QuadSquare};var altern_terrain_QuadSquareChunk=function(){this.__uid=hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID,this.MinY=2147483647,this.MaxY=-2147483647;var t=[];t.length=4,this.Child=t,this.EnabledFlags=0,this.SubEnabledCount=new Int32Array(2),this.SubEnabledCount[0]=0,this.SubEnabledCount[1]=0};e["altern.terrain.QuadSquareChunk"]=altern_terrain_QuadSquareChunk,altern_terrain_QuadSquareChunk.__name__=["altern","terrain","QuadSquareChunk"],altern_terrain_QuadSquareChunk.__interfaces__=[hxbit_Serializable],altern_terrain_QuadSquareChunk.prototype={customSerialize:function(t){},customUnserialize:function(t){this.EnabledFlags=0,this.SubEnabledCount=new Int32Array(2),this.SubEnabledCount[0]=0,this.SubEnabledCount[1]=0},destroy:function(){null!=this.Child[0]&&(this.Child[0].destroy(),this.Child[0]=null),null!=this.Child[1]&&(this.Child[1].destroy(),this.Child[1]=null),null!=this.Child[2]&&(this.Child[2].destroy(),this.Child[2]=null),null!=this.Child[3]&&(this.Child[3].destroy(),this.Child[3]=null)},SetupCornerData:function(t,i,e){var n=1<<i.Level;switch(t.Parent=i,t.Square=this.Child[e],t.Level=i.Level-1,t.ChildIndex=e,e){case 0:t.xorg=i.xorg+n,t.zorg=i.zorg;break;case 1:t.xorg=i.xorg,t.zorg=i.zorg;break;case 2:t.xorg=i.xorg,t.zorg=i.zorg+n;break;case 3:t.xorg=i.xorg+n,t.zorg=i.zorg+n}},CountNodes:function(){for(var t=1,i=0;i<4;){if(null!=this.Child[i])t+=this.Child[i].CountNodes();else for(var e=0;e<4;){if(null!=this.Child[e])throw new js__$Boot_HaxeError("NOT dense!");++e}++i}return t},GetNeighbor:function(t,i){if(null==i.Parent)return null!=altern_terrain_QuadSquareChunk.QUADTREE_GRID?this.getNeighborCornerData(i,t).Square:i.Square;var e=null,n=1^i.ChildIndex^(1&t)<<1;if(0!=(t-i.ChildIndex&2))e=i.Parent.Square;else if(null==(e=i.Parent.Square.GetNeighbor(t,i.Parent)))return null;return e.Child[n]},EnableEdgeVertex:function(t,i,e){if(0==(this.EnabledFlags&1<<t)||i){this.EnabledFlags|=1<<t,!i||0!=t&&3!=t||this.SubEnabledCount[1&t]++;for(var n=this,s=e,r=0,a=altern_terrain_QuadSquareChunk.STACK;;){var h=s.ChildIndex;if(null==s.Parent||null==s.Parent.Square){if(n=(s=null!=altern_terrain_QuadSquareChunk.QUADTREE_GRID?this.getNeighborCornerData(s,t):s).Square,r>0)break;return t^=2,n.EnabledFlags|=1<<t,void(!i||0!=t&&3!=t||n.SubEnabledCount[1&t]++)}n=s.Parent.Square,s=s.Parent;var o=t-h&2;if(h=1^h^(1&t)<<1,a[r++]=h,0!=o)break}t^=2,(n=n.EnableDescendant(r,a,s)).EnabledFlags|=1<<t,!i||0!=t&&3!=t||n.SubEnabledCount[1&t]++}},getNeighborCornerData:function(t,i){var e=t.xorg,n=t.zorg,s=1<<t.Level<<1;t.ChildIndex;0==i?(e+=s)>altern_terrain_QuadSquareChunk.QUADTREE_GRID.originX+altern_terrain_QuadSquareChunk.QUADTREE_GRID.cols*s-s&&(e=0):1==i?(n-=s)<altern_terrain_QuadSquareChunk.QUADTREE_GRID.originY&&(n=altern_terrain_QuadSquareChunk.QUADTREE_GRID.cols*s-s):2==i?(e-=s)<altern_terrain_QuadSquareChunk.QUADTREE_GRID.originX&&(e=altern_terrain_QuadSquareChunk.QUADTREE_GRID.cols*s-s):(n+=s)>altern_terrain_QuadSquareChunk.QUADTREE_GRID.originY+altern_terrain_QuadSquareChunk.QUADTREE_GRID.cols*s-s&&(n=0);var r=altern_terrain_QuadSquareChunk.QUADTREE_GRID,a=t.Level;return++a,r.vec[(n-r.originY>>a)*r.cols+(e-r.originX>>a)]},EnableDescendant:function(t,i,e){var n=i[--t];if(0==(this.EnabledFlags&16<<n)&&this.EnableChild(n,e),t>0){var s=altern_terrain_QuadChunkCornerData.create();return this.SetupCornerData(s,e,n),this.Child[n].EnableDescendant(t,i,s)}return this.Child[n]},EnableChild:function(t,i){if(i.Level<=altern_terrain_QuadSquareChunk.LOD_LVL_MIN)throw new js__$Boot_HaxeError("SHOULD not allow!");0==(this.EnabledFlags&16<<t)&&(this.EnabledFlags|=16<<t,this.EnableEdgeVertex(t,!0,i),this.EnableEdgeVertex(t+1&3,!0,i))},NotifyChildDisable:function(t,i){var e;this.EnabledFlags&=~(16<<i),null!=(e=0!=(2&i)?this:this.GetNeighbor(1,t))&&e.SubEnabledCount[1]--,null!=(e=1==i||2==i?this.GetNeighbor(2,t):this)&&e.SubEnabledCount[0]--},ResetTree:function(){null!=this.Child[0]&&this.Child[0].ResetTree(),null!=this.Child[1]&&this.Child[1].ResetTree(),null!=this.Child[2]&&this.Child[2].ResetTree(),null!=this.Child[3]&&this.Child[3].ResetTree(),this.EnabledFlags=0,this.SubEnabledCount[0]=0,this.SubEnabledCount[1]=0},BoxTest:function(t,i,e,n,s,r,a){var h=.5*e,o=Math.abs(t+h-a.x)-h,l=Math.abs(.5*(n+s)-a.y)-.5*(s-n),u=Math.abs(i+h-a.z)-h,m=o;return l>m&&(m=l),u>m&&(m=u),r*altern_terrain_QuadSquareChunk.DetailThreshold>m},Update:function(t,i,e,n,s){altern_terrain_QuadChunkCornerData.BI=0,altern_terrain_QuadSquareChunk.DetailThreshold=e,this.UpdateAux(t,i,0,n,s)},UpdateAux:function(t,i,e,n,s){if(!(s<0)){altern_terrain_QuadSquareChunk.BlockUpdateCount++;var r,a,h=1<<t.Level,o=h<<1,l=!1;if(s>=0&&t.Level>altern_terrain_QuadSquareChunk.LOD_LVL_MIN)0==(16&this.EnabledFlags)&&this.BoxTest(t.xorg+h,t.zorg,h,this.MinY,this.MaxY,this.Child[0].error,i)&&(this.EnableChild(0,t),l=!0),0==(32&this.EnabledFlags)&&this.BoxTest(t.xorg,t.zorg,h,this.MinY,this.MaxY,this.Child[1].error,i)&&(this.EnableChild(1,t),l=!0),0==(64&this.EnabledFlags)&&this.BoxTest(t.xorg,t.zorg+h,h,this.MinY,this.MaxY,this.Child[2].error,i)&&(this.EnableChild(2,t),l=!0),0==(128&this.EnabledFlags)&&this.BoxTest(t.xorg+h,t.zorg+h,h,this.MinY,this.MaxY,this.Child[3].error,i)&&(this.EnableChild(3,t),l=!0),0!=(32&this.EnabledFlags)&&(a=altern_terrain_QuadChunkCornerData.create(),this.SetupCornerData(a,t,1),(r=this.Child[1]).UpdateAux(a,i,r.error,n,0!=s?n.cullingInFrustum(s,a.xorg,a.Square.MinY,a.zorg,a.xorg+h,a.Square.MaxY,a.zorg+h):0)),0!=(16&this.EnabledFlags)&&(a=altern_terrain_QuadChunkCornerData.create(),this.SetupCornerData(a,t,0),(r=this.Child[0]).UpdateAux(a,i,r.error,n,0!=s?n.cullingInFrustum(s,a.xorg,a.Square.MinY,a.zorg,a.xorg+h,a.Square.MaxY,a.zorg+h):0)),0!=(64&this.EnabledFlags)&&(a=altern_terrain_QuadChunkCornerData.create(),this.SetupCornerData(a,t,2),(r=this.Child[2]).UpdateAux(a,i,r.error,n,0!=s?n.cullingInFrustum(s,a.xorg,a.Square.MinY,a.zorg,a.xorg+h,a.Square.MaxY,a.zorg+h):0)),0!=(128&this.EnabledFlags)&&(a=altern_terrain_QuadChunkCornerData.create(),this.SetupCornerData(a,t,3),(r=this.Child[3]).UpdateAux(a,i,r.error,n,0!=s?n.cullingInFrustum(s,a.xorg,a.Square.MinY,a.zorg,a.xorg+h,a.Square.MaxY,a.zorg+h):0));l||this.BoxTest(t.xorg,t.zorg,o,this.MinY,this.MaxY,e,i)||(0!=(1&this.EnabledFlags)&&0==this.SubEnabledCount[0]&&(this.EnabledFlags&=-2,null!=(r=this.GetNeighbor(0,t))&&(r.EnabledFlags&=-5)),0!=(8&this.EnabledFlags)&&0==this.SubEnabledCount[1]&&(this.EnabledFlags&=-9,null!=(r=this.GetNeighbor(3,t))&&(r.EnabledFlags&=-3)),0==(255&this.EnabledFlags)&&null!=t.Parent&&(this.EnabledFlags=0,t.Parent.Square.NotifyChildDisable(t.Parent,t.ChildIndex)))}},getCLID:function(){return altern_terrain_QuadSquareChunk.__clid},serialize:function(t){var i=this.Child;if(null==i)t.out.b.push(0);else{var e=i.length+1;e>=0&&e<128?t.out.b.push(e):(t.out.b.push(128),t.out.addInt32(e));for(var n=0;n<i.length;){var s=i[n];++n,t.addKnownRef(s)}}var r=this.error;r>=0&&r<128?t.out.b.push(r):(t.out.b.push(128),t.out.addInt32(r));var a=this.MinY;a>=0&&a<128?t.out.b.push(a):(t.out.b.push(128),t.out.addInt32(a));var h=this.MaxY;h>=0&&h<128?t.out.b.push(h):(t.out.b.push(128),t.out.addInt32(h)),this.customSerialize(t)},getSerializeSchema:function(){var t=new hxbit_Schema;return t.fieldsNames.push("Child"),t.fieldsTypes.push(v.PArray(v.PSerializable("altern.terrain.QuadSquareChunk"))),t.fieldsNames.push("error"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("MinY"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("MaxY"),t.fieldsTypes.push(v.PInt),t.isFinal=hxbit_Serializer.isClassFinal(altern_terrain_QuadSquareChunk.__clid),t},unserializeInit:function(){},unserialize:function(t){var i,e=t.input.b[t.inPos++];128==e&&(e=t.input.getInt32(t.inPos),t.inPos+=4);var n,s=e;if(0==s)n=null;else{for(var r=[],a=0,h=--s;a<h;){var o=a++;i=t.getRef(altern_terrain_QuadSquareChunk,altern_terrain_QuadSquareChunk.__clid),r[o]=i}n=r}this.Child=n;var l=t.input.b[t.inPos++];128==l&&(l=t.input.getInt32(t.inPos),t.inPos+=4),this.error=l;var u=t.input.b[t.inPos++];128==u&&(u=t.input.getInt32(t.inPos),t.inPos+=4),this.MinY=u;var m=t.input.b[t.inPos++];128==m&&(m=t.input.getInt32(t.inPos),t.inPos+=4),this.MaxY=m,this.customUnserialize(t)},__class__:altern_terrain_QuadSquareChunk};var altern_terrain_QuadTreePage=function(){this.uvTileSize=0,altern_terrain_QuadChunkCornerData.call(this)};e["altern.terrain.QuadTreePage"]=altern_terrain_QuadTreePage,altern_terrain_QuadTreePage.__name__=["altern","terrain","QuadTreePage"],altern_terrain_QuadTreePage.isBase2=function(t){return Math.pow(2,Math.round(1.4426950408889634*Math.log(t)))==t},altern_terrain_QuadTreePage.create=function(t,i,e){var n=new altern_terrain_QuadTreePage;if(n.xorg=t,n.zorg=i,!altern_terrain_QuadTreePage.isBase2(e))throw new js__$Boot_HaxeError("Size isn't base 2!"+e);return e>>=1,n.Level=Math.round(1.4426950408889634*Math.log(e)),n},altern_terrain_QuadTreePage.__super__=altern_terrain_QuadChunkCornerData,altern_terrain_QuadTreePage.prototype=$extend(altern_terrain_QuadChunkCornerData.prototype,{getCLID:function(){return altern_terrain_QuadTreePage.__clid},serialize:function(t){altern_terrain_QuadChunkCornerData.prototype.serialize.call(this,t);var i=this.requirements;i>=0&&i<128?t.out.b.push(i):(t.out.b.push(128),t.out.addInt32(i)),t.addKnownRef(this.heightMap)},getSerializeSchema:function(){var t=altern_terrain_QuadChunkCornerData.prototype.getSerializeSchema.call(this);return t.fieldsNames.push("requirements"),t.fieldsTypes.push(v.PInt),t.fieldsNames.push("heightMap"),t.fieldsTypes.push(v.PSerializable("altern.terrain.HeightMapInfo")),t.isFinal=hxbit_Serializer.isClassFinal(altern_terrain_QuadTreePage.__clid),t},unserializeInit:function(){altern_terrain_QuadChunkCornerData.prototype.unserializeInit.call(this),this.uvTileSize=0},unserialize:function(t){altern_terrain_QuadChunkCornerData.prototype.unserialize.call(this,t);var i=t.input.b[t.inPos++];128==i&&(i=t.input.getInt32(t.inPos),t.inPos+=4),this.requirements=i,this.heightMap=t.getRef(altern_terrain_HeightMapInfo,altern_terrain_HeightMapInfo.__clid)},__class__:altern_terrain_QuadTreePage});var altern_terrain_TerrainChunkState=function(){};e["altern.terrain.TerrainChunkState"]=altern_terrain_TerrainChunkState,altern_terrain_TerrainChunkState.__name__=["altern","terrain","TerrainChunkState"],altern_terrain_TerrainChunkState.prototype={__class__:altern_terrain_TerrainChunkState};var altern_terrain_TerrainChunkStateList=function(){};e["altern.terrain.TerrainChunkStateList"]=altern_terrain_TerrainChunkStateList,altern_terrain_TerrainChunkStateList.__name__=["altern","terrain","TerrainChunkStateList"],altern_terrain_TerrainChunkStateList.prototype={append:function(t){t.parent=this,null!=this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):(this.head=this.tail=t,t.next=t.prev=null),this.validate("")},appendList:function(t,i){for(var e=t;null!=e;)e.parent=this,e=e.next;for(var n=t;null!=n;)n=n.next;null!=this.head?(this.tail.next=t,t.prev=this.tail,this.tail=i):(this.head=t,this.tail=i)},validate:function(t){if(null!=this.head&&null==this.head.next&&this.head!=this.tail)throw new js__$Boot_HaxeError("WRONG: Head doesn't match tail when head.next is null"+t+" : "+Std.string(this.head)+", "+Std.string(this.tail));if(null!=this.head&&null==this.tail)throw new js__$Boot_HaxeError("WRONG2_headTail:"+t+" : "+Std.string(this.head)+", "+Std.string(this.tail));if(null!=this.head&&this.head==this.tail&&null!=this.head.next)throw new js__$Boot_HaxeError("Both head tail is same but why got head.next??")},getAvailable:function(){var t=this.head;return null==t?null:(this.head=this.head.next,null!=this.head&&(this.head.prev=null),this.tail==t&&(this.tail=null),t.next=null,t.parent=null,t)},remove:function(t){this.head==t&&(this.head=this.head.next),this.tail==t&&(this.tail=this.tail.prev),null!=t.prev&&(t.prev.next=t.next),null!=t.next&&(t.next.prev=t.prev),t.parent=null,t.next=null,t.prev=null},removeAll:function(){for(;null!=this.head;){var t=this.head;this.head=this.head.next,t.prev=null,t.next=null,t.parent=null}this.tail=null},__class__:altern_terrain_TerrainChunkStateList};var altern_terrain_TerrainCollidable=function(t){this.terrainGeom=new util_geom_Geometry,this.terrain=t};e["altern.terrain.TerrainCollidable"]=altern_terrain_TerrainCollidable,altern_terrain_TerrainCollidable.__name__=["altern","terrain","TerrainCollidable"],altern_terrain_TerrainCollidable.__interfaces__=[altern_ray_IRaycastImpl,systems_collisions_ITCollidable],altern_terrain_TerrainCollidable.prototype={collectGeometryAndTransforms:function(t,i){this.terrain.setupCollisionGeometry(t.sphere,this.terrainGeom.vertices,this.terrainGeom.indices,0,0),this.terrainGeom.numVertices=this.terrainGeom.numIndices=3*this.terrain.numCollisionTriangles,t.geometries[t.numGeometries]=this.terrainGeom,t.transforms[t.numGeometries]=i,t.numGeometries++},intersectRay:function(t,i,e){return this.terrain.intersectRay(t,i,e)},__class__:altern_terrain_TerrainCollidable};var altern_terrain_TerrainGeomTools=function(){};e["altern.terrain.TerrainGeomTools"]=altern_terrain_TerrainGeomTools,altern_terrain_TerrainGeomTools.__name__=["altern","terrain","TerrainGeomTools"],altern_terrain_TerrainGeomTools.createLODTerrainChunkForMesh=function(t,i){null==i&&(i=256),null==t&&(t=32);var e=t+1,n=new util_geom_Geometry;n.vertices.length=e*e;var s,r,a=[],h=[],o=1/t,l=new Int32Array(e*e),u=0;for(r=2;r<e-2;){for(s=2;s<e-2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,++s;++r}for(s=e-2,r=e-3;r>=2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r-=2;for(r=1,s=e-3;s>=2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s-=2;for(s=1,r=2;r<=e-3;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r+=2;for(r=e-2,s=2;s<=e-3;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s+=2;for(r=e-2,s=e-1;r>=1;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r-=2;for(r=0,s=e-2;s>=1;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s-=2;for(s=0,r=1;r<=e-2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r+=2;for(s=1,r=e-1;s<=e-2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s+=2;var m=u;for(s=e-2,r=e-2;r>=1;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r-=2;for(s=e-1,r=e-1;r>=0;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r-=2;for(r=1,s=e-4;s>=1;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s-=2;for(r=0,s=e-3;s>=0;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s-=2;for(s=1,r=3;r<=e-2;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r+=2;for(s=0,r=2;r<=e-1;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,r+=2;for(r=e-2,s=3;s<=e-4;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s+=2;for(r=e-1,s=2;s<=e-3;)altern_terrain_TerrainGeomTools.writeVertices(a,s,r,i,o,0),l[r*e+s]=u++,s+=2;for(r=0;r<t;){for(s=0;s<t;)altern_terrain_TerrainGeomTools.createFace(h,a,l[r*e+s+2],l[r*e+s+1],l[(r+1)*e+s+1],l[(r+1)*e+s+2],0,0,1,1,0,0,-1,!0),altern_terrain_TerrainGeomTools.createFace(h,a,l[r*e+s],l[(r+1)*e+s],l[(r+1)*e+s+1],l[r*e+s+1],0,0,1,1,0,0,-1,!0),altern_terrain_TerrainGeomTools.createFace(h,a,l[(r+1)*e+s+1],l[(r+1)*e+s],l[(r+2)*e+s],l[(r+2)*e+s+1],0,0,1,1,0,0,-1,!0),altern_terrain_TerrainGeomTools.createFace(h,a,l[(r+1)*e+s+1],l[(r+2)*e+s+1],l[(r+2)*e+s+2],l[(r+1)*e+s+2],0,0,1,1,0,0,-1,!0),s+=2;r+=2}n.indices=h,n.numIndices=h.length,n.vertices=a,n.numVertices=a.length/3|0;var c=new altern_terrain_GeometryResult;return c.geometry=n,c.edgeChangeVertexIndex=m,c.uvSeg=o,c.indexLookup=l,c.verticesAcross=e,c.patchSize=i,c},altern_terrain_TerrainGeomTools.writeVertices=function(t,i,e,n,s,r){for(t.push(i*n),t.push(0),t.push(-e*n);--r>-1;)t.push(0)},altern_terrain_TerrainGeomTools.createFace=function(t,i,e,n,s,r,a,h,o,l,u,m,c,f){var x;f&&(a=-a,h=-h,o=-o,c=-c,x=e,e=r,r=x,x=n,n=s,s=x),t.push(e),t.push(n),t.push(s),t.push(e),t.push(s),t.push(r)},altern_terrain_TerrainGeomTools.writeInnerIndicesToByteArray=function(t,i,e,n){var s,r;null==n&&(n=0);var a=t+1;for(r=2+n;r<t-2-n;){for(s=2+n;s<t-2-n;)altern_terrain_TerrainGeomTools.writeRegularQuad(s,r,a,e,i),s+=2;r+=2}},altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray=function(t,i,e,n){var s,r,a=t+1;for(s=a-3,0,r=a-5;r>=2;)altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,1&n),r-=2;for(r=0,altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,3&n),0,s=a-5;s>=2;)altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,2&n),s-=2;for(s=0,altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,6&n),0,r=2;r<=a-5;)altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,4&n),r+=2;for(r=a-3,altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,12&n),0,r=a-3,s=2;s<=a-5;)altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,8&n),s+=2;s=a-3,altern_terrain_TerrainGeomTools.writeConditionalQuad(s,r,a,e,i,9&n)},altern_terrain_TerrainGeomTools.writeRegularQuad=function(t,i,e,n,s){var r,a,h,o;r=s[i*e+t+2],a=s[i*e+t+1],h=s[(i+1)*e+t+1],o=s[(i+1)*e+t+2],n.push(r),n.push(a),n.push(h),n.push(r),n.push(h),n.push(o),r=s[i*e+t],a=s[(i+1)*e+t],h=s[(i+1)*e+t+1],o=s[i*e+t+1],n.push(r),n.push(a),n.push(h),n.push(r),n.push(h),n.push(o),r=s[(i+1)*e+t+1],a=s[(i+1)*e+t],h=s[(i+2)*e+t],o=s[(i+2)*e+t+1],n.push(r),n.push(a),n.push(h),n.push(r),n.push(h),n.push(o),r=s[(i+1)*e+t+1],a=s[(i+2)*e+t+1],h=s[(i+2)*e+t+2],o=s[(i+1)*e+t+2],n.push(r),n.push(a),n.push(h),n.push(r),n.push(h),n.push(o)},altern_terrain_TerrainGeomTools.writeConditionalQuad=function(t,i,e,n,s,r){var a,h,o,l;a=s[i*e+t+2],h=s[i*e+t+1],o=s[(i+1)*e+t+1],l=s[(i+1)*e+t+2],0!=(3&r)?(0==(2&r)&&(n.push(o),n.push(a),n.push(h)),0==(1&r)&&(n.push(o),n.push(l),n.push(a))):(n.push(a),n.push(h),n.push(o),n.push(a),n.push(o),n.push(l)),a=s[i*e+t],h=s[(i+1)*e+t],o=s[(i+1)*e+t+1],l=s[i*e+t+1],0!=(6&r)?(0==(2&r)&&(n.push(o),n.push(l),n.push(a)),0==(4&r)&&(n.push(o),n.push(a),n.push(h))):(n.push(a),n.push(h),n.push(o),n.push(a),n.push(o),n.push(l)),a=s[(i+1)*e+t+1],h=s[(i+1)*e+t],o=s[(i+2)*e+t],l=s[(i+2)*e+t+1],0!=(12&r)?(0==(8&r)&&(n.push(a),n.push(o),n.push(l)),0==(4&r)&&(n.push(a),n.push(h),n.push(o))):(n.push(a),n.push(h),n.push(o),n.push(a),n.push(o),n.push(l)),a=s[(i+1)*e+t+1],h=s[(i+2)*e+t+1],o=s[(i+2)*e+t+2],l=s[(i+1)*e+t+2],0!=(9&r)?(0==(8&r)&&(n.push(a),n.push(h),n.push(o)),0==(1&r)&&(n.push(a),n.push(o),n.push(l))):(n.push(a),n.push(h),n.push(o),n.push(a),n.push(o),n.push(l)),a=s[(i+1)*e+t+1],0!=(1&r)&&(h=s[(i+2)*e+t+2],o=s[i*e+t+2],n.push(a),n.push(h),n.push(o)),0!=(2&r)&&(h=s[i*e+t+2],o=s[i*e+t],n.push(a),n.push(h),n.push(o)),0!=(4&r)&&(h=s[i*e+t],o=s[(i+2)*e+t],n.push(a),n.push(h),n.push(o)),0!=(8&r)&&(h=s[(i+2)*e+t],o=s[(i+2)*e+t+2],n.push(a),n.push(h),n.push(o))};var altern_terrain_TerrainLOD=function(){this.numCollisionTriangles=0,this.currentLookupIndex=0,this.lodLvlMin=12,this._patchHeights=new Int32Array(12),this._squaredDistUpdate=0,this.waterLevel=-340282346638528e24,this.detail=5,this._data32PerVertex=3,this.handedness=1,this._lastUpdateCameraPos=new jeash_geom_Vector3D,this._cameraPos=new jeash_geom_Vector3D,this.cached_retrieved=0,this.pool_retrieved=0,this.newly_instantiated=0,this.lastDrawnChunks=0,this.drawnChunks=0,this.activeChunks=new altern_terrain_TerrainChunkStateList,this.chunkPool=new altern_terrain_TerrainChunkStateList,this.culler=this,this._patchHeights[0]=0,this._patchHeights[1]=0,this._patchHeights[3]=1,this._patchHeights[4]=0,this._patchHeights[6]=0,this._patchHeights[7]=1,this._patchHeights[9]=1,this._patchHeights[10]=1,this._lastUpdateCameraPos.x=-1e22,this._lastUpdateCameraPos.y=-1e22,this._lastUpdateCameraPos.z=-1e22,this.cornerMask=new Int32Array(4),this.cornerMask[0]=12,this.cornerMask[1]=9,this.cornerMask[2]=3,this.cornerMask[3]=6};e["altern.terrain.TerrainLOD"]=altern_terrain_TerrainLOD,altern_terrain_TerrainLOD.__name__=["altern","terrain","TerrainLOD"],altern_terrain_TerrainLOD.__interfaces__=[altern_ray_IRaycastImpl,altern_terrain_ICuller],altern_terrain_TerrainLOD.createTriOrderIndiceTable=function(t){var i=new Int32Array(6);return t?(i[0]=0,i[1]=2,i[2]=1,i[3]=2,i[4]=3,i[5]=1):(i[0]=0,i[1]=3,i[2]=1,i[3]=0,i[4]=2,i[5]=3),i},altern_terrain_TerrainLOD.createQuadOrderIndiceTable=function(t){var i=[];i.length=4;for(var e=i,n=t?[1,0,2,3]:[3,2,0,1],s=new Int32Array(n.length),r=0,a=n.length;r<a;){var h=r++;s[h]=n[h]}e[0]=s;for(var o=t?[0,1,3,2]:[2,3,1,0],l=new Int32Array(o.length),u=0,m=o.length;u<m;){var c=u++;l[c]=o[c]}e[1]=l;for(var f=t?[2,3,1,0]:[0,1,3,2],x=new Int32Array(f.length),d=0,_=f.length;d<_;){var g=d++;x[g]=f[g]}e[2]=x;for(var p=t?[3,0,2,1]:[1,2,0,3],v=new Int32Array(p.length),y=0,b=p.length;y<b;){var w=y++;v[w]=p[w]}return e[3]=v,e},altern_terrain_TerrainLOD.createQuadOffsetTable=function(){var t=new Int32Array(4);return t[0]=1,t[1]=0,t[2]=2,t[3]=3,t},altern_terrain_TerrainLOD.installQuadTreePageHeightmap=function(t,i,e,n,s){null==s&&(s=0),null==n&&(n=256),null==e&&(e=0),null==i&&(i=0);var r=altern_terrain_QuadCornerData.createRoot(i,e,0==s?n*(t.XSize-1):s);r.Square.AddHeightMap(r,t);var a=new altern_terrain_QuadTreePage;return a.Level=r.Level,a.xorg=r.xorg,a.zorg=r.zorg,a.Square=r.Square.GetQuadSquareChunk(r,r.Square.RecomputeErrorAndLighting(r)),a.heightMap=t,a},altern_terrain_TerrainLOD.prototype={setDetail:function(t){this.detail=t,this._lastUpdateCameraPos.x=-1e22,this._lastUpdateCameraPos.y=-1e22,this._lastUpdateCameraPos.z=-1e22},setupUpdateCullingMode:function(t){this.culler=0==t?new altern_terrain_NoCulling:1==t?new altern_terrain_WaterClipCulling(this):this},setUpdateRadius:function(t){this._squaredDistUpdate=t*t},setupIndexReferences:function(t,i){altern_terrain_TerrainLOD.numTrianglesLookup=new Int32Array(9),altern_terrain_TerrainLOD.indexSideLookup=new Int32Array(16);var e=0,n=[];altern_terrain_TerrainGeomTools.writeInnerIndicesToByteArray(i,t,n);var s=n.length;altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,0),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[15]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,1),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[14]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,2),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[13]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,4),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[11]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,8),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[7]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,3),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[12]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,6),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[9]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,12),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[3]=e,++e,n.length=s,altern_terrain_TerrainGeomTools.writeEdgeVerticesToByteArray(i,t,n,9),altern_terrain_TerrainLOD.numTrianglesLookup[e]=n.length/3|0,this.setupIndexBuffer(n,e),altern_terrain_TerrainLOD.indexSideLookup[6]=e,++e},setupPreliminaries:function(t,i,e,n){if(Math.pow(2,Math.round(1.4426950408889634*Math.log(e)))!=e)throw new js__$Boot_HaxeError("tileSize must be base 2!");if(this.lodLvlMin=Math.round(1.4426950408889634*Math.log(32*e))-1,null==altern_terrain_TerrainLOD.PROTO_32&&(altern_terrain_TerrainLOD.PROTO_32=altern_terrain_TerrainGeomTools.createLODTerrainChunkForMesh(32,e)),null==altern_terrain_TerrainLOD.indexSideLookup&&this.setupIndexReferences(altern_terrain_TerrainLOD.PROTO_32.indexLookup,32),this.tileSize=e,this.tileSizeInv=1/e,this.tileShift=Math.round(1.4426950408889634*Math.log(e)),this.tileMod=e-1,n>0&&Math.pow(2,Math.round(1.4426950408889634*Math.log(n)))!=n)throw new js__$Boot_HaxeError("uvTileSize must be base 2!")},setupPostliminaries:function(t,i,e,n){if(e>0)if(e<=32*i)!0;else if(!0,t|=4,null!=this.tree&&(this.tree.requirements|=4),null!=this.gridPagesVector)for(var s=this.gridPagesVector.length;--s>-1;)this.gridPagesVector[s].requirements|=4;this.setupVertexUpload(t,i)},setupVertexUpload:function(t,i){this._vertexUpload=new I(1089*this._data32PerVertex)},getNewChunkState:function(){return new altern_terrain_TerrainChunkState},loadSinglePage:function(t,i,e,n){null==n&&(n=256),null==e&&(e=-1),null==i&&(i=0),this.runSinglePage(t.heightMap,t,e>=0?e:t.requirements,0!=i?i:t.uvTileSize,n)},runSinglePage:function(t,i,e,n,s){null==s&&(s=256),null==n&&(n=0),this.setupPreliminaries(i,e,s,n);var r=i.Square;this.tree=new altern_terrain_QuadTreePage,this.tree.heightMap=t,this.tree.requirements=e,this.tree.uvTileSize=0!=n?n:this.tree.uvTileSize,this.tree.Square=r,this.tree.Level=i.Level,this.tree.xorg=i.xorg,this.tree.zorg=i.zorg,this.setupPostliminaries(e,s,n,this.tree.Level)},calculateFrustum:function(t){},setupIndexBuffer:function(t,i){},setupVertexChunkState:function(t,i,e){},drawChunkState:function(t,i,e){},sampleHeights:function(t,i,e){var n=this._data32PerVertex,s=i.Data,r=e.xorg,a=e.zorg,h=i.XOrigin,o=i.ZOrigin;a-=o,r=(r-=h)/this.tileSize|0,a=a/this.tileSize|0;var l,u,m,c,f,x=1<<e.Level<<1>>this.tileShift,d=x>>5,_=a+x+1,g=r+x+1,p=i.RowWidth,v=altern_terrain_TerrainLOD.PROTO_32.indexLookup;for(m=0,c=a;c<_;){for(u=0,f=r;f<g;)l=v[33*m+u]*n,this._vertexUpload[l]=f*this.tileSize+h,this._vertexUpload[l+1]=s[c*p+f],this._vertexUpload[l+2]=c*this.tileSize+o,++u,f+=d;++m,c+=d}},drawLeaf:function(t,i,e){var n,s=null!=t.Parent?altern_terrain_TerrainLOD.indexSideLookup[15&t.Parent.Square.EnabledFlags|this.cornerMask[t.ChildIndex]]:0;null==(n=i.state)?(this.newly_instantiated++,n=new altern_terrain_TerrainChunkState,i.state=n,this.sampleHeights(this._currentPage.requirements,this._currentPage.heightMap,t),this.setupVertexChunkState(n,this._vertexUpload,t)):this.cached_retrieved++;this.drawChunkState(n,s,t),null!=n.parent&&n.parent.remove(n),this.activeChunks.append(n),this.drawnChunks++},drawQuad:function(t,i,e){var n,s,r,a,h,o,l,u=t.Square;if(t.Level<=this.lodLvlMin)this.drawLeaf(t,u,i);else if(0!=(15&u.EnabledFlags)){h=(a=1<<t.Level)<<1;var m,c=t.xorg+a,f=t.zorg+a;r=0,r|=this._cameraPos.x<c?1:0,r|=this._cameraPos.z<f?2:0,r=(l=this.quadOrderTable[r])[0],m=altern_terrain_TerrainLOD.QUAD_OFFSETS[r],s=u.Child[r],0!=(u.EnabledFlags&16<<r)?(o=0==e?0:this.cullingInFrustum(e,t.xorg+(0!=(1&m)?a:0),s.MinY,t.zorg+(0!=(2&m)?a:0),t.xorg+(0!=(1&m)?h:a),s.MaxY,t.zorg+(0!=(2&m)?h:a)))>=0&&(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawQuad(n,i,o)):(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawLeaf(n,s,i)),r=l[1],m=altern_terrain_TerrainLOD.QUAD_OFFSETS[r],s=u.Child[r],0!=(u.EnabledFlags&16<<r)?(o=0==e?0:this.cullingInFrustum(e,t.xorg+(0!=(1&m)?a:0),s.MinY,t.zorg+(0!=(2&m)?a:0),t.xorg+(0!=(1&m)?h:a),s.MaxY,t.zorg+(0!=(2&m)?h:a)))>=0&&(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawQuad(n,i,o)):(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawLeaf(n,s,i)),r=l[2],m=altern_terrain_TerrainLOD.QUAD_OFFSETS[r],s=u.Child[r],0!=(u.EnabledFlags&16<<r)?(o=0==e?0:this.cullingInFrustum(e,t.xorg+(0!=(1&m)?a:0),s.MinY,t.zorg+(0!=(2&m)?a:0),t.xorg+(0!=(1&m)?h:a),s.MaxY,t.zorg+(0!=(2&m)?h:a)))>=0&&(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawQuad(n,i,o)):(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawLeaf(n,s,i)),r=l[3],m=altern_terrain_TerrainLOD.QUAD_OFFSETS[r],s=u.Child[r],0!=(u.EnabledFlags&16<<r)?(o=0==e?0:this.cullingInFrustum(e,t.xorg+(0!=(1&m)?a:0),s.MinY,t.zorg+(0!=(2&m)?a:0),t.xorg+(0!=(1&m)?h:a),s.MaxY,t.zorg+(0!=(2&m)?h:a)))>=0&&(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawQuad(n,i,o)):(n=altern_terrain_QuadChunkCornerData.create(),u.SetupCornerData(n,t,r),this.drawLeaf(n,s,i))}else this.drawLeaf(t,u,i)},collectDraws:function(t){var i,e,n,s,r,a;this.drawnChunks=0,this.newly_instantiated=0,this.cached_retrieved=0,this.pool_retrieved=0,altern_terrain_QuadSquareChunk.LOD_LVL_MIN=this.lodLvlMin,this.quadOrderTable=altern_terrain_TerrainLOD.QUAD_ORDER2,this._cameraPos.x=t.x,this._cameraPos.y=t.y,this._cameraPos.z=t.z;var h=!1;(s=this._cameraPos.x-this._lastUpdateCameraPos.x)*s+(r=this._cameraPos.y-this._lastUpdateCameraPos.y)*r+(a=this._cameraPos.z-this._lastUpdateCameraPos.z)*a>this._squaredDistUpdate&&(this._lastUpdateCameraPos.x=this._cameraPos.x,this._lastUpdateCameraPos.y=this._cameraPos.y,this._lastUpdateCameraPos.z=this._cameraPos.z,h=!0),this.calculateFrustum(t);var o,l=0;if(null!=this.tree&&(this._currentPage=this.tree,i=(o=this.tree).Square,e=1<<o.Level<<1,l=this.cullingInFrustum(63,o.xorg,i.MinY,o.zorg,o.xorg+e,i.MaxY,o.zorg+e),h&&(altern_terrain_QuadChunkCornerData.BI=0,this.tree.Square.Update(this.tree,this._cameraPos,this.detail,this.culler,l),altern_terrain_QuadChunkCornerData.BI=0),l>=0&&this.drawQuad(this.tree,t,l),altern_terrain_QuadChunkCornerData.BI=0),null!=this.gridPagesVector){for(e=1<<(o=this.gridPagesVector[0]).Level<<1,n=this.gridPagesVector.length;--n>-1;){o=this.gridPagesVector[n],this._currentPage=o,i=o.Square;var u=this.cullingInFrustum(63,o.xorg,i.MinY,o.zorg,o.xorg+e,i.MaxY,o.zorg+e);u>=0&&(altern_terrain_QuadChunkCornerData.BI=0,i.Update(o,this._cameraPos,this.detail,this.culler,u),altern_terrain_QuadChunkCornerData.BI=0,u>=0&&this.drawQuad(o,t,u))}altern_terrain_QuadChunkCornerData.BI=0}null!=this.activeChunks.head&&(this.chunkPool.appendList(this.activeChunks.head,this.activeChunks.tail),this.activeChunks.head=null,this.activeChunks.tail=null)},cullingInFrustum:function(t,i,e,n,s,r,a){if(r<this.waterLevel)return-1;for(var h=1,o=this.frustum;null!=o;){if(0!=(t&h))if(o.x>=0)if(o.y>=0)if(o.z>=0){if(s*o.x+r*o.y+a*o.z<=o.offset)return-1;i*o.x+e*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(s*o.x+r*o.y+n*o.z<=o.offset)return-1;i*o.x+e*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.z>=0){if(s*o.x+e*o.y+a*o.z<=o.offset)return-1;i*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(s*o.x+e*o.y+n*o.z<=o.offset)return-1;i*o.x+r*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.y>=0)if(o.z>=0){if(i*o.x+r*o.y+a*o.z<=o.offset)return-1;s*o.x+e*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(i*o.x+r*o.y+n*o.z<=o.offset)return-1;s*o.x+e*o.y+a*o.z>o.offset&&(t&=63&~h)}else if(o.z>=0){if(i*o.x+e*o.y+a*o.z<=o.offset)return-1;s*o.x+r*o.y+n*o.z>o.offset&&(t&=63&~h)}else{if(i*o.x+e*o.y+n*o.z<=o.offset)return-1;s*o.x+r*o.y+a*o.z>o.offset&&(t&=63&~h)}h<<=1,o=o.next}return t},intersectRay:function(t,i,e){if(null==this.tree&&null==this.gridPagesVector)return null;var n=null;if(this._boundRayTime=0,null!=this.tree&&this.boundIntersectRay(t,i,this.tree.xorg,this.tree.Square.MinY,this.tree.zorg,this.tree.xorg+(1<<this.tree.Level<<1),this.tree.Square.MaxY,this.tree.zorg+(1<<this.tree.Level<<1),e)&&(this._currentPage=this.tree,n=this.intersectRayQuad(e,this.tree,t,i)),null!=this.gridPagesVector)throw new js__$Boot_HaxeError("Not yet done gridPagesVector for intersectRay!");return n},intersectRayQuad:function(t,i,e,n){var s,r,a,h,o,l,u=altern_terrain_QuadChunkCornerData.BI,m=altern_terrain_TerrainLOD.QD_STACK,c=(s=i.Square).Child,f=1<<i.Level,x=f<<1,d=altern_terrain_TerrainLOD.QUAD_ORDER2,_=altern_terrain_TerrainLOD.QUAD_OFFSETS,g=1;for(m[0]=i;g>0;)if(c=(s=(i=m[--g]).Square).Child,x=(f=1<<i.Level)<<1,null!=c[0]){var p=i.xorg+f,v=i.zorg+f;r=0,r|=e.x<p?1:0,a=c[r=(o=d[r|=e.z<v?2:0])[0]],l=_[r],this.boundIntersectRay(e,n,i.xorg+(0!=(1&l)?f:0),a.MinY,i.zorg+(0!=(2&l)?f:0),i.xorg+(0!=(1&l)?x:f),a.MaxY,i.zorg+(0!=(2&l)?x:f),t)&&(h=altern_terrain_QuadChunkCornerData.create(),s.SetupCornerData(h,i,r),m[g++]=h),a=c[r=o[1]],l=_[r],this.boundIntersectRay(e,n,i.xorg+(0!=(1&l)?f:0),a.MinY,i.zorg+(0!=(2&l)?f:0),i.xorg+(0!=(1&l)?x:f),a.MaxY,i.zorg+(0!=(2&l)?x:f),t)&&(h=altern_terrain_QuadChunkCornerData.create(),s.SetupCornerData(h,i,r),m[g++]=h),a=c[r=o[2]],l=_[r],this.boundIntersectRay(e,n,i.xorg+(0!=(1&l)?f:0),a.MinY,i.zorg+(0!=(2&l)?f:0),i.xorg+(0!=(1&l)?x:f),a.MaxY,i.zorg+(0!=(2&l)?x:f),t)&&(h=altern_terrain_QuadChunkCornerData.create(),s.SetupCornerData(h,i,r),m[g++]=h),a=c[r=o[3]],l=_[r],this.boundIntersectRay(e,n,i.xorg+(0!=(1&l)?f:0),a.MinY,i.zorg+(0!=(2&l)?f:0),i.xorg+(0!=(1&l)?x:f),a.MaxY,i.zorg+(0!=(2&l)?x:f),t)&&(h=altern_terrain_QuadChunkCornerData.create(),s.SetupCornerData(h,i,r),m[g++]=h)}else if(this.calculateDDAIntersect(t,this._currentPage.heightMap,i,e,n))return t;return altern_terrain_QuadChunkCornerData.BI=u,null},calculateDDAIntersect:function(t,i,e,n,s){var r,a,h,o,l,u,m,c,f,x=s.x,d=s.z*this.handedness,_=this._currentPage.xorg,g=this._currentPage.zorg,p=1<<e.Level<<1,v=p>>this.tileShift,y=n.x,b=n.z*this.handedness,w=n.y;if(y<e.xorg||y>=e.xorg+p||b<e.zorg||b>=e.zorg+p){if(!((m=this.calcBoundIntersection(t,n,s,e.xorg,e.Square.MinY,e.zorg,e.xorg+p,e.Square.MaxY,e.zorg+p))>0))return m=340282346638528e24,!1;if(m>=(s.w>0?s.w:1e22)||m>=(t.w>0?t.w:1e22))return!1;y=t.x,b=t.z*this.handedness,b-=d<0?1:-1,y-=x<0?1:-1,w=t.y,this._boundRayTime=m,c=(y-_|0)>>this.tileShift,f=(b-g|0)>>this.tileShift}else c=(y-_|0)>>this.tileShift,f=(b-g|0)>>this.tileShift;var z=e.xorg-_>>this.tileShift,Y=e.zorg-g>>this.tileShift,S=z+v,X=Y+v,Z=y/this.tileSize;Z-=0|Z;var P=b/this.tileSize;P-=0|P;var T=s.w>0?(s.w-this._boundRayTime)*this.tileSizeInv:1e22;if(m=0,x<0?(r=-Z/x,a=-1/x,l=-1):(r=(1-Z)/x,a=1/x,l=1),d<0?(h=-P/d,o=-1/d,u=-1):(h=(1-P)/d,o=1/d,u=1),c<z||c>=S||f<Y||f>=X)return!1;if(this.checkHitPatch(t,i,c,f,s.y<0?r<h?w+r*s.y*this.tileSize:w+h*s.y*this.tileSize:w+m*s.y*this.tileSize,n,s))return!0;for(;;){if(r<h?(c+=l,m=r,r+=a):(f+=u,m=h,h+=o),m>=T||c<z||c>=S||f<Y||f>=X)return!1;if(this.checkHitPatch(t,i,c,f,s.y<0?r<h?w+r*s.y*this.tileSize:w+h*s.y*this.tileSize:w+m*s.y*this.tileSize,n,s))return!0}},intersectRayTri:function(t,i,e,n,s,r,a,h,o,l,u,m,c,f,x,d){var _=u-h,g=m-o,p=c-l,v=f-h,y=x-o,b=d-l,w=b*g-y*p,z=v*p-b*_,Y=y*_-v*g,S=w*w+z*z+Y*Y;S>.001&&(w*=S=1/Math.sqrt(S),z*=S,Y*=S);var X=s*w+r*z+a*Y;if(X<0){var Z=i*w+e*z+n*Y-(h*w+o*z+l*Y);if(Z>0){var P=-Z/X,T=i+s*P,L=e+r*P,I=n+a*P;if(((b=I-l)*(g=m-o)-(y=L-o)*(p=c-l))*w+((v=T-h)*p-b*(_=u-h))*z+(y*_-v*g)*Y>=0&&((b=I-c)*(g=x-m)-(y=L-m)*(p=d-c))*w+((v=T-u)*p-b*(_=f-u))*z+(y*_-v*g)*Y>=0&&((b=I-d)*(g=o-x)-(y=L-x)*(p=l-d))*w+((v=T-f)*p-b*(_=h-f))*z+(y*_-v*g)*Y>=0)return t.w=P,t.x=T,t.y=L,t.z=I,!0}}return!1},checkHitPatch:function(t,i,e,n,s,r,a){var h,o=i.Data[e+n*i.RowWidth],l=this._currentPage.heightMap.XOrigin,u=this._currentPage.heightMap.ZOrigin;if(this._patchHeights[2]=o,(h=i.Data[e+1+n*i.RowWidth])>o&&(o=h),this._patchHeights[5]=h,(h=i.Data[e+(n+1)*i.RowWidth])>o&&(o=h),this._patchHeights[8]=h,(h=i.Data[e+1+(n+1)*i.RowWidth])>o&&(o=h),this._patchHeights[11]=h,s>o)return!1;var m,c,f,x,d,_,g,p,v,y=(1&e)!=(1&n)?altern_terrain_TerrainLOD.TRI_ORDER_TRUE:altern_terrain_TerrainLOD.TRI_ORDER_FALSE;return m=(this._patchHeights[3*y[0]]+e)*this.tileSize+l,f=(this._patchHeights[3*y[0]+1]+n)*this.tileSize+u,f*=this.handedness,c=this._patchHeights[3*y[0]+2],x=(this._patchHeights[3*y[1]]+e)*this.tileSize+l,_=(this._patchHeights[3*y[1]+1]+n)*this.tileSize+u,_*=this.handedness,d=this._patchHeights[3*y[1]+2],g=(this._patchHeights[3*y[2]]+e)*this.tileSize+l,v=(this._patchHeights[3*y[2]+1]+n)*this.tileSize+u,v*=this.handedness,p=this._patchHeights[3*y[2]+2],!!this.intersectRayTri(t,r.x,r.y,r.z,a.x,a.y,a.z,m,c,f,x,d,_,g,p,v)||(m=(this._patchHeights[3*y[3]]+e)*this.tileSize+l,f=(this._patchHeights[3*y[3]+1]+n)*this.tileSize+u,f*=this.handedness,c=this._patchHeights[3*y[3]+2],x=(this._patchHeights[3*y[4]]+e)*this.tileSize+l,_=(this._patchHeights[3*y[4]+1]+n)*this.tileSize+u,_*=this.handedness,d=this._patchHeights[3*y[4]+2],g=(this._patchHeights[3*y[5]]+e)*this.tileSize+l,v=(this._patchHeights[3*y[5]+1]+n)*this.tileSize+u,v*=this.handedness,p=this._patchHeights[3*y[5]+2],!!this.intersectRayTri(t,r.x,r.y,r.z,a.x,a.y,a.z,m,c,f,x,d,_,g,p,v))},collectTrisForTree2D:function(t,i,e,n,s,r){var a=t.heightMap,h=i.w,o=a.XOrigin,l=a.ZOrigin;h=h<this.tileSize>>1?this.tileSize>>1:h;var u=(i.x-o-h)*this.tileSizeInv-1|0,m=(i.z*this.handedness-l-h)*this.tileSizeInv-1|0;u<0?u=0:u>=a.XSize?--u:u=u,m<0?m=0:m>=a.ZSize?--m:m=m;var c,f,x,d,_,g,p,v,y,b,w,z,Y=a.Data,S=2*h*this.tileSizeInv+2|0,X=u+S,Z=m+S,P=a.RowWidth,T=.3333333333333333;for(c=m;c<Z;){for(f=u;f<X;)this._patchHeights[2]=Y[f+c*P],this._patchHeights[5]=Y[f+1+c*P],this._patchHeights[8]=Y[f+(c+1)*P],this._patchHeights[11]=Y[f+1+(c+1)*P],x=(1&f)!=(1&c)?altern_terrain_TerrainLOD.TRI_ORDER_TRUE:altern_terrain_TerrainLOD.TRI_ORDER_FALSE,d=(this._patchHeights[3*x[0]]+f)*this.tileSize+o,g=(this._patchHeights[3*x[0]+1]+c)*this.tileSize+l,g*=this.handedness,_=this._patchHeights[3*x[0]+2],p=(this._patchHeights[3*x[1]]+f)*this.tileSize+o,y=(this._patchHeights[3*x[1]+1]+c)*this.tileSize+l,y*=this.handedness,v=this._patchHeights[3*x[1]+2],b=(this._patchHeights[3*x[2]]+f)*this.tileSize+o,z=(this._patchHeights[3*x[2]+1]+c)*this.tileSize+l,z*=this.handedness,w=this._patchHeights[3*x[2]+2],n[r++]=s*T|0,e[s++]=d,e[s++]=_,e[s++]=g,n[r++]=s*T|0,e[s++]=p,e[s++]=v,e[s++]=y,n[r++]=s*T|0,e[s++]=b,e[s++]=w,e[s++]=z,this.numCollisionTriangles++,d=(this._patchHeights[3*x[3]]+f)*this.tileSize+o,g=(this._patchHeights[3*x[3]+1]+c)*this.tileSize+l,g*=this.handedness,_=this._patchHeights[3*x[3]+2],p=(this._patchHeights[3*x[4]]+f)*this.tileSize+o,y=(this._patchHeights[3*x[4]+1]+c)*this.tileSize+l,y*=this.handedness,v=this._patchHeights[3*x[4]+2],b=(this._patchHeights[3*x[5]]+f)*this.tileSize+o,z=(this._patchHeights[3*x[5]+1]+c)*this.tileSize+l,z*=this.handedness,w=this._patchHeights[3*x[5]+2],n[r++]=s*T|0,e[s++]=d,e[s++]=_,e[s++]=g,n[r++]=s*T|0,e[s++]=p,e[s++]=v,e[s++]=y,n[r++]=s*T|0,e[s++]=b,e[s++]=w,e[s++]=z,this.numCollisionTriangles++,++f;++c}},setupCollisionGeometry:function(t,i,e,n,s){if(null==s&&(s=0),null==n&&(n=0),this.numCollisionTriangles=0,null!=this.tree&&(this._currentPage=this.tree,this.collectTrisForTree2D(this.tree,t,i,e,n,s)),null!=this.gridPagesVector)for(var r=0,a=this.gridPagesVector.length;r<a;){var h=r++;this._currentPage=this.gridPagesVector[h],this.collectTrisForTree2D(this._currentPage,t,i,e,n,s)}},boundIntersectSphere:function(t,i,e,n,s,r,a){return t.x+t.w>i&&t.x-t.w<s&&t.y+t.w>e&&t.y-t.w<r&&t.z+t.w>n&&t.z-t.w<a},boundIntersectRay:function(t,i,e,n,s,r,a,h,o){if(t.x>=e&&t.x<=r&&t.y>=n&&t.y<=a&&t.z>=s&&t.z<=h)return!0;if(t.x<e&&i.x<=0)return!1;if(t.x>r&&i.x>=0)return!1;if(t.y<n&&i.y<=0)return!1;if(t.y>a&&i.y>=0)return!1;if(t.z<s&&i.z<=0)return!1;if(t.z>h&&i.z>=0)return!1;var l,u,m,c,f=1e-6;return i.x>f?(l=(e-t.x)/i.x,u=(r-t.x)/i.x):i.x<-1e-6?(l=(r-t.x)/i.x,u=(e-t.x)/i.x):(l=-1e22,u=1e22),i.y>f?(m=(n-t.y)/i.y,c=(a-t.y)/i.y):i.y<-1e-6?(m=(a-t.y)/i.y,c=(n-t.y)/i.y):(m=-1e22,c=1e22),!(m>=u||c<=l)&&(m<l||(l=m),c<u&&(u=c),i.z>f?(m=(s-t.z)/i.z,c=(h-t.z)/i.z):i.z<-1e-6?(m=(h-t.z)/i.z,c=(s-t.z)/i.z):(m=-1e22,c=1e22),m=m>l?m:l,c=c<u?c:u,!(i.w>0&&m>=i.w||o.w>0&&m>=o.w)&&!(m>=u||c<=l))},calcBoundIntersection:function(t,i,e,n,s,r,a,h,o){if(i.x>=n&&i.x<=a&&i.y>=s&&i.y<=h&&i.z>=r&&i.z<=o)return 0;if(i.x<n&&e.x<=0)return-1;if(i.x>a&&e.x>=0)return-1;if(i.y<s&&e.y<=0)return-1;if(i.y>h&&e.y>=0)return-1;if(i.z<r&&e.z<=0)return-1;if(i.z>o&&e.z>=0)return-1;var l,u,m,c,f=1e-6;return e.x>f?(l=(n-i.x)/e.x,u=(a-i.x)/e.x):e.x<-1e-6?(l=(a-i.x)/e.x,u=(n-i.x)/e.x):(l=-1e22,u=1e22),e.y>f?(m=(s-i.y)/e.y,c=(h-i.y)/e.y):e.y<-1e-6?(m=(h-i.y)/e.y,c=(s-i.y)/e.y):(m=-1e22,c=1e22),m>=u||c<=l?-1:(m<l||(l=m),c<u&&(u=c),e.z>f?(m=(r-i.z)/e.z,c=(o-i.z)/e.z):e.z<-1e-6?(m=(o-i.z)/e.z,c=(r-i.z)/e.z):(m=-1e22,c=1e22),c=c<u?c:u,(m=m>l?m:l)>=u||c<=l?-1:(t.x=i.x+e.x*m,t.y=i.y+e.y*m,t.z=i.z+e.z*m,m))},__class__:altern_terrain_TerrainLOD};var altern_terrain_NoCulling=function(){};e["altern.terrain.NoCulling"]=altern_terrain_NoCulling,altern_terrain_NoCulling.__name__=["altern","terrain","NoCulling"],altern_terrain_NoCulling.__interfaces__=[altern_terrain_ICuller],altern_terrain_NoCulling.prototype={cullingInFrustum:function(t,i,e,n,s,r,a){return 0},__class__:altern_terrain_NoCulling};var altern_terrain_WaterClipCulling=function(t){this.terrainLOD=t};e["altern.terrain.WaterClipCulling"]=altern_terrain_WaterClipCulling,altern_terrain_WaterClipCulling.__name__=["altern","terrain","WaterClipCulling"],altern_terrain_WaterClipCulling.__interfaces__=[altern_terrain_ICuller],altern_terrain_WaterClipCulling.prototype={cullingInFrustum:function(t,i,e,n,s,r,a){return-1},__class__:altern_terrain_WaterClipCulling};var util_geom_IAABB=function(){};e["util.geom.IAABB"]=util_geom_IAABB,util_geom_IAABB.__name__=["util","geom","IAABB"],util_geom_IAABB.prototype={__class__:util_geom_IAABB};var components_BoundBox=function(){this.minX=17976931348623157e292,this.minY=17976931348623157e292,this.minZ=17976931348623157e292,this.maxX=-17976931348623157e292,this.maxY=-17976931348623157e292,this.maxZ=-17976931348623157e292};e["components.BoundBox"]=components_BoundBox,components_BoundBox.__name__=["components","BoundBox"],components_BoundBox.__interfaces__=[util_geom_IAABB],components_BoundBox.prototype={__class__:components_BoundBox};var components_CollisionResult=function(){this.gotCollision=!1,this.flags=0,this.stateFlags=0,this.max_ground_normal_threshold=.573576436351046,this.maximum_normal_impulse=0,this.maximum_ground_normal=new util_geom_Vec3};e["components.CollisionResult"]=components_CollisionResult,components_CollisionResult.__name__=["components","CollisionResult"],components_CollisionResult.prototype={get_gotGroundNormal:function(){return 0!=(2&this.stateFlags)},set_gotGroundNormal:function(t){return t?this.stateFlags|=2:this.stateFlags&=-3,t},__class__:components_CollisionResult};var components_Ellipsoid=function(t,i,e){null==e&&(e=32),null==i&&(i=32),null==t&&(t=32),util_geom_Vec3.call(this,t,i,e)};e["components.Ellipsoid"]=components_Ellipsoid,components_Ellipsoid.__name__=["components","Ellipsoid"],components_Ellipsoid.__super__=util_geom_Vec3,components_Ellipsoid.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Ellipsoid});var components_Jump=function(t,i){this.JUMP_COOLDOWN=t,this.jump_speed=i,this.jump_timer=0,this.enabled=!0};e["components.Jump"]=components_Jump,components_Jump.__name__=["components","Jump"],components_Jump.prototype={update:function(t){this.jump_timer=this.jump_timer-t<0?0:this.jump_timer-t},attemptJump:function(t,i){var e=this.enabled&&this.jump_timer<=0;return e&&(t.z+=.04*this.jump_speed,this.jump_timer=this.JUMP_COOLDOWN),e},attemptJumpY:function(t,i){var e=this.enabled&&this.jump_timer<=0;return e&&(t.y+=this.jump_speed,this.jump_timer=this.JUMP_COOLDOWN),e},__class__:components_Jump};var components_MoveResult=function(){util_geom_Vec3.call(this)};e["components.MoveResult"]=components_MoveResult,components_MoveResult.__name__=["components","MoveResult"],components_MoveResult.__super__=util_geom_Vec3,components_MoveResult.prototype=$extend(util_geom_Vec3.prototype,{init:function(){this.preventDefault=!1},disposeCollisions:function(){if(null!=this.collisions){for(var t=this.collisions;null!=t.next;)t=t.next;t.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=this.collisions,this.collisions=null}},setIntegrationNewVelAtCollideTime:function(t,i,e,n){for(var s=this.collisions,r=null,a=null;null!=s;){if(s.t==n){a=s;break}r=s,s=s.next}if(null!=a)if(null!=r){n=1/(n=r.t-a.t);e.x,e.y,e.z;i.x=r.dest.x,i.y=r.dest.y,i.z=r.dest.z,i.x-=t.x,i.y-=t.y,i.z-=t.z,i.x*=n,i.y*=n,i.z*=n}else n=1/(n=1-a.t),i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.x*=n,i.y*=n,i.z*=n},initIntegration:function(t,i,e,n){i.x=t.x,i.y=t.y,i.z=t.z;var s=this.collisions;if(null!=s){for(var r=null,a=null;null!=s&&(r=s,null!=(s=s.next));)0!=s.t&&(a=s);if(0!=r.t){n.x,n.y,n.z;e.x=r.dest.x,e.y=r.dest.y,e.z=r.dest.z,1/r.t,e.x-=t.x,e.y-=t.y,e.z-=t.z}else if(null!=a){n.x,n.y,n.z;e.x=a.dest.x,e.y=a.dest.y,e.z=a.dest.z,1/a.t,e.x-=t.x,e.y-=t.y,e.z-=t.z}else e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z}else e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},findNearestCollisionEvent:function(t){var i=this.collisions;if(null==i)return null;for(var e=null;null!=i&&!(i.t<=t);)e=i,i=i.next;return e},truncateCollisionEvents:function(t){for(var i=this.collisions,e=null;null!=i&&!(i.t<=t);)e=i,i=i.next;if(null!=e){var n=this.collisions;this.collisions=e.next,e.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=n}},addCollisionEvent:function(t){t.next=this.collisions,this.collisions=t},__class__:components_MoveResult});var components_Pos=function(t,i,e){null==e&&(e=0),null==i&&(i=0),null==t&&(t=0),util_geom_Vec3.call(this,t,i,e)};e["components.Pos"]=components_Pos,components_Pos.__name__=["components","Pos"],components_Pos.__super__=util_geom_Vec3,components_Pos.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Pos});var components_Transform3D=function(){this.identity()};e["components.Transform3D"]=components_Transform3D,components_Transform3D.__name__=["components","Transform3D"],components_Transform3D.prototype={identity:function(){this.a=1,this.b=0,this.c=0,this.d=0,this.e=0,this.f=1,this.g=0,this.h=0,this.i=0,this.j=0,this.k=1,this.l=0},compose:function(t,i,e,n,s,r,a,h,o){var l=Math.cos(n),u=Math.sin(n),m=Math.cos(s),c=Math.sin(s),f=Math.cos(r),x=Math.sin(r),d=f*c,_=x*c,g=m*a,p=u*h,v=l*h,y=l*o,b=u*o;this.a=f*g,this.b=d*p-x*v,this.c=d*y+x*b,this.d=t,this.e=x*g,this.f=_*p+f*v,this.g=_*y-f*b,this.h=i,this.i=-c*a,this.j=m*p,this.k=m*y,this.l=e},invert:function(){var t=this.a,i=this.b,e=this.c,n=this.d,s=this.e,r=this.f,a=this.g,h=this.h,o=this.i,l=this.j,u=this.k,m=this.l,c=1/(-e*r*o+i*a*o+e*s*l-t*a*l-i*s*u+t*r*u);this.a=(-a*l+r*u)*c,this.b=(e*l-i*u)*c,this.c=(-e*r+i*a)*c,this.d=(n*a*l-e*h*l-n*r*u+i*h*u+e*r*m-i*a*m)*c,this.e=(a*o-s*u)*c,this.f=(-e*o+t*u)*c,this.g=(e*s-t*a)*c,this.h=(e*h*o-n*a*o+n*s*u-t*h*u-e*s*m+t*a*m)*c,this.i=(-r*o+s*l)*c,this.j=(i*o-t*l)*c,this.k=(-i*s+t*r)*c,this.l=(n*r*o-i*h*o-n*s*l+t*h*l+i*s*m-t*r*m)*c},initFromVector:function(t){this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5],this.g=t[6],this.h=t[7],this.i=t[8],this.j=t[9],this.k=t[10],this.l=t[11]},append:function(t){var i=this.a,e=this.b,n=this.c,s=this.d,r=this.e,a=this.f,h=this.g,o=this.h,l=this.i,u=this.j,m=this.k,c=this.l;this.a=t.a*i+t.b*r+t.c*l,this.b=t.a*e+t.b*a+t.c*u,this.c=t.a*n+t.b*h+t.c*m,this.d=t.a*s+t.b*o+t.c*c+t.d,this.e=t.e*i+t.f*r+t.g*l,this.f=t.e*e+t.f*a+t.g*u,this.g=t.e*n+t.f*h+t.g*m,this.h=t.e*s+t.f*o+t.g*c+t.h,this.i=t.i*i+t.j*r+t.k*l,this.j=t.i*e+t.j*a+t.k*u,this.k=t.i*n+t.j*h+t.k*m,this.l=t.i*s+t.j*o+t.k*c+t.l},prepend:function(t){var i=this.a,e=this.b,n=this.c,s=this.d,r=this.e,a=this.f,h=this.g,o=this.h,l=this.i,u=this.j,m=this.k,c=this.l;this.a=i*t.a+e*t.e+n*t.i,this.b=i*t.b+e*t.f+n*t.j,this.c=i*t.c+e*t.g+n*t.k,this.d=i*t.d+e*t.h+n*t.l+s,this.e=r*t.a+a*t.e+h*t.i,this.f=r*t.b+a*t.f+h*t.j,this.g=r*t.c+a*t.g+h*t.k,this.h=r*t.d+a*t.h+h*t.l+o,this.i=l*t.a+u*t.e+m*t.i,this.j=l*t.b+u*t.f+m*t.j,this.k=l*t.c+u*t.g+m*t.k,this.l=l*t.d+u*t.h+m*t.l+c},combine:function(t,i){this.a=t.a*i.a+t.b*i.e+t.c*i.i,this.b=t.a*i.b+t.b*i.f+t.c*i.j,this.c=t.a*i.c+t.b*i.g+t.c*i.k,this.d=t.a*i.d+t.b*i.h+t.c*i.l+t.d,this.e=t.e*i.a+t.f*i.e+t.g*i.i,this.f=t.e*i.b+t.f*i.f+t.g*i.j,this.g=t.e*i.c+t.f*i.g+t.g*i.k,this.h=t.e*i.d+t.f*i.h+t.g*i.l+t.h,this.i=t.i*i.a+t.j*i.e+t.k*i.i,this.j=t.i*i.b+t.j*i.f+t.k*i.j,this.k=t.i*i.c+t.j*i.g+t.k*i.k,this.l=t.i*i.d+t.j*i.h+t.k*i.l+t.l},calculateInversion:function(t){var i=t.a,e=t.b,n=t.c,s=t.d,r=t.e,a=t.f,h=t.g,o=t.h,l=t.i,u=t.j,m=t.k,c=t.l,f=1/(-n*a*l+e*h*l+n*r*u-i*h*u-e*r*m+i*a*m);this.a=(-h*u+a*m)*f,this.b=(n*u-e*m)*f,this.c=(-n*a+e*h)*f,this.d=(s*h*u-n*o*u-s*a*m+e*o*m+n*a*c-e*h*c)*f,this.e=(h*l-r*m)*f,this.f=(-n*l+i*m)*f,this.g=(n*r-i*h)*f,this.h=(n*o*l-s*h*l+s*r*m-i*o*m-n*r*c+i*h*c)*f,this.i=(-a*l+r*u)*f,this.j=(e*l-i*u)*f,this.k=(-e*r+i*a)*f,this.l=(s*a*l-e*o*l-s*r*u+i*o*u+e*r*c-i*a*c)*f},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l},__class__:components_Transform3D};var components_Vel=function(t,i,e){null==e&&(e=0),null==i&&(i=0),null==t&&(t=0),util_geom_Vec3.call(this,t,i,e)};e["components.Vel"]=components_Vel,components_Vel.__name__=["components","Vel"],components_Vel.__super__=util_geom_Vec3,components_Vel.prototype=$extend(util_geom_Vec3.prototype,{__class__:components_Vel});var components_controller_SurfaceMovement=function(){this.walk_state=0,this.strafe_state=0,this.friction=0,this.WALK_SPEED=115,this.WALKBACK_SPEED=32,this.STRAFE_SPEED=37};e["components.controller.SurfaceMovement"]=components_controller_SurfaceMovement,components_controller_SurfaceMovement.__name__=["components","controller","SurfaceMovement"],components_controller_SurfaceMovement.updateWith=function(t,i,e,n,s,r,a,h,o,l,u,m){var c;if(null==u&&(u=.25),null!=m){e.x*=u,e.y*=u,e.z*=u,e.x*e.x+e.y*e.y+e.z*e.z<1&&(e.x=0,e.y=0,e.z=0),null!=i&&(r.x=-Math.sin(i.z),r.y=Math.cos(i.z),r.z=0),r.x*m.x+r.y*m.y+r.z*m.z>0&&(c=r.x*m.x+r.y*m.y+r.z*m.z,r.x-=r.x*c,r.y-=r.y*c,r.z-=r.z*c);var f=1/Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z);r.x*=f,r.y*=f,r.z*=f,0!=n&&(c=-1!=n?h:-o,e.x+=r.x*c,e.y+=r.y*c,e.z+=r.z*c),a.x=r.y*m.z-r.z*m.y,a.y=r.z*m.x-m.z*r.x,a.z=r.x*m.y-r.y*m.x;var x=1/Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);a.x*=x,a.y*=x,a.z*=x,0!=s&&(c=-1!=s?l:-l,e.x+=a.x*c,e.y+=a.y*c,e.z+=a.z*c)}},components_controller_SurfaceMovement.prototype={resetAllStates:function(){this.walk_state=0,this.strafe_state=0},setWalkSpeeds:function(t,i){null==i&&(i=-1),this.WALK_SPEED=t,this.WALKBACK_SPEED=-1!=i?i:t},setStrafeSpeed:function(t){this.STRAFE_SPEED=t},setAllSpeeds:function(t){this.WALK_SPEED=t,this.WALKBACK_SPEED=t,this.STRAFE_SPEED=t},respond_move_forward:function(){this.walk_state=1},respond_move_back:function(){this.walk_state=-1},respond_move_stop:function(){this.walk_state=0},respond_strafe_left:function(){this.strafe_state=-1},respond_strafe_right:function(){this.strafe_state=1},respond_strafe_stop:function(){this.strafe_state=0},__class__:components_controller_SurfaceMovement};var de_polygonal_ds_tools_ArrayTools=function(){};e["de.polygonal.ds.tools.ArrayTools"]=de_polygonal_ds_tools_ArrayTools,de_polygonal_ds_tools_ArrayTools.__name__=["de","polygonal","ds","tools","ArrayTools"],de_polygonal_ds_tools_ArrayTools.alloc=function(t){return new Array(t)},de_polygonal_ds_tools_ArrayTools.trim=function(t,i){return t.length>i?(t.length=i,t):t},de_polygonal_ds_tools_ArrayTools.swap=function(t,i,e){if(i!=e){var n=t[i];t[i]=t[e],t[e]=n}},de_polygonal_ds_tools_ArrayTools.getFront=function(t,i){if(0!=i){var e=t[i];t[i]=t[0],t[0]=e}return t[0]},de_polygonal_ds_tools_ArrayTools.init=function(t,i,e,n){null==n&&(n=0),null==e&&(e=0);for(var s=e,r=n<=0?t.length:s+n;s<r;)t[s++]=i;return t},de_polygonal_ds_tools_ArrayTools.blit=function(t,i,e,n,s){if(s>0)if(t==e){if(i<n)for(var r=i+s,a=n+s,h=0,o=s;h<o;){h++;--r,t[--a]=t[r]}else if(i>n)for(var l=i,u=n,m=0,c=s;m<c;){m++;t[u]=t[l],++l,++u}}else if(0==i&&0==n)for(var f=0,x=s;f<x;){var d=f++;e[d]=t[d]}else if(0==i)for(var _=0,g=s;_<g;){var p=_++;e[n+p]=t[p]}else if(0==n)for(var v=0,y=s;v<y;){var b=v++;e[b]=t[i+b]}else for(var w=0,z=s;w<z;){var Y=w++;e[n+Y]=t[i+Y]}},de_polygonal_ds_tools_ArrayTools.iter=function(t,i,e){null==e&&(e=0),0==e&&(e=t.length);for(var n=0,s=e;n<s;){i(t[n++])}},de_polygonal_ds_tools_ArrayTools.forEach=function(t,i){for(var e=0,n=t.length;e<n;){var s=e++;t[s]=i(t[s],s)}},de_polygonal_ds_tools_ArrayTools.binarySearchCmp=function(t,i,e,n,s){for(var r,a=e,h=n+1;a<h;)s(t[r=a+(h-a>>1)],i)<0?a=r+1:h=r;return a<=n&&0==s(t[a],i)?a:~a},de_polygonal_ds_tools_ArrayTools.binarySearchf=function(t,i,e,n){for(var s,r=e,a=n+1;r<a;)t[s=r+(a-r>>1)]<i?r=s+1:a=s;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_ArrayTools.binarySearchi=function(t,i,e,n){for(var s,r=e,a=n+1;r<a;)t[s=r+(a-r>>1)]<i?r=s+1:a=s;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_ArrayTools.shuffle=function(t,i){var e=t.length;if(null==i)for(;--e>1;){var n=de_polygonal_ds_tools_Shuffle._f()*e|0,s=t[e];t[e]=t[n],t[n]=s}else for(var r=0;--e>1;){var a=i[r++]*e|0,h=t[e];t[e]=t[a],t[a]=h}},de_polygonal_ds_tools_ArrayTools.sortRange=function(t,i,e,n,s){if(t.length>1)if(e)for(var r=n+1,a=n+s;r<a;){for(var h=r++,o=t[h],l=h;l>n;){var u=t[l-1];if(!(i(u,o)>0))break;t[l]=u,--l}t[l]=o}else de_polygonal_ds_tools_ArrayTools._quickSort(t,n,s,i)},de_polygonal_ds_tools_ArrayTools.quickPerm=function(t){var i,e,n,s=[],r=[],a=[];for(i=0;i<t;)r[i]=i+1,a[i]=0,++i;for(s.push(r.slice()),i=1;i<t;)a[i]<i?(n=r[e=i%2*a[i]],r[e]=r[i],r[i]=n,s.push(r.slice()),a[i]++,i=1):(a[i]=0,++i);return s},de_polygonal_ds_tools_ArrayTools.equals=function(t,i){if(t.length!=i.length)return!1;for(var e=0,n=t.length;e<n;){var s=e++;if(t[s]!=i[s])return!1}return!0},de_polygonal_ds_tools_ArrayTools.split=function(t,i,e){for(var n=[],s=null,r=0,a=i;r<a;){var h=r++;h%e==0&&(s=[],n[h/e|0]=s),s.push(t[h])}return n},de_polygonal_ds_tools_ArrayTools.pairwise=function(t,i){for(var e=0,n=t.length;e<n;)i(e,t[e],t[e+1]),e+=2},de_polygonal_ds_tools_ArrayTools.bruteforce=function(t,i){for(var e,n=0,s=t.length,r=s-1;n<r;){for(e=n+1;e<s;)i(t[n],t[e]),++e;++n}},de_polygonal_ds_tools_ArrayTools._quickSort=function(t,i,e,n){var s=i+e-1,r=i,a=s;if(e>1){var h,o=i,l=o+(e>>1),u=o+e-1,m=t[o],c=t[l],f=t[u],x=n(m,f),d=t[h=x<0&&n(m,c)<0?n(c,f)<0?l:u:n(c,m)<0&&n(c,f)<0?x<0?o:u:n(f,m)<0?l:o];for(t[h]=t[i];r<a;){for(;n(d,t[a])<0&&r<a;)--a;for(a!=r&&(t[r]=t[a],++r);n(d,t[r])>0&&r<a;)++r;a!=r&&(t[a]=t[r],--a)}t[r]=d,de_polygonal_ds_tools_ArrayTools._quickSort(t,i,r-i,n),de_polygonal_ds_tools_ArrayTools._quickSort(t,r+1,s-r,n)}};var de_polygonal_ds_tools_Assert=function(){};e["de.polygonal.ds.tools.Assert"]=de_polygonal_ds_tools_Assert,de_polygonal_ds_tools_Assert.__name__=["de","polygonal","ds","tools","Assert"];var de_polygonal_ds_tools_NativeArrayTools=function(){};e["de.polygonal.ds.tools.NativeArrayTools"]=de_polygonal_ds_tools_NativeArrayTools,de_polygonal_ds_tools_NativeArrayTools.__name__=["de","polygonal","ds","tools","NativeArrayTools"],de_polygonal_ds_tools_NativeArrayTools.alloc=function(t){return new Array(t)},de_polygonal_ds_tools_NativeArrayTools.get=function(t,i){return t[i]},de_polygonal_ds_tools_NativeArrayTools.set=function(t,i,e){t[i]=e},de_polygonal_ds_tools_NativeArrayTools.size=function(t){return t.length},de_polygonal_ds_tools_NativeArrayTools.toArray=function(t,i,e,n){if(0==e)return[];var s=new Array(e);if(0==i)for(var r=0,a=e;r<a;){var h=r++;s[h]=t[h]}else for(var o=i,l=i+e;o<l;){var u=o++;s[u-i]=t[u]}return s},de_polygonal_ds_tools_NativeArrayTools.ofArray=function(t){return t.slice(0,t.length)},de_polygonal_ds_tools_NativeArrayTools.blit=function(t,i,e,n,s){if(s>0)if(t==e){if(i<n)for(var r=i+s,a=n+s,h=0,o=s;h<o;){h++;--r,t[--a]=t[r]}else if(i>n)for(var l=i,u=n,m=0,c=s;m<c;){m++;t[u]=t[l],++l,++u}}else if(0==i&&0==n)for(var f=0,x=s;f<x;){var d=f++;e[d]=t[d]}else if(0==i)for(var _=0,g=s;_<g;){var p=_++;e[n+p]=t[p]}else if(0==n)for(var v=0,y=s;v<y;){var b=v++;e[b]=t[i+b]}else for(var w=0,z=s;w<z;){var Y=w++;e[n+Y]=t[i+Y]}},de_polygonal_ds_tools_NativeArrayTools.copy=function(t){return t.slice(0)},de_polygonal_ds_tools_NativeArrayTools.zero=function(t,i,e){null==e&&(e=0),null==i&&(i=0);for(var n=i,s=e<=0?t.length:n+e;n<s;)t[n++]=0;return t},de_polygonal_ds_tools_NativeArrayTools.init=function(t,i,e,n){null==n&&(n=0),null==e&&(e=0);for(var s=e,r=n<=0?t.length:s+n;s<r;)t[s++]=i;return t},de_polygonal_ds_tools_NativeArrayTools.nullify=function(t,i,e){null==e&&(e=0),null==i&&(i=0);for(var n=i,s=e<=0?t.length:n+e;n<s;)t[n++]=null;return t},de_polygonal_ds_tools_NativeArrayTools.binarySearchCmp=function(t,i,e,n,s){for(var r,a=e,h=n+1;a<h;)s(t[r=a+(h-a>>1)],i)<0?a=r+1:h=r;return a<=n&&0==s(t[a],i)?a:~a},de_polygonal_ds_tools_NativeArrayTools.binarySearchf=function(t,i,e,n){for(var s,r=e,a=n+1;r<a;)t[s=r+(a-r>>1)]<i?r=s+1:a=s;return r<=n&&t[r]==i?r:~r},de_polygonal_ds_tools_NativeArrayTools.binarySearchi=function(t,i,e,n){for(var s,r=e,a=n+1;r<a;)t[s=r+(a-r>>1)]<i?r=s+1:a=s;return r<=n&&t[r]==i?r:~r};var de_polygonal_ds_tools_NativeInt32ArrayTools=function(){};e["de.polygonal.ds.tools.NativeInt32ArrayTools"]=de_polygonal_ds_tools_NativeInt32ArrayTools,de_polygonal_ds_tools_NativeInt32ArrayTools.__name__=["de","polygonal","ds","tools","NativeInt32ArrayTools"],de_polygonal_ds_tools_NativeInt32ArrayTools.alloc=function(t){return new Int32Array(t)},de_polygonal_ds_tools_NativeInt32ArrayTools.get=function(t,i){return t[i]},de_polygonal_ds_tools_NativeInt32ArrayTools.setD=function(t,i,e){t[i]=e},de_polygonal_ds_tools_NativeInt32ArrayTools.size=function(t){return t.length},de_polygonal_ds_tools_NativeInt32ArrayTools.toArray=function(t,i,e,n){if(0==e)return[];var s=new Array(e);if(0==i)for(var r=0,a=e;r<a;){var h=r++;s[h]=t[h]}else for(var o=i,l=i+e;o<l;){var u=o++;s[u-i]=t[u]}return s},de_polygonal_ds_tools_NativeInt32ArrayTools.ofArray=function(t){for(var i=new Int32Array(t.length),e=0,n=t.length;e<n;){var s=e++;i[s]=t[s]}return i},de_polygonal_ds_tools_NativeInt32ArrayTools.blit=function(t,i,e,n,s){if(s>0)if(t==e){if(i<n)for(var r=i+s,a=n+s,h=0,o=s;h<o;){h++;--r,t[--a]=t[r]}else if(i>n)for(var l=i,u=n,m=0,c=s;m<c;){m++;t[u]=t[l],++l,++u}}else if(0==i&&0==n)for(var f=0,x=s;f<x;){var d=f++;e[d]=t[d]}else if(0==i)for(var _=0,g=s;_<g;){var p=_++;e[n+p]=t[p]}else if(0==n)for(var v=0,y=s;v<y;){var b=v++;e[b]=t[i+b]}else for(var w=0,z=s;w<z;){var Y=w++;e[n+Y]=t[i+Y]}},de_polygonal_ds_tools_NativeInt32ArrayTools.copy=function(t){for(var i=t.length,e=new Int32Array(i),n=0,s=i;n<s;){var r=n++;e[r]=t[r]}return e},de_polygonal_ds_tools_NativeInt32ArrayTools.zero=function(t,i,e){null==e&&(e=0),null==i&&(i=0);for(var n=i,s=e<=0?t.length:n+e;n<s;)t[n++]=0;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.init=function(t,i,e,n){null==n&&(n=0),null==e&&(e=0);for(var s=e,r=n<=0?t.length:s+n;s<r;)t[s++]=i;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.nullify=function(t,i,e){null==e&&(e=0),null==i&&(i=0);for(var n=i,s=e<=0?t.length:n+e;n<s;)t[n++]=null;return t},de_polygonal_ds_tools_NativeInt32ArrayTools.binarySearchCmp=function(t,i,e,n,s){for(var r,a=e,h=n+1;a<h;)s(t[r=a+(h-a>>1)],i)<0?a=r+1:h=r;return a<=n&&0==s(t[a],i)?a:~a},de_polygonal_ds_tools_NativeInt32ArrayTools.binarySearchi=function(t,i,e,n){for(var s,r=e,a=n+1;r<a;)t[s=r+(a-r>>1)]<i?r=s+1:a=s;return r<=n&&t[r]==i?r:~r};var de_polygonal_ds_tools_Shuffle=function(){};e["de.polygonal.ds.tools.Shuffle"]=de_polygonal_ds_tools_Shuffle,de_polygonal_ds_tools_Shuffle.__name__=["de","polygonal","ds","tools","Shuffle"],de_polygonal_ds_tools_Shuffle._f=function(){return Math.random()},de_polygonal_ds_tools_Shuffle.setRandom=function(t){de_polygonal_ds_tools_Shuffle._f=t},de_polygonal_ds_tools_Shuffle.frand=function(){return de_polygonal_ds_tools_Shuffle._f()};var haxe_IMap=function(){};e["haxe.IMap"]=haxe_IMap,haxe_IMap.__name__=["haxe","IMap"],haxe_IMap.prototype={__class__:haxe_IMap};var haxe__$Int64__$_$_$Int64=function(t,i){this.high=t,this.low=i};e["haxe._Int64.___Int64"]=haxe__$Int64__$_$_$Int64,haxe__$Int64__$_$_$Int64.__name__=["haxe","_Int64","___Int64"],haxe__$Int64__$_$_$Int64.prototype={__class__:haxe__$Int64__$_$_$Int64};var haxe_crypto_Crc32=function(){};e["haxe.crypto.Crc32"]=haxe_crypto_Crc32,haxe_crypto_Crc32.__name__=["haxe","crypto","Crc32"],haxe_crypto_Crc32.make=function(t){for(var i=-1,e=t.b.bufferValue,n=0,s=t.length;n<s;){for(var r=n++,a=255&(i^e.bytes[r]),h=0;h<8;){h++;1==(1&a)?a=a>>>1^-306674912:a>>>=1}i=i>>>8^a}return-1^i};var haxe_ds_BalancedTree=function(){};e["haxe.ds.BalancedTree"]=haxe_ds_BalancedTree,haxe_ds_BalancedTree.__name__=["haxe","ds","BalancedTree"],haxe_ds_BalancedTree.prototype={set:function(t,i){this.root=this.setLoop(t,i,this.root)},get:function(t){for(var i=this.root;null!=i;){var e=this.compare(t,i.key);if(0==e)return i.value;i=e<0?i.left:i.right}return null},keys:function(){var t=[];return this.keysLoop(this.root,t),HxOverrides.iter(t)},setLoop:function(t,i,e){if(null==e)return new haxe_ds_TreeNode(null,t,i,null);var n=this.compare(t,e.key);if(0==n)return new haxe_ds_TreeNode(e.left,t,i,e.right,null==e?0:e._height);if(n<0){var s=this.setLoop(t,i,e.left);return this.balance(s,e.key,e.value,e.right)}var r=this.setLoop(t,i,e.right);return this.balance(e.left,e.key,e.value,r)},keysLoop:function(t,i){null!=t&&(this.keysLoop(t.left,i),i.push(t.key),this.keysLoop(t.right,i))},balance:function(t,i,e,n){var s=null==t?0:t._height,r=null==n?0:n._height;if(s>r+2){var a=t.left,h=t.right;return(null==a?0:a._height)>=(null==h?0:h._height)?new haxe_ds_TreeNode(t.left,t.key,t.value,new haxe_ds_TreeNode(t.right,i,e,n)):new haxe_ds_TreeNode(new haxe_ds_TreeNode(t.left,t.key,t.value,t.right.left),t.right.key,t.right.value,new haxe_ds_TreeNode(t.right.right,i,e,n))}if(r>s+2){var o=n.right,l=n.left;return(null==o?0:o._height)>(null==l?0:l._height)?new haxe_ds_TreeNode(new haxe_ds_TreeNode(t,i,e,n.left),n.key,n.value,n.right):new haxe_ds_TreeNode(new haxe_ds_TreeNode(t,i,e,n.left.left),n.left.key,n.left.value,new haxe_ds_TreeNode(n.left.right,n.key,n.value,n.right))}return new haxe_ds_TreeNode(t,i,e,n,(s>r?s:r)+1)},compare:function(t,i){return Reflect.compare(t,i)},__class__:haxe_ds_BalancedTree};var haxe_ds_TreeNode=function(t,i,e,n,s){if(null==s&&(s=-1),this.left=t,this.key=i,this.value=e,this.right=n,-1==s){var r,a=this.left,h=this.right;if((null==a?0:a._height)>(null==h?0:h._height)){var o=this.left;r=null==o?0:o._height}else{var l=this.right;r=null==l?0:l._height}this._height=r+1}else this._height=s};e["haxe.ds.TreeNode"]=haxe_ds_TreeNode,haxe_ds_TreeNode.__name__=["haxe","ds","TreeNode"],haxe_ds_TreeNode.prototype={__class__:haxe_ds_TreeNode};var haxe_ds_EnumValueMap=function(){haxe_ds_BalancedTree.call(this)};e["haxe.ds.EnumValueMap"]=haxe_ds_EnumValueMap,haxe_ds_EnumValueMap.__name__=["haxe","ds","EnumValueMap"],haxe_ds_EnumValueMap.__interfaces__=[haxe_IMap],haxe_ds_EnumValueMap.__super__=haxe_ds_BalancedTree,haxe_ds_EnumValueMap.prototype=$extend(haxe_ds_BalancedTree.prototype,{compare:function(t,i){var e=t[1]-i[1];if(0!=e)return e;var n=t.slice(2),s=i.slice(2);return 0==n.length&&0==s.length?0:this.compareArgs(n,s)},compareArgs:function(t,i){var e=t.length-i.length;if(0!=e)return e;for(var n=0,s=t.length;n<s;){var r=n++,a=this.compareArg(t[r],i[r]);if(0!=a)return a}return 0},compareArg:function(t,i){return Reflect.isEnumValue(t)&&Reflect.isEnumValue(i)?this.compare(t,i):t instanceof Array&&null==t.__enum__&&i instanceof Array&&null==i.__enum__?this.compareArgs(t,i):Reflect.compare(t,i)},__class__:haxe_ds_EnumValueMap});var haxe_ds_IntMap=function(){this.h={}};e["haxe.ds.IntMap"]=haxe_ds_IntMap,haxe_ds_IntMap.__name__=["haxe","ds","IntMap"],haxe_ds_IntMap.__interfaces__=[haxe_IMap],haxe_ds_IntMap.prototype={get:function(t){return this.h[t]},remove:function(t){return!!this.h.hasOwnProperty(t)&&(delete this.h[t],!0)},keys:function(){var t=[];for(var i in this.h)this.h.hasOwnProperty(i)&&t.push(0|i);return HxOverrides.iter(t)},__class__:haxe_ds_IntMap};var haxe_ds_ObjectMap=function(){this.h={__keys__:{}}};e["haxe.ds.ObjectMap"]=haxe_ds_ObjectMap,haxe_ds_ObjectMap.__name__=["haxe","ds","ObjectMap"],haxe_ds_ObjectMap.__interfaces__=[haxe_IMap],haxe_ds_ObjectMap.prototype={set:function(t,i){var e=t.__id__||(t.__id__=++haxe_ds_ObjectMap.count);this.h[e]=i,this.h.__keys__[e]=t},get:function(t){return this.h[t.__id__]},remove:function(t){var i=t.__id__;return null!=this.h.__keys__[i]&&(delete this.h[i],delete this.h.__keys__[i],!0)},keys:function(){var t=[];for(var i in this.h.__keys__)this.h.hasOwnProperty(i)&&t.push(this.h.__keys__[i]);return HxOverrides.iter(t)},__class__:haxe_ds_ObjectMap};var haxe_ds_StringMap=function(){this.h={}};e["haxe.ds.StringMap"]=haxe_ds_StringMap,haxe_ds_StringMap.__name__=["haxe","ds","StringMap"],haxe_ds_StringMap.__interfaces__=[haxe_IMap],haxe_ds_StringMap.prototype={get:function(t){return null!=Z[t]?this.getReserved(t):this.h[t]},setReserved:function(t,i){null==this.rh&&(this.rh={}),this.rh["$"+t]=i},getReserved:function(t){return null==this.rh?null:this.rh["$"+t]},existsReserved:function(t){return null!=this.rh&&this.rh.hasOwnProperty("$"+t)},keys:function(){return HxOverrides.iter(this.arrayKeys())},arrayKeys:function(){var t=[];for(var i in this.h)this.h.hasOwnProperty(i)&&t.push(i);if(null!=this.rh)for(var i in this.rh)36==i.charCodeAt(0)&&t.push(i.substr(1));return t},__class__:haxe_ds_StringMap};var haxe_io_Bytes=function(t){this.length=t.byteLength,this.b=new O(t),this.b.bufferValue=t,t.hxBytes=this,t.bytes=this.b};e["haxe.io.Bytes"]=haxe_io_Bytes,haxe_io_Bytes.__name__=["haxe","io","Bytes"],haxe_io_Bytes.alloc=function(t){return new haxe_io_Bytes(new P(t))},haxe_io_Bytes.ofString=function(t){for(var i=[],e=0;e<t.length;){var n=t.charCodeAt(e++);55296<=n&&n<=56319&&(n=n-55232<<10|1023&t.charCodeAt(e++)),n<=127?i.push(n):n<=2047?(i.push(192|n>>6),i.push(128|63&n)):n<=65535?(i.push(224|n>>12),i.push(128|n>>6&63),i.push(128|63&n)):(i.push(240|n>>18),i.push(128|n>>12&63),i.push(128|n>>6&63),i.push(128|63&n))}return new haxe_io_Bytes(new O(i).buffer)},haxe_io_Bytes.ofData=function(t){var i=t.hxBytes;return null!=i?i:new haxe_io_Bytes(t)},haxe_io_Bytes.fastGet=function(t,i){return t.bytes[i]},haxe_io_Bytes.prototype={blit:function(t,i,e,n){if(t<0||e<0||n<0||t+n>this.length||e+n>i.length)throw new js__$Boot_HaxeError(a.OutsideBounds);0==e&&n==i.b.byteLength?this.b.set(i.b,t):this.b.set(i.b.subarray(e,e+n),t)},sub:function(t,i){if(t<0||i<0||t+i>this.length)throw new js__$Boot_HaxeError(a.OutsideBounds);return new haxe_io_Bytes(this.b.buffer.slice(t+this.b.byteOffset,t+this.b.byteOffset+i))},getDouble:function(t){return null==this.data&&(this.data=new L(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat64(t,!0)},getFloat:function(t){return null==this.data&&(this.data=new L(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getFloat32(t,!0)},getInt32:function(t){return null==this.data&&(this.data=new L(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.getInt32(t,!0)},setInt32:function(t,i){null==this.data&&(this.data=new L(this.b.buffer,this.b.byteOffset,this.b.byteLength)),this.data.setInt32(t,i,!0)},getInt64:function(t){return new haxe__$Int64__$_$_$Int64(this.getInt32(t+4),this.getInt32(t))},getString:function(t,i){if(t<0||i<0||t+i>this.length)throw new js__$Boot_HaxeError(a.OutsideBounds);for(var e="",n=this.b,s=String.fromCharCode,r=t,h=t+i;r<h;){var o=n[r++];if(o<128){if(0==o)break;e+=s(o)}else if(o<224)e+=s((63&o)<<6|127&n[r++]);else if(o<240){e+=s((31&o)<<12|(127&n[r++])<<6|127&n[r++])}else{var l=(15&o)<<18|(127&n[r++])<<12|(127&n[r++])<<6|127&n[r++];e+=s(55232+(l>>10)),e+=s(1023&l|56320)}}return e},__class__:haxe_io_Bytes};var haxe_io_BytesBuffer=function(){this.b=[]};e["haxe.io.BytesBuffer"]=haxe_io_BytesBuffer,haxe_io_BytesBuffer.__name__=["haxe","io","BytesBuffer"],haxe_io_BytesBuffer.prototype={addInt32:function(t){this.b.push(255&t),this.b.push(t>>8&255),this.b.push(t>>16&255),this.b.push(t>>>24)},addInt64:function(t){this.addInt32(t.low),this.addInt32(t.high)},getBytes:function(){var t=new haxe_io_Bytes(new O(this.b).buffer);return this.b=null,t},__class__:haxe_io_BytesBuffer};var a=e["haxe.io.Error"]={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]};a.Blocked=["Blocked",0],a.Blocked.toString=$estr,a.Blocked.__enum__=a,a.Overflow=["Overflow",1],a.Overflow.toString=$estr,a.Overflow.__enum__=a,a.OutsideBounds=["OutsideBounds",2],a.OutsideBounds.toString=$estr,a.OutsideBounds.__enum__=a,a.Custom=function(t){var i=["Custom",3,t];return i.__enum__=a,i.toString=$estr,i};var haxe_io_FPHelper=function(){};e["haxe.io.FPHelper"]=haxe_io_FPHelper,haxe_io_FPHelper.__name__=["haxe","io","FPHelper"],haxe_io_FPHelper.i32ToFloat=function(t){var i=t>>>23&255,e=8388607&t;return 0==e&&0==i?0:(1-(t>>>31<<1))*(1+Math.pow(2,-23)*e)*Math.pow(2,i-127)},haxe_io_FPHelper.floatToI32=function(t){if(0==t)return 0;var i=t<0?-t:t,e=Math.floor(Math.log(i)/.6931471805599453);e<-127?e=-127:e>128&&(e=128);var n=Math.round(8388608*(i/Math.pow(2,e)-1));return 8388608==n&&e<128&&(n=0,++e),(t<0?-2147483648:0)|e+127<<23|n},haxe_io_FPHelper.i64ToDouble=function(t,i){var e=(i>>20&2047)-1023,n=4294967296*(1048575&i)+2147483648*(t>>>31)+(2147483647&t);return 0==n&&-1023==e?0:(1-(i>>>31<<1))*(1+Math.pow(2,-52)*n)*Math.pow(2,e)},haxe_io_FPHelper.doubleToI64=function(t){var i=haxe_io_FPHelper.i64tmp;if(0==t)i.low=0,i.high=0;else if(isFinite(t)){var e=t<0?-t:t,n=Math.floor(Math.log(e)/.6931471805599453),s=Math.round(4503599627370496*(e/Math.pow(2,n)-1)),r=0|s,a=s/4294967296|0;i.low=r,i.high=(t<0?-2147483648:0)|n+1023<<20|a}else t>0?(i.low=0,i.high=2146435072):(i.low=0,i.high=-1048576);return i};var h={};e["haxe.io._UInt32Array.UInt32Array_Impl_"]=h,h.__name__=["haxe","io","_UInt32Array","UInt32Array_Impl_"],h.fromArray=function(t,i,e){if(null==i&&(i=0),null==e&&(e=t.length-i),i<0||e<0||i+e>t.length)throw new js__$Boot_HaxeError(a.OutsideBounds);if(0==i&&e==t.length)return new Uint32Array(t);for(var n=new Uint32Array(t.length),s=0,r=e;s<r;){var h=s++;n[h]=0|t[h+i]}return n},h.fromBytes=function(t,i,e){return null==i&&(i=0),null==e&&(e=t.length-i>>2),new Uint32Array(t.b.bufferValue,i,e)};var o={};e["haxe.io._UInt8Array.UInt8Array_Impl_"]=o,o.__name__=["haxe","io","_UInt8Array","UInt8Array_Impl_"],o.fromBytes=function(t,i,e){return null==i&&(i=0),null==e&&(e=t.length-i),new O(t.b.bufferValue,i,e)};var haxe_rtti_Meta=function(){};e["haxe.rtti.Meta"]=haxe_rtti_Meta,haxe_rtti_Meta.__name__=["haxe","rtti","Meta"],haxe_rtti_Meta.getType=function(t){var i=haxe_rtti_Meta.getMeta(t);return null==i||null==i.obj?{}:i.obj},haxe_rtti_Meta.getMeta=function(t){return t.__meta__};var hxGeomAlgo_Debug=function(){};e["hxGeomAlgo.Debug"]=hxGeomAlgo_Debug,hxGeomAlgo_Debug.__name__=["hxGeomAlgo","Debug"],hxGeomAlgo_Debug.assert=function(t,i,e){};var hxGeomAlgo_HomogCoord=function(t,i,e){null==e&&(e=1),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.w=e};e["hxGeomAlgo.HomogCoord"]=hxGeomAlgo_HomogCoord,hxGeomAlgo_HomogCoord.__name__=["hxGeomAlgo","HomogCoord"],hxGeomAlgo_HomogCoord.det=function(t,i,e){return t.w*i.perpdot(e)-i.w*t.perpdot(e)+e.w*t.perpdot(i)},hxGeomAlgo_HomogCoord.ccw=function(t,i,e){return hxGeomAlgo_HomogCoord.det(t,i,e)>0},hxGeomAlgo_HomogCoord.cw=function(t,i,e){return hxGeomAlgo_HomogCoord.det(t,i,e)<0},hxGeomAlgo_HomogCoord.prototype={add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},neg:function(){return this.w=-this.w,this.x=-this.x,this.y=-this.y,this},mul:function(t){return this.w*=t,this.x*=t,this.y*=t,this},div:function(t){return this.w/=t,this.x/=t,this.y/=t,this},normalize:function(){return this.div(this.length())},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},perp:function(){var t=-this.y;return this.y=this.x,this.x=t,this},dotPoint:function(t){return this.w+this.x*t.x+this.y*t.y},dot:function(t){return this.w*t.w+this.x*t.x+this.y*t.y},perpdot:function(t){return this.x*t.y-this.y*t.x},dotperp:function(t){return-this.x*t.y+this.y*t.x},equals:function(t){return t.w*this.x==this.w*t.x&&t.w*this.y==this.w*t.y},left:function(t){return this.dotPoint(t)>0},right:function(t){return this.dotPoint(t)<0},toScreen:function(){return l._new(this.x/this.w,-this.y/this.w)},toPoint:function(){return l._new(this.x/this.w,this.y/this.w)},meet:function(t){return new hxGeomAlgo_HomogCoord(t.w*this.y-this.w*t.y,this.w*t.x-t.w*this.x,this.x*t.y-this.y*t.x)},meetPoint:function(t){return new hxGeomAlgo_HomogCoord(this.y-this.w*t.y,this.w*t.x-this.x,this.x*t.y-this.y*t.x)},toString:function(){return" (w:"+this.w+"; x:"+this.x+", y:"+this.y+")  "},__class__:hxGeomAlgo_HomogCoord};var l={};e["hxGeomAlgo._HxPoint.HxPoint_Impl_"]=l,l.__name__=["hxGeomAlgo","_HxPoint","HxPoint_Impl_"],l.get_x=function(t){return t.x},l.set_x=function(t,i){return t.x=i},l.get_y=function(t){return t.y},l.set_y=function(t,i){return t.y=i},l._new=function(t,i){return null==i&&(i=0),null==t&&(t=0),new hxGeomAlgo_HxPointData(t,i)},l.setTo=function(t,i,e){t.x=i,t.y=e},l.equals=function(t,i){return null!=t&&null!=i&&i.x==t.x&&i.y==t.y},l.notEequals=function(t,i){return!(null!=t&&null!=i&&i.x==t.x&&i.y==t.y)},l.clone=function(t){return l._new(t.x,t.y)},l.toString=function(t){return"("+t.x+", "+t.y+")"},l.fromPointStruct=function(t){return l._new(t.x,t.y)},l.toPointStruct=function(t){return{x:t.x,y:t.y}},l.areEqual=function(t,i){return null!=t&&null!=i&&i.x==t.x&&i.y==t.y},l.areNotEqual=function(t,i){return!(null!=t&&null!=i&&i.x==t.x&&i.y==t.y)};var hxGeomAlgo_HxPointData=function(t,i){null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i};e["hxGeomAlgo.HxPointData"]=hxGeomAlgo_HxPointData,hxGeomAlgo_HxPointData.__name__=["hxGeomAlgo","HxPointData"],hxGeomAlgo_HxPointData.prototype={__class__:hxGeomAlgo_HxPointData};var hxGeomAlgo_IsoContoursPixels=function(t,i){this.pixels=t,this.width=t.width,this.height=t.height,this.values=null,this.isoFunction=null!=i?i:hxGeomAlgo_IsoContoursPixels.isoAlpha};e["hxGeomAlgo.IsoContoursPixels"]=hxGeomAlgo_IsoContoursPixels,hxGeomAlgo_IsoContoursPixels.__name__=["hxGeomAlgo","IsoContoursPixels"],hxGeomAlgo_IsoContoursPixels.isoAlpha=function(t,i,e){if(i<0||e<0||i>=t.width||e>=t.height)return 0;var n=e*t.width+i<<2;return(t.bytes.b[n+t.format.ch0]<<24|t.bytes.b[n+t.format.ch1]<<16|t.bytes.b[n+t.format.ch2]<<8|t.bytes.b[n+t.format.ch3])>>24&255},hxGeomAlgo_IsoContoursPixels.isOutOfBounds=function(t,i,e){return i<0||e<0||i>=t.width||e>=t.height},hxGeomAlgo_IsoContoursPixels.prototype={find:function(t,i,e){return null==e&&(e=!0),null==i&&(i=!0),null==t&&(t=0),this.march(t,i,e),this.merge()},merge:function(){for(var t=[],i=null;null!=(i=this.adjacencyMap.getFirstSegment());){for(var e=i.from,n=i.to,s=[e],r=[n];n=this.adjacencyMap.getEndingPointOf(n),e=this.adjacencyMap.getStartingPointOf(e),null!=n&&r.push(n),null!=e&&s.push(e),null!=e||null!=n;);s.reverse(),t.push(s.concat(r))}return t},march:function(t,i,e){null==e&&(e=!0),null==i&&(i=!0),null==t&&(t=0),this.adjacencyMap=new hxGeomAlgo_AdjacencyMap;var n=this.width+2,s=this.height+2;if(e||null==this.values){var r=new Array(n*s);this.values=r;for(var a=0,h=s;a<h;)for(var o=a++,u=0,m=n;u<m;){var c=u++,f=o*n+c,x=this.isoFunction(this.pixels,c-1,o-1);this.values[f]=x}}var d=-.5,_=0,g=0,p=this.width+1,v=this.height+1;i||(_=1,g=1,p=this.width,v=this.height);for(var y=g,b=v;y<b;)for(var w=y++,z=_,Y=p;z<Y;){var S=z++,X=w*n+S,Z=this.values[X],P=this.values[X+1],T=this.values[X+1+n],L=this.values[X+n],I=0;if(Z>t&&(I+=8),P>t&&(I+=4),T>t&&(I+=2),L>t&&++I,0!=I&&15!=I){var O=l._new(d+S+this.interp(t,Z,P),d+w),E=l._new(d+S,d+w+this.interp(t,Z,L)),C=l._new(d+S+1,d+w+this.interp(t,P,T)),D=l._new(d+S+this.interp(t,L,T),d+w+1);if(5==I||10==I)(Z+P+T+L)/4<=0&&(I=15&~I);switch(I){case 1:this.adjacencyMap.addSegment(E,D);break;case 2:this.adjacencyMap.addSegment(D,C);break;case 3:this.adjacencyMap.addSegment(E,C);break;case 4:this.adjacencyMap.addSegment(C,O);break;case 5:this.adjacencyMap.addSegment(E,O),this.adjacencyMap.addSegment(C,D);break;case 6:this.adjacencyMap.addSegment(D,O);break;case 7:this.adjacencyMap.addSegment(E,O);break;case 8:this.adjacencyMap.addSegment(O,E);break;case 9:this.adjacencyMap.addSegment(O,D);break;case 10:this.adjacencyMap.addSegment(D,E),this.adjacencyMap.addSegment(O,C);break;case 11:this.adjacencyMap.addSegment(O,C);break;case 12:this.adjacencyMap.addSegment(C,E);break;case 13:this.adjacencyMap.addSegment(C,D);break;case 14:this.adjacencyMap.addSegment(D,E)}}}},interp:function(t,i,e){return i==e?0:(t-i)/(e-i)},__class__:hxGeomAlgo_IsoContoursPixels};var hxGeomAlgo_AdjacencyMap=function(){this.firstIdx=0,this.pointSet=new haxe_ds_StringMap,this.segments=[],this.mapStartToEnd=new haxe_ds_ObjectMap,this.mapEndToStart=new haxe_ds_ObjectMap};e["hxGeomAlgo.AdjacencyMap"]=hxGeomAlgo_AdjacencyMap,hxGeomAlgo_AdjacencyMap.__name__=["hxGeomAlgo","AdjacencyMap"],hxGeomAlgo_AdjacencyMap.prototype={addSegment:function(t,i){if(null==t||null==i||i.x!=t.x||i.y!=t.y){var e="("+t.x+", "+t.y+")",n="("+i.x+", "+i.y+")",s=this.pointSet;if(null!=Z[e]?s.existsReserved(e):s.h.hasOwnProperty(e)){var r=this.pointSet;t=null!=Z[e]?r.getReserved(e):r.h[e]}else{var a=this.pointSet;null!=Z[e]?a.setReserved(e,t):a.h[e]=t}var h=this.pointSet;if(null!=Z[n]?h.existsReserved(n):h.h.hasOwnProperty(n)){var o=this.pointSet;i=null!=Z[n]?o.getReserved(n):o.h[n]}else{var l=this.pointSet;null!=Z[n]?l.setReserved(n,i):l.h[n]=i}var u=this.segments.length;this.segments.push(new hxGeomAlgo__$IsoContoursPixels_Segment(t,i)),null!=this.mapStartToEnd.h.__keys__[t.__id__]?this.mapStartToEnd.h[t.__id__].push(u):this.mapStartToEnd.set(t,[u]),null!=this.mapEndToStart.h.__keys__[i.__id__]?this.mapEndToStart.h[i.__id__].push(u):this.mapEndToStart.set(i,[u])}},getStartingPointOf:function(t){if(null==t)return null;var i=null;if(null!=this.mapEndToStart.h.__keys__[t.__id__]){var e=this.mapEndToStart.h[t.__id__][0];i=this.segments[e].from,this.removeSegmentAt(e)}return i},getEndingPointOf:function(t){if(null==t)return null;var i=null;if(null!=this.mapStartToEnd.h.__keys__[t.__id__]){var e=this.mapStartToEnd.h[t.__id__][0];i=this.segments[e].to,this.removeSegmentAt(e)}return i},getFirstSegment:function(){for(var t=null,i=this.firstIdx,e=this.segments.length;i<e;){var n=i++;if(null!=(t=this.segments[n])){this.removeSegmentAt(n),this.firstIdx=n;break}}return t},removeSegmentAt:function(t){var i=this.segments[t],e=i.from,n=i.to,s=this.mapStartToEnd.h[e.__id__];HxOverrides.remove(s,t),0==s.length&&this.mapStartToEnd.remove(e),s=this.mapEndToStart.h[n.__id__],HxOverrides.remove(s,t),0==s.length&&this.mapEndToStart.remove(n),this.segments[t]=null},__class__:hxGeomAlgo_AdjacencyMap};var hxGeomAlgo__$IsoContoursPixels_Segment=function(t,i){this.from=t,this.to=i};e["hxGeomAlgo._IsoContoursPixels.Segment"]=hxGeomAlgo__$IsoContoursPixels_Segment,hxGeomAlgo__$IsoContoursPixels_Segment.__name__=["hxGeomAlgo","_IsoContoursPixels","Segment"],hxGeomAlgo__$IsoContoursPixels_Segment.prototype={__class__:hxGeomAlgo__$IsoContoursPixels_Segment};var hxGeomAlgo_PolyTools=function(){};e["hxGeomAlgo.PolyTools"]=hxGeomAlgo_PolyTools,hxGeomAlgo_PolyTools.__name__=["hxGeomAlgo","PolyTools"],hxGeomAlgo_PolyTools.isCCW=function(t){if(t.length<=2)return!0;for(var i=0,e=0,n=t.length;e<n;){for(var s=e++,r=s-1,a=t.length;r<0;)r+=a;for(var h=t[r%a].x*t[s].y,o=t[s].x,l=s-1,u=t.length;l<0;)l+=u;i+=h-o*t[l%u].y}return i<0},hxGeomAlgo_PolyTools.makeCCW=function(t){var i=!1;return hxGeomAlgo_PolyTools.isCCW(t)||(t.reverse(),i=!0),i},hxGeomAlgo_PolyTools.makeCW=function(t){var i=!1;return hxGeomAlgo_PolyTools.isCCW(t)&&(t.reverse(),i=!0),i},hxGeomAlgo_PolyTools.isConvex=function(t){for(var i=null,e=0,n=t.length;e<n;){var s=e++,r=0==s?t.length-1:s-1,a=s,h=s==t.length-1?0:s+1,o=t[a].x-t[r].x,l=t[a].y-t[r].y,u=t[h].x-t[a].x,m=o*(t[h].y-t[a].y)-u*l,c=m>0;if(0!=m)if(null==i)i=c;else if(i!=c)return!1}return!0},hxGeomAlgo_PolyTools.isSimple=function(t){var i=t.length;if(i<=3)return!0;for(var e=0,n=i;e<n;)for(var s=e++,r=s,a=s==i-1?0:s+1,h=s+1,o=i;h<o;){var l,u,m=h++,c=m,f=m==i-1?0:m+1,x=hxGeomAlgo_PolyTools.segmentIntersect(t[r],t[a],t[c],t[f]);if(null!=x){var d,_=t[r];if(null==x||null==_||_.x!=x.x||_.y!=x.y){var g=t[a];d=null!=x&&null!=g&&g.x==x.x&&g.y==x.y}else d=!0;u=!d}else u=!1;if(u){var p,v=t[c];if(null==x||null==v||v.x!=x.x||v.y!=x.y){var y=t[f];p=null!=x&&null!=y&&y.x==x.x&&y.y==x.y}else p=!0;l=!p}else l=!1;if(l)return!1}return!0},hxGeomAlgo_PolyTools.segmentIntersect=function(t,i,e,n){var s,r,a,h,o,u,m;r=i.y-t.y,h=t.x-i.x,u=i.x*t.y-t.x*i.y,a=n.y-e.y,o=e.x-n.x,m=n.x*e.y-e.x*n.y;var c=r*o-a*h;if(0==c)return null;(s=l._new()).x=(h*m-o*u)/c,s.y=(a*u-r*m)/c;var f=s.x-i.x,x=s.y-i.y,d=t.x-i.x,_=t.y-i.y;if(f*f+x*x>d*d+_*_)return null;var g=s.x-t.x,p=s.y-t.y,v=t.x-i.x,y=t.y-i.y;if(g*g+p*p>v*v+y*y)return null;var b=s.x-n.x,w=s.y-n.y,z=e.x-n.x,Y=e.y-n.y;if(b*b+w*w>z*z+Y*Y)return null;var S=s.x-e.x,X=s.y-e.y,Z=e.x-n.x,P=e.y-n.y;return S*S+X*X>Z*Z+P*P?null:s},hxGeomAlgo_PolyTools.findDuplicatePoints=function(t,i,e){null==e&&(e=!0),null==i&&(i=!0);var n=t.length;if(n<=1)return[];for(var s,r=[],a=0,h=n-1;a<h;)for(var o=a++,l=o+1;l<n;){var u=t[o],m=t[l],c=null!=u&&null!=m&&m.x==u.x&&m.y==u.y;if(c&&r.push(o),i||c&&!i)break;++l}if(e&&i){var f=t[0],x=t[n-1];s=null!=f&&null!=x&&x.x==f.x&&x.y==f.y}else s=!1;return s&&r.push(n-1),r},hxGeomAlgo_PolyTools.intersection=function(t,i,e,n){var s=null,r=i.y-t.y,a=t.x-i.x,h=r*t.x+a*t.y,o=n.y-e.y,u=e.x-n.x,m=o*e.x+u*e.y,c=r*u-o*a;return Math.abs(c)<=hxGeomAlgo_PolyTools.EPSILON||((s=l._new()).x=(u*h-a*m)/c,s.y=(r*m-o*h)/c),s},hxGeomAlgo_PolyTools.isReflex=function(t,i){for(var e=i-1,n=t.length;e<0;)e+=n;for(var s=t[e%n],r=i,a=t.length;r<0;)r+=a;for(var h=t[r%a],o=i+1,l=t.length;o<0;)o+=l;var u=t[o%l];return(h.x-s.x)*(u.y-s.y)-(u.x-s.x)*(h.y-s.y)<0},hxGeomAlgo_PolyTools.at=function(t,i){for(var e=t.length;i<0;)i+=e;return t[i%e]},hxGeomAlgo_PolyTools.side=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)},hxGeomAlgo_PolyTools.isLeft=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)>0},hxGeomAlgo_PolyTools.isLeftOrOn=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)>=0},hxGeomAlgo_PolyTools.isRight=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)<0},hxGeomAlgo_PolyTools.isRightOrOn=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)<=0},hxGeomAlgo_PolyTools.isCollinear=function(t,i,e){return(i.x-t.x)*(e.y-t.y)-(e.x-t.x)*(i.y-t.y)==0},hxGeomAlgo_PolyTools.distance=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},hxGeomAlgo_PolyTools.distanceToSegment=function(t,i,e){return Math.sqrt(hxGeomAlgo_PolyTools.distanceToSegmentSquared(t,i,e))},hxGeomAlgo_PolyTools.distanceSquared=function(t,i){var e=t.x-i.x,n=t.y-i.y;return e*e+n*n},hxGeomAlgo_PolyTools.distanceToSegmentSquared=function(t,i,e){var n=i.x-e.x,s=i.y-e.y,r=n*n+s*s;if(0==r){var a=t.x-i.x,h=t.y-i.y;return a*a+h*h}var o=((t.x-i.x)*(e.x-i.x)+(t.y-i.y)*(e.y-i.y))/r;if(o<0){var u=t.x-i.x,m=t.y-i.y;return u*u+m*m}if(o>1){var c=t.x-e.x,f=t.y-e.y;return c*c+f*f}l.setTo(hxGeomAlgo_PolyTools.point,i.x+o*(e.x-i.x),i.y+o*(e.y-i.y));var x=hxGeomAlgo_PolyTools.point,d=t.x-x.x,_=t.y-x.y;return d*d+_*_},hxGeomAlgo_PolyTools.meet=function(t,i){return new hxGeomAlgo_HomogCoord(t.y-i.y,i.x-t.x,t.x*i.y-t.y*i.x)},hxGeomAlgo_PolyTools.dot=function(t,i){return t.x*i.x+t.y*i.y},hxGeomAlgo_PolyTools.sqr=function(t){return t*t},hxGeomAlgo_PolyTools.eq=function(t,i){return Math.abs(t-i)<=hxGeomAlgo_PolyTools.EPSILON},hxGeomAlgo_PolyTools.clear=function(t){t.length=0},hxGeomAlgo_PolyTools.toFloatArray=function(t,i){i=null!=i?i:[];for(var e=0;e<t.length;){var n=t[e];++e,i.push(n.x),i.push(n.y)}return i},hxGeomAlgo_PolyTools.reverseFloatArray=function(t,i){null==i&&(i=!1);for(var e=i?t:[],n=t.length>>1,s=0,r=n;s<r;){var a=s++,h=2*(n-a-1);e[2*a]=t[h],e[2*a+1]=t[h+1]}return e},hxGeomAlgo_PolyTools.flatten=function(t,i){for(var e=null!=i?i:[],n=0;n<t.length;){var s=t[n];++n;for(var r=0;r<s.length;){var a=s[r];++r,e.push(a)}}return e},hxGeomAlgo_PolyTools.toPointArray=function(t,i){i=null!=i?i:[];var e=t.length;t.length%2==1&&--e;for(var n=0,s=e>>1;n<s;){var r=n++;i.push(l._new(t[2*r],t[2*r+1]))}return i};var u=e["hxGeomAlgo.WindingRule"]={__ename__:!0,__constructs__:["ODD","NON_ZERO","POSITIVE","NEGATIVE","ABS_GEQ_TWO"]};u.ODD=["ODD",0],u.ODD.toString=$estr,u.ODD.__enum__=u,u.NON_ZERO=["NON_ZERO",1],u.NON_ZERO.toString=$estr,u.NON_ZERO.__enum__=u,u.POSITIVE=["POSITIVE",2],u.POSITIVE.toString=$estr,u.POSITIVE.__enum__=u,u.NEGATIVE=["NEGATIVE",3],u.NEGATIVE.toString=$estr,u.NEGATIVE.__enum__=u,u.ABS_GEQ_TWO=["ABS_GEQ_TWO",4],u.ABS_GEQ_TWO.toString=$estr,u.ABS_GEQ_TWO.__enum__=u;var m=e["hxGeomAlgo.ResultType"]={__ename__:!0,__constructs__:["POLYGONS","CONNECTED_POLYGONS","BOUNDARY_CONTOURS"]};m.POLYGONS=["POLYGONS",0],m.POLYGONS.toString=$estr,m.POLYGONS.__enum__=m,m.CONNECTED_POLYGONS=["CONNECTED_POLYGONS",1],m.CONNECTED_POLYGONS.toString=$estr,m.CONNECTED_POLYGONS.__enum__=m,m.BOUNDARY_CONTOURS=["BOUNDARY_CONTOURS",2],m.BOUNDARY_CONTOURS.toString=$estr,m.BOUNDARY_CONTOURS.__enum__=m;var hxGeomAlgo_Tess2=function(){};e["hxGeomAlgo.Tess2"]=hxGeomAlgo_Tess2,hxGeomAlgo_Tess2.__name__=["hxGeomAlgo","Tess2"],hxGeomAlgo_Tess2.tesselate=function(t,i,e,n,s,r){null==s&&(s=2),null==n&&(n=3);for(var a=new hxGeomAlgo_Tesselator,h=0,o=t.length;h<o;){var l=h++;a.addContour(s,t[l])}return a.tesselate(null==i?u.ODD:i,null==e?m.POLYGONS:e,n,s,null==r?[0,0,1]:r),{vertices:a.vertices,vertexIndices:a.vertexIndices,vertexCount:a.vertexCount,elements:a.elements,elementCount:a.elementCount}},hxGeomAlgo_Tess2.getTotalAreaOfTriResult=function(t,i,e){null==e&&(e=!1);for(var n=0,s=t.elements.length,r=t.vertices,a=0;n<s;){var h=t.elements[n],o=t.elements[n+1],l=t.elements[n+2],u=r[1+(h<<1)],m=r[1+(o<<1)],c=r[1+(l<<1)],f=Math.abs(.5*(r[h<<1]*(m-c)+r[o<<1]*(c-u)+r[l<<1]*(u-m)));null!=i&&i.push(f),a+=f,n+=3}if(null!=i&&e)for(var x=0,d=i.length;x<d;){i[x++]/=a}return a},hxGeomAlgo_Tess2.getAreaOfTri2D=function(t,i,e,n,s,r){return Math.abs(.5*(t*(n-r)+e*(r-i)+s*(i-n)))},hxGeomAlgo_Tess2.pickRandomDistribIndex=function(t,i){null==i&&(i=1);for(var e=Math.random()*i,n=0,s=0,r=t.length;s<r;){var a=s++;if((n+=t[a])>=e)return a}return-1},hxGeomAlgo_Tess2.setRandomPointInTri2D=function(t,i,e,n,s,r,a){var h=n-i,o=s-e,l=r-i,u=a-e,m=Math.random(),c=Math.random(),f=h*m+l*c,x=o*m+u*c,d=r-n,_=a-s,g=_,p=-d;g*h+p*o<0&&(g=-g,p=-p),(f+=i)*g+(x+=e)*p>g*n+p*s&&(f=2*-(d=n+.5*d)-f,x=2*-(_=s+.5*_)-x),t.x=f,t.y=x},hxGeomAlgo_Tess2.union=function(t,i,e,n,s){null==s&&(s=2),null==n&&(n=3);var r=t.concat(i);return hxGeomAlgo_Tess2.tesselate(r,u.NON_ZERO,e,n,s)},hxGeomAlgo_Tess2.intersection=function(t,i,e,n,s){null==s&&(s=2),null==n&&(n=3);var r=t.concat(i);return hxGeomAlgo_Tess2.tesselate(r,u.ABS_GEQ_TWO,e,n,s)},hxGeomAlgo_Tess2.difference=function(t,i,e,n,s){null==s&&(s=2),null==n&&(n=3);for(var r=[],a=0;a<i.length;){var h=i[a];++a,r.push(hxGeomAlgo_PolyTools.reverseFloatArray(h))}var o=r,l=t.concat(o);return hxGeomAlgo_Tess2.tesselate(l,u.POSITIVE,e,n,s)},hxGeomAlgo_Tess2.convertResult=function(t,i,e,n,s){if(s=null!=s?s:[],2!=e[1])n>=3&&i.length;var r=0;switch(e[1]){case 0:for(;r<i.length;){for(var a=[],h=0,o=n;h<o;){var u=i[r+h++];-1!=u&&a.push(l._new(t[2*u],t[2*u+1]))}s.push(a),r+=n}break;case 1:for(;r<i.length;){for(var m=[],c=0,f=n;c<f;){var x=i[r+c++];-1!=x&&m.push(l._new(t[2*x],t[2*x+1]))}s.push(m),r+=2*n}break;case 2:for(;r<i.length;){for(var d=[],_=i[r],g=0,p=i[r+1];g<p;){var v=_+g++;d.push(l._new(t[2*v],t[2*v+1]))}s.push(d),r+=2}}return s};var hxGeomAlgo__$Tess2_TessVertex=function(){this.idx=0,this.n=0,this.pqHandle=0,this.t=0,this.s=0,this.coords=[0,0,0],this.anEdge=null,this.prev=null,this.next=null};e["hxGeomAlgo._Tess2.TessVertex"]=hxGeomAlgo__$Tess2_TessVertex,hxGeomAlgo__$Tess2_TessVertex.__name__=["hxGeomAlgo","_Tess2","TessVertex"],hxGeomAlgo__$Tess2_TessVertex.prototype={__class__:hxGeomAlgo__$Tess2_TessVertex};var hxGeomAlgo__$Tess2_TessFace=function(){this.inside=!1,this.marked=!1,this.n=0,this.trail=null,this.anEdge=null,this.prev=null,this.next=null};e["hxGeomAlgo._Tess2.TessFace"]=hxGeomAlgo__$Tess2_TessFace,hxGeomAlgo__$Tess2_TessFace.__name__=["hxGeomAlgo","_Tess2","TessFace"],hxGeomAlgo__$Tess2_TessFace.prototype={__class__:hxGeomAlgo__$Tess2_TessFace};var hxGeomAlgo__$Tess2_TessHalfEdge=function(t){this.winding=0,this.activeRegion=null,this.Lface=null,this.Org=null,this.Lnext=null,this.Onext=null,this.Sym=null,this.next=null,this.side=t};e["hxGeomAlgo._Tess2.TessHalfEdge"]=hxGeomAlgo__$Tess2_TessHalfEdge,hxGeomAlgo__$Tess2_TessHalfEdge.__name__=["hxGeomAlgo","_Tess2","TessHalfEdge"],hxGeomAlgo__$Tess2_TessHalfEdge.prototype={get_Rface:function(){return this.Sym.Lface},set_Rface:function(t){return this.Sym.Lface=t},get_Dst:function(){return this.Sym.Org},set_Dst:function(t){return this.Sym.Org=t},get_Oprev:function(){return this.Sym.Lnext},set_Oprev:function(t){return this.Sym.Lnext=t},get_Lprev:function(){return this.Onext.Sym},set_Lprev:function(t){return this.Onext.Sym=t},get_Dprev:function(){return this.Lnext.Sym},set_Dprev:function(t){return this.Lnext.Sym=t},get_Rprev:function(){return this.Sym.Onext},set_Rprev:function(t){return this.Sym.Onext=t},get_Dnext:function(){return this.Sym.Onext.Sym},set_Dnext:function(t){return this.Sym.Onext.Sym=t},get_Rnext:function(){return this.Sym.Lnext.Sym},set_Rnext:function(t){return this.Sym.Lnext.Sym=t},__class__:hxGeomAlgo__$Tess2_TessHalfEdge};var hxGeomAlgo__$Tess2_TessMesh=function(){this.eSym=new hxGeomAlgo__$Tess2_TessHalfEdge(1),this.e=new hxGeomAlgo__$Tess2_TessHalfEdge(0),this.f=new hxGeomAlgo__$Tess2_TessFace,this.v=new hxGeomAlgo__$Tess2_TessVertex,this.v.next=this.v.prev=this.v,this.v.anEdge=null,this.f.next=this.f.prev=this.f,this.f.anEdge=null,this.f.trail=null,this.f.marked=!1,this.f.inside=!1,this.e.next=this.e,this.e.Sym=this.eSym,this.e.Onext=null,this.e.Lnext=null,this.e.Org=null,this.e.Lface=null,this.e.winding=0,this.e.activeRegion=null,this.eSym.next=this.eSym,this.eSym.Sym=this.e,this.eSym.Onext=null,this.eSym.Lnext=null,this.eSym.Org=null,this.eSym.Lface=null,this.eSym.winding=0,this.eSym.activeRegion=null,this.vHead=this.v,this.fHead=this.f,this.eHead=this.e,this.eHeadSym=this.eSym};e["hxGeomAlgo._Tess2.TessMesh"]=hxGeomAlgo__$Tess2_TessMesh,hxGeomAlgo__$Tess2_TessMesh.__name__=["hxGeomAlgo","_Tess2","TessMesh"],hxGeomAlgo__$Tess2_TessMesh.prototype={makeEdge_:function(t){var i=new hxGeomAlgo__$Tess2_TessHalfEdge(0),e=new hxGeomAlgo__$Tess2_TessHalfEdge(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return e.next=n,n.Sym.next=i,i.next=t,t.Sym.next=e,i.Sym=e,i.Onext=i,i.Lnext=e,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,e.Sym=i,e.Onext=e,e.Lnext=i,e.Org=null,e.Lface=null,e.winding=0,e.activeRegion=null,i},splice_:function(t,i){var e=t.Onext,n=i.Onext;e.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=e},makeVertex_:function(t,i,e){var n=t,s=e.prev;n.prev=s,s.next=n,n.next=e,e.prev=n,n.anEdge=i;for(var r=i;r.Org=n,(r=r.Onext)!=i;);},makeFace_:function(t,i,e){var n=t,s=e.prev;n.prev=s,s.next=n,n.next=e,e.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=e.inside;for(var r=i;r.Lface=n,(r=r.Lnext)!=i;);},killEdge_:function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,e=t.Sym.next;i.Sym.next=e,e.Sym.next=i},killVertex_:function(t,i){for(var e=t.anEdge,n=e;n.Org=i,(n=n.Onext)!=e;);var s=t.prev,r=t.next;r.prev=s,s.next=r},killFace_:function(t,i){for(var e=t.anEdge,n=e;n.Lface=i,(n=n.Lnext)!=e;);var s=t.prev,r=t.next;r.prev=s,s.next=r},makeEdge:function(){var t=new hxGeomAlgo__$Tess2_TessVertex,i=new hxGeomAlgo__$Tess2_TessVertex,e=new hxGeomAlgo__$Tess2_TessFace,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(e,n,this.fHead),n},splice:function(t,i){var e=!1,n=!1;if(t!=i){if(i.Org!=t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!=t.Lface&&(e=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new hxGeomAlgo__$Tess2_TessVertex;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!e){var r=new hxGeomAlgo__$Tess2_TessFace;this.makeFace_(r,i,t.Lface),t.Lface.anEdge=t}}},delete:function(t){var i=t.Sym,e=!1;if(t.Lface!=t.get_Rface()&&(e=!0,this.killFace_(t.Lface,t.get_Rface())),t.Onext==t)this.killVertex_(t.Org,null);else if(t.get_Rface().anEdge=t.get_Oprev(),t.Org.anEdge=t.Onext,this.splice_(t,t.get_Oprev()),!e){var n=new hxGeomAlgo__$Tess2_TessFace;this.makeFace_(n,t,t.Lface)}i.Onext==i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.get_Oprev(),i.Org.anEdge=i.Onext,this.splice_(i,i.get_Oprev())),this.killEdge_(t)},addEdgeVertex:function(t){var i=this.makeEdge_(t),e=i.Sym;this.splice_(i,t.Lnext),i.Org=t.get_Dst();var n=new hxGeomAlgo__$Tess2_TessVertex;return this.makeVertex_(n,e,i.Org),i.Lface=e.Lface=t.Lface,i},splitEdge:function(t){var i=this.addEdgeVertex(t).Sym;return this.splice_(t.Sym,t.Sym.get_Oprev()),this.splice_(t.Sym,i),t.set_Dst(i.Org),i.get_Dst().anEdge=i.Sym,i.set_Rface(t.get_Rface()),i.winding=t.winding,i.Sym.winding=t.Sym.winding,i},connect:function(t,i){var e=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!=t.Lface&&(e=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.get_Dst(),s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!e){var r=new hxGeomAlgo__$Tess2_TessFace;this.makeFace_(r,n,t.Lface)}return n},zapFace:function(t){var i,e,n,s,r,a=t.anEdge;for(e=a.Lnext;e=(i=e).Lnext,i.Lface=null,null==i.get_Rface()&&(i.Onext==i?this.killVertex_(i.Org,null):(i.Org.anEdge=i.Onext,this.splice_(i,i.get_Oprev())),(n=i.Sym).Onext==n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.get_Oprev())),this.killEdge_(i)),i!=a;);s=t.prev,(r=t.next).prev=s,s.next=r},countFaceVerts_:function(t){for(var i=t.anEdge,e=0;++e,(i=i.Lnext)!=t.anEdge;);return e},mergeConvexFaces:function(t){var i,e,n,s,r;for(i=this.fHead.next;i!=this.fHead;)if(i.inside){for(r=(e=i.anEdge).Org;n=e.Lnext,null!=(s=e.Sym)&&null!=s.Lface&&s.Lface.inside&&this.countFaceVerts_(i)+this.countFaceVerts_(s.Lface)-2<=t&&hxGeomAlgo__$Tess2_Geom.vertCCW(e.get_Lprev().Org,e.Org,s.Lnext.Lnext.Org)&&hxGeomAlgo__$Tess2_Geom.vertCCW(s.get_Lprev().Org,s.Org,e.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),e=null,s=null),null==e||e.Lnext.Org!=r;)e=n;i=i.next}else i=i.next;return!0},check:function(){var t,i,e,n,s,r,a=this.fHead,h=this.vHead,o=this.eHead;for(i=a;(t=i.next)!=a;){t.prev;for(s=t.anEdge;;){s.Sym,s.Sym.Sym,s.Lnext.Onext.Sym,s.Onext.Sym.Lnext,s.Lface;if((s=s.Lnext)==t.anEdge)break}i=t}t.prev==i&&t.anEdge;for(n=h;(e=n.next)!=h;){e.prev;for(s=e.anEdge;;){s.Sym,s.Sym.Sym,s.Lnext.Onext.Sym,s.Onext.Sym.Lnext,s.Org;if((s=s.Onext)==e.anEdge)break}n=e}e.prev==n&&e.anEdge;for(r=o;(s=r.next)!=o;){s.Sym.next,r.Sym,s.Sym,s.Sym.Sym,s.Org,s.get_Dst(),s.Lnext.Onext.Sym,s.Onext.Sym.Lnext;r=s}s.Sym.next==r.Sym&&s.Sym==this.eHeadSym&&s.Sym.Sym==s&&null==s.Org&&null==s.get_Dst()&&null==s.Lface&&s.get_Rface()},__class__:hxGeomAlgo__$Tess2_TessMesh};var hxGeomAlgo__$Tess2_Geom=function(){};e["hxGeomAlgo._Tess2.Geom"]=hxGeomAlgo__$Tess2_Geom,hxGeomAlgo__$Tess2_Geom.__name__=["hxGeomAlgo","_Tess2","Geom"],hxGeomAlgo__$Tess2_Geom.vertEq=function(t,i){return t.s==i.s&&t.t==i.t},hxGeomAlgo__$Tess2_Geom.vertLeq=function(t,i){return t.s<i.s||t.s==i.s&&t.t<=i.t},hxGeomAlgo__$Tess2_Geom.transLeq=function(t,i){return t.t<i.t||t.t==i.t&&t.s<=i.s},hxGeomAlgo__$Tess2_Geom.edgeGoesLeft=function(t){return hxGeomAlgo__$Tess2_Geom.vertLeq(t.get_Dst(),t.Org)},hxGeomAlgo__$Tess2_Geom.edgeGoesRight=function(t){return hxGeomAlgo__$Tess2_Geom.vertLeq(t.Org,t.get_Dst())},hxGeomAlgo__$Tess2_Geom.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},hxGeomAlgo__$Tess2_Geom.edgeEval=function(t,i,e){hxGeomAlgo__$Tess2_Geom.vertLeq(t,i)&&hxGeomAlgo__$Tess2_Geom.vertLeq(i,e);var n=i.s-t.s,s=e.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-e.t)*(n/(n+s)):i.t-e.t+(e.t-t.t)*(s/(n+s)):0},hxGeomAlgo__$Tess2_Geom.edgeSign=function(t,i,e){hxGeomAlgo__$Tess2_Geom.vertLeq(t,i)&&hxGeomAlgo__$Tess2_Geom.vertLeq(i,e);var n=i.s-t.s,s=e.s-i.s;return n+s>0?(i.t-e.t)*n+(i.t-t.t)*s:0},hxGeomAlgo__$Tess2_Geom.transEval=function(t,i,e){hxGeomAlgo__$Tess2_Geom.transLeq(t,i)&&hxGeomAlgo__$Tess2_Geom.transLeq(i,e);var n=i.t-t.t,s=e.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-e.s)*(n/(n+s)):i.s-e.s+(e.s-t.s)*(s/(n+s)):0},hxGeomAlgo__$Tess2_Geom.transSign=function(t,i,e){hxGeomAlgo__$Tess2_Geom.transLeq(t,i)&&hxGeomAlgo__$Tess2_Geom.transLeq(i,e);var n=i.t-t.t,s=e.t-i.t;return n+s>0?(i.s-e.s)*n+(i.s-t.s)*s:0},hxGeomAlgo__$Tess2_Geom.vertCCW=function(t,i,e){return t.s*(i.t-e.t)+i.s*(e.t-t.t)+e.s*(t.t-i.t)>=0},hxGeomAlgo__$Tess2_Geom.interpolate=function(t,i,e,n){return t<0&&(t=0),e<0&&(e=0),t<=e?0==e?(i+n)/2:i+t/(t+e)*(n-i):n+e/(t+e)*(i-n)},hxGeomAlgo__$Tess2_Geom.intersect=function(t,i,e,n,s){var r,a,h;hxGeomAlgo__$Tess2_Geom.vertLeq(t,i)||(h=t,t=i,i=h),hxGeomAlgo__$Tess2_Geom.vertLeq(e,n)||(h=e,e=n,n=h),hxGeomAlgo__$Tess2_Geom.vertLeq(t,e)||(h=t,t=e,e=h,h=i,i=n,n=h),hxGeomAlgo__$Tess2_Geom.vertLeq(e,i)?hxGeomAlgo__$Tess2_Geom.vertLeq(i,n)?((r=hxGeomAlgo__$Tess2_Geom.edgeEval(t,e,i))+(a=hxGeomAlgo__$Tess2_Geom.edgeEval(e,i,n))<0&&(r=-r,a=-a),s.s=hxGeomAlgo__$Tess2_Geom.interpolate(r,e.s,a,i.s)):((r=hxGeomAlgo__$Tess2_Geom.edgeSign(t,e,i))+(a=-hxGeomAlgo__$Tess2_Geom.edgeSign(t,n,i))<0&&(r=-r,a=-a),s.s=hxGeomAlgo__$Tess2_Geom.interpolate(r,e.s,a,n.s)):s.s=(e.s+i.s)/2,hxGeomAlgo__$Tess2_Geom.transLeq(t,i)||(h=t,t=i,i=h),hxGeomAlgo__$Tess2_Geom.transLeq(e,n)||(h=e,e=n,n=h),hxGeomAlgo__$Tess2_Geom.transLeq(t,e)||(h=t,t=e,e=h,h=i,i=n,n=h),hxGeomAlgo__$Tess2_Geom.transLeq(e,i)?hxGeomAlgo__$Tess2_Geom.transLeq(i,n)?((r=hxGeomAlgo__$Tess2_Geom.transEval(t,e,i))+(a=hxGeomAlgo__$Tess2_Geom.transEval(e,i,n))<0&&(r=-r,a=-a),s.t=hxGeomAlgo__$Tess2_Geom.interpolate(r,e.t,a,i.t)):((r=hxGeomAlgo__$Tess2_Geom.transSign(t,e,i))+(a=-hxGeomAlgo__$Tess2_Geom.transSign(t,n,i))<0&&(r=-r,a=-a),s.t=hxGeomAlgo__$Tess2_Geom.interpolate(r,e.t,a,n.t)):s.t=(e.t+i.t)/2};var hxGeomAlgo__$Tess2_DictNode=function(){this.prev=null,this.next=null,this.key=null};e["hxGeomAlgo._Tess2.DictNode"]=hxGeomAlgo__$Tess2_DictNode,hxGeomAlgo__$Tess2_DictNode.__name__=["hxGeomAlgo","_Tess2","DictNode"],hxGeomAlgo__$Tess2_DictNode.prototype={__class__:hxGeomAlgo__$Tess2_DictNode};var hxGeomAlgo__$Tess2_Dict=function(t,i){this.head=new hxGeomAlgo__$Tess2_DictNode,this.head.next=this.head,this.head.prev=this.head,this.frame=t,this.leq=i};e["hxGeomAlgo._Tess2.Dict"]=hxGeomAlgo__$Tess2_Dict,hxGeomAlgo__$Tess2_Dict.__name__=["hxGeomAlgo","_Tess2","Dict"],hxGeomAlgo__$Tess2_Dict.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(t){return this.insertBefore(this.head,t)},search:function(t){for(var i=this.head;null!=(i=i.next).key&&!this.leq(this.frame,t,i.key););return i},insertBefore:function(t,i){for(;null!=(t=t.prev).key&&!this.leq(this.frame,t.key,i););var e=new hxGeomAlgo__$Tess2_DictNode;return e.key=i,e.next=t.next,t.next.prev=e,e.prev=t,t.next=e,e},delete:function(t){t.next.prev=t.prev,t.prev.next=t.next},__class__:hxGeomAlgo__$Tess2_Dict};var hxGeomAlgo__$Tess2_PQNode=function(){this.handle=-1};e["hxGeomAlgo._Tess2.PQNode"]=hxGeomAlgo__$Tess2_PQNode,hxGeomAlgo__$Tess2_PQNode.__name__=["hxGeomAlgo","_Tess2","PQNode"],hxGeomAlgo__$Tess2_PQNode.prototype={__class__:hxGeomAlgo__$Tess2_PQNode};var hxGeomAlgo__$Tess2_PQHandleElem=function(){this.node=-1,this.key=null};e["hxGeomAlgo._Tess2.PQHandleElem"]=hxGeomAlgo__$Tess2_PQHandleElem,hxGeomAlgo__$Tess2_PQHandleElem.__name__=["hxGeomAlgo","_Tess2","PQHandleElem"],hxGeomAlgo__$Tess2_PQHandleElem.prototype={__class__:hxGeomAlgo__$Tess2_PQHandleElem};var hxGeomAlgo__$Tess2_PriorityQ=function(t,i){this.size=0,this.max=t,this.nodes=[];for(var e=0,n=t+1;e<n;){var s=e++;this.nodes[s]=new hxGeomAlgo__$Tess2_PQNode}this.handles=[];for(var r=0,a=t+1;r<a;){var h=r++;this.handles[h]=new hxGeomAlgo__$Tess2_PQHandleElem}this.initialized=!1,this.freeList=0,this.leq=i,this.nodes[1].handle=1,this.handles[1].key=null};e["hxGeomAlgo._Tess2.PriorityQ"]=hxGeomAlgo__$Tess2_PriorityQ,hxGeomAlgo__$Tess2_PriorityQ.__name__=["hxGeomAlgo","_Tess2","PriorityQ"],hxGeomAlgo__$Tess2_PriorityQ.prototype={floatDown_:function(t){var i,e,n,s=this.nodes,r=this.handles;for(i=s[t].handle;;){(n=t<<1)<this.size&&this.leq(r[s[n+1].handle].key,r[s[n].handle].key)&&++n;this.max;if(e=s[n].handle,n>this.size||this.leq(r[i].key,r[e].key)){s[t].handle=i,r[i].node=t;break}s[t].handle=e,r[e].node=t,t=n}},floatUp_:function(t){var i,e,n,s=this.nodes,r=this.handles;for(i=s[t].handle;;){if(e=s[n=t>>1].handle,0==n||this.leq(r[e].key,r[i].key)){s[t].handle=i,r[i].node=t;break}s[t].handle=e,r[e].node=t,t=n}},init:function(){for(var t=this.size;t>=1;)this.floatDown_(t),--t;this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){return 0==this.size},insert:function(t){var i,e;if(2*(i=++this.size)>this.max){this.max*=2;for(var n=this.nodes.length,s=n,r=this.max+1;s<r;){var a=s++;this.nodes[a]=new hxGeomAlgo__$Tess2_PQNode}n=this.handles.length;for(var h=this.handles.length,o=this.max+1;h<o;){var l=h++;this.handles[l]=new hxGeomAlgo__$Tess2_PQHandleElem}}return 0==this.freeList?e=i:(e=this.freeList,this.freeList=this.handles[e].node),this.nodes[i].handle=e,this.handles[e].node=i,this.handles[e].key=t,this.initialized&&this.floatUp_(i),e},extractMin:function(){var t=this.nodes,i=this.handles,e=t[1].handle,n=i[e].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[e].key=null,i[e].node=this.freeList,this.freeList=e,--this.size,this.size>0&&this.floatDown_(1)),n},delete:function(t){var i,e=this.nodes,n=this.handles;t>=1&&t<=this.max&&n[t].key;e[i=n[t].node].handle=e[this.size].handle,n[e[i].handle].node=i,--this.size,i<=this.size&&(i<=1||this.leq(n[e[i>>1].handle].key,n[e[i].handle].key)?this.floatDown_(i):this.floatUp_(i)),n[t].key=null,n[t].node=this.freeList,this.freeList=t},__class__:hxGeomAlgo__$Tess2_PriorityQ};var hxGeomAlgo__$Tess2_ActiveRegion=function(){this.fixUpperEdge=!1,this.dirty=!1,this.sentinel=!1,this.inside=!1,this.windingNumber=0,this.nodeUp=null,this.eUp=null};e["hxGeomAlgo._Tess2.ActiveRegion"]=hxGeomAlgo__$Tess2_ActiveRegion,hxGeomAlgo__$Tess2_ActiveRegion.__name__=["hxGeomAlgo","_Tess2","ActiveRegion"],hxGeomAlgo__$Tess2_ActiveRegion.prototype={__class__:hxGeomAlgo__$Tess2_ActiveRegion};var hxGeomAlgo__$Tess2_Sweep=function(){};e["hxGeomAlgo._Tess2.Sweep"]=hxGeomAlgo__$Tess2_Sweep,hxGeomAlgo__$Tess2_Sweep.__name__=["hxGeomAlgo","_Tess2","Sweep"],hxGeomAlgo__$Tess2_Sweep.regionBelow=function(t){return t.nodeUp.prev.key},hxGeomAlgo__$Tess2_Sweep.regionAbove=function(t){return t.nodeUp.next.key},hxGeomAlgo__$Tess2_Sweep.debugEvent=function(t){},hxGeomAlgo__$Tess2_Sweep.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},hxGeomAlgo__$Tess2_Sweep.edgeLeq=function(t,i,e){var n=t.event,s=i.eUp,r=e.eUp;return s.get_Dst()==n?r.get_Dst()==n?hxGeomAlgo__$Tess2_Geom.vertLeq(s.Org,r.Org)?hxGeomAlgo__$Tess2_Geom.edgeSign(r.get_Dst(),s.Org,r.Org)<=0:hxGeomAlgo__$Tess2_Geom.edgeSign(s.get_Dst(),r.Org,s.Org)>=0:hxGeomAlgo__$Tess2_Geom.edgeSign(r.get_Dst(),n,r.Org)<=0:r.get_Dst()==n?hxGeomAlgo__$Tess2_Geom.edgeSign(s.get_Dst(),n,s.Org)>=0:hxGeomAlgo__$Tess2_Geom.edgeEval(s.get_Dst(),n,s.Org)>=hxGeomAlgo__$Tess2_Geom.edgeEval(r.get_Dst(),n,r.Org)},hxGeomAlgo__$Tess2_Sweep.deleteRegion=function(t,i){if(i.fixUpperEdge)i.eUp.winding;i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},hxGeomAlgo__$Tess2_Sweep.fixUpperEdge=function(t,i,e){i.fixUpperEdge;t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=e,e.activeRegion=i},hxGeomAlgo__$Tess2_Sweep.topLeftRegion=function(t,i){for(var e,n=i.eUp.Org;(i=hxGeomAlgo__$Tess2_Sweep.regionAbove(i)).eUp.Org==n;);if(i.fixUpperEdge){if(null==(e=t.mesh.connect(hxGeomAlgo__$Tess2_Sweep.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;hxGeomAlgo__$Tess2_Sweep.fixUpperEdge(t,i,e),i=hxGeomAlgo__$Tess2_Sweep.regionAbove(i)}return i},hxGeomAlgo__$Tess2_Sweep.topRightRegion=function(t){for(var i=t.eUp.get_Dst(),e=null;(e=hxGeomAlgo__$Tess2_Sweep.regionAbove(e)).eUp.get_Dst()==i;);return e},hxGeomAlgo__$Tess2_Sweep.addRegionBelow=function(t,i,e){var n=new hxGeomAlgo__$Tess2_ActiveRegion;return n.eUp=e,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,e.activeRegion=n,n},hxGeomAlgo__$Tess2_Sweep.isWindingInside=function(t,i){switch(t.windingRule[1]){case 0:return 0!=(1&i);case 1:return 0!=i;case 2:return i>0;case 3:return i<0;case 4:return!(i<2)||i<=-2}},hxGeomAlgo__$Tess2_Sweep.computeWinding=function(t,i){i.windingNumber=hxGeomAlgo__$Tess2_Sweep.regionAbove(i).windingNumber+i.eUp.winding,i.inside=hxGeomAlgo__$Tess2_Sweep.isWindingInside(t,i.windingNumber)},hxGeomAlgo__$Tess2_Sweep.finishRegion=function(t,i){var e=i.eUp,n=e.Lface;n.inside=i.inside,n.anEdge=e,hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,i)},hxGeomAlgo__$Tess2_Sweep.finishLeftRegions=function(t,i,e){for(var n,s=null,r=i,a=i.eUp;r!=e;){if(r.fixUpperEdge=!1,(n=(s=hxGeomAlgo__$Tess2_Sweep.regionBelow(r)).eUp).Org!=a.Org){if(!s.fixUpperEdge){hxGeomAlgo__$Tess2_Sweep.finishRegion(t,r);break}n=t.mesh.connect(a.get_Lprev(),n.Sym),hxGeomAlgo__$Tess2_Sweep.fixUpperEdge(t,s,n)}a.Onext!=n&&(t.mesh.splice(n.get_Oprev(),n),t.mesh.splice(a,n)),hxGeomAlgo__$Tess2_Sweep.finishRegion(t,r),a=s.eUp,r=s}return a},hxGeomAlgo__$Tess2_Sweep.addRightEdges=function(t,i,e,n,s,r){var a,h,o,l=null,u=!0;for(h=e;;){hxGeomAlgo__$Tess2_Geom.vertLeq(h.Org,h.get_Dst());if(hxGeomAlgo__$Tess2_Sweep.addRegionBelow(t,i,h.Sym),(h=h.Onext)==n)break}for(null==s&&(s=hxGeomAlgo__$Tess2_Sweep.regionBelow(i).eUp.get_Rprev()),a=i,o=s;(h=(l=hxGeomAlgo__$Tess2_Sweep.regionBelow(a)).eUp.Sym).Org==o.Org;)h.Onext!=o&&(t.mesh.splice(h.get_Oprev(),h),t.mesh.splice(o.get_Oprev(),h)),l.windingNumber=a.windingNumber-h.winding,l.inside=hxGeomAlgo__$Tess2_Sweep.isWindingInside(t,l.windingNumber),a.dirty=!0,!u&&hxGeomAlgo__$Tess2_Sweep.checkForRightSplice(t,a)&&(hxGeomAlgo__$Tess2_Sweep.addWinding(h,o),hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,a),t.mesh.delete(o)),u=!1,a=l,o=h;a.dirty=!0;a.windingNumber,h.winding,l.windingNumber;r&&hxGeomAlgo__$Tess2_Sweep.walkDirtyRegions(t,a)},hxGeomAlgo__$Tess2_Sweep.spliceMergeVertices=function(t,i,e){t.mesh.splice(i,e)},hxGeomAlgo__$Tess2_Sweep.vertexWeights=function(t,i,e){var n=hxGeomAlgo__$Tess2_Geom.vertL1dist(i,t),s=hxGeomAlgo__$Tess2_Geom.vertL1dist(e,t),r=.5*s/(n+s),a=.5*n/(n+s);t.coords[0]+=r*i.coords[0]+a*e.coords[0],t.coords[1]+=r*i.coords[1]+a*e.coords[1],t.coords[2]+=r*i.coords[2]+a*e.coords[2]},hxGeomAlgo__$Tess2_Sweep.getIntersectData=function(t,i,e,n,s,r){var a=i.coords[1]=i.coords[2]=0;i.coords[0]=a,i.idx=-1,hxGeomAlgo__$Tess2_Sweep.vertexWeights(i,e,n),hxGeomAlgo__$Tess2_Sweep.vertexWeights(i,s,r)},hxGeomAlgo__$Tess2_Sweep.checkForRightSplice=function(t,i){var e=hxGeomAlgo__$Tess2_Sweep.regionBelow(i),n=i.eUp,s=e.eUp;if(hxGeomAlgo__$Tess2_Geom.vertLeq(n.Org,s.Org)){if(hxGeomAlgo__$Tess2_Geom.edgeSign(s.get_Dst(),n.Org,s.Org)>0)return!1;hxGeomAlgo__$Tess2_Geom.vertEq(n.Org,s.Org)?n.Org!=s.Org&&(t.pq.delete(n.Org.pqHandle),hxGeomAlgo__$Tess2_Sweep.spliceMergeVertices(t,s.get_Oprev(),n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.get_Oprev()),i.dirty=e.dirty=!0)}else{if(hxGeomAlgo__$Tess2_Geom.edgeSign(n.get_Dst(),s.Org,n.Org)<0)return!1;hxGeomAlgo__$Tess2_Sweep.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.get_Oprev(),n)}return!0},hxGeomAlgo__$Tess2_Sweep.checkForLeftSplice=function(t,i){var e,n=hxGeomAlgo__$Tess2_Sweep.regionBelow(i),s=i.eUp,r=n.eUp;hxGeomAlgo__$Tess2_Geom.vertEq(s.get_Dst(),r.get_Dst());if(hxGeomAlgo__$Tess2_Geom.vertLeq(s.get_Dst(),r.get_Dst())){if(hxGeomAlgo__$Tess2_Geom.edgeSign(s.get_Dst(),r.get_Dst(),s.Org)<0)return!1;hxGeomAlgo__$Tess2_Sweep.regionAbove(i).dirty=i.dirty=!0,e=t.mesh.splitEdge(s),t.mesh.splice(r.Sym,e),e.Lface.inside=i.inside}else{if(hxGeomAlgo__$Tess2_Geom.edgeSign(r.get_Dst(),s.get_Dst(),r.Org)>0)return!1;i.dirty=n.dirty=!0,e=t.mesh.splitEdge(r),t.mesh.splice(s.Lnext,r.Sym),e.get_Rface().inside=i.inside}return!0},hxGeomAlgo__$Tess2_Sweep.checkForIntersect=function(t,i){var e,n,s=hxGeomAlgo__$Tess2_Sweep.regionBelow(i),r=i.eUp,a=s.eUp,h=r.Org,o=a.Org,l=r.get_Dst(),u=a.get_Dst(),m=new hxGeomAlgo__$Tess2_TessVertex;hxGeomAlgo__$Tess2_Geom.vertEq(u,l),hxGeomAlgo__$Tess2_Geom.edgeSign(l,t.event,h),hxGeomAlgo__$Tess2_Geom.edgeSign(u,t.event,o),h!=t.event&&t.event,!i.fixUpperEdge&&s.fixUpperEdge;if(h==o)return!1;if(Math.min(h.t,l.t)>Math.max(o.t,u.t))return!1;if(hxGeomAlgo__$Tess2_Geom.vertLeq(h,o)){if(hxGeomAlgo__$Tess2_Geom.edgeSign(u,h,o)>0)return!1}else if(hxGeomAlgo__$Tess2_Geom.edgeSign(l,o,h)<0)return!1;hxGeomAlgo__$Tess2_Sweep.debugEvent(t),hxGeomAlgo__$Tess2_Geom.intersect(l,h,u,o,m);Math.min(h.t,l.t),m.t,m.t,Math.max(o.t,u.t),Math.min(u.s,l.s),m.s,m.s,Math.max(o.s,h.s);return hxGeomAlgo__$Tess2_Geom.vertLeq(m,t.event)&&(m.s=t.event.s,m.t=t.event.t),e=hxGeomAlgo__$Tess2_Geom.vertLeq(h,o)?h:o,hxGeomAlgo__$Tess2_Geom.vertLeq(e,m)&&(m.s=e.s,m.t=e.t),hxGeomAlgo__$Tess2_Geom.vertEq(m,h)||hxGeomAlgo__$Tess2_Geom.vertEq(m,o)?(hxGeomAlgo__$Tess2_Sweep.checkForRightSplice(t,i),!1):!hxGeomAlgo__$Tess2_Geom.vertEq(l,t.event)&&hxGeomAlgo__$Tess2_Geom.edgeSign(l,t.event,m)>=0||!hxGeomAlgo__$Tess2_Geom.vertEq(u,t.event)&&hxGeomAlgo__$Tess2_Geom.edgeSign(u,t.event,m)<=0?u==t.event?(t.mesh.splitEdge(r.Sym),t.mesh.splice(a.Sym,r),i=hxGeomAlgo__$Tess2_Sweep.topLeftRegion(t,i),r=hxGeomAlgo__$Tess2_Sweep.regionBelow(i).eUp,hxGeomAlgo__$Tess2_Sweep.finishLeftRegions(t,hxGeomAlgo__$Tess2_Sweep.regionBelow(i),s),hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,i,r.get_Oprev(),r,r,!0),!0):l==t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(r.Lnext,a.get_Oprev()),s=i,i=hxGeomAlgo__$Tess2_Sweep.topRightRegion(i),n=hxGeomAlgo__$Tess2_Sweep.regionBelow(i).eUp.get_Rprev(),s.eUp=a.get_Oprev(),a=hxGeomAlgo__$Tess2_Sweep.finishLeftRegions(t,s,null),hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,i,a.Onext,r.get_Rprev(),n,!0),!0):(hxGeomAlgo__$Tess2_Geom.edgeSign(l,t.event,m)>=0&&(hxGeomAlgo__$Tess2_Sweep.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),r.Org.s=t.event.s,r.Org.t=t.event.t),hxGeomAlgo__$Tess2_Geom.edgeSign(u,t.event,m)<=0&&(i.dirty=s.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),!1):(t.mesh.splitEdge(r.Sym),t.mesh.splitEdge(a.Sym),t.mesh.splice(a.get_Oprev(),r),r.Org.s=m.s,r.Org.t=m.t,r.Org.pqHandle=t.pq.insert(r.Org),hxGeomAlgo__$Tess2_Sweep.getIntersectData(t,r.Org,h,l,o,u),hxGeomAlgo__$Tess2_Sweep.regionAbove(i).dirty=i.dirty=s.dirty=!0,!1)},hxGeomAlgo__$Tess2_Sweep.walkDirtyRegions=function(t,i){for(var e,n,s=hxGeomAlgo__$Tess2_Sweep.regionBelow(i);;){for(;s.dirty;)i=s,s=hxGeomAlgo__$Tess2_Sweep.regionBelow(s);if(!i.dirty&&(s=i,null==(i=hxGeomAlgo__$Tess2_Sweep.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,e=i.eUp,n=s.eUp,e.get_Dst()!=n.get_Dst()&&hxGeomAlgo__$Tess2_Sweep.checkForLeftSplice(t,i)&&(s.fixUpperEdge?(hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,s),t.mesh.delete(n),n=(s=hxGeomAlgo__$Tess2_Sweep.regionBelow(i)).eUp):i.fixUpperEdge&&(hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,i),t.mesh.delete(e),e=(i=hxGeomAlgo__$Tess2_Sweep.regionAbove(s)).eUp)),e.Org!=n.Org)if(e.get_Dst()==n.get_Dst()||i.fixUpperEdge||s.fixUpperEdge||e.get_Dst()!=t.event&&n.get_Dst()!=t.event)hxGeomAlgo__$Tess2_Sweep.checkForRightSplice(t,i);else if(hxGeomAlgo__$Tess2_Sweep.checkForIntersect(t,i))return;e.Org==n.Org&&e.get_Dst()==n.get_Dst()&&(hxGeomAlgo__$Tess2_Sweep.addWinding(n,e),hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,i),t.mesh.delete(e),i=hxGeomAlgo__$Tess2_Sweep.regionAbove(s))}},hxGeomAlgo__$Tess2_Sweep.connectRightVertex=function(t,i,e){var n,s=e.Onext,r=hxGeomAlgo__$Tess2_Sweep.regionBelow(i),a=i.eUp,h=r.eUp,o=!1;a.get_Dst()!=h.get_Dst()&&hxGeomAlgo__$Tess2_Sweep.checkForIntersect(t,i),hxGeomAlgo__$Tess2_Geom.vertEq(a.Org,t.event)&&(t.mesh.splice(s.get_Oprev(),a),i=hxGeomAlgo__$Tess2_Sweep.topLeftRegion(t,i),s=hxGeomAlgo__$Tess2_Sweep.regionBelow(i).eUp,hxGeomAlgo__$Tess2_Sweep.finishLeftRegions(t,hxGeomAlgo__$Tess2_Sweep.regionBelow(i),r),o=!0),hxGeomAlgo__$Tess2_Geom.vertEq(h.Org,t.event)&&(t.mesh.splice(e,h.get_Oprev()),e=hxGeomAlgo__$Tess2_Sweep.finishLeftRegions(t,r,null),o=!0),o?hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,i,e.Onext,s,s,!0):(n=hxGeomAlgo__$Tess2_Geom.vertLeq(h.Org,a.Org)?h.get_Oprev():a,n=t.mesh.connect(e.get_Lprev(),n),hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,hxGeomAlgo__$Tess2_Sweep.walkDirtyRegions(t,i))},hxGeomAlgo__$Tess2_Sweep.connectLeftDegenerate=function(t,i,e){var n,s,r,a,h;if(n=i.eUp,hxGeomAlgo__$Tess2_Geom.vertEq(n.Org,e))hxGeomAlgo__$Tess2_Sweep.spliceMergeVertices(t,n,e.anEdge);else{if(!hxGeomAlgo__$Tess2_Geom.vertEq(n.get_Dst(),e))return t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(e.anEdge,n),void hxGeomAlgo__$Tess2_Sweep.sweepEvent(t,e);i=hxGeomAlgo__$Tess2_Sweep.topRightRegion(i),s=a=(r=(h=hxGeomAlgo__$Tess2_Sweep.regionBelow(i)).eUp.Sym).Onext,h.fixUpperEdge&&(hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,h),t.mesh.delete(r),r=s.get_Oprev()),t.mesh.splice(e.anEdge,r),hxGeomAlgo__$Tess2_Geom.edgeGoesLeft(s)||(s=null),hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,i,r.Onext,a,s,!0)}},hxGeomAlgo__$Tess2_Sweep.connectLeftVertex=function(t,i){var e,n,s,r,a,h,o=new hxGeomAlgo__$Tess2_ActiveRegion;if(o.eUp=i.anEdge.Sym,e=t.dict.search(o).key,null!=(n=hxGeomAlgo__$Tess2_Sweep.regionBelow(e)))if(r=e.eUp,a=n.eUp,0!=hxGeomAlgo__$Tess2_Geom.edgeSign(r.get_Dst(),i,r.Org))if(s=hxGeomAlgo__$Tess2_Geom.vertLeq(a.get_Dst(),r.get_Dst())?e:n,e.inside||s.fixUpperEdge){if(s==e)h=t.mesh.connect(i.anEdge.Sym,r.Lnext);else h=t.mesh.connect(a.get_Dnext(),i.anEdge).Sym;s.fixUpperEdge?hxGeomAlgo__$Tess2_Sweep.fixUpperEdge(t,s,h):hxGeomAlgo__$Tess2_Sweep.computeWinding(t,hxGeomAlgo__$Tess2_Sweep.addRegionBelow(t,e,h)),hxGeomAlgo__$Tess2_Sweep.sweepEvent(t,i)}else hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,e,i.anEdge,i.anEdge,null,!0);else hxGeomAlgo__$Tess2_Sweep.connectLeftDegenerate(t,e,i)},hxGeomAlgo__$Tess2_Sweep.sweepEvent=function(t,i){t.event=i,hxGeomAlgo__$Tess2_Sweep.debugEvent(t);for(var e=i.anEdge;null==e.activeRegion;)if((e=e.Onext)==i.anEdge)return void hxGeomAlgo__$Tess2_Sweep.connectLeftVertex(t,i);var n=hxGeomAlgo__$Tess2_Sweep.topLeftRegion(t,e.activeRegion),s=hxGeomAlgo__$Tess2_Sweep.regionBelow(n),r=s.eUp,a=hxGeomAlgo__$Tess2_Sweep.finishLeftRegions(t,s,null);a.Onext==r?hxGeomAlgo__$Tess2_Sweep.connectRightVertex(t,n,a):hxGeomAlgo__$Tess2_Sweep.addRightEdges(t,n,a.Onext,r,r,!0)},hxGeomAlgo__$Tess2_Sweep.addSentinel=function(t,i,e,n){var s=new hxGeomAlgo__$Tess2_ActiveRegion,r=t.mesh.makeEdge();r.Org.s=e,r.Org.t=n,r.get_Dst().s=i,r.get_Dst().t=n,t.event=r.get_Dst(),s.eUp=r,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},hxGeomAlgo__$Tess2_Sweep.initEdgeDict=function(t){t.dict=new hxGeomAlgo__$Tess2_Dict(t,hxGeomAlgo__$Tess2_Sweep.edgeLeq);var i=t.bmax[0]-t.bmin[0],e=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,r=t.bmin[1]-e,a=t.bmax[1]+e;hxGeomAlgo__$Tess2_Sweep.addSentinel(t,n,s,r),hxGeomAlgo__$Tess2_Sweep.addSentinel(t,n,s,a)},hxGeomAlgo__$Tess2_Sweep.doneEdgeDict=function(t){for(var i,e=0;null!=(i=t.dict.min().key);){if(!i.sentinel)i.fixUpperEdge,++e;i.windingNumber;hxGeomAlgo__$Tess2_Sweep.deleteRegion(t,i)}},hxGeomAlgo__$Tess2_Sweep.removeDegenerateEdges=function(t){var i,e,n,s=t.mesh.eHead;for(i=s.next;i!=s;)e=i.next,n=i.Lnext,hxGeomAlgo__$Tess2_Geom.vertEq(i.Org,i.get_Dst())&&i.Lnext.Lnext!=i&&(hxGeomAlgo__$Tess2_Sweep.spliceMergeVertices(t,n,i),t.mesh.delete(i),n=(i=n).Lnext),n.Lnext==i&&(n!=i&&(n!=e&&n!=e.Sym||(e=e.next),t.mesh.delete(n)),i!=e&&i!=e.Sym||(e=e.next),t.mesh.delete(i)),i=e},hxGeomAlgo__$Tess2_Sweep.initPriorityQ=function(t){var i,e,n,s=0;for(e=(n=t.mesh.vHead).next;e!=n;)++s,e=e.next;for(s+=8,i=t.pq=new hxGeomAlgo__$Tess2_PriorityQ(s,hxGeomAlgo__$Tess2_Geom.vertLeq),e=(n=t.mesh.vHead).next;e!=n;)e.pqHandle=i.insert(e),e=e.next;return e==n&&(i.init(),!0)},hxGeomAlgo__$Tess2_Sweep.donePriorityQ=function(t){t.pq=null},hxGeomAlgo__$Tess2_Sweep.removeDegenerateFaces=function(t,i){var e,n,s;for(e=i.fHead.next;e!=i.fHead;){n=e.next;(s=e.anEdge).Lnext;s.Lnext.Lnext==s&&(hxGeomAlgo__$Tess2_Sweep.addWinding(s.Onext,s),t.mesh.delete(s)),e=n}return!0},hxGeomAlgo__$Tess2_Sweep.computeInterior=function(t){var i,e;if(hxGeomAlgo__$Tess2_Sweep.removeDegenerateEdges(t),!hxGeomAlgo__$Tess2_Sweep.initPriorityQ(t))return!1;hxGeomAlgo__$Tess2_Sweep.initEdgeDict(t);for(t.pq;null!=(i=t.pq.extractMin());){for(;null!=(e=t.pq.min())&&hxGeomAlgo__$Tess2_Geom.vertEq(e,i);)e=t.pq.extractMin(),hxGeomAlgo__$Tess2_Sweep.spliceMergeVertices(t,i.anEdge,e.anEdge);hxGeomAlgo__$Tess2_Sweep.sweepEvent(t,i)}return t.event=t.dict.min().key.eUp.Org,hxGeomAlgo__$Tess2_Sweep.debugEvent(t),hxGeomAlgo__$Tess2_Sweep.doneEdgeDict(t),hxGeomAlgo__$Tess2_Sweep.donePriorityQ(t),!!hxGeomAlgo__$Tess2_Sweep.removeDegenerateFaces(t,t.mesh)&&(t.mesh.check(),!0)};var hxGeomAlgo_Tesselator=function(){this.elementCount=0,this.elements=[],this.vertexCount=0,this.vertexIndices=[],this.vertices=[],this.vertexIndexCounter=0,this.event=null,this.pq=null,this.dict=null,this.bmax=[0,0],this.bmin=[0,0],this.tUnit=[0,0,0],this.sUnit=[0,0,0],this.normal=[0,0,0],this.mesh=null,this.windingRule=u.ODD};e["hxGeomAlgo.Tesselator"]=hxGeomAlgo_Tesselator,hxGeomAlgo_Tesselator.__name__=["hxGeomAlgo","Tesselator"],hxGeomAlgo_Tesselator.prototype={dot_:function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},normalize_:function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},longAxis_:function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},computeNormal_:function(t){var i,e,n,s,r,a,h,o=[0,0,0],l=[0,0,0],u=[0,0,0],m=0,c=0,f=0,x=0,d=0,_=0,g=[null,null,null],p=[null,null,null],v=this.mesh.vHead;i=v.next;for(var y=0;y<3;){var b=y++;s=i.coords[b],l[b]=s,p[b]=i,o[b]=s,g[b]=i}for(i=v.next;i!=v;){for(var w=0;w<3;){var z=w++;(s=i.coords[z])<l[z]&&(l[z]=s,p[z]=i),s>o[z]&&(o[z]=s,g[z]=i)}i=i.next}if(h=0,o[1]-l[1]>o[0]-l[0]&&(h=1),o[2]-l[2]>o[h]-l[h]&&(h=2),l[h]>=o[h])return t[0]=0,t[1]=0,void(t[2]=1);for(a=0,e=p[h],n=g[h],u[0]=e.coords[0]-n.coords[0],u[1]=e.coords[1]-n.coords[1],u[2]=e.coords[2]-n.coords[2],i=v.next;i!=v;)m=i.coords[0]-n.coords[0],c=i.coords[1]-n.coords[1],f=i.coords[2]-n.coords[2],(r=(x=u[1]*f-u[2]*c)*x+(d=u[2]*m-u[0]*f)*d+(_=u[0]*c-u[1]*m)*_)>a&&(a=r,t[0]=x,t[1]=d,t[2]=_),i=i.next;a<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},checkOrientation_:function(){var t,i,e,n,s=this.mesh.fHead,r=this.mesh.vHead;for(t=0,i=s.next;i!=s;)if((n=i.anEdge).winding<=0)i=i.next;else{for(;t+=(n.Org.s-n.get_Dst().s)*(n.Org.t+n.get_Dst().t),(n=n.Lnext)!=i.anEdge;);i=i.next}if(t<0){for(e=r.next;e!=r;)e.t=-e.t,e=e.next;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var t,i,e,n,s,r=this.mesh.vHead,a=[0,0,0],h=!1;for(a[0]=this.normal[0],a[1]=this.normal[1],a[2]=this.normal[2],0==a[0]&&0==a[1]&&0==a[2]&&(this.computeNormal_(a),h=!0),i=this.sUnit,e=this.tUnit,i[n=this.longAxis_(a)]=0,i[(n+1)%3]=1,i[(n+2)%3]=0,e[n]=0,e[(n+1)%3]=0,e[(n+2)%3]=a[n]>0?1:-1,t=r.next;t!=r;)t.s=this.dot_(t.coords,i),t.t=this.dot_(t.coords,e),t=t.next;for(h&&this.checkOrientation_(),s=!0,t=r.next;t!=r;){if(s){var o=this.bmax[0]=t.s;this.bmin[0]=o;var l=this.bmax[1]=t.t;this.bmin[1]=l,s=!1}else t.s<this.bmin[0]&&(this.bmin[0]=t.s),t.s>this.bmax[0]&&(this.bmax[0]=t.s),t.t<this.bmin[1]&&(this.bmin[1]=t.t),t.t>this.bmax[1]&&(this.bmax[1]=t.t);t=t.next}},addWinding_:function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},tessellateMonoRegion_:function(t,i){var e,n;for((e=i.anEdge).Lnext!=e&&e.Lnext.Lnext;hxGeomAlgo__$Tess2_Geom.vertLeq(e.get_Dst(),e.Org);)e=e.get_Lprev();for(;hxGeomAlgo__$Tess2_Geom.vertLeq(e.Org,e.get_Dst());)e=e.Lnext;for(n=e.get_Lprev();e.Lnext!=n;)if(hxGeomAlgo__$Tess2_Geom.vertLeq(e.get_Dst(),n.Org)){for(;n.Lnext!=e&&(hxGeomAlgo__$Tess2_Geom.edgeGoesLeft(n.Lnext)||hxGeomAlgo__$Tess2_Geom.edgeSign(n.Org,n.get_Dst(),n.Lnext.get_Dst())<=0);){n=t.connect(n.Lnext,n).Sym}n=n.get_Lprev()}else{for(;n.Lnext!=e&&(hxGeomAlgo__$Tess2_Geom.edgeGoesRight(e.get_Lprev())||hxGeomAlgo__$Tess2_Geom.edgeSign(e.get_Dst(),e.Org,e.get_Lprev().Org)>=0);){var s=t.connect(e,e.get_Lprev());e=s.Sym}e=e.Lnext}for(n.Lnext;n.Lnext.Lnext!=e;){n=t.connect(n.Lnext,n).Sym}return!0},tessellateInterior_:function(t){var i,e;for(i=t.fHead.next;i!=t.fHead;){if(e=i.next,i.inside&&!this.tessellateMonoRegion_(t,i))return!1;i=e}return!0},discardExterior_:function(t){var i,e;for(i=t.fHead.next;i!=t.fHead;)e=i.next,i.inside||t.zapFace(i),i=e},setWindingNumber_:function(t,i,e){var n,s;for(n=t.eHead.next;n!=t.eHead;)s=n.next,n.get_Rface().inside!=n.Lface.inside?n.winding=n.Lface.inside?i:-i:e?t.delete(n):n.winding=0,n=s},getNeighbourFace_:function(t){return null==t.get_Rface()?-1:t.get_Rface().inside?t.get_Rface().n:-1},outputPolymesh_:function(t,i,e,n){var s,r,a,h,o=0,l=0;for(e>3&&t.mergeConvexFaces(e),s=t.vHead.next;s!=t.vHead;)s.n=-1,s=s.next;for(r=t.fHead.next;r!=t.fHead;)if(r.n=-1,r.inside){for(a=r.anEdge,h=0;-1==(s=a.Org).n&&(s.n=l,++l),++h,(a=a.Lnext)!=r.anEdge;);r.n=o,++o,r=r.next}else r=r.next;for(this.elementCount=o,i==m.CONNECTED_POLYGONS&&(o*=2),this.elements=[],this.vertexCount=l,this.vertices=[],this.vertexIndices=[],s=t.vHead.next;s!=t.vHead;){if(-1!=s.n){var u=s.n*n;this.vertices[u]=s.coords[0],this.vertices[u+1]=s.coords[1],n>2&&(this.vertices[u+2]=s.coords[2]),this.vertexIndices[s.n]=s.idx}s=s.next}var c=0;for(r=t.fHead.next;r!=t.fHead;)if(r.inside){for(a=r.anEdge,h=0;s=a.Org,this.elements[c++]=s.n,++h,(a=a.Lnext)!=r.anEdge;);for(var f=h,x=e;f<x;){f++;this.elements[c++]=-1}if(i==m.CONNECTED_POLYGONS){for(a=r.anEdge;this.elements[c++]=this.getNeighbourFace_(a),(a=a.Lnext)!=r.anEdge;);for(var d=h,_=e;d<_;){d++;this.elements[c++]=-1}}r=r.next}else r=r.next},outputContours_:function(t,i){var e,n,s,r=0,a=0;for(this.vertexCount=0,this.elementCount=0,e=t.fHead.next;e!=t.fHead;)if(e.inside){for(s=n=e.anEdge;this.vertexCount++,(n=n.Lnext)!=s;);this.elementCount++,e=e.next}else e=e.next;this.elements=[],this.vertices=[],this.vertexIndices=[];var h=0,o=0,l=0;for(r=0,e=t.fHead.next;e!=t.fHead;)if(e.inside){for(a=0,s=n=e.anEdge;this.vertices[h++]=n.Org.coords[0],this.vertices[h++]=n.Org.coords[1],i>2&&(this.vertices[h++]=n.Org.coords[2]),this.vertexIndices[o++]=n.Org.idx,++a,(n=n.Lnext)!=s;);this.elements[l++]=r,this.elements[l++]=a,r+=a,e=e.next}else e=e.next},addContour:function(t,i){var e,n;for(null==this.mesh&&(this.mesh=new hxGeomAlgo__$Tess2_TessMesh),t<2&&(t=2),t>3&&(t=3),e=null,n=0;n<i.length;)null==e?(e=this.mesh.makeEdge(),this.mesh.splice(e,e.Sym)):(this.mesh.splitEdge(e),e=e.Lnext),e.Org.coords[0]=i[n],e.Org.coords[1]=i[n+1],e.Org.coords[2]=t>2?i[n+2]:0,e.Org.idx=this.vertexIndexCounter++,e.winding=1,e.Sym.winding=-1,n+=t},tesselate:function(t,i,e,n,s){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,null!=s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),null==this.mesh)return!1;this.projectPolygon_(),hxGeomAlgo__$Tess2_Sweep.computeInterior(this);var r=this.mesh;return i==m.BOUNDARY_CONTOURS?this.setWindingNumber_(r,1,!0):this.tessellateInterior_(r),r.check(),i==m.BOUNDARY_CONTOURS?this.outputContours_(r,n):this.outputPolymesh_(r,i,e,n),!0},__class__:hxGeomAlgo_Tesselator};var c=t.Pixels={};e.Pixels=c,c.__name__=["Pixels"],c._new=function(t,i,e){return null==e&&(e=!0),new hxPixels__$Pixels_PixelsData(t,i,e)},c.getByte=function(t,i){return t.bytes.b[(-4&i)+t.format.channelMap[3&i]]},c.isMatchingPixel=function(t,i,e){return null==e&&(e=0),Math.abs((t>>16&255)-(i>>16&255))<=e&&Math.abs((t>>8&255)-(i>>8&255))<=e&&Math.abs((255&t)-(255&i))<=e},c.newPixel=function(t,i,e){return-16777216|(255&t)<<16|(255&i)<<8|e},c.newPixel32=function(t,i,e,n){return(255&n)<<24|(255&t)<<16|(255&i)<<8|e},c.isMatchingPixelAt=function(t,i,e,n,s){null==s&&(s=0);var r=e*t.width+i<<2,a=t.bytes.b[r+t.format.ch1]<<16,h=t.bytes.b[r+t.format.ch2]<<8,o=t.bytes.b[r+t.format.ch3];return c.isMatchingPixel(a|h|o,n,s)},c.getRawInt32=function(t,i){return t.bytes.getInt32(i<<2)},c.getRawPixel32=function(t,i,e){var n=e*t.width+i<<2;return t.bytes.getInt32(n)},c.getPixel=function(t,i,e){var n=e*t.width+i<<2;return t.bytes.b[n+t.format.ch1]<<16|t.bytes.b[n+t.format.ch2]<<8|t.bytes.b[n+t.format.ch3]},c.getPixel32=function(t,i,e){var n=e*t.width+i<<2;return t.bytes.b[n+t.format.ch0]<<24|t.bytes.b[n+t.format.ch1]<<16|t.bytes.b[n+t.format.ch2]<<8|t.bytes.b[n+t.format.ch3]},c.setByte=function(t,i,e){t.bytes.b[(-4&i)+t.format.channelMap[3&i]]=255&e},c.setRawInt32=function(t,i,e){t.bytes.setInt32(i<<2,e)},c.setRawPixel32=function(t,i,e,n){var s=e*t.width+i<<2;t.bytes.setInt32(s,n)},c.setPixel=function(t,i,e,n){var s=e*t.width+i<<2,r=n>>16&255,a=n>>8&255,h=255&n;t.bytes.b[s+t.format.ch1]=255&r,t.bytes.b[s+t.format.ch2]=255&a,t.bytes.b[s+t.format.ch3]=255&h},c.setPixel32=function(t,i,e,n){var s=e*t.width+i<<2,r=n>>24&255,a=n>>16&255,h=n>>8&255,o=255&n;t.bytes.b[s+t.format.ch0]=255&r,t.bytes.b[s+t.format.ch1]=255&a,t.bytes.b[s+t.format.ch2]=255&h,t.bytes.b[s+t.format.ch3]=255&o},c.fillRect=function(t,i,e,n,s,r){var a=e*t.width+i<<2,h=new hxPixels__$Pixels_PixelsData(n,1,!0);h.format=t.format;for(var o=n<<2,l=0,u=n;l<u;){var m=l++,c=0*h.width+m<<2,f=r>>24&255,x=r>>16&255,d=r>>8&255,_=255&r;h.bytes.b[c+h.format.ch0]=255&f,h.bytes.b[c+h.format.ch1]=255&x,h.bytes.b[c+h.format.ch2]=255&d,h.bytes.b[c+h.format.ch3]=255&_}for(var g=0,p=s;g<p;){g++;t.bytes.blit(a,h.bytes,0,o),a+=t.width<<2}},c.clone=function(t){var i=new hxPixels__$Pixels_PixelsData(t.width,t.height,!0);return i.bytes.blit(0,t.bytes,0,t.bytes.length),i.format=t.format,i},c.fromBytes=function(t,i,e,n){var s=new hxPixels__$Pixels_PixelsData(i,e,!1);return s.format=null!=n?n:f.ARGB,s.bytes=t,s.uint8Array=o.fromBytes(t),s.uint32Array=h.fromBytes(t),s},c.convertTo=function(t,i){return c.convert(t,i,!0)},c.convert=function(t,i,e){null==e&&(e=!1);var n=e?t:c.clone(t);if(i==t.format)return n;var s=0,r=0;if(t.format==f.BGRA&&i==f.RGBA||t.format==f.RGBA&&i==f.BGRA)for(;s<t.count;){var a=r+1,h=t.bytes.b[(-4&a)+t.format.channelMap[3&a]],o=r+3,l=t.bytes.b[(-4&o)+t.format.channelMap[3&o]];n.bytes.b[r+i.ch1]=255&h,n.bytes.b[r+i.ch3]=255&l,++s,r+=4}else for(;s<t.count;){var u=t.bytes.b[(-4&r)+t.format.channelMap[3&r]],m=r+1,x=t.bytes.b[(-4&m)+t.format.channelMap[3&m]],d=r+2,_=t.bytes.b[(-4&d)+t.format.channelMap[3&d]],g=r+3,p=t.bytes.b[(-4&g)+t.format.channelMap[3&g]];n.bytes.b[r+i.ch0]=255&u,n.bytes.b[r+i.ch1]=255&x,n.bytes.b[r+i.ch2]=255&_,n.bytes.b[r+i.ch3]=255&p,++s,r+=4}return n.format=i,n},c.fromImageData=function(t){var i=new hxPixels__$Pixels_PixelsData(t.width,t.height,!1);i.format=f.RGBA;var e=t.data,n=haxe_io_Bytes.ofData(e.buffer);return i.bytes=n,i.uint8Array=o.fromBytes(n),i.uint32Array=h.fromBytes(n),i},c.applyToImageData=function(t,i){var e=new Uint8ClampedArray(t.bytes.b.bufferValue);return i.data.set(e),i};var hxPixels__$Pixels_PixelsData=function(t,i,e,n){if(null==e&&(e=!0),this.uint32Array=null,this.uint8Array=null,this.count=t*i,e){var s=new haxe_io_Bytes(new P(this.count<<2));this.bytes=s,this.uint8Array=o.fromBytes(s),this.uint32Array=h.fromBytes(s)}this.width=t,this.height=i,this.format=null!=n?n:f.ARGB};e["hxPixels._Pixels.PixelsData"]=hxPixels__$Pixels_PixelsData,hxPixels__$Pixels_PixelsData.__name__=["hxPixels","_Pixels","PixelsData"],hxPixels__$Pixels_PixelsData.prototype={set_bytes:function(t){return this.bytes=t,this.uint8Array=o.fromBytes(t),this.uint32Array=h.fromBytes(t),this.bytes},__class__:hxPixels__$Pixels_PixelsData};var f=t.hxPixels.PixelFormat=function(t,i,e,n,s){null==s&&(s="PixelFormat"),this.channelMap=[t,i,e,n],this.ch0=t,this.ch1=i,this.ch2=e,this.ch3=n,this.name=s};e["hxPixels.PixelFormat"]=f,f.__name__=["hxPixels","PixelFormat"],f.convert=function(t,i,e){return(t>>8*(3-i.ch0)&255)<<8*(3-e.ch0)|(t>>8*(3-i.ch1)&255)<<8*(3-e.ch1)|(t>>8*(3-i.ch2)&255)<<8*(3-e.ch2)|(t>>8*(3-i.ch3)&255)<<8*(3-e.ch3)},f.getNativeFormatFor=function(t){switch(t){case"flambe flash":case"flash":case"nme desktop":case"nme flash":case"openfl flash":return f.ARGB;case"format":return f.BGRA;case"java":return f.RGBA;case"openfl desktop":return f.BGRA;case"flambe web":case"js":case"luxe":case"openfl js":return f.RGBA;default:throw new js__$Boot_HaxeError("Unhandled target!")}},f.prototype={get_A:function(){return this.ch0},get_R:function(){return this.ch1},get_G:function(){return this.ch2},get_B:function(){return this.ch3},toString:function(){return this.name},__class__:f};var x={};e["hxPixels._Pixels.Channel_Impl_"]=x,x.__name__=["hxPixels","_Pixels","Channel_Impl_"];var d=t.Pixel={};e.Pixel=d,d.__name__=["Pixel"],d.fclamp=function(t){return t<=0?0:t>=1?1:t},d.iclamp=function(t){return t<=0?0:t>=255?255:t},d.iround=function(t){return t+.5|0},d.multiplyAlpha=function(t){var i=(t>>24&255)/255,e=i*(t>>16&255)+.5|0,n=i*(t>>8&255)+.5|0,s=i*(255&t)+.5|0;return-16777216&t|(e<=0?0:e>=255?255:e)<<16|(n<=0?0:n>=255?255:n)<<8|(s<=0?0:s>=255?255:s)},d.unmultiplyAlpha=function(t){var i=1/((t>>24&255)/255+1e-8),e=i*(t>>16&255)+.5|0,n=i*(t>>8&255)+.5|0,s=i*(255&t)+.5|0;return-16777216&t|(e<=0?0:e>=255?255:e)<<16|(n<=0?0:n>=255?255:n)<<8|(s<=0?0:s>=255?255:s)},d.create=function(t,i,e,n){return(255&t)<<24|(255&i)<<16|(255&e)<<8|n},d.fcreate=function(t,i,e,n){return(255&(255*t|0))<<24|(255&(255*i|0))<<16|(255&(255*e|0))<<8|255*n|0},d.getChannel=function(t,i){return t>>8*(3-i)&255},d.setChannel=function(t,i,e){return t=t&~x.MASK[i]|e<<8*(3-i),e},d.get_A=function(t){return t>>24&255},d.set_A=function(t,i){return t=16777215&t|i<<24,i},d.get_R=function(t){return t>>16&255},d.set_R=function(t,i){return t=-16711681&t|i<<16,i},d.get_G=function(t){return t>>8&255},d.set_G=function(t,i){return t=-65281&t|i<<8,i},d.get_B=function(t){return 255&t},d.set_B=function(t,i){return t=-256&t|i,i},d.get_fA=function(t){return(t>>24&255)/255},d.set_fA=function(t,i){return t=16777215&t|(255*i|0)<<24,i},d.get_fR=function(t){return(t>>16&255)/255},d.set_fR=function(t,i){return t=-16711681&t|(255*i|0)<<16,i},d.get_fG=function(t){return(t>>8&255)/255},d.set_fG=function(t,i){return t=-65281&t|(255*i|0)<<8,i},d.get_fB=function(t){return(255&t)/255},d.set_fB=function(t,i){return t=-256&t|255*i|0,i};var _={};e["hxPixels._Pixels.TargetType_Impl_"]=_,_.__name__=["hxPixels","_Pixels","TargetType_Impl_"],_.getCurrent=function(){return"js"};var g={};e["hxPixels._Pixels.Endianness_Impl_"]=g,g.__name__=["hxPixels","_Pixels","Endianness_Impl_"],g.getCurrent=function(){var t=h.fromArray([-573785174]);return 221==o.fromBytes(haxe_io_Bytes.ofData(t.buffer))[0]?0:1},g.getName=function(t){return g.names[t]};var hxbit_ConvertField=function(t,i){this.from=t,this.to=i};e["hxbit.ConvertField"]=hxbit_ConvertField,hxbit_ConvertField.__name__=["hxbit","ConvertField"],hxbit_ConvertField.prototype={__class__:hxbit_ConvertField};var hxbit_Convert=function(t,i){for(var e=new haxe_ds_StringMap,n=0,s=t.fieldsNames.length;n<s;){var r=n++,a=t.fieldsNames[r],h=t.fieldsTypes[r];null!=Z[a]?e.setReserved(a,h):e.h[a]=h}if(this.read=[],t.isFinal!=i.isFinal)throw new js__$Boot_HaxeError("TODO : handle final flag change");for(var o=new haxe_ds_StringMap,l=0,u=i.fieldsNames.length;l<u;){var m=l++,c=i.fieldsTypes[m],f=i.fieldsNames[m],x=null!=Z[f]?e.getReserved(f):e.h[f],d=new hxbit_ConvertField(c,x);null!=x&&(hxbit_Convert.sameType(c,x)?d.same=!0:d.defaultValue=hxbit_Convert.getDefault(x)),d.index=this.read.length,this.read.push(d);var _=i.fieldsNames[m];null!=Z[_]?o.setReserved(_,d):o.h[_]=d}this.write=[];for(var g=0,p=t.fieldsNames.length;g<p;){var v=g++,y=t.fieldsTypes[v],b=t.fieldsNames[v],w=null!=Z[b]?o.getReserved(b):o.h[b];null==w&&((w=new hxbit_ConvertField(null,y)).defaultValue=hxbit_Convert.getDefault(y)),this.write.push(w)}};e["hxbit.Convert"]=hxbit_Convert,hxbit_Convert.__name__=["hxbit","Convert"],hxbit_Convert.sameType=function(t,i){switch(t[1]){case 0:switch(i[1]){case 10:var e=i[2];return hxbit_Convert.sameType(t,e);case 16:return!0;default:return Type.enumEq(t,i)}break;case 7:switch(i[1]){case 7:var n=t[2],s=t[3],r=i[3],a=i[2];return!!hxbit_Convert.sameType(n,a)&&hxbit_Convert.sameType(s,r);case 10:var h=i[2];return hxbit_Convert.sameType(t,h);default:return Type.enumEq(t,i)}break;case 8:switch(i[1]){case 8:var o=t[2],l=i[2];return hxbit_Convert.sameType(o,l);case 10:var u=i[2];return hxbit_Convert.sameType(t,u);default:return Type.enumEq(t,i)}break;case 9:switch(i[1]){case 9:var m=t[2],c=i[2];if(m.length!=c.length)return!1;for(var f=0,x=m.length;f<x;){var d=f++,_=m[d],g=c[d];if(_.name!=g.name||_.opt!=g.opt||!hxbit_Convert.sameType(_.type,g.type))return!1}return!0;case 10:var p=i[2];return hxbit_Convert.sameType(t,p);default:return Type.enumEq(t,i)}break;case 10:if(10==i[1]){var v=t[2],y=i[2];return hxbit_Convert.sameType(v,y)}var b=t[2];return hxbit_Convert.sameType(b,i);case 11:switch(i[1]){case 10:var w=i[2];return hxbit_Convert.sameType(t,w);case 11:var z=t[2],Y=i[2];return hxbit_Convert.sameType(z,Y);default:return Type.enumEq(t,i)}break;case 12:switch(i[1]){case 10:var S=i[2];return hxbit_Convert.sameType(t,S);case 12:var X=t[2],Z=i[2];return hxbit_Convert.sameType(X,Z);default:return Type.enumEq(t,i)}break;case 16:switch(i[1]){case 0:return!0;case 10:var P=i[2];return hxbit_Convert.sameType(t,P);default:return Type.enumEq(t,i)}break;default:if(10==i[1]){var T=i[2];return hxbit_Convert.sameType(t,T)}return Type.enumEq(t,i)}},hxbit_Convert.getDefault=function(t){switch(t[1]){case 1:return 0;case 2:return!1;case 7:switch(t[2][1]){case 0:return new haxe_ds_IntMap;case 3:return new haxe_ds_StringMap;default:return new haxe_ds_ObjectMap}break;case 8:return[];case 3:case 4:case 5:case 6:case 9:case 12:case 13:case 14:case 17:return null;case 10:var i=t[2];return hxbit_Convert.getDefault(i);case 11:return new Array(0);case 15:return new haxe__$Int64__$_$_$Int64(0,0);case 0:case 16:return 0}},hxbit_Convert.prototype={toString:function(){for(var t=[],i=0,e=this.write.length;i<e;){var n=i++,s=this.write[n];t.push(null==s.from?"insert:"+Std.string(s.defaultValue):s.same?n==s.index?"s":"@"+s.index:"@"+s.index+":"+Std.string(s.to))}return t.toString()},__class__:hxbit_Convert};var p=e["hxbit.RpcMode"]={__ename__:!0,__constructs__:["All","Clients","Server","Owner","Immediate"]};p.All=["All",0],p.All.toString=$estr,p.All.__enum__=p,p.Clients=["Clients",1],p.Clients.toString=$estr,p.Clients.__enum__=p,p.Server=["Server",2],p.Server.toString=$estr,p.Server.__enum__=p,p.Owner=["Owner",3],p.Owner.toString=$estr,p.Owner.__enum__=p,p.Immediate=["Immediate",4],p.Immediate.toString=$estr,p.Immediate.__enum__=p;var v=e["hxbit.PropTypeDesc"]={__ename__:!0,__constructs__:["PInt","PFloat","PBool","PString","PBytes","PSerializable","PEnum","PMap","PArray","PObj","PAlias","PVector","PNull","PUnknown","PDynamic","PInt64","PFlags","PStruct"]};v.PInt=["PInt",0],v.PInt.toString=$estr,v.PInt.__enum__=v,v.PFloat=["PFloat",1],v.PFloat.toString=$estr,v.PFloat.__enum__=v,v.PBool=["PBool",2],v.PBool.toString=$estr,v.PBool.__enum__=v,v.PString=["PString",3],v.PString.toString=$estr,v.PString.__enum__=v,v.PBytes=["PBytes",4],v.PBytes.toString=$estr,v.PBytes.__enum__=v,v.PSerializable=function(t){var i=["PSerializable",5,t];return i.__enum__=v,i.toString=$estr,i},v.PEnum=function(t){var i=["PEnum",6,t];return i.__enum__=v,i.toString=$estr,i},v.PMap=function(t,i){var e=["PMap",7,t,i];return e.__enum__=v,e.toString=$estr,e},v.PArray=function(t){var i=["PArray",8,t];return i.__enum__=v,i.toString=$estr,i},v.PObj=function(t){var i=["PObj",9,t];return i.__enum__=v,i.toString=$estr,i},v.PAlias=function(t){var i=["PAlias",10,t];return i.__enum__=v,i.toString=$estr,i},v.PVector=function(t){var i=["PVector",11,t];return i.__enum__=v,i.toString=$estr,i},v.PNull=function(t){var i=["PNull",12,t];return i.__enum__=v,i.toString=$estr,i},v.PUnknown=["PUnknown",13],v.PUnknown.toString=$estr,v.PUnknown.__enum__=v,v.PDynamic=["PDynamic",14],v.PDynamic.toString=$estr,v.PDynamic.__enum__=v,v.PInt64=["PInt64",15],v.PInt64.toString=$estr,v.PInt64.__enum__=v,v.PFlags=function(t){var i=["PFlags",16,t];return i.__enum__=v,i.toString=$estr,i},v.PStruct=["PStruct",17],v.PStruct.toString=$estr,v.PStruct.__enum__=v;var hxbit_Macros=function(){};e["hxbit.Macros"]=hxbit_Macros,hxbit_Macros.__name__=["hxbit","Macros"];var hxbit_Schema=function(){this.__uid=hxbit_Serializer.SEQ<<24|++hxbit_Serializer.UID,this.fieldsNames=[],this.fieldsTypes=[]};e["hxbit.Schema"]=hxbit_Schema,hxbit_Schema.__name__=["hxbit","Schema"],hxbit_Schema.__interfaces__=[hxbit_Serializable],hxbit_Schema.prototype={get_checkSum:function(){var t=new hxbit_Serializer;t.begin();var i=this.__uid;this.__uid=0,t.addKnownRef(this),this.__uid=i;var e=t.end();return haxe_crypto_Crc32.make(e)},getCLID:function(){return hxbit_Schema.__clid},serialize:function(t){t.out.b.push(this.isFinal?1:0);var i=this.fieldsNames;if(null==i)t.out.b.push(0);else{var e=i.length+1;e>=0&&e<128?t.out.b.push(e):(t.out.b.push(128),t.out.addInt32(e));for(var n=0;n<i.length;){var s=i[n];if(++n,null==s)t.out.b.push(0);else{var r=haxe_io_Bytes.ofString(s),a=r.length+1;a>=0&&a<128?t.out.b.push(a):(t.out.b.push(128),t.out.addInt32(a));for(var h=t.out,o=(h.b,r.b),l=0,u=r.length;l<u;){var m=l++;h.b.push(o[m])}}}}var c=this.fieldsTypes;if(null==c)t.out.b.push(0);else{var f=c.length+1;f>=0&&f<128?t.out.b.push(f):(t.out.b.push(128),t.out.addInt32(f));for(var x=0;x<c.length;){var d=c[x];++x,hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,d)}}},getSerializeSchema:function(){var t=new hxbit_Schema;return t.fieldsNames.push("isFinal"),t.fieldsTypes.push(v.PBool),t.fieldsNames.push("fieldsNames"),t.fieldsTypes.push(v.PArray(v.PString)),t.fieldsNames.push("fieldsTypes"),t.fieldsTypes.push(v.PArray(v.PEnum("hxbit.PropTypeDesc"))),t.isFinal=hxbit_Serializer.isClassFinal(hxbit_Schema.__clid),t},unserializeInit:function(){},unserialize:function(t){var i;this.isFinal=0!=t.input.b[t.inPos++];var e=t.input.b[t.inPos++];128==e&&(e=t.input.getInt32(t.inPos),t.inPos+=4);var n,s,r=e;if(0==r)n=null;else{for(var a=[],h=0,o=--r;h<o;){var l=h++,u=t.input.b[t.inPos++];128==u&&(u=t.input.getInt32(t.inPos),t.inPos+=4);var m=u;if(0==m)i=null;else{--m;var c=t.input.getString(t.inPos,m);t.inPos+=m,i=c}a[l]=i}n=a}this.fieldsNames=n;var f=t.input.b[t.inPos++];128==f&&(f=t.input.getInt32(t.inPos),t.inPos+=4);var x,d=f;if(0==d)x=null;else{for(var _=[],g=0,p=--d;g<p;){var v=g++;s=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),_[v]=s}x=_}this.fieldsTypes=x},__class__:hxbit_Schema};var hxbit_SerializableEnum=function(){};e["hxbit.SerializableEnum"]=hxbit_SerializableEnum,hxbit_SerializableEnum.__name__=["hxbit","SerializableEnum"];var hxbit_StructSerializable=function(){};e["hxbit.StructSerializable"]=hxbit_StructSerializable,hxbit_StructSerializable.__name__=["hxbit","StructSerializable"],hxbit_StructSerializable.prototype={__class__:hxbit_StructSerializable};var hxbit_enumSer_hxbit_$PropTypeDesc=function(){};e["hxbit.enumSer.hxbit_PropTypeDesc"]=hxbit_enumSer_hxbit_$PropTypeDesc,hxbit_enumSer_hxbit_$PropTypeDesc.__name__=["hxbit","enumSer","hxbit_PropTypeDesc"],hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize=function(t,i){if(null==i)t.out.b.push(0);else switch(i[1]){case 0:t.out.b.push(1);break;case 1:t.out.b.push(2);break;case 2:t.out.b.push(3);break;case 3:t.out.b.push(4);break;case 4:t.out.b.push(5);break;case 5:var e=i[2];if(t.out.b.push(6),null==e)t.out.b.push(0);else{var n=haxe_io_Bytes.ofString(e),s=n.length+1;s>=0&&s<128?t.out.b.push(s):(t.out.b.push(128),t.out.addInt32(s));for(var r=t.out,a=(r.b,n.b),h=0,o=n.length;h<o;){var l=h++;r.b.push(a[l])}}break;case 6:var u=i[2];if(t.out.b.push(7),null==u)t.out.b.push(0);else{var m=haxe_io_Bytes.ofString(u),c=m.length+1;c>=0&&c<128?t.out.b.push(c):(t.out.b.push(128),t.out.addInt32(c));for(var f=t.out,x=(f.b,m.b),d=0,_=m.length;d<_;){var g=d++;f.b.push(x[g])}}break;case 7:var p=i[3],v=i[2];t.out.b.push(8),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,v),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,p);break;case 8:var y=i[2];t.out.b.push(9),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,y);break;case 9:var b=i[2];if(t.out.b.push(10),null==b)t.out.b.push(0);else{var w=b.length+1;w>=0&&w<128?t.out.b.push(w):(t.out.b.push(128),t.out.addInt32(w));for(var z=0;z<b.length;){var Y=b[z];++z;var S=Y;if(null==S)t.out.b.push(0);else{var X=0;null!=S.name&&(X|=1),null!=S.type&&(X|=2);var Z=X+1;if(Z>=0&&Z<128?t.out.b.push(Z):(t.out.b.push(128),t.out.addInt32(Z)),0!=(1&X)){var P=S.name;if(null==P)t.out.b.push(0);else{var T=haxe_io_Bytes.ofString(P),L=T.length+1;L>=0&&L<128?t.out.b.push(L):(t.out.b.push(128),t.out.addInt32(L));for(var I=t.out,O=(I.b,T.b),E=0,C=T.length;E<C;){var D=E++;I.b.push(O[D])}}}t.out.b.push(S.opt?1:0),0!=(2&X)&&hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,S.type)}}}break;case 10:var k=i[2];t.out.b.push(11),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,k);break;case 11:var A=i[2];t.out.b.push(12),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,A);break;case 12:var M=i[2];t.out.b.push(13),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,M);break;case 13:t.out.b.push(14);break;case 14:t.out.b.push(15);break;case 15:t.out.b.push(16);break;case 16:var R=i[2];t.out.b.push(17),hxbit_enumSer_hxbit_$PropTypeDesc.doSerialize(t,R);break;case 17:t.out.b.push(18)}},hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize=function(t){var i=t.input.b[t.inPos++];if(0==i)return null;switch(i){case 1:return v.PInt;case 2:return v.PFloat;case 3:return v.PBool;case 4:return v.PString;case 5:return v.PBytes;case 6:var e,n=t.input.b[t.inPos++];128==n&&(n=t.input.getInt32(t.inPos),t.inPos+=4);var s=n;if(0==s)e=null;else{--s;var r=t.input.getString(t.inPos,s);t.inPos+=s,e=r}return v.PSerializable(e);case 7:var a,h=t.input.b[t.inPos++];128==h&&(h=t.input.getInt32(t.inPos),t.inPos+=4);var o=h;if(0==o)a=null;else{--o;var l=t.input.getString(t.inPos,o);t.inPos+=o,a=l}return v.PEnum(a);case 8:var u,m;return u=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),m=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PMap(u,m);case 9:var c;return c=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PArray(c);case 10:var f,x,d=t.input.b[t.inPos++];128==d&&(d=t.input.getInt32(t.inPos),t.inPos+=4);var _=d;if(0==_)f=null;else{for(var g=[],p=0,y=--_;p<y;){var b=p++,w=t.input.b[t.inPos++];128==w&&(w=t.input.getInt32(t.inPos),t.inPos+=4);var z=w;if(0==z)x=null;else{var Y,S=null,X=null;if(0!=(1&--z)){var Z=t.input.b[t.inPos++];128==Z&&(Z=t.input.getInt32(t.inPos),t.inPos+=4);var P=Z;if(0==P)X=null;else{--P;var T=t.input.getString(t.inPos,P);t.inPos+=P,X=T}}if(Y=0!=t.input.b[t.inPos++],0!=(2&z))S=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t);x={name:X,opt:Y,type:S}}g[b]=x}f=g}return v.PObj(f);case 11:var L;return L=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PAlias(L);case 12:var I;return I=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PVector(I);case 13:var O;return O=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PNull(O);case 14:return v.PUnknown;case 15:return v.PDynamic;case 16:return v.PInt64;case 17:var E;return E=hxbit_enumSer_hxbit_$PropTypeDesc.doUnserialize(t),v.PFlags(E);case 18:return v.PStruct;default:throw new js__$Boot_HaxeError("Invalid enum index "+i)}},hxbit_enumSer_hxbit_$PropTypeDesc.getSchema=function(){var t=new hxbit_Schema;t.fieldsTypes.push(null),t.fieldsNames.push("PInt"),t.fieldsTypes.push(null),t.fieldsNames.push("PFloat"),t.fieldsTypes.push(null),t.fieldsNames.push("PBool"),t.fieldsTypes.push(null),t.fieldsNames.push("PString"),t.fieldsTypes.push(null),t.fieldsNames.push("PBytes");for(var i=t.fieldsTypes,e=[],n=0,s=[v.PString];n<s.length;){var r=s[n];++n,e.push({name:"",type:r,opt:!1})}i.push(v.PObj(e)),t.fieldsNames.push("PSerializable");for(var a=t.fieldsTypes,h=[],o=0,l=[v.PString];o<l.length;){var u=l[o];++o,h.push({name:"",type:u,opt:!1})}a.push(v.PObj(h)),t.fieldsNames.push("PEnum");for(var m=t.fieldsTypes,c=[],f=0,x=[v.PEnum("hxbit.PropTypeDesc")];f<x.length;){var d=x[f];++f,c.push({name:"",type:d,opt:!1})}m.push(v.PObj(c)),t.fieldsNames.push("PMap");for(var _=t.fieldsTypes,g=[],p=0,y=[v.PEnum("hxbit.PropTypeDesc")];p<y.length;){var b=y[p];++p,g.push({name:"",type:b,opt:!1})}_.push(v.PObj(g)),t.fieldsNames.push("PArray");for(var w=t.fieldsTypes,z=[],Y=0,S=[v.PArray(v.PObj([{opt:!1,type:v.PString,name:"name"},{opt:!1,type:v.PBool,name:"opt"},{opt:!1,type:v.PEnum("hxbit.PropTypeDesc"),name:"type"}]))];Y<S.length;){var X=S[Y];++Y,z.push({name:"",type:X,opt:!1})}w.push(v.PObj(z)),t.fieldsNames.push("PObj");for(var Z=t.fieldsTypes,P=[],T=0,L=[v.PEnum("hxbit.PropTypeDesc")];T<L.length;){var I=L[T];++T,P.push({name:"",type:I,opt:!1})}Z.push(v.PObj(P)),t.fieldsNames.push("PAlias");for(var O=t.fieldsTypes,E=[],C=0,D=[v.PEnum("hxbit.PropTypeDesc")];C<D.length;){var k=D[C];++C,E.push({name:"",type:k,opt:!1})}O.push(v.PObj(E)),t.fieldsNames.push("PVector");for(var A=t.fieldsTypes,M=[],R=0,B=[v.PEnum("hxbit.PropTypeDesc")];R<B.length;){var N=B[R];++R,M.push({name:"",type:N,opt:!1})}A.push(v.PObj(M)),t.fieldsNames.push("PNull"),t.fieldsTypes.push(null),t.fieldsNames.push("PUnknown"),t.fieldsTypes.push(null),t.fieldsNames.push("PDynamic"),t.fieldsTypes.push(null),t.fieldsNames.push("PInt64");for(var V=t.fieldsTypes,F=[],j=0,U=[v.PEnum("hxbit.PropTypeDesc")];j<U.length;){var q=U[j];++j,F.push({name:"",type:q,opt:!1})}return V.push(v.PObj(F)),t.fieldsNames.push("PFlags"),t.fieldsTypes.push(null),t.fieldsNames.push("PStruct"),t};var jeash_geom_Matrix=function(t,i,e,n,s,r){this.a=null==t?1:t,this.b=null==i?0:i,this.c=null==e?0:e,this.d=null==n?1:n,this.tx=null==s?0:s,this.ty=null==r?0:r};e["jeash.geom.Matrix"]=jeash_geom_Matrix,jeash_geom_Matrix.__name__=["jeash","geom","Matrix"],jeash_geom_Matrix.prototype={copyFrom:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},clone:function(){return new jeash_geom_Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)},concat:function(t){var i=this.a*t.a+this.b*t.c;this.b=this.a*t.b+this.b*t.d,this.a=i;var e=this.c*t.a+this.d*t.c;this.d=this.c*t.b+this.d*t.d,this.c=e;var n=this.tx*t.a+this.ty*t.c+t.tx;this.ty=this.tx*t.b+this.ty*t.d+t.ty,this.tx=n},createBox:function(t,i,e,n,s){this.a=t,this.d=i,this.b=null==e?0:e,this.tx=null==n?0:n,this.ty=null==s?0:s},createGradientBox:function(t,i,e,n,s){if(this.a=t/1638.4,this.d=i/1638.4,null!=e&&0!=e){var r=Math.cos(e),a=Math.sin(e);this.b=a*this.d,this.c=-a*this.a,this.a*=r,this.d*=r}else this.b=this.c=0;this.tx=null!=n?n+t/2:t/2,this.ty=null!=s?s+i/2:i/2},deltaTransformPoint:function(t){return new jeash_geom_Point(t.x*this.a+t.y*this.c,t.x*this.b+t.y*this.d)},identity:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},invert:function(){var t=this.a*this.d-this.b*this.c;if(0==t)this.a=this.b=this.c=this.d=0,this.tx=-this.tx,this.ty=-this.ty;else{t=1/t;var i=this.d*t;this.d=this.a*t,this.a=i,this.b*=-t,this.c*=-t;var e=-this.a*this.tx-this.c*this.ty;this.ty=-this.b*this.tx-this.d*this.ty,this.tx=e}return this},mult:function(t){var i=new jeash_geom_Matrix;return i.a=this.a*t.a+this.b*t.c,i.b=this.a*t.b+this.b*t.d,i.c=this.c*t.a+this.d*t.c,i.d=this.c*t.b+this.d*t.d,i.tx=this.tx*t.a+this.ty*t.c+t.tx,i.ty=this.tx*t.b+this.ty*t.d+t.ty,i},rotate:function(t){var i=Math.cos(t),e=Math.sin(t),n=this.a*i-this.b*e;this.b=this.a*e+this.b*i,this.a=n;var s=this.c*i-this.d*e;this.d=this.c*e+this.d*i,this.c=s;var r=this.tx*i-this.ty*e;this.ty=this.tx*e+this.ty*i,this.tx=r},scale:function(t,i){this.a*=t,this.b*=i,this.c*=t,this.d*=i,this.tx*=t,this.ty*=i},setRotation:function(t,i){var e=null==i?1:i;this.a=Math.cos(t)*e,this.c=Math.sin(t)*e,this.b=-this.c,this.d=this.a},setTo:function(t,i,e,n,s,r){this.a=t,this.b=i,this.c=e,this.d=n,this.tx=s,this.ty=r},transformPoint:function(t){return new jeash_geom_Point(t.x*this.a+t.y*this.c+this.tx,t.x*this.b+t.y*this.d+this.ty)},translate:function(t,i){this.tx+=t,this.ty+=i},toString:function(){return"[ "+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.tx+" "+this.ty+" ]"},__class__:jeash_geom_Matrix};var jeash_geom_Point=function(t,i){this.x=null==t?0:t,this.y=null==i?0:i};e["jeash.geom.Point"]=jeash_geom_Point,jeash_geom_Point.__name__=["jeash","geom","Point"],jeash_geom_Point.distance=function(t,i){var e=t.x-i.x,n=t.y-i.y;return Math.sqrt(e*e+n*n)},jeash_geom_Point.interpolate=function(t,i,e){return new jeash_geom_Point(i.x+e*(t.x-i.x),i.y+e*(t.y-i.y))},jeash_geom_Point.polar=function(t,i){return new jeash_geom_Point(t*Math.cos(i),t*Math.sin(i))},jeash_geom_Point.prototype={add:function(t){return new jeash_geom_Point(t.x+this.x,t.y+this.y)},clone:function(){return new jeash_geom_Point(this.x,this.y)},equals:function(t){return t.x==this.x&&t.y==this.y},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(t){if(0==this.x&&0==this.y)this.x=t;else{var i=t/Math.sqrt(this.x*this.x+this.y*this.y);this.x*=i,this.y*=i}},offset:function(t,i){this.x+=t,this.y+=i},subtract:function(t){return new jeash_geom_Point(this.x-t.x,this.y-t.y)},__class__:jeash_geom_Point};var jeash_geom_Rectangle=function(t,i,e,n){this.x=null==t?0:t,this.y=null==i?0:i,this.width=null==e?0:e,this.height=null==n?0:n};e["jeash.geom.Rectangle"]=jeash_geom_Rectangle,jeash_geom_Rectangle.__name__=["jeash","geom","Rectangle"],jeash_geom_Rectangle.prototype={get_left:function(){return this.x},set_left:function(t){return this.width-=t-this.x,this.x=t,t},get_right:function(){return this.x+this.width},set_right:function(t){return this.width=t-this.x,t},get_top:function(){return this.y},set_top:function(t){return this.height-=t-this.y,this.y=t,t},get_bottom:function(){return this.y+this.height},set_bottom:function(t){return this.height=t-this.y,t},get_topLeft:function(){return new jeash_geom_Point(this.x,this.y)},set_topLeft:function(t){return this.x=t.x,this.y=t.y,t.clone()},get_size:function(){return new jeash_geom_Point(this.width,this.height)},set_size:function(t){return this.width=t.x,this.height=t.y,t.clone()},get_bottomRight:function(){return new jeash_geom_Point(this.x+this.width,this.y+this.height)},set_bottomRight:function(t){return this.width=t.x-this.x,this.height=t.y-this.y,t.clone()},clone:function(){return new jeash_geom_Rectangle(this.x,this.y,this.width,this.height)},contains:function(t,i){return t>=this.x&&i>=this.y&&t<this.get_right()&&i<this.get_bottom()},containsPoint:function(t){return this.contains(t.x,t.y)},containsRect:function(t){return!!this.contains(t.x,t.y)&&this.containsPoint(t.get_bottomRight())},equals:function(t){return this.x==t.x&&this.y==t.y&&this.width==t.width&&this.height==t.height},inflate:function(t,i){this.x-=t,this.width+=2*t,this.y-=i,this.height+=2*i},inflatePoint:function(t){this.inflate(t.x,t.y)},intersection:function(t){var i=this.x<t.x?t.x:this.x,e=this.get_right()>t.get_right()?t.get_right():this.get_right();if(e<=i)return new jeash_geom_Rectangle;var n=this.y<t.y?t.y:this.y,s=this.get_bottom()>t.get_bottom()?t.get_bottom():this.get_bottom();return s<=n?new jeash_geom_Rectangle:new jeash_geom_Rectangle(i,n,e-i,s-n)},intersects:function(t){var i=this.x<t.x?t.x:this.x;if((this.get_right()>t.get_right()?t.get_right():this.get_right())<=i)return!1;var e=this.y<t.y?t.y:this.y;return(this.get_bottom()>t.get_bottom()?t.get_bottom():this.get_bottom())>e},union:function(t){var i=this.x>t.x?t.x:this.x,e=this.get_right()<t.get_right()?t.get_right():this.get_right(),n=this.y>t.y?t.y:this.y,s=this.get_bottom()<t.get_bottom()?t.get_bottom():this.get_bottom();return new jeash_geom_Rectangle(i,n,e-i,s-n)},isEmpty:function(){return 0==this.width&&0==this.height},offset:function(t,i){this.x+=t,this.y+=i},offsetPoint:function(t){this.x+=t.x,this.y+=t.y},setEmpty:function(){this.x=this.y=this.width=this.height=0},transform:function(t){var i=t.a*this.x+t.c*this.y,e=i,n=t.b*this.x+t.d*this.y,s=i,r=t.a*(this.x+this.width)+t.c*this.y,a=t.b*(this.x+this.width)+t.d*this.y;return r<i&&(i=r),a<n&&(n=a),r>e&&(e=r),a>s&&(s=a),(r=t.a*(this.x+this.width)+t.c*(this.y+this.height))<i&&(i=r),(a=t.b*(this.x+this.width)+t.d*(this.y+this.height))<n&&(n=a),r>e&&(e=r),a>s&&(s=a),(r=t.a*this.x+t.c*(this.y+this.height))<i&&(i=r),(a=t.b*this.x+t.d*(this.y+this.height))<n&&(n=a),r>e&&(e=r),a>s&&(s=a),new jeash_geom_Rectangle(i+t.tx,n+t.ty,e-i,s-n)},extendBounds:function(t){var i=this.x-t.x;i>0&&(this.x-=i,this.width+=i);var e=this.y-t.y;e>0&&(this.y-=e,this.height+=e),t.get_right()>this.get_right()&&this.set_right(t.get_right()),t.get_bottom()>this.get_bottom()&&this.set_bottom(t.get_bottom())},__class__:jeash_geom_Rectangle};var js__$Boot_HaxeError=function(t){Error.call(this),this.val=t,this.message=String(t),Error.captureStackTrace&&Error.captureStackTrace(this,js__$Boot_HaxeError)};e["js._Boot.HaxeError"]=js__$Boot_HaxeError,js__$Boot_HaxeError.__name__=["js","_Boot","HaxeError"],js__$Boot_HaxeError.wrap=function(t){return t instanceof Error?t:new js__$Boot_HaxeError(t)},js__$Boot_HaxeError.__super__=Error,js__$Boot_HaxeError.prototype=$extend(Error.prototype,{__class__:js__$Boot_HaxeError});var js_Boot=function(){};e["js.Boot"]=js_Boot,js_Boot.__name__=["js","Boot"],js_Boot.getClass=function(t){if(t instanceof Array&&null==t.__enum__)return Array;var i=t.__class__;if(null!=i)return i;var e=js_Boot.__nativeClassName(t);return null!=e?js_Boot.__resolveNativeClass(e):null},js_Boot.__string_rec=function(t,i){if(null==t)return"null";if(i.length>=5)return"<...>";var e=typeof t;switch("function"==e&&(t.__name__||t.__ename__)&&(e="object"),e){case"function":return"<function>";case"object":if(t instanceof Array){if(t.__enum__){if(2==t.length)return t[0];var n=t[0]+"(";i+="\t";for(var s=2,r=t.length;s<r;){var a=s++;n+=2!=a?","+js_Boot.__string_rec(t[a],i):js_Boot.__string_rec(t[a],i)}return n+")"}var h="[";i+="\t";for(var o=0,l=t.length;o<l;){var u=o++;h+=(u>0?",":"")+js_Boot.__string_rec(t[u],i)}return h+="]"}var m;try{m=t.toString}catch(t){return"???"}if(null!=m&&m!=Object.toString&&"function"==typeof m){var c=t.toString();if("[object Object]"!=c)return c}var f=null,x="{\n";i+="\t";var d=null!=t.hasOwnProperty;for(var f in t)d&&!t.hasOwnProperty(f)||"prototype"!=f&&"__class__"!=f&&"__super__"!=f&&"__interfaces__"!=f&&"__properties__"!=f&&(2!=x.length&&(x+=", \n"),x+=i+f+" : "+js_Boot.__string_rec(t[f],i));return x+="\n"+(i=i.substring(1))+"}";case"string":return t;default:return String(t)}},js_Boot.__interfLoop=function(t,i){if(null==t)return!1;if(t==i)return!0;var e=t.__interfaces__;if(null!=e)for(var n=0,s=e.length;n<s;){var r=e[n++];if(r==i||js_Boot.__interfLoop(r,i))return!0}return js_Boot.__interfLoop(t.__super__,i)},js_Boot.__instanceof=function(t,i){if(null==i)return!1;switch(i){case Array:return t instanceof Array&&null==t.__enum__;case Y:return"boolean"==typeof t;case w:return!0;case z:return"number"==typeof t;case b:return"number"==typeof t&&(0|t)===t;case String:return"string"==typeof t;default:if(null==t)return!1;if("function"==typeof i){if(t instanceof i)return!0;if(js_Boot.__interfLoop(js_Boot.getClass(t),i))return!0}else if("object"==typeof i&&js_Boot.__isNativeObj(i)&&t instanceof i)return!0;return i==S&&null!=t.__name__||(i==X&&null!=t.__ename__||t.__enum__==i)}},js_Boot.__nativeClassName=function(t){var i=js_Boot.__toStr.call(t).slice(8,-1);return"Object"==i||"Function"==i||"Math"==i||"JSON"==i?null:i},js_Boot.__isNativeObj=function(t){return null!=js_Boot.__nativeClassName(t)},js_Boot.__resolveNativeClass=function(t){return i[t]};var js_html_compat_ArrayBuffer=function(t){if(t instanceof Array&&null==t.__enum__)this.a=t,this.byteLength=t.length;else{var i=t;this.a=[];for(var e=0,n=i;e<n;){var s=e++;this.a[s]=0}this.byteLength=i}};e["js.html.compat.ArrayBuffer"]=js_html_compat_ArrayBuffer,js_html_compat_ArrayBuffer.__name__=["js","html","compat","ArrayBuffer"],js_html_compat_ArrayBuffer.sliceImpl=function(t,i){var e=new O(this,t,null==i?null:i-t),n=new P(e.byteLength);return new O(n).set(e),n},js_html_compat_ArrayBuffer.prototype={slice:function(t,i){return new js_html_compat_ArrayBuffer(this.a.slice(t,i))},__class__:js_html_compat_ArrayBuffer};var js_html_compat_DataView=function(t,i,e){if(this.buf=t,this.offset=null==i?0:i,this.length=null==e?t.byteLength-this.offset:e,this.offset<0||this.length<0||this.offset+this.length>t.byteLength)throw new js__$Boot_HaxeError(a.OutsideBounds);this.byteLength=this.length,this.byteOffset=this.offset,this.buffer=this.buf};e["js.html.compat.DataView"]=js_html_compat_DataView,js_html_compat_DataView.__name__=["js","html","compat","DataView"],js_html_compat_DataView.prototype={getInt8:function(t){var i=this.buf.a[this.offset+t];return i>=128?i-256:i},getUint8:function(t){return this.buf.a[this.offset+t]},getInt16:function(t,i){var e=this.getUint16(t,i);return e>=32768?e-65536:e},getUint16:function(t,i){return i?this.buf.a[this.offset+t]|this.buf.a[this.offset+t+1]<<8:this.buf.a[this.offset+t]<<8|this.buf.a[this.offset+t+1]},getInt32:function(t,i){var e=this.offset+t,n=this.buf.a[e++],s=this.buf.a[e++],r=this.buf.a[e++],a=this.buf.a[e++];return i?n|s<<8|r<<16|a<<24:a|r<<8|s<<16|n<<24},getUint32:function(t,i){var e=this.getInt32(t,i);return e<0?e+4294967296:e},getFloat32:function(t,i){return haxe_io_FPHelper.i32ToFloat(this.getInt32(t,i))},getFloat64:function(t,i){var e=this.getInt32(t,i),n=this.getInt32(t+4,i);return haxe_io_FPHelper.i64ToDouble(i?e:n,i?n:e)},setInt8:function(t,i){this.buf.a[t+this.offset]=i<0?i+128&255:255&i},setUint8:function(t,i){this.buf.a[t+this.offset]=255&i},setInt16:function(t,i,e){this.setUint16(t,i<0?i+65536:i,e)},setUint16:function(t,i,e){var n=t+this.offset;e?(this.buf.a[n]=255&i,this.buf.a[n++]=i>>8&255):(this.buf.a[n++]=i>>8&255,this.buf.a[n]=255&i)},setInt32:function(t,i,e){this.setUint32(t,i,e)},setUint32:function(t,i,e){var n=t+this.offset;e?(this.buf.a[n++]=255&i,this.buf.a[n++]=i>>8&255,this.buf.a[n++]=i>>16&255,this.buf.a[n++]=i>>>24):(this.buf.a[n++]=i>>>24,this.buf.a[n++]=i>>16&255,this.buf.a[n++]=i>>8&255,this.buf.a[n++]=255&i)},setFloat32:function(t,i,e){this.setUint32(t,haxe_io_FPHelper.floatToI32(i),e)},setFloat64:function(t,i,e){var n=haxe_io_FPHelper.doubleToI64(i);e?(this.setUint32(t,n.low),this.setUint32(t,n.high)):(this.setUint32(t,n.high),this.setUint32(t,n.low))},__class__:js_html_compat_DataView};var js_html_compat_Float32Array=function(){};e["js.html.compat.Float32Array"]=js_html_compat_Float32Array,js_html_compat_Float32Array.__name__=["js","html","compat","Float32Array"],js_html_compat_Float32Array._new=function(t,i,e){var n;if("number"==typeof t){n=[];for(var s=0,r=t;s<r;){n[s++]=0}n.byteLength=n.length<<2,n.byteOffset=0;for(var a=[],h=0,o=n.length<<2;h<o;){h++;a.push(0)}n.buffer=new js_html_compat_ArrayBuffer(a)}else if(js_Boot.__instanceof(t,js_html_compat_ArrayBuffer)){var l=t;null==i&&(i=0),null==e&&(e=l.byteLength-i>>2),n=[];for(var u=0,m=e;u<m;){u++;var c=l.a[i++]|l.a[i++]<<8|l.a[i++]<<16|l.a[i++]<<24;n.push(haxe_io_FPHelper.i32ToFloat(c))}n.byteLength=n.length<<2,n.byteOffset=i,n.buffer=l}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO "+Std.string(t));n=t.slice();for(var f=[],x=0;x<n.length;){var d=n[x];++x;var _=haxe_io_FPHelper.floatToI32(d);f.push(255&_),f.push(_>>8&255),f.push(_>>16&255),f.push(_>>>24)}n.byteLength=n.length<<2,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(f)}return n.subarray=js_html_compat_Float32Array._subarray,n.set=js_html_compat_Float32Array._set,n},js_html_compat_Float32Array._set=function(t,i){if(js_Boot.__instanceof(t.buffer,js_html_compat_ArrayBuffer)){var e=t;if(t.byteLength+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var n=0,s=t.byteLength;n<s;){var r=n++;this[r+i]=e[r]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO");var a=t;if(a.length+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var h=0,o=a.length;h<o;){var l=h++;this[l+i]=a[l]}}},js_html_compat_Float32Array._subarray=function(t,i){var e=js_html_compat_Float32Array._new(this.slice(t,i));return e.byteOffset=4*t,e};var js_html_compat_Uint8Array=function(){};e["js.html.compat.Uint8Array"]=js_html_compat_Uint8Array,js_html_compat_Uint8Array.__name__=["js","html","compat","Uint8Array"],js_html_compat_Uint8Array._new=function(t,i,e){var n;if("number"==typeof t){n=[];for(var s=0,r=t;s<r;){n[s++]=0}n.byteLength=n.length,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(n)}else if(js_Boot.__instanceof(t,js_html_compat_ArrayBuffer)){var a=t;null==i&&(i=0),null==e&&(e=a.byteLength-i),(n=0==i?a.a:a.a.slice(i,i+e)).byteLength=n.length,n.byteOffset=i,n.buffer=a}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO "+Std.string(t));(n=t.slice()).byteLength=n.length,n.byteOffset=0,n.buffer=new js_html_compat_ArrayBuffer(n)}return n.subarray=js_html_compat_Uint8Array._subarray,n.set=js_html_compat_Uint8Array._set,n},js_html_compat_Uint8Array._set=function(t,i){if(js_Boot.__instanceof(t.buffer,js_html_compat_ArrayBuffer)){var e=t;if(t.byteLength+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var n=0,s=t.byteLength;n<s;){var r=n++;this[r+i]=e[r]}}else{if(!(t instanceof Array&&null==t.__enum__))throw new js__$Boot_HaxeError("TODO");var a=t;if(a.length+i>this.byteLength)throw new js__$Boot_HaxeError("set() outside of range");for(var h=0,o=a.length;h<o;){var l=h++;this[l+i]=a[l]}}},js_html_compat_Uint8Array._subarray=function(t,i){var e=js_html_compat_Uint8Array._new(this.slice(t,i));return e.byteOffset=t,e};var systems_collisions_CollisionEvent=function(){this.pos=new util_geom_Vec3,this.normal=new util_geom_Vec3,this.dest=new util_geom_Vec3};e["systems.collisions.CollisionEvent"]=systems_collisions_CollisionEvent,systems_collisions_CollisionEvent.__name__=["systems","collisions","CollisionEvent"],systems_collisions_CollisionEvent.Get=function(t,i,e,n,s,r){var a=null!=systems_collisions_CollisionEvent.COLLECTOR?systems_collisions_CollisionEvent.COLLECTOR:systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent;systems_collisions_CollisionEvent.COLLECTOR=systems_collisions_CollisionEvent.COLLECTOR.next;var h=a.pos;h.x=t.x,h.y=t.y,h.z=t.z;var o=a.normal;o.x=i.x,o.y=i.y,o.z=i.z;var l=a.dest;return l.x=s.x,l.y=s.y,l.z=s.z,a.offset=e,a.t=n,a.geomtype=r,a.next=null,a},systems_collisions_CollisionEvent.GetAs3=function(t,i,e,n,s,r){var a=null!=systems_collisions_CollisionEvent.COLLECTOR?systems_collisions_CollisionEvent.COLLECTOR:systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent;systems_collisions_CollisionEvent.COLLECTOR=systems_collisions_CollisionEvent.COLLECTOR.next;var h=a.pos;h.x=t.x,h.y=t.y,h.z=t.z;var o=a.normal;o.x=i.x,o.y=i.y,o.z=i.z;var l=a.dest;return l.x=s.x,l.y=s.y,l.z=s.z,a.offset=e,a.t=n,a.geomtype=r,a.next=null,a},systems_collisions_CollisionEvent.get=function(t,i,e,n,s,r){return systems_collisions_CollisionEvent.Get(t,i,e,n,s,r)},systems_collisions_CollisionEvent.getGeomTypeString=function(t){switch(t){case 1:return"POINT";case 2:return"EDGE";case 3:return"POLYGON";case 4:return"THING";default:return"UNDEF"}},systems_collisions_CollisionEvent.prototype={getNumEvents:function(){for(var t=1,i=this;null!=(i=i.next);)++t;return t},write:function(t,i,e,n,s,r){var a=this.pos;a.x=t.x,a.y=t.y,a.z=t.z;var h=this.normal;h.x=i.x,h.y=i.y,h.z=i.z;var o=this.dest;o.x=s.x,o.y=s.y,o.z=s.z,this.offset=e,this.t=n,this.geomtype=r},calcFallbackPosition:function(t,i,e,n){n.x=this.dest.x,n.y=this.dest.y,n.z=this.dest.z},dispose:function(){this.next=systems_collisions_CollisionEvent.COLLECTOR,systems_collisions_CollisionEvent.COLLECTOR=this},__class__:systems_collisions_CollisionEvent};var systems_collisions_EllipsoidCollider=function(t,i,e,n,s){null==s&&(s=!1),null==n&&(n=.001),this.threshold=n,this.timestamp=0,this.requireEvents=s,this.radiusX=t,this.radiusY=i,this.radiusZ=e,this.matrix=new components_Transform3D,this.inverseMatrix=new components_Transform3D,this.sphere=new jeash_geom_Vector3D,this.cornerA=new jeash_geom_Vector3D,this.cornerB=new jeash_geom_Vector3D,this.cornerC=new jeash_geom_Vector3D,this.cornerD=new jeash_geom_Vector3D,this.resultVector=new jeash_geom_Vector3D,this.collisionPoint=new jeash_geom_Vector3D,this.collisionPlane=new jeash_geom_Vector3D,this.resCollisionPoint=new jeash_geom_Vector3D,this.resCollisionPlane=new jeash_geom_Vector3D,this.geometries=[],this.transforms=[],this.numGeometries=0,this.vertices=[],this.normals=[],this.indices=[],this.numI=0,this.displ=new jeash_geom_Vector3D,this.dest=new jeash_geom_Vector3D,this.src=new jeash_geom_Vector3D};e["systems.collisions.EllipsoidCollider"]=systems_collisions_EllipsoidCollider,systems_collisions_EllipsoidCollider.__name__=["systems","collisions","EllipsoidCollider"],systems_collisions_EllipsoidCollider.isNaN2=function(t){return t!=t},systems_collisions_EllipsoidCollider.prototype={calculateSphere:function(t){this.sphere.x=t.d,this.sphere.y=t.h,this.sphere.z=t.l;var i=t.a*this.cornerA.x+t.b*this.cornerA.y+t.c*this.cornerA.z+t.d,e=t.e*this.cornerA.x+t.f*this.cornerA.y+t.g*this.cornerA.z+t.h,n=t.i*this.cornerA.x+t.j*this.cornerA.y+t.k*this.cornerA.z+t.l,s=t.a*this.cornerB.x+t.b*this.cornerB.y+t.c*this.cornerB.z+t.d,r=t.e*this.cornerB.x+t.f*this.cornerB.y+t.g*this.cornerB.z+t.h,a=t.i*this.cornerB.x+t.j*this.cornerB.y+t.k*this.cornerB.z+t.l,h=t.a*this.cornerC.x+t.b*this.cornerC.y+t.c*this.cornerC.z+t.d,o=t.e*this.cornerC.x+t.f*this.cornerC.y+t.g*this.cornerC.z+t.h,l=t.i*this.cornerC.x+t.j*this.cornerC.y+t.k*this.cornerC.z+t.l,u=t.a*this.cornerD.x+t.b*this.cornerD.y+t.c*this.cornerD.z+t.d,m=t.e*this.cornerD.x+t.f*this.cornerD.y+t.g*this.cornerD.z+t.h,c=t.i*this.cornerD.x+t.j*this.cornerD.y+t.k*this.cornerD.z+t.l,f=i-this.sphere.x,x=e-this.sphere.y,d=n-this.sphere.z;this.sphere.w=f*f+x*x+d*d;var _=(f=s-this.sphere.x)*f+(x=r-this.sphere.y)*x+(d=a-this.sphere.z)*d;_>this.sphere.w&&(this.sphere.w=_),(_=(f=h-this.sphere.x)*f+(x=o-this.sphere.y)*x+(d=l-this.sphere.z)*d)>this.sphere.w&&(this.sphere.w=_),(_=(f=u-this.sphere.x)*f+(x=m-this.sphere.y)*x+(d=c-this.sphere.z)*d)>this.sphere.w&&(this.sphere.w=_),this.sphere.w=Math.sqrt(this.sphere.w)},prepare:function(t,i){this.radius=this.radiusX,this.radiusY>this.radius&&(this.radius=this.radiusY),this.radiusZ>this.radius&&(this.radius=this.radiusZ),this.matrix.compose(t.x,t.y,t.z,0,0,0,this.radiusX/this.radius,this.radiusY/this.radius,this.radiusZ/this.radius),this.inverseMatrix.copy(this.matrix),this.inverseMatrix.invert(),this.src.x=0,this.src.y=0,this.src.z=0,this.displ.x=this.inverseMatrix.a*i.x+this.inverseMatrix.b*i.y+this.inverseMatrix.c*i.z,this.displ.y=this.inverseMatrix.e*i.x+this.inverseMatrix.f*i.y+this.inverseMatrix.g*i.z,this.displ.z=this.inverseMatrix.i*i.x+this.inverseMatrix.j*i.y+this.inverseMatrix.k*i.z,this.dest.x=this.src.x+this.displ.x,this.dest.y=this.src.y+this.displ.y,this.dest.z=this.src.z+this.displ.z;var e=this.displ,n=this.radius+Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);this.cornerA.x=-n,this.cornerA.y=-n,this.cornerA.z=-n,this.cornerB.x=n,this.cornerB.y=-n,this.cornerB.z=-n,this.cornerC.x=n,this.cornerC.y=n,this.cornerC.z=-n,this.cornerD.x=-n,this.cornerD.y=n,this.cornerD.z=-n,this.rad=n},loopGeometries:function(){var t=this.rad;this.numFaces=0;for(var i,e=0,n=0,s=0,r=0,a=0,h=this.numGeometries;a<h;){var o=a++,l=this.geometries[o],u=this.transforms[o],m=l.numVertices,c=l.numIndices,f=l.vertices;if(0!=m&&0!=c){i=0;for(var x=3*m;i<x;){var d=f[i],_=f[i+1],g=f[i+2];this.vertices[r]=u.a*d+u.b*_+u.c*g+u.d,++r,this.vertices[r]=u.e*d+u.f*_+u.g*g+u.h,++r,this.vertices[r]=u.i*d+u.j*_+u.k*g+u.l,++r,i+=3}var p=l.indices;for(i=0;i<c;){var v=p[i]+s;++i;var y=3*v,b=this.vertices[y];++y;var w=this.vertices[y];++y;var z=this.vertices[y],Y=p[i]+s;++i,y=3*Y;var S=this.vertices[y];++y;var X=this.vertices[y];++y;var Z=this.vertices[y],P=p[i]+s;++i,y=3*P;var T=this.vertices[y];++y;var L=this.vertices[y];++y;var I=this.vertices[y];if(!(b>t&&S>t&&T>t||b<-t&&S<-t&&T<-t)&&!(w>t&&X>t&&L>t||w<-t&&X<-t&&L<-t||z>t&&Z>t&&I>t||z<-t&&Z<-t&&I<-t)){var O=S-b,E=X-w,C=Z-z,D=T-b,k=L-w,A=I-z,M=A*E-k*C,R=D*C-A*O,B=k*O-D*E,N=M*M+R*R+B*B;if(!(N<.001)){var V=b*(M*=N=1/Math.sqrt(N))+w*(R*=N)+z*(B*=N);V>t||V<-t||(this.indices[e]=v,++e,this.indices[e]=Y,++e,this.indices[e]=P,++e,this.normals[n]=M,++n,this.normals[n]=R,++n,this.normals[n]=B,++n,this.normals[n]=V,++n,this.numFaces++)}}}s+=m}}this.numGeometries=0,this.numI=e},loopGeometriesNaive:function(){this.rad;this.numFaces=0;for(var t,i=0,e=0,n=0,s=0,r=0,a=this.numGeometries;r<a;){var h=r++,o=this.geometries[h],l=this.matrix,u=o.numVertices,m=o.numIndices,c=o.vertices;if(0!=u&&0!=m){t=0;for(var f=3*u;t<f;){var x=c[t],d=c[t+1],_=c[t+2];this.vertices[s]=l.a*x+l.b*d+l.c*_+l.d,++s,this.vertices[s]=l.e*x+l.f*d+l.g*_+l.h,++s,this.vertices[s]=l.i*x+l.j*d+l.k*_+l.l,++s,t+=3}var g=o.indices;for(t=0;t<m;){var p=g[t]+n;++t;var v=3*p,y=this.vertices[v];++v;var b=this.vertices[v];++v;var w=this.vertices[v],z=g[t]+n;++t,v=3*z;var Y=this.vertices[v];++v;var S=this.vertices[v];++v;var X=this.vertices[v],Z=g[t]+n;++t,v=3*Z;var P=this.vertices[v];++v;var T=this.vertices[v];++v;var L=Y-y,I=S-b,O=X-w,E=P-y,C=T-b,D=this.vertices[v]-w,k=D*I-C*O,A=E*O-D*L,M=C*L-E*I,R=k*k+A*A+M*M,B=y*(k*=R=1/Math.sqrt(R))+b*(A*=R)+w*(M*=R);this.indices[i]=p,++i,this.indices[i]=z,++i,this.indices[i]=Z,++i,this.normals[e]=k,++e,this.normals[e]=A,++e,this.normals[e]=M,++e,this.normals[e]=B,++e,this.numFaces++}n+=u}}this.numGeometries=0,this.numI=i},calculateCollidableGeometry:function(t,i){this.prepare(t,systems_collisions_EllipsoidCollider.ZERO_VECTOR),i.collectGeometry(this),this.loopGeometriesNaive()},addGeometry:function(t,i){this.geometries[this.numGeometries]=t,this.transforms[this.numGeometries]=i,this.numGeometries++},calculateDestination:function(t,i,e,n,s){if(null==s&&(s=0),null==n&&(n=1),Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)<=this.threshold)return this.gotMoved=!1,new jeash_geom_Vector3D(t.x,t.y,t.z,t.w);this.gotMoved=!0,this.timestamp++,this.prepare(t,i),e.collectGeometry(this),this.loopGeometries();var r,a=n,h=s;if(this.collisions=null,this.numFaces>0){for(var o=0;o++<50&&(r=this.checkCollision())<1;){var l,u,m,c=r*a;h+=c,a-=c,this.resCollisionPoint.x=this.matrix.a*this.collisionPoint.x+this.matrix.b*this.collisionPoint.y+this.matrix.c*this.collisionPoint.z+this.matrix.d,this.resCollisionPoint.y=this.matrix.e*this.collisionPoint.x+this.matrix.f*this.collisionPoint.y+this.matrix.g*this.collisionPoint.z+this.matrix.h,this.resCollisionPoint.z=this.matrix.i*this.collisionPoint.x+this.matrix.j*this.collisionPoint.y+this.matrix.k*this.collisionPoint.z+this.matrix.l,this.collisionPlane.x<this.collisionPlane.y?this.collisionPlane.x<this.collisionPlane.z?(l=0,u=-this.collisionPlane.z,m=this.collisionPlane.y):(l=-this.collisionPlane.y,u=this.collisionPlane.x,m=0):this.collisionPlane.y<this.collisionPlane.z?(l=this.collisionPlane.z,u=0,m=-this.collisionPlane.x):(l=-this.collisionPlane.y,u=this.collisionPlane.x,m=0);var f=this.collisionPlane.z*u-this.collisionPlane.y*m,x=this.collisionPlane.x*m-this.collisionPlane.z*l,d=this.collisionPlane.y*l-this.collisionPlane.x*u,_=this.matrix.a*l+this.matrix.b*u+this.matrix.c*m,g=this.matrix.e*l+this.matrix.f*u+this.matrix.g*m,p=this.matrix.i*l+this.matrix.j*u+this.matrix.k*m,v=this.matrix.a*f+this.matrix.b*x+this.matrix.c*d,y=this.matrix.e*f+this.matrix.f*x+this.matrix.g*d,b=this.matrix.i*f+this.matrix.j*x+this.matrix.k*d;this.resCollisionPlane.x=p*y-g*b,this.resCollisionPlane.y=_*b-p*v,this.resCollisionPlane.z=g*v-_*y;var w=this.resCollisionPlane,z=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);0!=z&&(w.x/=z,w.y/=z,w.z/=z),this.resCollisionPlane.w=this.resCollisionPoint.x*this.resCollisionPlane.x+this.resCollisionPoint.y*this.resCollisionPlane.y+this.resCollisionPoint.z*this.resCollisionPlane.z;var Y=this.radius+this.threshold+this.collisionPlane.w-this.dest.x*this.collisionPlane.x-this.dest.y*this.collisionPlane.y-this.dest.z*this.collisionPlane.z;if(this.dest.x+=this.collisionPlane.x*Y,this.dest.y+=this.collisionPlane.y*Y,this.dest.z+=this.collisionPlane.z*Y,this.src.x=this.collisionPoint.x+this.collisionPlane.x*(this.radius+this.threshold),this.src.y=this.collisionPoint.y+this.collisionPlane.y*(this.radius+this.threshold),this.src.z=this.collisionPoint.z+this.collisionPlane.z*(this.radius+this.threshold),this.requireEvents){this.resultVector.x=this.matrix.a*this.src.x+this.matrix.b*this.src.y+this.matrix.c*this.src.z+this.matrix.d,this.resultVector.y=this.matrix.e*this.src.x+this.matrix.f*this.src.y+this.matrix.g*this.src.z+this.matrix.h,this.resultVector.z=this.matrix.i*this.src.x+this.matrix.j*this.src.y+this.matrix.k*this.src.z+this.matrix.l;var S=systems_collisions_CollisionEvent.GetAs3(this.resCollisionPoint,this.resCollisionPlane,this.resCollisionPlane.w,h,this.resultVector,3);S.next=this.collisions,this.collisions=S}this.displ.x=this.dest.x-this.src.x,this.displ.y=this.dest.y-this.src.y,this.displ.z=this.dest.z-this.src.z;var X=this.displ;if(Math.sqrt(X.x*X.x+X.y*X.y+X.z*X.z)<this.threshold)break}this.resultVector.x=this.matrix.a*this.dest.x+this.matrix.b*this.dest.y+this.matrix.c*this.dest.z+this.matrix.d,this.resultVector.y=this.matrix.e*this.dest.x+this.matrix.f*this.dest.y+this.matrix.g*this.dest.z+this.matrix.h,this.resultVector.z=this.matrix.i*this.dest.x+this.matrix.j*this.dest.y+this.matrix.k*this.dest.z+this.matrix.l}else this.resultVector.x=t.x+i.x,this.resultVector.y=t.y+i.y,this.resultVector.z=t.z+i.z;var Z=this.resultVector.x;return Z!=Z?new jeash_geom_Vector3D(t.x,t.y,t.z,t.w):this.resultVector},getCollision:function(t,i,e,n,s){if(Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)<=this.threshold)return!1;if(this.prepare(t,i),s.collectGeometry(this),this.loopGeometries(),this.numFaces>0){if(this.checkCollision()<1){var r,a,h;e.x=this.matrix.a*this.collisionPoint.x+this.matrix.b*this.collisionPoint.y+this.matrix.c*this.collisionPoint.z+this.matrix.d,e.y=this.matrix.e*this.collisionPoint.x+this.matrix.f*this.collisionPoint.y+this.matrix.g*this.collisionPoint.z+this.matrix.h,e.z=this.matrix.i*this.collisionPoint.x+this.matrix.j*this.collisionPoint.y+this.matrix.k*this.collisionPoint.z+this.matrix.l,this.collisionPlane.x<this.collisionPlane.y?this.collisionPlane.x<this.collisionPlane.z?(r=0,a=-this.collisionPlane.z,h=this.collisionPlane.y):(r=-this.collisionPlane.y,a=this.collisionPlane.x,h=0):this.collisionPlane.y<this.collisionPlane.z?(r=this.collisionPlane.z,a=0,h=-this.collisionPlane.x):(r=-this.collisionPlane.y,a=this.collisionPlane.x,h=0);var o=this.collisionPlane.z*a-this.collisionPlane.y*h,l=this.collisionPlane.x*h-this.collisionPlane.z*r,u=this.collisionPlane.y*r-this.collisionPlane.x*a,m=this.matrix.a*r+this.matrix.b*a+this.matrix.c*h,c=this.matrix.e*r+this.matrix.f*a+this.matrix.g*h,f=this.matrix.i*r+this.matrix.j*a+this.matrix.k*h,x=this.matrix.a*o+this.matrix.b*l+this.matrix.c*u,d=this.matrix.e*o+this.matrix.f*l+this.matrix.g*u,_=this.matrix.i*o+this.matrix.j*l+this.matrix.k*u;n.x=f*d-c*_,n.y=m*_-f*x,n.z=c*x-m*d;var g=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return 0!=g&&(n.x/=g,n.y/=g,n.z/=g),n.w=e.x*n.x+e.y*n.y+e.z*n.z,!0}return!1}return!1},checkCollision:function(){for(var t,i=1,e=this.displ,n=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),s=3*this.numFaces,r=0,a=0;a<s;){var h=3*this.indices[a];++a;var o=this.vertices[h];++h;var l=this.vertices[h];++h;var u=this.vertices[h];h=3*this.indices[a],++a;var m=this.vertices[h];++h;var c=this.vertices[h];++h;var f=this.vertices[h];h=3*this.indices[a],++a;var x=this.vertices[h];++h;var d=this.vertices[h];++h;var _=this.vertices[h],g=this.normals[r];++r;var p=this.normals[r];++r;var v=this.normals[r];++r;var y=this.normals[r];++r;var b,w,z,Y=this.src.x*g+this.src.y*p+this.src.z*v-y;Y<this.radius?(b=this.src.x-g*Y,w=this.src.y-p*Y,z=this.src.z-v*Y):(t=(Y-this.radius)/(Y-this.dest.x*g-this.dest.y*p-this.dest.z*v+y),b=this.src.x+this.displ.x*t-g*this.radius,w=this.src.y+this.displ.y*t-p*this.radius,z=this.src.z+this.displ.z*t-v*this.radius);for(var S=0,X=0,Z=0,P=1e22,T=!0,L=0;L<3;){var I,O,E,C,D,k,A=L++;0==A?(I=o,O=l,E=u,C=m,D=c,k=f):1==A?(I=m,O=c,E=f,C=x,D=d,k=_):(I=x,O=d,E=_,C=o,D=l,k=u);var M=C-I,R=D-O,B=k-E,N=b-I,V=w-O,F=z-E,j=F*R-V*B,U=N*B-F*M,q=V*M-N*R;if(j*g+U*p+q*v<0){var G,H=M*M+R*R+B*B,W=(j*j+U*U+q*q)/H;if(W<P)(t=(M/=H=Math.sqrt(H))*N+(R/=H)*V+(B/=H)*F)<0?(G=N*N+V*V+F*F)<P&&(P=G,S=I,X=O,Z=E):t>H?(G=(N=b-C)*N+(V=w-D)*V+(F=z-k)*F)<P&&(P=G,S=C,X=D,Z=k):(P=W,S=I+M*t,X=O+R*t,Z=E+B*t);T=!1}}T&&(S=b,X=w,Z=z);var Q=this.src.x-S,K=this.src.y-X,$=this.src.z-Z;if(Q*this.displ.x+K*this.displ.y+$*this.displ.z<=0){var J=Q*Q+K*K+$*$,tt=Q*(-this.displ.x/n)+K*(-this.displ.y/n)+$*(-this.displ.z/n),it=this.radius*this.radius-J+tt*tt;if(it>0){var et=(tt-Math.sqrt(it))/n;et<i&&(i=et,this.collisionPoint.x=S,this.collisionPoint.y=X,this.collisionPoint.z=Z,T?(this.collisionPlane.x=g,this.collisionPlane.y=p,this.collisionPlane.z=v,this.collisionPlane.w=y):(J=Math.sqrt(J),this.collisionPlane.x=Q/J,this.collisionPlane.y=K/J,this.collisionPlane.z=$/J,this.collisionPlane.w=this.collisionPoint.x*this.collisionPlane.x+this.collisionPoint.y*this.collisionPlane.y+this.collisionPoint.z*this.collisionPlane.z))}}}return i},__class__:systems_collisions_EllipsoidCollider};var util_LibUtil=function(){};e["util.LibUtil"]=util_LibUtil,util_LibUtil.__name__=["util","LibUtil"],util_LibUtil.is=function(t,i){return js_Boot.__instanceof(t,i)},util_LibUtil.as=function(t,i){return js_Boot.__instanceof(t,i)?t:null};var util_TypeDefs=function(){};e["util.TypeDefs"]=util_TypeDefs,util_TypeDefs.__name__=["util","TypeDefs"],util_TypeDefs.createFloatVector=function(t,i){var e=[];return e.length=t,e},util_TypeDefs.createIntVector=function(t,i){var e=[];return e.length=t,e},util_TypeDefs.createUIntVector=function(t,i){var e=[];return e.length=t,e},util_TypeDefs.createVector=function(t,i){var e=[];return e.length=t,e},util_TypeDefs.setVectorLen=function(t,i,e){null==e&&(e=-1),t.length=i};var util_geom_AABBUtils=function(){};e["util.geom.AABBUtils"]=util_geom_AABBUtils,util_geom_AABBUtils.__name__=["util","geom","AABBUtils"],util_geom_AABBUtils.getRect=function(t,i){null==i&&(i=.1);var e=t.maxX-t.minX,n=t.maxZ-t.minZ;return new jeash_geom_Rectangle(t.minX,t.minZ,e<0||e<i?i:e,n<0||n<i?i:n)},util_geom_AABBUtils.clampMagnitude=function(t,i){return null==i&&(i=.1),t<0||t<i?i:t},util_geom_AABBUtils.abs=function(t){return t<0?-t:t},util_geom_AABBUtils.norm=function(t){return 0!=t?t<0?-1:1:0},util_geom_AABBUtils.getString=function(t){return"AABB: "+Std.string([t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ])},util_geom_AABBUtils.pointInside=function(t,i){return!(i.x<t.minX||i.y<t.minY||i.z<t.minZ||i.x>t.maxX||i.y>t.maxY||i.z>t.maxZ)},util_geom_AABBUtils.intersectsEachOther=function(t,i){return!(t.maxX<i.minX||t.maxY<i.minY||t.maxZ<i.minZ||t.minX>i.maxX||t.minY>i.maxY||t.minZ>i.maxZ)},util_geom_AABBUtils.intersectsBoundValues=function(t,i,e,n,s,r,a){return!(t.maxX<i||t.maxY<e||t.maxZ<n||t.minX>s||t.minY>r||t.minZ>a)},util_geom_AABBUtils.transform=function(t,i){var e=t.minX,n=t.minY,s=t.minZ,r=t.maxX,a=t.maxY,h=t.maxZ;t.minX=17976931348623157e292,t.minY=17976931348623157e292,t.minZ=17976931348623157e292,t.maxX=-17976931348623157e292,t.maxY=-17976931348623157e292,t.maxZ=-17976931348623157e292;var o,l,u,m=e,c=n,f=s;o=m*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),c=n,f=s,o=(m=r)*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),c=a,f=s,o=(m=e)*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),c=n,f=h,o=(m=e)*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),m=t.maxX,c=t.maxY,f=t.minZ,o=m*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),c=a,f=h,o=(m=e)*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),c=n,f=h,o=(m=r)*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u),m=t.maxX,c=t.maxY,f=t.maxZ,o=m*i.a+c*i.b+f*i.c+i.d,l=m*i.e+c*i.f+f*i.g+i.h,u=m*i.i+c*i.j+f*i.k+i.l,o<t.minX&&(t.minX=o),l<t.minY&&(t.minY=l),u<t.minZ&&(t.minZ=u),o>t.maxX&&(t.maxX=o),l>t.maxY&&(t.maxY=l),u>t.maxZ&&(t.maxZ=u)},util_geom_AABBUtils.match=function(t,i){t.minX=i.minX,t.minY=i.minY,t.minZ=i.minZ,t.maxX=i.maxX,t.maxY=i.maxY,t.maxZ=i.maxZ},util_geom_AABBUtils.setToMax=function(t){t.minX=-17976931348623157e292,t.minY=-17976931348623157e292,t.minZ=-17976931348623157e292,t.maxX=17976931348623157e292,t.maxY=17976931348623157e292,t.maxZ=17976931348623157e292},util_geom_AABBUtils.reset=function(t){t.minX=17976931348623157e292,t.minY=17976931348623157e292,t.minZ=17976931348623157e292,t.maxX=-17976931348623157e292,t.maxY=-17976931348623157e292,t.maxZ=-17976931348623157e292},util_geom_AABBUtils.expand2=function(t,i){i.minX<t.minX&&(t.minX=i.minX),i.minY<t.minY&&(t.minY=i.minY),i.minZ<t.minZ&&(t.minZ=i.minZ),i.maxX>t.maxX&&(t.maxX=i.maxX),i.maxY>t.maxY&&(t.maxY=i.maxY),i.maxZ>t.maxZ&&(t.maxZ=i.maxZ)},util_geom_AABBUtils.expand=function(t,i,e,n){t<n.minX&&(n.minX=t),i<n.minY&&(n.minY=i),e<n.minZ&&(n.minZ=e),t>n.maxX&&(n.maxX=t),i>n.maxY&&(n.maxY=i),e>n.maxZ&&(n.maxZ=e)},util_geom_AABBUtils.expandWithPoint=function(t,i){t.x<i.minX&&(i.minX=t.x),t.y<i.minY&&(i.minY=t.y),t.z<i.minZ&&(i.minZ=t.z),t.x>i.maxX&&(i.maxX=t.x),t.y>i.maxY&&(i.maxY=t.y),t.z>i.maxZ&&(i.maxZ=t.z)},util_geom_AABBUtils.checkSphere=function(t,i){return i.x+i.w>t.minX&&i.x-i.w<t.maxX&&i.y+i.w>t.minY&&i.y-i.w<t.maxY&&i.z+i.w>t.minZ&&i.z-i.w<t.maxZ},util_geom_AABBUtils.intersectRay=function(t,i,e){return i.x>=t.minX&&i.x<=t.maxX&&i.y>=t.minY&&i.y<=t.maxY&&i.z>=t.minZ&&i.z<=t.maxZ||!(i.x<t.minX&&e.x<=0)&&(!(i.x>t.maxX&&e.x>=0)&&(!(i.y<t.minY&&e.y<=0)&&(!(i.y>t.maxY&&e.y>=0)&&(!(i.z<t.minZ&&e.z<=0)&&(!(i.z>t.maxZ&&e.z>=0)&&(e.x>1e-6?(n=(t.minX-i.x)/e.x,s=(t.maxX-i.x)/e.x):e.x<-1e-6?(n=(t.maxX-i.x)/e.x,s=(t.minX-i.x)/e.x):(n=-1e22,s=1e22),e.y>1e-6?(r=(t.minY-i.y)/e.y,a=(t.maxY-i.y)/e.y):e.y<-1e-6?(r=(t.maxY-i.y)/e.y,a=(t.minY-i.y)/e.y):(r=-1e22,a=1e22),!(r>=s||a<=n)&&(r<n||(n=r),a<s&&(s=a),e.z>1e-6?(r=(t.minZ-i.z)/e.z,a=(t.maxZ-i.z)/e.z):e.z<-1e-6?(r=(t.maxZ-i.z)/e.z,a=(t.minZ-i.z)/e.z):(r=-1e22,a=1e22),!(r>=s||a<=n))))))));var n,s,r,a};var util_geom_GeomCollisionSceneUtil=function(){};e["util.geom.GeomCollisionSceneUtil"]=util_geom_GeomCollisionSceneUtil,util_geom_GeomCollisionSceneUtil.__name__=["util","geom","GeomCollisionSceneUtil"],util_geom_GeomCollisionSceneUtil.calculateHierarchyBoundBox=function(t,i,e){if(null==e&&(e=new components_BoundBox),null!=i&&t!=i){var n,s=null;util_geom_GeomCollisionSceneUtil.toRootTransform.copy(t.transform);for(var r=t;null!=r._parent;)r=r._parent,util_geom_GeomCollisionSceneUtil.toRootTransform.append(r.transform),r==i&&(s=util_geom_GeomCollisionSceneUtil.toRootTransform);if(n=r,null==s){for(util_geom_GeomCollisionSceneUtil.fromRootTransform.copy(i.inverseTransform),r=i;null!=r._parent;)r=r._parent,util_geom_GeomCollisionSceneUtil.fromRootTransform.prepend(r.inverseTransform);if(n!=r)throw new js__$Boot_HaxeError("Object and boundBoxSpace must be located in the same hierarchy.");util_geom_GeomCollisionSceneUtil.toRootTransform.append(util_geom_GeomCollisionSceneUtil.fromRootTransform),s=util_geom_GeomCollisionSceneUtil.toRootTransform}util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(t,e,s)}else util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(t,e);return e},util_geom_GeomCollisionSceneUtil.transformBounds=function(t,i){var e,n,s;e=t.minX,n=t.minY,s=t.minZ,t.minX=i.a*e+i.b*n+i.c*s+i.d,t.minY=i.e*e+i.f*n+i.g*s+i.h,t.minZ=i.i*e+i.j*n+i.k*s+i.l,e=t.maxX,n=t.maxY,s=t.maxZ,t.maxX=i.a*e+i.b*n+i.c*s+i.d,t.maxY=i.e*e+i.f*n+i.g*s+i.h,t.maxZ=i.i*e+i.j*n+i.k*s+i.l},util_geom_GeomCollisionSceneUtil.updateBounds=function(t,i){i.minX<t.minX&&(t.minX=i.minX),i.maxX>t.maxX&&(t.maxX=i.maxX),i.minY<t.minY&&(t.minY=i.minY),i.maxY>t.maxY&&(t.maxY=i.maxY),i.minZ<t.minZ&&(t.minZ=i.minZ),i.maxZ>t.maxZ&&(t.maxZ=i.maxZ)},util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically=function(t,i,e){if(null!=t.boundBox){var n=t.boundBox;n.minX<i.minX&&(i.minX=n.minX),n.maxX>i.maxX&&(i.maxX=n.maxX),n.minY<i.minY&&(i.minY=n.minY),n.maxY>i.maxY&&(i.maxY=n.maxY),n.minZ<i.minZ&&(i.minZ=n.minZ),n.maxZ>i.maxZ&&(i.maxZ=n.maxZ)}for(var s=t.childrenList;null!=s;)s.localToGlobalTransform.copy(s.transform),null!=e&&s.localToGlobalTransform.append(e),util_geom_GeomCollisionSceneUtil.updateBoundBoxHierarchically(s,i,s.localToGlobalTransform),s=s.next};var util_geom_GeomUtil=function(){};e["util.geom.GeomUtil"]=util_geom_GeomUtil,util_geom_GeomUtil.__name__=["util","geom","GeomUtil"],util_geom_GeomUtil.transformVertices=function(t,i){for(var e=t.length,n=0;n<e;){var s=t[n],r=t[n+1],a=t[n+2];t[n]=i.a*s+i.b*r+i.c*a+i.d,t[n+1]=i.e*s+i.f*r+i.g*a+i.h,t[n+2]=i.i*s+i.j*r+i.k*a+i.l,n+=3}},util_geom_GeomUtil.boundIntersectSphere=function(t,i,e,n,s,r,a){return t.x+t.w>i&&t.x-t.w<s&&t.y+t.w>e&&t.y-t.w<r&&t.z+t.w>n&&t.z-t.w<a},util_geom_GeomUtil.boundIntersectRay=function(t,i,e,n,s,r,a,h,o){if(t.x>=e&&t.x<=r&&t.y>=n&&t.y<=a&&t.z>=s&&t.z<=h)return!0;if(t.x<e&&i.x<=0)return!1;if(t.x>r&&i.x>=0)return!1;if(t.y<n&&i.y<=0)return!1;if(t.y>a&&i.y>=0)return!1;if(t.z<s&&i.z<=0)return!1;if(t.z>h&&i.z>=0)return!1;var l,u,m,c,f=1e-6;return i.x>f?(l=(e-t.x)/i.x,u=(r-t.x)/i.x):i.x<-1e-6?(l=(r-t.x)/i.x,u=(e-t.x)/i.x):(l=-1e22,u=1e22),i.y>f?(m=(n-t.y)/i.y,c=(a-t.y)/i.y):i.y<-1e-6?(m=(a-t.y)/i.y,c=(n-t.y)/i.y):(m=-1e22,c=1e22),!(m>=u||c<=l)&&(m<l||(l=m),c<u&&(u=c),i.z>f?(m=(s-t.z)/i.z,c=(h-t.z)/i.z):i.z<-1e-6?(m=(h-t.z)/i.z,c=(s-t.z)/i.z):(m=-1e22,c=1e22),m=m>l?m:l,c=c<u?c:u,!(i.w>0&&m>=i.w||o.w>0&&m>=o.w)&&!(m>=u||c<=l))},util_geom_GeomUtil.intersectRayTri=function(t,i,e,n,s,r,a,h,o,l,u,m,c,f,x,d){var _=u-h,g=m-o,p=c-l,v=f-h,y=x-o,b=d-l,w=b*g-y*p,z=v*p-b*_,Y=y*_-v*g,S=w*w+z*z+Y*Y;S>.001&&(w*=S=1/Math.sqrt(S),z*=S,Y*=S);var X=s*w+r*z+a*Y;if(X<0){var Z=i*w+e*z+n*Y-(h*w+o*z+l*Y);if(Z>0){var P=-Z/X,T=i+s*P,L=e+r*P,I=n+a*P;if(((b=I-l)*(g=m-o)-(y=L-o)*(p=c-l))*w+((v=T-h)*p-b*(_=u-h))*z+(y*_-v*g)*Y>=0&&((b=I-c)*(g=x-m)-(y=L-m)*(p=d-c))*w+((v=T-u)*p-b*(_=f-u))*z+(y*_-v*g)*Y>=0&&((b=I-d)*(g=o-x)-(y=L-x)*(p=l-d))*w+((v=T-f)*p-b*(_=h-f))*z+(y*_-v*g)*Y>=0)return t.w=P,t.x=T,t.y=L,t.z=I,!0}}return!1};var util_geom_ITECollidable=function(){};e["util.geom.ITECollidable"]=util_geom_ITECollidable,util_geom_ITECollidable.__name__=["util","geom","ITECollidable"],util_geom_ITECollidable.__interfaces__=[systems_collisions_ITCollidable,systems_collisions_IECollidable];var util_geom_Geometry=function(){this.vertices=[],this.indices=[],this.numVertices=0,this.numIndices=0};e["util.geom.Geometry"]=util_geom_Geometry,util_geom_Geometry.__name__=["util","geom","Geometry"],util_geom_Geometry.__interfaces__=[altern_culling_IFrustumCollectTri,altern_ray_IRaycastImpl,util_geom_ITECollidable],util_geom_Geometry.prototype={setVertices:function(t){this.vertices=t,this.numVertices=t.length/3|0},setIndices:function(t){this.indices=t,this.numIndices=t.length},collectGeometry:function(t){t.geometries[t.numGeometries]=this,t.transforms[t.numGeometries]=t.inverseMatrix,t.numGeometries++},collectGeometryAndTransforms:function(t,i){t.geometries[t.numGeometries]=this,t.transforms[t.numGeometries]=i,t.numGeometries++},intersectRay:function(t,i,e){for(var n=t.x,s=t.y,r=t.z,a=i.x,h=i.y,o=i.z,l=null,u=0!=e.w?e.w:0!=i.w?i.w:1e22,m=3*Math.floor(this.numIndices/3),c=0,f=0;f<m;){var x=this.indices[f],d=this.indices[f+1],_=this.indices[f+2];c=3*x;var g=this.vertices[c++],p=this.vertices[c++],v=this.vertices[c];c=3*d;var y=this.vertices[c++],b=this.vertices[c++],w=this.vertices[c];c=3*_;var z=this.vertices[c++],Y=this.vertices[c++],S=this.vertices[c],X=y-g,Z=b-p,P=w-v,T=z-g,L=Y-p,I=S-v,O=I*Z-L*P,E=T*P-I*X,C=L*X-T*Z,D=O*O+E*E+C*C;D>.001&&(O*=D=1/Math.sqrt(D),E*=D,C*=D);var k=a*O+h*E+o*C;if(k<0){var A=n*O+s*E+r*C-(g*O+p*E+v*C);if(A>0){var M=-A/k;if(null==l||M<u){var R=n+a*M,B=s+h*M,N=r+o*M;((I=N-v)*(Z=b-p)-(L=B-p)*(P=w-v))*O+((T=R-g)*P-I*(X=y-g))*E+(L*X-T*Z)*C>=0&&((I=N-w)*(Z=Y-b)-(L=B-b)*(P=S-w))*O+((T=R-y)*P-I*(X=z-y))*E+(L*X-T*Z)*C>=0&&((I=N-S)*(Z=p-Y)-(L=B-Y)*(P=v-S))*O+((T=R-z)*P-I*(X=g-z))*E+(L*X-T*Z)*C>=0&&M<u&&(u=M,null==l&&(l=util_geom_Geometry.sampleRayPoint),l.x=R,l.y=B,l.z=N,g,p,v,O,y,b,w,E,z,Y,S,C)}}}f+=3}return null!=l?(e.x=l.x,e.y=l.y,e.z=l.z,e.w=u,e):null},collectTrisForFrustum:function(t,i,e,n,s){for(var r,a=n.length,h=s.length,o=this.numIndices,l=0;l<o;){var u=this.indices[l],m=this.indices[l+1],c=this.indices[l+2];r=3*u;var f=this.vertices[r++],x=this.vertices[r++],d=this.vertices[r];r=3*m;var _=this.vertices[r++],g=this.vertices[r++],p=this.vertices[r];r=3*c;var v,y=this.vertices[r++],b=this.vertices[r++],w=this.vertices[r];if(!!altern_culling_DefaultCulling.isInFrontOfFrustum(f,x,d,_,g,p,y,b,w,e)&&(v=altern_culling_DefaultCulling.triInFrustumCover(t,f,x,d,_,g,p,y,b,w))>=0)if(0==v)n[a++]=f,s[h]=h++,n[a++]=x,s[h]=h++,n[a++]=d,s[h]=h++,n[a++]=_,s[h]=h++,n[a++]=g,s[h]=h++,n[a++]=p,s[h]=h++,n[a++]=y,s[h]=h++,n[a++]=b,s[h]=h++,n[a++]=w,s[h]=h++;else if(null!=altern_culling_DefaultCulling.clippedFace){for(var z,Y=altern_culling_DefaultCulling.clippedFace,S=Y.wrapper.vertex,X=(z=Y.wrapper.next).next;null!=X;){var Z=z.vertex,P=X.vertex;n[a++]=S.x,s[h]=h++,n[a++]=S.y,s[h]=h++,n[a++]=S.z,s[h]=h++,n[a++]=Z.x,s[h]=h++,n[a++]=Z.y,s[h]=h++,n[a++]=Z.z,s[h]=h++,n[a++]=P.x,s[h]=h++,n[a++]=P.y,s[h]=h++,n[a++]=P.z,s[h]=h++,z=z.next,X=X.next}var T=altern_culling_DefaultCulling.clippedFace;T.destroy(),T.next=altern_geom_Face.collector,altern_geom_Face.collector=T}l+=3}},__class__:util_geom_Geometry};var util_geom_IMat3=function(){};e["util.geom.IMat3"]=util_geom_IMat3,util_geom_IMat3.__name__=["util","geom","IMat3"],util_geom_IMat3.prototype={__class__:util_geom_IMat3};var util_geom_IMat4=function(){};e["util.geom.IMat4"]=util_geom_IMat4,util_geom_IMat4.__name__=["util","geom","IMat4"],util_geom_IMat4.__interfaces__=[util_geom_IMat3],util_geom_IMat4.prototype={__class__:util_geom_IMat4};var util_geom_Mat3=function(t,i,e,n,s,r,a,h,o){null==o&&(o=1),null==h&&(h=0),null==a&&(a=0),null==r&&(r=0),null==s&&(s=1),null==n&&(n=0),null==e&&(e=0),null==i&&(i=0),null==t&&(t=1),this.a=t,this.b=i,this.c=e,this.e=n,this.f=s,this.g=r,this.i=a,this.j=h,this.k=o};e["util.geom.Mat3"]=util_geom_Mat3,util_geom_Mat3.__name__=["util","geom","Mat3"],util_geom_Mat3.__interfaces__=[util_geom_IMat3],util_geom_Mat3.prototype={determinant:function(){return 1/(-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k)},identity:function(){this.a=this.f=this.k=1,this.b=this.c=this.e=this.g=this.i=this.j=0},clone:function(){return new util_geom_Mat3(this.a,this.b,this.c,this.e,this.f,this.g,this.i,this.j,this.k)},transformVector:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},transformVectorTransposed:function(t,i){i.x=this.a*t.x+this.e*t.y+this.i*t.z,i.y=this.b*t.x+this.f*t.y+this.j*t.z,i.z=this.c*t.x+this.g*t.y+this.k*t.z},transformVec3To3D:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},invert:function(){var t=1/(-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k);this.a=(this.f*this.k-this.g*this.j)*t,this.b=(this.c*this.g-this.b*this.k)*t,this.c=(this.b*this.g-this.c*this.f)*t,this.e=(this.g*this.i-this.e*this.k)*t,this.f=(this.a*this.k-this.c*this.i)*t,this.g=(this.c*this.e-this.a*this.g)*t,this.i=(this.e*this.j-this.f*this.i)*t,this.j=(this.b*this.i-this.a*this.j)*t,this.k=(this.a*this.f-this.b*this.e)*t},invert_with_determinant:function(t){this.a=(this.f*this.k-this.g*this.j)*t,this.b=(this.c*this.g-this.b*this.k)*t,this.c=(this.b*this.g-this.c*this.f)*t,this.e=(this.g*this.i-this.e*this.k)*t,this.f=(this.a*this.k-this.c*this.i)*t,this.g=(this.c*this.e-this.a*this.g)*t,this.i=(this.e*this.j-this.f*this.i)*t,this.j=(this.b*this.i-this.a*this.j)*t,this.k=(this.a*this.f-this.b*this.e)*t},append:function(t){this.a=t.a*this.a+t.b*this.e+t.c*this.i,this.b=t.a*this.b+t.b*this.f+t.c*this.j,this.c=t.a*this.c+t.b*this.g+t.c*this.k,this.e=t.e*this.a+t.f*this.e+t.g*this.i,this.f=t.e*this.b+t.f*this.f+t.g*this.j,this.g=t.e*this.c+t.f*this.g+t.g*this.k,this.i=t.i*this.a+t.j*this.e+t.k*this.i,this.j=t.i*this.b+t.j*this.f+t.k*this.j,this.k=t.i*this.c+t.j*this.g+t.k*this.k},prepend:function(t){this.a=this.a*t.a+this.b*t.e+this.c*t.i,this.b=this.a*t.b+this.b*t.f+this.c*t.j,this.c=this.a*t.c+this.b*t.g+this.c*t.k,this.e=this.e*t.a+this.f*t.e+this.g*t.i,this.f=this.e*t.b+this.f*t.f+this.g*t.j,this.g=this.e*t.c+this.f*t.g+this.g*t.k,this.i=this.i*t.a+this.j*t.e+this.k*t.i,this.j=this.i*t.b+this.j*t.f+this.k*t.j,this.k=this.i*t.c+this.j*t.g+this.k*t.k},prependTransposed:function(t){this.a=this.a*t.a+this.b*t.b+this.c*t.c,this.b=this.a*t.e+this.b*t.f+this.c*t.g,this.c=this.a*t.i+this.b*t.j+this.c*t.k,this.e=this.e*t.a+this.f*t.b+this.g*t.c,this.f=this.e*t.e+this.f*t.f+this.g*t.g,this.g=this.e*t.i+this.f*t.j+this.g*t.k,this.i=this.i*t.a+this.j*t.b+this.k*t.c,this.j=this.i*t.e+this.j*t.f+this.k*t.g,this.k=this.i*t.i+this.j*t.j+this.k*t.k},add:function(t){this.a+=t.a,this.b+=t.b,this.c+=t.c,this.e+=t.e,this.f+=t.f,this.g+=t.g,this.i+=t.i,this.j+=t.j,this.k+=t.k},subtract:function(t){this.a-=t.a,this.b-=t.b,this.c-=t.c,this.e-=t.e,this.f-=t.f,this.g-=t.g,this.i-=t.i,this.j-=t.j,this.k-=t.k},transpose:function(){var t=this.b;this.b=this.e,this.e=t,t=this.c,this.c=this.i,this.i=t,t=this.g,this.g=this.j,this.j=t},toSkewSymmetric:function(t){this.a=this.f=this.k=0,this.b=-t.z,this.c=t.y,this.e=t.z,this.g=-t.x,this.i=-t.y,this.j=t.x},copyFrom:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f,this.g=t.g,this.i=t.i,this.j=t.j,this.k=t.k},writeToEulerAngles:function(t){-1<this.i&&this.i<1?(t.x=Math.atan2(this.j,this.k),t.y=-Math.asin(this.i),t.z=Math.atan2(this.e,this.a)):(t.x=0,t.y=this.i<=-1?Math.PI:-Math.PI,t.y*=.5,t.z=Math.atan2(-this.b,this.f))},setRotation:function(t,i,e){var n=Math.cos(t),s=Math.sin(t),r=Math.cos(i),a=Math.sin(i),h=Math.cos(e),o=Math.sin(e),l=h*a,u=o*a;this.a=h*r,this.b=l*s-o*n,this.c=l*n+o*s,this.e=o*r,this.f=u*s+h*n,this.g=u*n-h*s,this.i=-a,this.j=r*s,this.k=r*n},setFromAxisAngle:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=1-e,r=t.x,a=t.y,h=t.z;this.a=s*r*r+e,this.b=s*r*a-h*n,this.c=s*r*h+a*n,this.e=s*r*a+h*n,this.f=s*a*a+e,this.g=s*a*h-r*n,this.i=s*r*h-a*n,this.j=s*a*h+r*n,this.k=s*h*h+e},toString:function(){return"[Mat3 ("+this.a+", "+this.b+", "+this.c+"), ("+this.e+", "+this.f+", "+this.g+"), ("+this.i+", "+this.j+", "+this.k+")]"},__class__:util_geom_Mat3};var util_geom_Mat4=function(t,i,e,n,s,r,a,h,o,l,u,m){null==m&&(m=0),null==u&&(u=1),null==l&&(l=0),null==o&&(o=0),null==h&&(h=0),null==a&&(a=0),null==r&&(r=1),null==s&&(s=0),null==n&&(n=0),null==e&&(e=0),null==i&&(i=0),null==t&&(t=1),this.a=t,this.b=i,this.c=e,this.d=n,this.e=s,this.f=r,this.g=a,this.h=h,this.i=o,this.j=l,this.k=u,this.l=m};e["util.geom.Mat4"]=util_geom_Mat4,util_geom_Mat4.__name__=["util","geom","Mat4"],util_geom_Mat4.__interfaces__=[util_geom_IMat4],util_geom_Mat4.prototype={identity:function(){this.a=this.f=this.k=1,this.b=this.c=this.e=this.g=this.i=this.j=this.d=this.h=this.l=0},determinant:function(){return-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k},invert:function(){var t=-this.c*this.f*this.i+this.b*this.g*this.i+this.c*this.e*this.j-this.a*this.g*this.j-this.b*this.e*this.k+this.a*this.f*this.k;this.a=(-this.g*this.j+this.f*this.k)/t,this.b=(this.c*this.j-this.b*this.k)/t,this.c=(-this.c*this.f+this.b*this.g)/t,this.d=(this.d*this.g*this.j-this.c*this.h*this.j-this.d*this.f*this.k+this.b*this.h*this.k+this.c*this.f*this.l-this.b*this.g*this.l)/t,this.e=(this.g*this.i-this.e*this.k)/t,this.f=(-this.c*this.i+this.a*this.k)/t,this.g=(this.c*this.e-this.a*this.g)/t,this.h=(this.c*this.h*this.i-this.d*this.g*this.i+this.d*this.e*this.k-this.a*this.h*this.k-this.c*this.e*this.l+this.a*this.g*this.l)/t,this.i=(-this.f*this.i+this.e*this.j)/t,this.j=(this.b*this.i-this.a*this.j)/t,this.k=(-this.b*this.e+this.a*this.f)/t,this.l=(this.d*this.f*this.i-this.b*this.h*this.i-this.d*this.e*this.j+this.a*this.h*this.j+this.b*this.e*this.l-this.a*this.f*this.l)/t},invert_with_determinant:function(t){this.a=(-this.g*this.j+this.f*this.k)/t,this.b=(this.c*this.j-this.b*this.k)/t,this.c=(-this.c*this.f+this.b*this.g)/t,this.d=(this.d*this.g*this.j-this.c*this.h*this.j-this.d*this.f*this.k+this.b*this.h*this.k+this.c*this.f*this.l-this.b*this.g*this.l)/t,this.e=(this.g*this.i-this.e*this.k)/t,this.f=(-this.c*this.i+this.a*this.k)/t,this.g=(this.c*this.e-this.a*this.g)/t,this.h=(this.c*this.h*this.i-this.d*this.g*this.i+this.d*this.e*this.k-this.a*this.h*this.k-this.c*this.e*this.l+this.a*this.g*this.l)/t,this.i=(-this.f*this.i+this.e*this.j)/t,this.j=(this.b*this.i-this.a*this.j)/t,this.k=(-this.b*this.e+this.a*this.f)/t,this.l=(this.d*this.f*this.i-this.b*this.h*this.i-this.d*this.e*this.j+this.a*this.h*this.j+this.b*this.e*this.l-this.a*this.f*this.l)/t},append:function(t){this.a=t.a*this.a+t.b*this.e+t.c*this.i,this.b=t.a*this.b+t.b*this.f+t.c*this.j,this.c=t.a*this.c+t.b*this.g+t.c*this.k,this.d=t.a*this.d+t.b*this.h+t.c*this.l+t.d,this.e=t.e*this.a+t.f*this.e+t.g*this.i,this.f=t.e*this.b+t.f*this.f+t.g*this.j,this.g=t.e*this.c+t.f*this.g+t.g*this.k,this.h=t.e*this.d+t.f*this.h+t.g*this.l+t.h,this.i=t.i*this.a+t.j*this.e+t.k*this.i,this.j=t.i*this.b+t.j*this.f+t.k*this.j,this.k=t.i*this.c+t.j*this.g+t.k*this.k,this.l=t.i*this.d+t.j*this.h+t.k*this.l+t.l},prepend:function(t){this.a=this.a*t.a+this.b*t.e+this.c*t.i,this.b=this.a*t.b+this.b*t.f+this.c*t.j,this.c=this.a*t.c+this.b*t.g+this.c*t.k,this.d=this.a*t.d+this.b*t.h+this.c*t.l+this.d,this.e=this.e*t.a+this.f*t.e+this.g*t.i,this.f=this.e*t.b+this.f*t.f+this.g*t.j,this.g=this.e*t.c+this.f*t.g+this.g*t.k,this.h=this.e*t.d+this.f*t.h+this.g*t.l+this.h,this.i=this.i*t.a+this.j*t.e+this.k*t.i,this.j=this.i*t.b+this.j*t.f+this.k*t.j,this.k=this.i*t.c+this.j*t.g+this.k*t.k,this.l=this.i*t.d+this.j*t.h+this.k*t.l+this.l},add:function(t){this.a+=t.a,this.b+=t.b,this.c+=t.c,this.d+=t.d,this.e+=t.e,this.f+=t.f,this.g+=t.g,this.h+=t.h,this.i+=t.i,this.j+=t.j,this.k+=t.k,this.l+=t.l},subtract:function(t){this.a-=t.a,this.b-=t.b,this.c-=t.c,this.d-=t.d,this.e-=t.e,this.f-=t.f,this.g-=t.g,this.h-=t.h,this.i-=t.i,this.j-=t.j,this.k-=t.k,this.l-=t.l},transformPoint:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z+this.d,i.y=this.e*t.x+this.f*t.y+this.g*t.z+this.h,i.z=this.i*t.x+this.j*t.y+this.k*t.z+this.l},transformPointTransposed:function(t,i){var e=t.x-this.d,n=t.y-this.h,s=t.z-this.l;i.x=this.a*e+this.e*n+this.i*s,i.y=this.b*e+this.f*n+this.j*s,i.z=this.c*e+this.g*n+this.k*s},transformPoints:function(t,i){for(var e,n,s=0,r=t.length;s<r;){var a=s++;e=t[a],(n=i[a]).x=this.a*e.x+this.b*e.y+this.c*e.z+this.d,n.y=this.e*e.x+this.f*e.y+this.g*e.z+this.h,n.z=a*e.x+this.j*e.y+this.k*e.z+this.l}},transformPointsN:function(t,i,e){for(var n,s,r=0,a=e;r<a;){var h=r++;n=t[h],(s=i[h]).x=this.a*n.x+this.b*n.y+this.c*n.z+this.d,s.y=this.e*n.x+this.f*n.y+this.g*n.z+this.h,s.z=h*n.x+this.j*n.y+this.k*n.z+this.l}},transformPointsTransposed:function(t,i){for(var e,n,s=0,r=t.length;s<r;){var a=s++;e=t[a],n=i[a];var h=e.x-this.d,o=e.y-this.h,l=e.z-this.l;n.x=this.a*h+this.e*o+a*l,n.y=this.b*h+this.f*o+this.j*l,n.z=this.c*h+this.g*o+this.k*l}},transformPointsTransposedN:function(t,i,e){for(var n,s,r=0,a=e;r<a;){var h=r++;n=t[h],s=i[h];var o=n.x-this.d,l=n.y-this.h,u=n.z-this.l;s.x=this.a*o+this.e*l+h*u,s.y=this.b*o+this.f*l+this.j*u,s.z=this.c*o+this.g*l+this.k*u}},getAxis:function(t,i){switch(t){case 0:return i.x=this.a,i.y=this.e,void(i.z=this.i);case 1:return i.x=this.b,i.y=this.f,void(i.z=this.j);case 2:return i.x=this.c,i.y=this.g,void(i.z=this.k);case 3:return i.x=this.d,i.y=this.h,void(i.z=this.l)}},setAxes:function(t,i,e,n){this.a=t.x,this.e=t.y,this.i=t.z,this.b=i.x,this.f=i.y,this.j=i.z,this.c=e.x,this.g=e.y,this.k=e.z,this.d=n.x,this.h=n.y,this.l=n.z},transformVector:function(t,i){i.x=this.a*t.x+this.b*t.y+this.c*t.z,i.y=this.e*t.x+this.f*t.y+this.g*t.z,i.z=this.i*t.x+this.j*t.y+this.k*t.z},transformVectorTransposed:function(t,i){i.x=this.a*t.x+this.e*t.y+this.i*t.z,i.y=this.b*t.x+this.f*t.y+this.j*t.z,i.z=this.c*t.x+this.g*t.y+this.k*t.z},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.e=t.e,this.f=t.f,this.g=t.g,this.h=t.h,this.i=t.i,this.j=t.j,this.k=t.k,this.l=t.l},copy3:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f,this.g=t.g,this.i=t.i,this.j=t.j,this.k=t.k},getEulerAngles:function(t){-1<this.i&&this.i<1?(t.x=Math.atan2(this.j,this.k),t.y=-Math.asin(this.i),t.z=Math.atan2(this.e,this.a)):(t.x=0,t.y=this.i<=-1?Math.PI:-Math.PI,t.y*=.5,t.z=Math.atan2(-this.b,this.f))},setPosition:function(t){this.d=t.x,this.h=t.y,this.l=t.z},setPositionXYZ:function(t,i,e){this.d=t,this.h=i,this.l=e},clone:function(){return new util_geom_Mat4(this.a,this.b,this.c,this.d,this.e,this.f,this.g,this.h,this.i,this.j,this.k,this.l)},toString:function(){return"[Mat4 ["+this.a+" "+this.b+" "+this.c+" "+this.d+"] ["+this.e+" "+this.f+" "+this.g+" "+this.h+"] ["+this.i+" "+this.j+" "+this.k+" "+this.l+"]]"},setRotation:function(t,i,e){var n=Math.cos(t),s=Math.sin(t),r=Math.cos(i),a=Math.sin(i),h=Math.cos(e),o=Math.sin(e),l=h*a,u=o*a;this.a=h*r,this.b=l*s-o*n,this.c=l*n+o*s,this.e=o*r,this.f=u*s+h*n,this.g=u*n-h*s,this.i=-a,this.j=r*s,this.k=r*n},setFromAxisAngle:function(t,i){var e=Math.cos(i),n=Math.sin(i),s=1-e,r=t.x,a=t.y,h=t.z;this.a=s*r*r+e,this.b=s*r*a-h*n,this.c=s*r*h+a*n,this.e=s*r*a+h*n,this.f=s*a*a+e,this.g=s*a*h-r*n,this.i=s*r*h-a*n,this.j=s*a*h+r*n,this.k=s*h*h+e},__class__:util_geom_Mat4};var util_geom_PMath=function(){};e["util.geom.PMath"]=util_geom_PMath,util_geom_PMath.__name__=["util","geom","PMath"],util_geom_PMath.isNaN=function(t){return t!=t},util_geom_PMath.floatToInt=function(t){return 0|t},util_geom_PMath.intToFloat=function(t){return t},util_geom_PMath.toRad=function(t){return.017453292519943295*t},util_geom_PMath.toDeg=function(t){return 57.29577951308232*t},util_geom_PMath.min=function(t,i){return t<i?t:i},util_geom_PMath.minF=function(t,i){return t<i?t:i},util_geom_PMath.max=function(t,i){return t>i?t:i},util_geom_PMath.maxF=function(t,i){return t>i?t:i},util_geom_PMath.abs=function(t){return t<0?-t:t},util_geom_PMath.absI=function(t){return t<0?-t:t},util_geom_PMath.sgn=function(t){return t>0?1:t<0?-1:0},util_geom_PMath.clamp=function(t,i,e){return t<i?i:t>e?e:t},util_geom_PMath.clampSym=function(t,i){return t<-i?-i:t>i?i:t},util_geom_PMath.wrap=function(t,i,e){return t<i?t-i+e+1:t>e?t-e+i-1:t},util_geom_PMath.fmin=function(t,i){return t<i?t:i},util_geom_PMath.fmax=function(t,i){return t>i?t:i},util_geom_PMath.fabs=function(t){return t<0?-t:t},util_geom_PMath.fsign=function(t){return t>=0?1:-1},util_geom_PMath.fclamp=function(t,i,e){return t<i?i:t>e?e:t},util_geom_PMath.fclampSym=function(t,i){return t<-i?-i:t>i?i:t},util_geom_PMath.fwrap=function(t,i,e){return t<i?t-i+e+1:t>e?t-e+i-1:t},util_geom_PMath.eqSgn=function(t,i){return(t^i)>=0},util_geom_PMath.isEven=function(t){return 0==(1&t)},util_geom_PMath.isPow2=function(t){return t>0&&0==(t&t-1)},util_geom_PMath.lerp=function(t,i,e){return t+(i-t)*e},util_geom_PMath.lerp3=function(t,i,e,n,s){return(e-t)/(e-i)*n+(t-i)/(e-i)*s},util_geom_PMath.biLerp=function(t,i,e,n,s,r,a,h,o,l){return(l-i)/(l-o)*((h-t)/(h-a)*e+(t-a)/(h-a)*s)+(i-o)/(l-o)*((h-t)/(h-a)*n+(t-a)/(h-a)*r)},util_geom_PMath.triLerp=function(t,i,e,n,s,r,a,h,o,l,u,m,c,f,x,d,_){return(_-e)/(_-d)*((x-i)/(x-f)*((c-t)/(c-m)*n+(t-m)/(c-m)*h)+(i-f)/(x-f)*((c-t)/(c-m)*s+(t-m)/(c-m)*o))+(e-d)/(_-d)*((x-i)/(x-f)*((c-t)/(c-m)*r+(t-m)/(c-m)*l)+(i-f)/(x-f)*((c-t)/(c-m)*a+(t-m)/(c-m)*u))},util_geom_PMath.slerp=function(t,i,e){var n=Math,s=n.sin(.5*t),r=n.cos(.5*t),a=n.sin(.5*i),h=n.cos(.5*i),o=r*h+s*a;if(o<0){if(1+o>1e-6){var l=n.acos(-o),u=n.sin(l),m=n.sin((1-e)*l)/u,c=n.sin(e*l)/u;return 2*n.atan2(m*s-c*a,m*r-c*h)}var f=1-e,x=e;return 2*n.atan2(f*s-x*a,f*r-x*h)}if(1-o>1e-6){var d=n.acos(o),_=n.sin(d),g=n.sin((1-e)*d)/_,p=n.sin(e*d)/_;return 2*n.atan2(g*s+p*a,g*r+p*h)}var v=1-e,y=e;return 2*n.atan2(v*s+y*a,v*r+y*h)},util_geom_PMath.nextPow2=function(t){var i=t;return i|=i>>1,i|=i>>2,i|=i>>3,i|=i>>4,(i|=i>>5)+1},util_geom_PMath.exp=function(t,i){for(var e=1,n=0;;){if(0!=(1&i)&&(e*=t),0==(i>>=1)){n=e;break}t*=t}return n},util_geom_PMath.roundTo=function(t,i){var e=t/i;return(0|(e>0?e+.5:e<0?e-.5:0))*i},util_geom_PMath.round=function(t){return 0|(t>0?t+.5:t<0?t-.5:0)},util_geom_PMath.ceil=function(t){if(t>0){var i=t+.5|0;return i<t?i+1:i}if(t<0){var e=t-.5|0;return e<t?e+1:e}return 0},util_geom_PMath.floor=function(t){if(t>0){var i=t+.5|0;return i<t?i:i-1}if(t<0){var e=t-.5|0;return e>t?e-1:e}return 0},util_geom_PMath.invSqrt=function(t){return 1/Math.sqrt(t)},util_geom_PMath.cmpAbs=function(t,i,e){var n=t-i;return n>0?n<e:-n<e},util_geom_PMath.cmpZero=function(t,i){return t>0?t<i:-t<i},util_geom_PMath.snap=function(t,i){var e=(t+.5*i)/i;if(e>0){var n=e+.5|0;return n<e?n:n-1}if(e<0){var s=e-.5|0;return s>e?s-1:s}return 0},util_geom_PMath.inRange=function(t,i,e){return t>=i&&t<=e},util_geom_PMath.rand=function(){return 2147483647*Math.random()|0},util_geom_PMath.randRange=function(t,i){var e=t-.4999+(i+.4999-(t-.4999))*Math.random();return 0|(e>0?e+.5:e<0?e-.5:0)},util_geom_PMath.randRangeSym=function(t){var i=-t,e=i-.4999+(t+.4999-(i-.4999))*Math.random();return 0|(e>0?e+.5:e<0?e-.5:0)},util_geom_PMath.frand=function(){return Math.random()},util_geom_PMath.frandRange=function(t,i){return t+(i-t)*Math.random()},util_geom_PMath.frandRangeSym=function(t){var i=-t;return i+(t-i)*Math.random()},util_geom_PMath.wrapToPi=function(t){var i=t/6.283185307179586,e=0|(i>0?i+.5:i<0?i-.5:0);return t<-3.141592653589793||t>3.141592653589793?t-6.283185307179586*e:t};var util_geom_Vec3Utils=function(){};e["util.geom.Vec3Utils"]=util_geom_Vec3Utils,util_geom_Vec3Utils.__name__=["util","geom","Vec3Utils"],util_geom_Vec3Utils.copy=function(t){return new util_geom_Vec3(t.x,t.y,t.z)},util_geom_Vec3Utils.createCross=function(t,i){return new util_geom_Vec3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},util_geom_Vec3Utils.createAdd=function(t,i){return new util_geom_Vec3(t.x+i.x,t.y+i.y,t.z+i.z)},util_geom_Vec3Utils.createSubtract=function(t,i){return new util_geom_Vec3(t.x-i.x,t.y-i.y,t.z-i.z)},util_geom_Vec3Utils.createScale=function(t,i){return new util_geom_Vec3(t.x*i,t.y*i,t.z*i)},util_geom_Vec3Utils.createProjection=function(t,i){var e=t.x*i.x+t.y*i.y+t.z*i.z;return new util_geom_Vec3(t.x-i.x*e,t.y-i.y*e,t.z-i.z*e)},util_geom_Vec3Utils.matchValues=function(t,i){t.x=i.x,t.y=i.y,t.z=i.z},util_geom_Vec3Utils.matchValuesVector3D=function(t,i){t.x=i.x,t.y=i.y,t.z=i.z},util_geom_Vec3Utils.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},util_geom_Vec3Utils.writeCross=function(t,i,e){e.x=t.y*i.z-t.z*i.y,e.y=t.z*i.x-i.z*t.x,e.z=t.x*i.y-t.y*i.x},util_geom_Vec3Utils.writeProjection=function(t,i,e){var n=t.x*i.x+t.y*i.y+t.z*i.z;e.x=t.x-i.x*n,e.y=t.y-i.y*n,e.z=t.z-i.z*n},util_geom_Vec3Utils.normalize=function(t){var i=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3Utils.subtract=function(t,i){t.x-=i.x,t.y-=i.y,t.z-=i.z},util_geom_Vec3Utils.add=function(t,i){t.x+=i.x,t.y+=i.y,t.z+=i.z},util_geom_Vec3Utils.scale=function(t,i){t.x*=i,t.y*=i,t.z*=i},util_geom_Vec3Utils.writeSubtract=function(t,i,e){t.x=i.x-e.x,t.y=i.y-e.y,t.z=i.z-e.z},util_geom_Vec3Utils.getLength=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},util_geom_Vec3Utils.sqDistBetween=function(t,i){var e=i.x-t.x,n=i.y-t.y,s=i.z-t.z;return e*e+n*n+s*s},util_geom_Vec3Utils.sqDist2DBetween=function(t,i){var e=i.x-t.x,n=i.y-t.y;return e*e+n*n},util_geom_Vec3Utils.distBetween=function(t,i){var e=i.x-t.x,n=i.y-t.y,s=i.z-t.z;return Math.sqrt(e*e+n*n+s*s)};var y=0;function $bind(t,i){return null==i?null:(null==i.__id__&&(i.__id__=y++),null==t.hx__closures__?t.hx__closures__={}:e=t.hx__closures__[i.__id__],null==e&&((e=function(){return e.method.apply(e.scope,arguments)}).scope=t,e.method=i,t.hx__closures__[i.__id__]=e),e);var e}e.Math=Math,String.prototype.__class__=e.String=String,String.__name__=["String"],e.Array=Array,Array.__name__=["Array"];var b=e.Int={__name__:["Int"]},w=e.Dynamic={__name__:["Dynamic"]},z=e.Float=Number;z.__name__=["Float"];var Y=e.Bool=Boolean;Y.__ename__=["Bool"];var S=e.Class={__name__:["Class"]},X={},Z={};f.ARGB=new f(0,1,2,3,"ARGB"),f.RGBA=new f(3,0,1,2,"RGBA"),f.BGRA=new f(3,2,1,0,"BGRA");var P=i.ArrayBuffer||js_html_compat_ArrayBuffer;null==P.prototype.slice&&(P.prototype.slice=js_html_compat_ArrayBuffer.sliceImpl);var T,L=i.DataView||js_html_compat_DataView,I=i.Float32Array||js_html_compat_Float32Array._new,O=i.Uint8Array||js_html_compat_Uint8Array._new;altern_collisions_dbvt_DBVT.COLLIDER_SPHERE=new jeash_geom_Vector3D,util_geom_Vec3.ZERO=new util_geom_Vec3(0,0,0),util_geom_Vec3.X_AXIS=new util_geom_Vec3(1,0,0),util_geom_Vec3.Y_AXIS=new util_geom_Vec3(0,1,0),util_geom_Vec3.Z_AXIS=new util_geom_Vec3(0,0,1),util_geom_Vec3.RIGHT=new util_geom_Vec3(1,0,0),util_geom_Vec3.LEFT=new util_geom_Vec3(-1,0,0),util_geom_Vec3.FORWARD=new util_geom_Vec3(0,1,0),util_geom_Vec3.BACK=new util_geom_Vec3(0,-1,0),util_geom_Vec3.UP=new util_geom_Vec3(0,0,1),util_geom_Vec3.DOWN=new util_geom_Vec3(0,0,-1),altern_geom_ClipMacros.DUMMY_VECTOR=new util_geom_Vec3,altern_geom_ClipMacros.transformId=0,altern_geom_IntersectSlopeUtil.RESULT_NONE=0,altern_geom_IntersectSlopeUtil.RESULT_SLOPE=1,altern_geom_IntersectSlopeUtil.RESULT_WALL=-1,altern_geom_IntersectSlopeUtil.RESULT_COLLINEAR=-2,altern_geom_IntersectSlopeUtil.RESULT_COLLINEAR_VALID=2,altern_geom_IntersectSlopeUtil.RESULT_ERROR=-3,altern_partition_js_BVHTree.FLOAT_MAX=340282346638528e24,hxbit_Serializer.UID=0,hxbit_Serializer.SEQ=0,hxbit_Serializer.SEQ_BITS=8,hxbit_Serializer.SEQ_MASK=16777215,hxbit_Serializer.CLASSES=[],altern_terrain_HeightMapInfo.__clid=hxbit_Serializer.registerClass(altern_terrain_HeightMapInfo),altern_terrain_QuadChunkCornerData.BUFFER=[],altern_terrain_QuadChunkCornerData.BI=0,altern_terrain_QuadChunkCornerData.BLEN=0,altern_terrain_QuadChunkCornerData.__clid=hxbit_Serializer.registerClass(altern_terrain_QuadChunkCornerData),altern_terrain_QuadCornerData.BUFFER=[],altern_terrain_QuadCornerData.BI=0,altern_terrain_QuadCornerData.BLEN=0,altern_terrain_QuadSquareChunk.BlockUpdateCount=0,altern_terrain_QuadSquareChunk.DetailThreshold=100,altern_terrain_QuadSquareChunk.LOD_LVL_MIN=12,altern_terrain_QuadSquareChunk.STACK=((T=[]).length=32,T),altern_terrain_QuadSquareChunk.__clid=hxbit_Serializer.registerClass(altern_terrain_QuadSquareChunk),altern_terrain_QuadTreePage.LOG2E=1.4426950408889634,altern_terrain_QuadTreePage.__clid=hxbit_Serializer.registerClass(altern_terrain_QuadTreePage),altern_terrain_TerrainGeomTools.NORTH_EAST=0,altern_terrain_TerrainGeomTools.NORTH_WEST=1,altern_terrain_TerrainGeomTools.SOUTH_WEST=2,altern_terrain_TerrainGeomTools.SOUTH_EAST=3,altern_terrain_TerrainGeomTools.MASK_EAST=1,altern_terrain_TerrainGeomTools.MASK_NORTH=2,altern_terrain_TerrainGeomTools.MASK_WEST=4,altern_terrain_TerrainGeomTools.MASK_SOUTH=8,altern_terrain_TerrainLOD.PATCHES_ACROSS=32,altern_terrain_TerrainLOD.NUM_VERTICES=1089,altern_terrain_TerrainLOD.PATCHES_SHIFT=5,altern_terrain_TerrainLOD.VERTEX_INCLUDE_UVS=4,altern_terrain_TerrainLOD.UV_STEPWISE=0,altern_terrain_TerrainLOD.UV_NORMALIZED=-1,altern_terrain_TerrainLOD.CULL_NONE=0,altern_terrain_TerrainLOD.CULL_WATER=1,altern_terrain_TerrainLOD.CULL_FULL=2,altern_terrain_TerrainLOD.TRI_ORDER_TRUE=altern_terrain_TerrainLOD.createTriOrderIndiceTable(!0),altern_terrain_TerrainLOD.TRI_ORDER_FALSE=altern_terrain_TerrainLOD.createTriOrderIndiceTable(!1),altern_terrain_TerrainLOD.DIAG_NORM_ORDER_TRUE=new jeash_geom_Vector3D(-.7071067811865476,.7071067811865476,0),altern_terrain_TerrainLOD.DIAG_NORM_ORDER_FALSE=new jeash_geom_Vector3D(.7071067811865476,.7071067811865476,0),altern_terrain_TerrainLOD.QUAD_ORDER=altern_terrain_TerrainLOD.createQuadOrderIndiceTable(!1),altern_terrain_TerrainLOD.QUAD_ORDER2=altern_terrain_TerrainLOD.createQuadOrderIndiceTable(!0),altern_terrain_TerrainLOD.QUAD_OFFSETS=altern_terrain_TerrainLOD.createQuadOffsetTable(),altern_terrain_TerrainLOD.QD_STACK=[],components_CollisionResult.MAX_GROUND_NORMAL_THRESHOLD=.573576436351046,components_CollisionResult.FLAG_MAX_NORMAL_IMPULSE=1,components_CollisionResult.FLAG_MAX_GROUND_NORMAL=2,components_Jump.EPSILON=1e-5,components_controller_SurfaceMovement.WALK_FORWARD=1,components_controller_SurfaceMovement.WALK_STOP=0,components_controller_SurfaceMovement.WALK_BACK=-1,components_controller_SurfaceMovement.STRAFE_LEFT=-1,components_controller_SurfaceMovement.STRAFE_STOP=0,components_controller_SurfaceMovement.STRAFE_RIGHT=1,components_controller_SurfaceMovement.STOP_VELOCITY_SQ_LENGTH=1,haxe_ds_ObjectMap.count=0,haxe_io_FPHelper.i64tmp=new haxe__$Int64__$_$_$Int64(0,0),hxGeomAlgo_HomogCoord.INFINITY=new hxGeomAlgo_HomogCoord,hxGeomAlgo_PolyTools.point=l._new(),hxGeomAlgo_PolyTools.zero=l._new(0,0),hxGeomAlgo_PolyTools.EPSILON=1e-8,c.CHANNEL_MASK=3,hxPixels__$Pixels_PixelsData.BYTES_PER_PIXEL=4,x.MASK=[-16777216,16711680,65280,255],x.CH_0=0,x.CH_1=1,x.CH_2=2,x.CH_3=3,_.FLASH="flash",_.FORMAT="format",_.FLAMBE_FLASH="flambe flash",_.FLAMBE_WEB="flambe web",_.LUXE="luxe",_.OPENFL_JS="openfl js",_.OPENFL_DESKTOP="openfl desktop",_.OPENFL_FLASH="openfl flash",_.NME_DESKTOP="nme desktop",_.NME_FLASH="nme flash",_.JAVA="java",_.JS="js",_.UNKNOWN="unknown",g.BIG=0,g.LITTLE=1,g.names=["BIG_ENDIAN","LITTLE_ENDIAN"],hxbit_Macros.IN_ENUM_SER=!1,hxbit_Schema.__clid=hxbit_Serializer.registerClass(hxbit_Schema),js_Boot.__toStr={}.toString,js_html_compat_Float32Array.BYTES_PER_ELEMENT=4,js_html_compat_Uint8Array.BYTES_PER_ELEMENT=1,systems_collisions_CollisionEvent.GEOMTYPE_POINT=1,systems_collisions_CollisionEvent.GEOMTYPE_EDGE=2,systems_collisions_CollisionEvent.GEOMTYPE_POLYGON=3,systems_collisions_CollisionEvent.GEOMTYPE_THING=4,systems_collisions_CollisionEvent.TOLERANCE_POLYGON_OVERLAP=1e-5,systems_collisions_CollisionEvent.TOLERANCE_BACKWARDS_T=1e-6,systems_collisions_CollisionEvent.TOLERANCE_TRANSVERSE_DISPLACEMENT=1e-6,systems_collisions_CollisionEvent.TOLERANCE_QUADRATIC_DISCRIMINANT=1e-6,systems_collisions_CollisionEvent.COLLECTOR=new systems_collisions_CollisionEvent,systems_collisions_EllipsoidCollider.ZERO_VECTOR=new jeash_geom_Vector3D,util_geom_AABBUtils.MAX_VALUE=17976931348623157e292,util_geom_AABBUtils.THRESHOLD=.1,util_geom_AABBUtils.THRESHOLD_RAY=1e-6,util_geom_GeomCollisionSceneUtil.toRootTransform=new components_Transform3D,util_geom_GeomCollisionSceneUtil.fromRootTransform=new components_Transform3D,util_geom_Geometry.IDENTITY=new components_Transform3D,util_geom_Geometry.sampleRayPoint=new jeash_geom_Vector3D,util_geom_Mat3.IDENTITY=new util_geom_Mat3,util_geom_Mat3.ZERO=new util_geom_Mat3(0,0,0,0,0,0,0,0,0),util_geom_Mat4.IDENTITY=new util_geom_Mat4,util_geom_PMath.INT8_MIN=-128,util_geom_PMath.INT8_MAX=127,util_geom_PMath.UINT8_MAX=255,util_geom_PMath.INT16_MIN=-32768,util_geom_PMath.INT16_MAX=32767,util_geom_PMath.UINT16_MAX=65535,util_geom_PMath.INT32_MIN=-2147483648,util_geom_PMath.INT32_MAX=2147483647,util_geom_PMath.UINT32_MAX=-1,util_geom_PMath.NaN=NaN,util_geom_PMath.POSITIVE_INFINITY=1/0,util_geom_PMath.NEGATIVE_INFINITY=-1/0,util_geom_PMath.FLOAT_MAX=340282346638528e24,util_geom_PMath.FLOAT_MIN=-340282346638528e24,util_geom_PMath.DOUBLE_MIN=179769313486231e294,util_geom_PMath.DOUBLE_MAX=-179769313486231e294,util_geom_PMath.RAD_DEG=57.29577951308232,util_geom_PMath.DEG_RAD=.017453292519943295,util_geom_PMath.LOG2E=1.4426950408889634,util_geom_PMath.LN2=.6931471805599453,util_geom_PMath.PIHALF=1.5707963267948966,util_geom_PMath.PI=3.141592653589793,util_geom_PMath.PI2=6.283185307179586,util_geom_PMath.EPS=1e-6,n.main()}("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);var CloneMeshInstances=pc.createScript("cloneMeshInstances");CloneMeshInstances.prototype._duplicateNodeGraph=function(e){for(var n=e.clone(),t=0;t<e._children.length;t++)n.addChild(this._duplicateNodeGraph(e._children[t]));return n},CloneMeshInstances.prototype.cloneMeshInstance=function(e){var n=this._duplicateNodeGraph(e.node);e.node.parent&&e.node.parent.addChild(n);var t=new pc.MeshInstance(n,e.mesh,e.material);return t.cull=e.cull,t},CloneMeshInstances.prototype.initialize=function(){var e=this.entity.model.meshInstances[0];e.cull=!1;var n=this.cloneMeshInstance(e);this.entity.model.meshInstances.push(n),n.node.setPosition(0,0,2);var t,s=this.entity.model.layers;for(t=0;t<s.length;t++)this.app.scene.layers.getLayerById(s[t]).addMeshInstances([n])},CloneMeshInstances.prototype.update=function(e){};var DynamicBatchCountLimit=pc.createScript("dynamicBatchCountLimit");DynamicBatchCountLimit.prototype.emptyFunc=function(){},DynamicBatchCountLimit.prototype._duplicateNodeGraph=function(t){for(var e=t.clone(),n=0;n<t._children.length;n++)e.addChild(this._duplicateNodeGraph(t._children[n]));return e},DynamicBatchCountLimit.CLONE_COUNT=0,DynamicBatchCountLimit.prototype.cloneMeshInstance=function(t){var e=this._duplicateNodeGraph(t.node);t.node.parent&&t.node.parent.addChild(e),e.setPosition(0,0,1*++DynamicBatchCountLimit.CLONE_COUNT);var n=new pc.MeshInstance(e,t.mesh,t.material);return n.cull=t.cull,n},DynamicBatchCountLimit.prototype.setInstanceLen=function(t,e){t.instanceLen=e,t.meshInstance.mesh.primitive[0].count=t.pCount*e},DynamicBatchCountLimit.prototype.updateMatrixPaletteAt=function(t,e){var n,a=t.matrixPalette,i=t.bones[e].getWorldTransform().data;a[n=16*e]=i[0],a[n+1]=i[1],a[n+2]=i[2],a[n+3]=i[3],a[n+4]=i[4],a[n+5]=i[5],a[n+6]=i[6],a[n+7]=i[7],a[n+8]=i[8],a[n+9]=i[9],a[n+10]=i[10],a[n+11]=i[11],a[n+12]=i[12],a[n+13]=i[13],a[n+14]=i[14],a[n+15]=i[15]},DynamicBatchCountLimit.prototype.finaliseMatrixPalette=function(t){t.device.supportsBoneTextures&&(t.boneTexture.lock(),t.boneTexture.unlock())},DynamicBatchCountLimit.prototype.updateMatrixPalette=function(){for(var t,e,n=this.matrixPalette,a=this.instanceLen-1;a>=0;a--)t=this.bones[a].getWorldTransform().data,n[e=16*a]=t[0],n[e+1]=t[1],n[e+2]=t[2],n[e+3]=t[3],n[e+4]=t[4],n[e+5]=t[5],n[e+6]=t[6],n[e+7]=t[7],n[e+8]=t[8],n[e+9]=t[9],n[e+10]=t[10],n[e+11]=t[11],n[e+12]=t[12],n[e+13]=t[13],n[e+14]=t[14],n[e+15]=t[15];this.device.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())},DynamicBatchCountLimit.prototype.initialize=function(){var t=this.entity.model.meshInstances[0],e=pc.BatchManager.prototype.update;pc.BatchManager.prototype.update=this.emptyFunc;var n=this.app.batcher.create([t,this.cloneMeshInstance(t),this.cloneMeshInstance(t),this.cloneMeshInstance(t)],!0,Math.random());pc.BatchManager.prototype.update=e,this.app.batcher._batchList.splice(this.app.batcher._batchList.indexOf(n),1),n.pCount=t.mesh.primitive[0].count,n.updateMatrixPalette=this.updateMatrixPalette,n.meshInstance.cull=!1,this.setInstanceLen(n,3),this.entity.model.removeModelFromLayers(this.entity.model.model);var a,i=this.entity.model.layers;for(a=0;a<i.length;a++)this.app.scene.layers.getLayerById(i[a]).addMeshInstances([n.meshInstance]);this.batch=n},DynamicBatchCountLimit.prototype.update=function(t){};var DynamicClones=pc.createScript("dynamicClones");DynamicClones.attributes.add("bufferAmount",{type:"number",min:1,default:128}),DynamicClones.attributes.add("growAmount",{type:"number",min:1,default:128}),DynamicClones.attributes.add("lodDistance",{type:"number",min:0}),DynamicClones.prototype.emptyFunc=function(){},DynamicClones.prototype.emptyFuncTest=function(){console.log("emptFuncTest")},DynamicClones.prototype.setInstanceLen=function(t,e){t.instanceLen=e,t.meshInstance.mesh.primitive[0].count=t.pCount*e},DynamicClones.prototype.popInstanceLen=function(t){var e=t.instanceLen-1;t.instanceLen=e,t.meshInstance.mesh.primitive[0].count=t.pCount*e},DynamicClones.prototype.setPositionAtIndex=function(t,e,n,s){var a=Math.floor(t/this.maxBufferAmount);t-=a*this.maxBufferAmount;for(var i=this.batchReps[a],o=i.length,h=16*t;--o>-1;){var r=i[o],c=r.meshInstance.skinInstance.matrixPalette,u=r.worldTransform.data;c[h]=u[0],c[h+1]=u[1],c[h+2]=u[2],c[h+3]=u[3],c[h+4]=u[4],c[h+5]=u[5],c[h+6]=u[6],c[h+7]=u[7],c[h+8]=u[8],c[h+9]=u[9],c[h+10]=u[10],c[h+11]=u[11],c[h+12]=e+u[12],c[h+13]=n+u[13],c[h+14]=s+u[14],c[h+15]=u[15]}},DynamicClones.prototype.setTransformDataAtIndex=function(t,e){var n=Math.floor(t/this.maxBufferAmount);t-=n*this.maxBufferAmount;for(var s,a=this.batchReps[n],i=a.length,o=16*t,h=s.meshInstance.skinInstance.matrixPalette;--i>-1;)s=a[i],h[o]=e[0],h[o+1]=e[1],h[o+2]=e[2],h[o+3]=e[3],h[o+4]=e[4],h[o+5]=e[5],h[o+6]=e[6],h[o+7]=e[7],h[o+8]=e[8],h[o+9]=e[9],h[o+10]=e[10],h[o+11]=e[11],h[o+12]=e[12],h[o+13]=e[13],h[o+14]=e[14],h[o+15]=e[15]},DynamicClones.prototype.updateMatrixPaletteAtWithPos=function(t,e,n,s,a){var i,o=t.meshInstance.skinInstance.matrixPalette,h=t.worldTransform.data;o[i=16*e]=h[0],o[i+1]=h[1],o[i+2]=h[2],o[i+3]=h[3],o[i+4]=h[4],o[i+5]=h[5],o[i+6]=h[6],o[i+7]=h[7],o[i+8]=h[8],o[i+9]=h[9],o[i+10]=h[10],o[i+11]=h[11],o[i+12]=n+h[12],o[i+13]=s+h[13],o[i+14]=a+h[14],o[i+15]=h[15]},DynamicClones.prototype.finaliseMatrixPalette=function(t){t.boneTexture.lock(),t.boneTexture.unlock()},DynamicClones.prototype.finaliseAllMatrixPalettes=function(){for(var t,e=this.batchReps.length;--e>=0;)for(var n=(t=this.batchReps[e]).length;--n>-1;)this.finaliseMatrixPalette(t[n].meshInstance.skinInstance)},DynamicClones.prototype.updateMatrixPalette=function(){},DynamicClones.prototype.validateBufferAmt=function(t){var e,n,s=this.entity.model.meshInstances,a=this.app.graphicsDevice.supportsBoneTextures?1024:this.app.graphicsDevice.boneLimit,i=s.length,o=0,h=0;for(e=0;e<i;e++){var r=(n=s[e]).mesh.vertexBuffer.getNumVertices();h=r>h?r:h,o=n.mesh.primitive[0].count>o?n.mesh.primitive[0].count:o}var c=Math.floor(65535/h);return this.maxBufferAmount=Math.min(c,a),Math.min(t,this.maxBufferAmount)},DynamicClones.prototype.initialize=function(){this.maxBufferAmount=0,this.useBufferAmount=this.validateBufferAmt(this.bufferAmount),this.batchReps=[],this.entity.setPosition(0,0,0),this.growth=this.bufferAmount,this.entity.model.removeModelFromLayers(this.entity.model.model),this.createExactBatches(this.bufferAmount)},DynamicClones.prototype.postInitialize=function(){},DynamicClones.prototype.createExactBatches=function(t){var e;for(this.instanceIndices=new Int32Array(t);t>0;)e=t>=this.maxBufferAmount?this.maxBufferAmount:t,this.batchReps.push(this.createBatch(e)),t-=e},DynamicClones.prototype.createBatches=function(t){var e;for(e=this.batchReps.length;e<t;e++)this.batchReps.push(this.createBatch())},DynamicClones.prototype.grow=function(t){if(!(this.growth<this.useBufferAmount&&this.growth+t<=this.useBufferAmount)){this.growth+=t,this.growth<=this.maxBufferAmount?this.useBufferAmount=this.growth:this.useBufferAmount=this.maxBufferAmount;var e,n=this.instanceIndices;this.instanceIndices=new Int32Array(this.growth),this.instanceIndices.set(n,0);var s,a,getPallete=function(t){return t.meshInstance.skinInstance.matrixPalette.slice(0,e)},i=Math.ceil(this.growth/this.maxBufferAmount);for(s=this.batchReps.length-1;s<i;s++)this.batchReps[s]?this.batchReps[s][0].amountBuffered<this.useBufferAmount&&(e=16*this.batchReps[0][0].instanceLen,a=this.batchReps[s].map(getPallete),this.destroyBatch(this.batchReps[s]),this.batchReps[s]=this.createBatch(this.useBufferAmount,a,this.batchReps[s][0].instanceLen)):this.batchReps[s]=this.createBatch(this.useBufferAmount)}},DynamicClones.prototype.spawnCloneAt2=function(t,e,n,s,a){var i,o,h=t.length;for(i=0;i<h;i++)o=t[i],this.updateMatrixPaletteAtWithPos(o,e,0,0,0)},DynamicClones.prototype.destroyBatch=function(t){for(var e=t.length;--e>=0;)this.destroyMyBatch(t[e])},DynamicClones.prototype.destroyMyBatch=function(t){t.refCounter=0;for(var e=this.entity.model.layers,n=0;n<e.length;n++)this.app.scene.layers.getLayerById(e[n]).removeMeshInstances(t.model.meshInstances);t.model.destroy()},DynamicClones.prototype.createBatch=function(t,e,n){t=t||this.useBufferAmount,n||(n=0);var s,a,i,o=this.entity.model.meshInstances,h=o.length,r=[],c="#define BONE_LIMIT "+this.app.graphicsDevice.getBoneLimit()+"\n#define DYNAMICBATCH\n",u=[],m=[];for(s=0;s<h;s++){var p=o[s].material;for(m.length=0,a=o[s],i=0;i<t;i++)m.push(a);var f=pc.BatchManager.prototype.update;pc.BatchManager.prototype.update=this.emptyFunc,batch=this.app.batcher.create(m,!0,Math.random()),pc.BatchManager.prototype.update=f,this.app.batcher._batchList.splice(this.app.batcher._batchList.indexOf(batch),1),batch.pCount=a.mesh.primitive[0].count,batch.origMeshInstances.length=1,batch.worldTransform=a.node.getWorldTransform().clone(),batch.amountBuffered=t,batch.meshInstance.skinInstance.bones=null,batch.meshInstance.skinInstance.updateMatrixPalette=this.emptyFunc;var l=batch.meshInstance.material;l.chunks.transformVS=c+(p.chunks.transformVS?p.chunks.transformVS:pc.shaderChunks.transformVS),l.chunks.skinTexVS=p.chunks.skinBatchTexVS?p.chunks.skinBatchTexVS:pc.shaderChunks.skinBatchTexVS,l.chunks.skinConstVS=p.chunks.skinBatchConstVS?p.chunks.skinBatchConstVS:pc.shaderChunks.skinBatchConstVS,batch.meshInstance.cull=!1,this.setInstanceLen(batch,n),r.push(batch),u.push(batch.meshInstance),e&&e[s]&&batch.meshInstance.skinInstance.matrixPalette.set(e[s],0)}var y=this.entity.model.layers;for(s=0;s<y.length;s++)this.app.scene.layers.getLayerById(y[s]).addMeshInstances(u);return r},DynamicClones.prototype.clearBatchRep=function(t){for(var e,n=t.length,s=this.entity.model.layers;--n>=0;)for(e=0;e<s.length;e++)this.app.scene.layers.getLayerById(s[e]).removeMeshInstances(t[n].map((function(t){return t.meshInstance})))},DynamicClones.prototype.getPCBoundingBox=function(){var t,e=this.entity.model.meshInstances,n=new pc.BoundingBox,s=e.length;for(n.add(e[0].aabb),t=1;t<s;t++)n.add(e[t].aabb);return n};var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var t=this.entity.getLocalEulerAngles();this.ex=t.x,this.ex=pc.math.clamp(this.ex,-90,90),this.ey=t.y,this.moved=!1,this.lmbDown=!1,this.lastTouchPosition=new pc.Vec2,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this))},FlyCamera.prototype.update=function(t){this.entity.setLocalEulerAngles(this.ex,this.ey,0);var e=this.app,o=this.speed;e.keyboard.isPressed(pc.KEY_SHIFT)&&(o=this.fastSpeed),e.keyboard.isPressed(pc.KEY_UP)||e.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-o*t):(e.keyboard.isPressed(pc.KEY_DOWN)||e.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,o*t),e.keyboard.isPressed(pc.KEY_LEFT)||e.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-o*t,0,0):(e.keyboard.isPressed(pc.KEY_RIGHT)||e.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(o*t,0,0)},FlyCamera.prototype.rotateCamera=function(t,e){this.ex-=e/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=t/5},FlyCamera.prototype.onMouseMove=function(t){if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?this.rotateCamera(t.dx,t.dy):this.moved=!0},FlyCamera.prototype.onMouseDown=function(t){0===t.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(t){0===t.button&&(this.lmbDown=!1)},FlyCamera.prototype.onTouchStart=function(t){if(1==t.touches.length){this.lmbDown=!0;var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)}t.event.preventDefault()},FlyCamera.prototype.onTouchEnd=function(t){if(0===t.touches.length)this.lmbDown=!1;else if(1==t.touches.length){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)}},FlyCamera.prototype.onTouchMove=function(t){var e=t.touches[0];1==t.touches.length&&this.rotateCamera(e.x-this.lastTouchPosition.x,e.y-this.lastTouchPosition.y,this.touchLookSensitivity),this.lastTouchPosition.set(e.x,e.y)},FlyCamera.prototype.onTouchCancel=function(t){this.lmbDown=!1};var ImposterSetup=pc.createScript("imposterSetup");ImposterSetup.attributes.add("bottomLeftUVCrop",{type:"vec2",default:[0,0]}),ImposterSetup.attributes.add("topLeftUVCrop",{type:"vec2",default:[0,1]}),ImposterSetup.attributes.add("bottomRightUVCrop",{type:"vec2",default:[1,0]}),ImposterSetup.attributes.add("topRightUVCrop",{type:"vec2",default:[1,1]}),ImposterSetup.prototype.initialize=function(){var e=this.entity.children[0],t=e.model.meshInstances[0].material,n=t.chunks,o=e.getLocalTransform(),a=e.model.meshInstances[0].mesh,i=[this.bottomLeftUVCrop.x,this.bottomLeftUVCrop.y,this.topLeftUVCrop.x,this.topLeftUVCrop.y,this.bottomRightUVCrop.x,this.bottomRightUVCrop.y,this.topRightUVCrop.x,this.topRightUVCrop.y],r=[],m=[],s=[this.bottomLeftUVCrop,this.topLeftUVCrop,this.bottomRightUVCrop,this.topRightUVCrop];this.getTransformedGeometry(a,o,null,r,m,s);var p=pc.calculateNormals(r,m),l=pc.calculateTangents(r,p,i,m),c=new pc.GraphNode;a=pc.createMesh(this.app.graphicsDevice,r,{uvs:i,indices:m,tangents:l,normals:p});var d=new pc.MeshInstance(c,a,t),h=new pc.Model;h.graph=c,h.meshInstances.push(d),this.entity.addComponent("model"),this.entity.model.model=h,this.entity.model.layers=e.model.layers,this.entity.model.receiveShadows=e.model.receiveShadows,this.entity.model.isStatic=e.model.isStatic,this.entity.model.castShadows=e.model.castShadows,this.entity.model.castShadowsLightmap=e.model.castShadowsLightmap,this.entity.model.lightmapped=e.model.lightmapped,e.destroy(),n.normalMapFloatPS="\n            uniform sampler2D texture_normalMap;\n         uniform float material_bumpiness;\n         void getNormal() {\n            vec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n            vec3 myN = vec3(normalMap.x, normalMap.z, normalMap.y);\n            dNormalMap = myN;\n          \n            normalMap = normalize(mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness));\n           \n            dNormalW = normalMap;\n            //dNormalW = dTBN * normalMap;\n        }",n.transformVS="\n\nuniform mat4 matrix_viewInverse;\n\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n        mat4 mat = getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n        mat4 mat = matrix_model * (getBoneMatrix(vertex_boneIndices.x) * vertex_boneWeights.x +\n               getBoneMatrix(vertex_boneIndices.y) * vertex_boneWeights.y +\n               getBoneMatrix(vertex_boneIndices.z) * vertex_boneWeights.z +\n               getBoneMatrix(vertex_boneIndices.w) * vertex_boneWeights.w);\n    #elif defined(INSTANCING)\n        mat4 mat = mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n        mat4 mat = matrix_model;\n    #endif\n\n    //normalize(vec3(matrix_viewInverse[2].x, 0.0, matrix_viewInverse[2].z));   // viewalign method\n    // normalize(vec3(matrix_viewInverse[3].x, 0.0, matrix_viewInverse[3].z) - vec3(mat[3].x, 0.0, mat[3].z)); // look  method\n  vec3 azimuth =normalize(vec3(matrix_viewInverse[2].x, 0.0, matrix_viewInverse[2].z));\n\n\n mat[1].xyz = vec3(0.0, 1.0, 0.0); \n            mat[2].xyz = azimuth;\t // 2\n            mat[0].xyz = vec3(azimuth.z, 0.0, -azimuth.x);  //0\t\n\n            return mat;\n}\n\nvec4 getPosition() {\n\n    dModelMatrix = getModelMatrix();\n    vec4 posW = dModelMatrix * vec4(vertex_position, 1.0);\n    dPositionW = posW.xyz;\n    return matrix_viewProjection * posW;\n}\n\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n\n\n"},ImposterSetup.prototype.getTransformedGeometry=function(e,t,n,o,a,i){var r,m=t,s=0,p=0,l=e.indexBuffer[pc.RENDERSTYLE_SOLID],c=e.vertexBuffer,d=c.getFormat(),h=d.size/4;for(j=0;j<d.elements.length;j++){var v=d.elements[j];v.name===pc.SEMANTIC_POSITION?r=new Float32Array(c.lock(),v.offset):v.name===pc.SEMANTIC_TEXCOORD0&&new Float32Array(c.lock(),v.offset)}var x,y,u,f,g,I,M=new Uint16Array(l.lock()),_=e.primitive[0].count/3,w=e.primitive[0].base,S=new pc.Vec3;s=0;var b,z=[],C=[];for(C.length=4,z.length=4,j=0;j<r.length;j+=h)f=r[j],g=r[j+1],b=0,b|=f>=0?2:0,b|=(I=r[j+2])>=0?1:0,m&&(S.x=f,S.y=g,S.z=I,t.transformPoint(S,S),f=S.x,g=S.y,I=S.z),z[b]=new pc.Vec3(f,g,I),C[b]=s,n&&altern.AABBUtils.expand(f,g,I,n),o[s++]=f,o[s++]=g,o[s++]=I;var V=new pc.Vec2;for(V.x=z[2].x-z[0].x,V.y=z[1].y-z[0].y,j=0;j<4;j++)s=C[j],o[s++]=z[0].x+i[j].x*V.x,o[s++]=z[0].y+i[j].y*V.y;for(j=0;j<_;j++)x=M[w+3*j],y=M[w+3*j+1],u=M[w+3*j+2],a[p++]=x,a[p++]=y,a[p++]=u};var LodSetup=pc.createScript("lodSetup");LodSetup.attributes.add("bakeShadowLOD",{type:"number",min:0,default:1}),LodSetup.attributes.add("updateDistThreshold",{type:"number",min:0,default:1}),LodSetup.prototype.initialize=function(){this.activeCamera=this.app.root.findByName("Camera");var t,i,e=this.entity.children,n=[];this.lodChildren=[],this.lodDistances=n;var d=Number.MAX_VALUE;for(t=0;t<e.length;t++)(i=e[t]).enabled&&i.script&&i.script.dynamicClones&&i.script.dynamicClones.enabled&&i.script.dynamicClones.lodDistance<d&&(d=i.script.dynamicClones.lodDistance,this.lodChildren.push(i),n.push(d));if(this.lodChildrenScripts=this.lodChildren.map((function(t){return t.script.dynamicClones})),this.lodChildren.length){var o=Math.floor(this.bakeShadowLOD);o=o<this.lodChildren.length?o:this.lodChildren.length-1,this.shadowSampleEntity=this.lodChildren[o].clone(),this.shadowSampleEntity.script.enabled=!1,this.shadowSampleEntity.script.destroy("dynamicClones")}else this.shadowSampleEntity=new pc.Entity},LodSetup.prototype.getRefBoundingBox=function(){if(this.refBoundingBox)return this.refBoundingBox;var t=new pc.BoundingBox;for(i=0;i<this.lodChildren.length;i++)t.add(this.lodChildrenScripts[i].getPCBoundingBox());var e=t.getMin(),n=t.getMax(),d=new altern.BoundBox;return d.minX=e.x,d.minY=e.y,d.minZ=e.z,d.maxX=n.x,d.maxY=n.y,d.maxZ=n.z,this.refBoundingBox=d,d},LodSetup.prototype.update=function(){this.enabled=!1};var ProceduralMesh=pc.createScript("proceduralMesh");ProceduralMesh.attributes.add("bottomLeftUVCrop",{type:"vec2",default:[0,0]}),ProceduralMesh.attributes.add("topLeftUVCrop",{type:"vec2",default:[0,1]}),ProceduralMesh.attributes.add("bottomRightUVCrop",{type:"vec2",default:[1,0]}),ProceduralMesh.attributes.add("topRightUVCrop",{type:"vec2",default:[1,1]}),ProceduralMesh.prototype.initialize=function(){var t=new pc.StandardMaterial,e=(t.chunks,new pc.Mat4),o=pc.createPlane(this.app.graphicsDevice),r=[this.bottomLeftUVCrop.x,this.bottomLeftUVCrop.y,this.topLeftUVCrop.x,this.topLeftUVCrop.y,this.bottomRightUVCrop.x,this.bottomRightUVCrop.y,this.topRightUVCrop.x,this.topRightUVCrop.y],a=[],i=[],s=[this.bottomLeftUVCrop,this.topLeftUVCrop,this.bottomRightUVCrop,this.topRightUVCrop];this.getTransformedGeometry(o,e,null,a,i,s);var p=pc.calculateNormals(a,i),h=pc.calculateTangents(a,p,r,i),c=new pc.GraphNode;o=pc.createMesh(this.app.graphicsDevice,a,{uvs:r,indices:i,tangents:h,normals:p});var n=new pc.MeshInstance(c,o,t),l=new pc.Model;l.graph=c,l.meshInstances.push(n),this.entity.addComponent("model"),this.entity.model.model=l,this.entity.model.receiveShadows=!1,this.entity.model.isStatic=!0,this.entity.model.castShadows=!1,this.entity.model.castShadowsLightmap=!1,this.entity.model.lightmapped=!1},ProceduralMesh.prototype.getTransformedGeometry=function(t,e,o,r,a,i){var s,p=e,h=0,c=0,n=t.indexBuffer[pc.RENDERSTYLE_SOLID],l=t.vertexBuffer,d=l.getFormat(),m=d.size/4;for(j=0;j<d.elements.length;j++){var f=d.elements[j];f.name===pc.SEMANTIC_POSITION?s=new Float32Array(l.lock(),f.offset):f.name===pc.SEMANTIC_TEXCOORD0&&new Float32Array(l.lock(),f.offset)}var u,y,g,C,v,U,V=new Uint16Array(n.lock()),M=t.primitive[0].count/3,b=t.primitive[0].base,w=new pc.Vec3;h=0;for(j=0;j<s.length;j+=m)C=s[j],v=s[j+1],U=s[j+2],p&&(w.x=C,w.y=v,w.z=U,e.transformPoint(w,w),C=w.x,v=w.y,U=w.z),o&&altern.AABBUtils.expand(C,v,U,o),r[h++]=C,r[h++]=v,r[h++]=U;for(j=0;j<M;j++)u=V[b+3*j],y=V[b+3*j+1],g=V[b+3*j+2],a[c++]=u,a[c++]=y,a[c++]=g};var TestImposterShader=pc.createScript("testImposterShader");TestImposterShader.prototype.initialize=function(){this.entity.model.meshInstances[0].material.chunks.transformVS="\n\nuniform mat4 matrix_viewInverse;\n\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n        mat4 mat = getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n        mat4 mat = matrix_model * (getBoneMatrix(vertex_boneIndices.x) * vertex_boneWeights.x +\n               getBoneMatrix(vertex_boneIndices.y) * vertex_boneWeights.y +\n               getBoneMatrix(vertex_boneIndices.z) * vertex_boneWeights.z +\n               getBoneMatrix(vertex_boneIndices.w) * vertex_boneWeights.w);\n    #elif defined(INSTANCING)\n        mat4 mat = mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n        mat4 mat = matrix_model;\n    #endif\n\n\n  vec3 azimuth = normalize(vec3(matrix_viewInverse[2].x, 0.0, matrix_viewInverse[2].z));\n mat[2].xyz = vec3(0.0, 1.0, 0.0); \n            mat[1].xyz = -azimuth;\t // 2\n            mat[0].xyz = vec3(-azimuth.z, 0.0, azimuth.x);  //0\t\n\n            return mat;\n}\n\nvec4 getPosition() {\n\n    dModelMatrix = getModelMatrix();\n    vec4 posW = dModelMatrix * vec4(vertex_position, 1.0);\n    dPositionW = posW.xyz;\n    return matrix_viewProjection * posW;\n}\n\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n\n\n"};var TestHlod=pc.createScript("testHlod");TestHlod.attributes.add("lodSetupEntity",{type:"entity"}),TestHlod.prototype.initialize=function(){var e;this.lodSetupEntity&&(this.activeCamera=this.app.root.findByName("Camera"),this.frustum=e=new altern.CullingPlane,e=(e=(e=(e=(e=e.next=new altern.CullingPlane).next=new altern.CullingPlane).next=new altern.CullingPlane).next=new altern.CullingPlane).next=new altern.CullingPlane,this.culler=new altern.DefaultCulling,this.culler.frustum=this.frustum,this.lodSetup=this.lodSetupEntity.script.lodSetup,this.updateDistThreshold=this.lodSetup.updateDistThreshold,this.updateDistThreshold*=this.updateDistThreshold,this.lastPosition=new pc.Vec3(.5*Number.MAX_VALUE,.5*Number.MAX_VALUE,.5*Number.MAX_VALUE))},TestHlod.prototype.postInitialize=function(){this.lodSetupEntity&&setTimeout(this.setupTest.bind(this),300)},TestHlod.prototype.setupTest=function(){var e,t=[],n=this.app.root;this.testCount=4e3;var s=[];this.instances=new Float32Array(this.testCount<<2),this.instancesPrevIndices=new Int32Array(this.testCount);var a,i=this.lodSetup.getRefBoundingBox();for(this.testVec=new pc.Vec3,e=0;e<this.testCount;e++){var o=160*Math.random()-80,r=160*Math.random()-80;s.push(o),s.push(0),s.push(r),t.push(a=this.lodSetup.shadowSampleEntity.clone()),a.setPosition(o,0,r),n.addChild(a),this.instances[e<<2]=o,this.instances[1+(e<<2)]=0,this.instances[2+(e<<2)]=r,this.instances[3+(e<<2)]=-1}for(this.currentLayer=this.app.scene.layers.layerList[0],this.lodManager=new altern.LODBatchHierachy(this.culler,this.lodSetup.lodDistances),this.lodManager.minLODVertical=1,this.lodManager.createWithAABBAndPositions(i,s),this.app.root.findByName("Floor").model.lightmapped=!0,this.app.lightmapper.bake(),e=0;e<t.length;e++)t[e].destroy();this.currentLayer.onPreCull=this.preDraw.bind(this)},TestHlod.prototype.preDraw=function(){this.cameraPos=this.activeCamera.getPosition();var e=this.cameraPos.x-this.lastPosition.x,t=this.cameraPos.y-this.lastPosition.y,n=this.cameraPos.z-this.lastPosition.z,s=e*e+t*t+n*n>=this.updateDistThreshold;s&&(this.lastPosition.x=this.cameraPos.x,this.lastPosition.y=this.cameraPos.y,this.lastPosition.z=this.cameraPos.z),this.calculateFrustum(),this.lodManager.lodBatches.length<2&&(s=!1),s?this.lodManager.cullAndUpdateLOD(this.cameraPos):this.lodManager.cull(this.cameraPos),this.updateLODBatches(s)},TestHlod.prototype.updateLODBatches=function(e){var t,n,s,a,i,o,r,l,c,h,d,u,p=this.lodSetup.lodChildrenScripts;for(s=this.instances,n=this.lodManager.lodBatches.length;--n>=0;)if((d=p[n]).invalidated=!1,a=(t=this.lodManager.lodBatches[n]).addCount,i=t.removeCount,0!==a||0!==i){d.invalidated=!0;var m=t.instanceLen;for(m>d.growth&&d.grow(Math.ceil((m-d.growth)/d.growAmount)*d.growAmount),l=Math.floor(t.lastInstanceLen/d.maxBufferAmount),h=(c=d.batchReps[l])[0];--i>=0;){((o=s[3+(t.removeIndices[i]<<2)])<0||o>=t.lastInstanceLen)&&console.error("Invalid target index range:"+o+" ::"+t.lastInstanceLen+"vs "+s[3+(t.removeIndices[i]<<2)]+" loding?"+e);var f=l*d.maxBufferAmount+h.instanceLen-1;f!==o&&(r=d.instanceIndices[f]<<2,d.setPositionAtIndex(o,s[r],s[r+1],s[r+2]),s[3+((u=d.instanceIndices[f])<<2)]=o,d.instanceIndices[o]=u),h.instanceLen--,h.instanceLen<0&&(h.instanceLen=0,(h=(c=d.batchReps[--l])[0]).instanceLen=d.maxBufferAmount-1),s[3+(t.removeIndices[i]<<2)]=-1}}for(n=this.lodManager.lodBatches.length;--n>=0;){for(d=p[n],a=(t=this.lodManager.lodBatches[n]).addCount,l=Math.floor((t.lastInstanceLen-t.removeCount)/d.maxBufferAmount),(c=d.batchReps[l])||console.error("curBatchesIdx:"+l+" missing.."),h=c[0];--a>=0;)r=(u=t.addIndices[a])<<2,h.instanceLen>=d.maxBufferAmount&&((h=(c=d.batchReps[++l])[0]).instanceLen=0),o=l*d.maxBufferAmount+h.instanceLen++,-1!==s[r+3]&&console.error("Should push from non-indexed position."+s[r+3]),s[r+3]=o,d.setPositionAtIndex(o,s[r],s[r+1],s[r+2]),d.instanceIndices[o]=u;if(t.lastInstanceLen!==t.instanceLen)for(var g,x,v=d.batchReps.length;--v>=0;)for(g=(c=d.batchReps[v]).length;--g>=0;)x=c[0].instanceLen>=1,c[g].meshInstance.cull=!x,c[g].meshInstance.visible=x,d.setInstanceLen(c[g],c[0].instanceLen);d.invalidated&&d.app.graphicsDevice.supportsBoneTextures&&d.finaliseAllMatrixPalettes()}},TestHlod.prototype.updateLODBatches2=function(e){var t,n,s,a,i,o,r,l,c,h=this.lodSetup.lodChildrenScripts;for(s=this.instances,n=this.lodManager.lodBatches.length;--n>=0;)for(i=(t=this.lodManager.lodBatches[n]).removeCount;--i>=0;){if(s[r=3+((c=t.removeIndices[i])<<2)]<0)throw new Error("below zero index found! ::"+e);this.instancesPrevIndices[c]=s[r],s[r]=-1}for(n=this.lodManager.lodBatches.length;--n>=0;)if(l=h[n],!1,a=(t=this.lodManager.lodBatches[n]).addCount,i=t.removeCount,0!==a||0!==i){!0;var d=t.instanceLen;d>l.growth&&l.grow(Math.ceil((d-l.growth)/l.growAmount)*l.growAmount);for(var u=Math.floor(t.lastInstanceLen/l.maxBufferAmount),p=l.batchReps[u],m=p[0],f=!1;--i>=0;)if(((o=this.instancesPrevIndices[t.removeIndices[i]])<0||o>=t.lastInstanceLen)&&console.error("Invalid target index range:"+o+" ::"+t.lastInstanceLen+"vs "+s[3+(t.removeIndices[i]<<2)]),a>=1)-1!==s[(r=(c=t.addIndices[--a])<<2)+3]&&console.error("Should add into from non-indexed position."+s[r+3]),s[r+3]=o,l.setPositionAtIndex(o,s[r],s[r+1],s[r+2]),l.instanceIndices[o]=c;else{f=!0;var g=u*l.maxBufferAmount+m.instanceLen-1;g!==o&&(r=l.instanceIndices[g]<<2,l.setPositionAtIndex(o,s[r],s[r+1],s[r+2]),s[3+((c=l.instanceIndices[g])<<2)]=o,this.instancesPrevIndices[c]=o,l.instanceIndices[o]=c),m.instanceLen--,m.instanceLen<0&&(m.instanceLen=0,(m=(p=l.batchReps[--u])[0]).instanceLen=l.maxBufferAmount-1)}for(f&&a>=1&&console.error("SHULD NOT be...only pop only!"),u=Math.floor((t.lastInstanceLen-t.removeCount)/l.maxBufferAmount),m=(p=l.batchReps[u])[0];--a>=0;)r=(c=t.addIndices[a])<<2,m.instanceLen>=l.maxBufferAmount&&((m=(p=l.batchReps[++u])[0]).instanceLen=0),o=u*l.maxBufferAmount+m.instanceLen++,-1!==s[r+3]&&console.error("Should push from non-indexed position."+s[r+3]),s[r+3]=o,l.setPositionAtIndex(o,s[r],s[r+1],s[r+2]),l.instanceIndices[o]=c;if(t.lastInstanceLen!==t.instanceLen)for(var x,v=l.batchReps.length;--v>=0;)for(x=(p=l.batchReps[v]).length;--x>=0;)p[x].meshInstance.visible=p[0].instanceLen>=1,l.setInstanceLen(p[x],p[0].instanceLen);l.app.graphicsDevice.supportsBoneTextures&&l.finaliseAllMatrixPalettes()}},TestHlod.prototype.calculateFrustum=function(){var e,t,n=this.frustum,s=this.activeCamera.camera.frustum.planes,a=this.activeCamera.getPosition(),i=this.activeCamera.forward,o=this.activeCamera.camera.farClip,r=this.activeCamera.camera.nearClip;for(t=s[5],n.x=t[0],n.y=t[1],n.z=t[2],n.offset=n.x*(a.x+i.x*r)+n.y*(a.y+i.y*r)+n.z*(a.z+i.z*r),n=n.next,t=s[4],n.x=t[0],n.y=t[1],n.z=t[2],n.offset=n.x*(a.x+i.x*o)+n.y*(a.y+i.y*o)+n.z*(a.z+i.z*o),n=n.next,e=0;e<4;e++)t=s[e],n.x=t[0],n.y=t[1],n.z=t[2],n.offset=n.x*a.x+n.y*a.y+n.z*a.z,n=n.next};